================================================================================
[001] マスターサーバー構築
[002] クライアントコマンド - 01
[003] クライアントコマンド - 02
[004] クライアントコマンド - 03
[005] ゾーンファイルの記述省略
[006] アクセス制御リスト
[007] スレーブサーバー構築
[008] ゾーン転送の暗号化
[009] サーバー管理用の管理コマンドの使用設定
[010] 管理コマンド - 01
[011] 管理コマンド - 02
[012] 管理コマンド - 03
[013] 管理コマンド - 04
[014] 管理コマンド - 05
[015] キャッシュサーバー構築
[016] クライアントコマンド - 04
[017] クライアントコマンド - 05
[018] クライアントコマンド - 06
[019] 管理コマンド - 06
[020] 管理コマンド - 07
[021] ラウンドロビン
[022] ソフトウェア停止
[X01] PowerDNS - 01
================================================================================
[001]
  マスターサーバー構築
  
[内容]
  ## 作業内容
    マスターサーバー構築
  
[確認]
  $ cd $HOME
  $ cat /etc/resolve.conf
  
  コマンドの実行結果
  --------------------------------------------------
  # Generated by NetworkManager
  search flets-east.jp iptvf.jp
  nameserver 192.168.1.1
  nameserver 2400:4052:20c0:bc00:1eb1:7fff:fe43:f0da
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=soa avswa.com 192.168.1.1
  
  コマンドの実行結果
  --------------------------------------------------
  Server: 192.168.1.1
  Address: 192.168.1.1#53
  
  server can't find avswa.com: NXDOMAIN  // インターネット上に「avswa.com」のドメインは存在しないと判明
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t soa avswa.com 192.168.1.1
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: 192.168.1.1
  Address: 192.168.1.1#53
  Aliases: 
  
  Host avswa.com not found: 3(NXDOMAIN)  // インターネット上に「avswa.com」のドメインは存在しないと判明
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @192.168.1.1 avswa.com soa
  
  コマンドの実行結果
  --------------------------------------------------
  ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> avswa.com soa
  ;; global options: +cmd
  ;; Got answer:
  ;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 42104
  ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1
  
  ;; OPT PSEUDOSECTION:
  ; EDNS: version: 0, flags:; udp: 512

  ;; QUESTION SECTION:
  ;avswa.com. IN SOA
  
  // インターネット上に「avswa.com」のドメインは存在しないと判明
  
  ;; AUTHORITY SECTION:
  com. 900 IN SOA a.gtld-servers.net. nstld.verisign-grs.com. 1686795543 1800 900 604800 86400
  
  ;; Query time: 29 msec
  ;; SERVER: 192.168.1.1#53(192.168.1.1)
  ;; WHEN: 木  6月 15 11:24:31 JST 2023
  ;; MSG SIZE  rcvd: 111
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 12 19:25:50 2023
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo firewall-cmd --list-all
    
    コマンドの実行結果
    --------------------------------------------------
    public
      target: default
      icmp-block-inversion: no
      interfaces: 
      sources: 
      services: cockpit dhcpv6-client dns iscsi-target ssh  // dns を確認
      ports: 12865/tcp 12866/tcp
      protocols: 
      forward: no
      masquerade: no
      forward-ports: 
      source-ports: 
      icmp-blocks: 
      rich rules: 
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo bash /usr/libexec/setup-named-chroot.sh /var/named/chroot on
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> スクリプトでchroot有効化
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cp -p /var/named/chroot/etc/named.conf /var/named/chroot/etc/named.conf.org
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 設定ファイルをバックアップ
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイル修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 詳細オプション
    options
    {
      directory "/var/named";       # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };       # Not Use IPv6
      recursion no;                 # Contents Server = no, Cache Server = yes
      version "unknown";            # Display Version
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type master;                  # File Type
      file "avswa.com.zone";        # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type master;                  # File Type
      file "rev.avswa.com.zone";    # File Name
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/avswa.com.zone -> 正引きファイル
    
    コマンドの実行結果
    --------------------------------------------------
    $ORIGIN avswa.com.
    $TTL 1D
    avswa.com. IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061201  ; serial
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
    avswa.com.       IN  NS     vm11.avswa.com.  ; Master
    vm11.avswa.com.  IN  A      192.168.122.11   ; Host1
    vm12.avswa.com.  IN  A      192.168.122.12   ; Host2
    vm13.avswa.com.  IN  A      192.168.122.13   ; Host3
    www1.avswa.com.  IN  CNAME  vm11.avswa.com.  ; Web Site1
    www2.avswa.com.  IN  CNAME  vm11.avswa.com.  ; Web Site2
    mail.avswa.com.  IN  MX 10  vm11.avswa.com.  ; Mail Server
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot avswa.com /var/named/avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061201
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/rev.avswa.com.zone -> 逆引きファイル
    
    コマンドの実行結果
    --------------------------------------------------
    $ORIGIN avswa.com.
    $TTL 1D
    122.168.192.in-addr.arpa. IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061201  ; serial
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
    122.168.192.in-addr.arpa.     IN  NS   vm11.example.com.
    11.122.168.192.in-addr.arpa.  IN  PTR  vm11.example.com.
    12.122.168.192.in-addr.arpa.  IN  PTR  vm12.example.com.
    13.122.168.192.in-addr.arpa.  IN  PTR  vm13.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot 122.168.192.in-addr.arpa /var/named/rev.avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061201
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl is-enabled named
    
    コマンドの実行結果
    --------------------------------------------------
    disabled
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl is-active named
    
    コマンドの実行結果
    --------------------------------------------------
    inactive
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl is-enabled named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    disabled
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl is-active named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    inactive
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl enable named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    Created symlink /etc/systemd/system/multi-user.target.wants/named-chroot.service → /usr/lib/systemd/system/named-chroot.service.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl start named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[002]
  クライアントコマンド - 01
  
[内容]
  ## 作業内容
    コマンド(nslookup)でコンテンツサーバーに名前解決を依頼
  
  ## コマンド(nslookup)
    nslookup -type=XX   : レコードタイプ(XX)を指定
    nslookup -norecurse : 再帰問合せをしない
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 12 19:38:20 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /etc/resolve.conf
    
    コマンドの実行結果
    --------------------------------------------------
    nameserver 192.168.122.1  // クライアントコマンドはコンテンツサーバーを参照しない
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ nslookup
    
    コマンドの実行結果
    --------------------------------------------------
    (プロンプト変化)
    --------------------------------------------------
      
      > サーバー指定
      > server localhost
      
      コマンドの実行結果
      --------------------------------------------------
      Default server: localhost
      Address: 127.0.0.1#53
      --------------------------------------------------
      
      > 名前解決(正引き)
      > vm11.avswa.com
      
      コマンドの実行結果
      --------------------------------------------------
      Server: localhost
      Address: 127.0.0.1#53
      
      Name: vm11.avswa.com
      Address: 192.168.122.11
      --------------------------------------------------
      
      > 名前解決(逆引き)
      > 192.168.122.11
      
      コマンドの実行結果
      --------------------------------------------------
      11.122.168.192.in-addr.arpa  name = vm11.example.com.
      --------------------------------------------------
      
      > 対話モード終了
      > exit
      
      コマンドの実行結果
      --------------------------------------------------
      (プロンプト変化)
      --------------------------------------------------
      
    vm11$ cd $HOME
    vm11$ nslookup -type=soa avswa.com localhost -> 参照サーバーにコンテンツサーバーを指定
    
    コマンドの実行結果
    --------------------------------------------------
    Server: localhost
    Address: 127.0.0.1#53
    
    avswa.com
      origin = vm11.avswa.com
      mail addr = makoto.avswa.com
      serial = 2023061201
      refresh = 300
      retry = 300
      expire = 86400
      minimum = 86400
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ nslookup -type=ns avswa.com localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Server: localhost
    Address: 127.0.0.1#53
    
    avswa.com nameserver = vm11.avswa.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ nslookup -type=a vm11.avswa.com localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Server: localhost
    Address: 127.0.0.1#53
    
    Name: vm11.avswa.com
    Address: 192.168.122.11
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ nslookup -type=a www1.avswa.com localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Server: localhost
    Address: 127.0.0.1#53
    
    www1.avswa.com canonical name = vm11.avswa.com.
    Name: vm11.avswa.com
    Address: 192.168.122.11
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ nslookup -type=ptr 192.168.122.11 localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Server: localhost
    Address: 127.0.0.1#53
    
    11.122.168.192.in-addr.arpa name = vm11.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ nslookup -type=mx mail.avswa.com localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Server: localhost
    Address: 127.0.0.1#53
    
    mail.avswa.com mail exchanger = 10 vm11.avswa.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ nslookup -type=soa avswa.com vm11 -> ホスト側からもコンテンツサーバーに問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm11
  Address: 192.168.122.11#53
  
  avswa.com
    origin = vm11.avswa.com
    mail addr = makoto.avswa.com
    serial = 2023061201
    refresh = 300
    retry = 300
    expire = 86400
    minimum = 86400
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=ns avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm11
  Address: 192.168.122.11#53
  
  avswa.com nameserver = vm11.avswa.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=a vm11.avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm11
  Address: 192.168.122.11#53
  
  Name: vm11.avswa.com
  Address: 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=a www1.avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm11
  Address: 192.168.122.11#53
  
  www1.avswa.com canonical name = vm11.avswa.com.
  Name: vm11.avswa.com
  Address: 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=ptr 192.168.122.11 vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm11
  Address: 192.168.122.11#53
  
  11.122.168.192.in-addr.arpa name = vm11.example.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=mx mail.avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm11
  Address: 192.168.122.11#53
  
  mail.avswa.com mail exchanger = 10 vm11.avswa.com.
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[003]
  クライアントコマンド - 02
  
[内容]
  ## 作業内容
    コマンド(host)でコンテンツサーバーに名前解決を依頼
  
  ## コマンド(host)
    host -t XX  : レコードタイプ(XX)を指定
    host -v     : 詳細情報を表示
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 12 21:06:01 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /etc/resolve.conf
    
    コマンドの実行結果
    --------------------------------------------------
    nameserver 192.168.122.1  // クライアントコマンドはコンテンツサーバーを参照しない
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ host -t soa avswa.com localhost -> 参照サーバーにコンテンツサーバーを指定
    
    コマンドの実行結果
    --------------------------------------------------
    Using domain server:
    Name: localhost
    Address: 127.0.0.1#53
    Aliases: 
    
    avswa.com has SOA record vm11.avswa.com. makoto.avswa.com. 2023061201 300 300 86400 86400
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ host -t ns avswa.com localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Using domain server:
    Name: localhost
    Address: 127.0.0.1#53
    Aliases: 
    
    avswa.com name server vm11.avswa.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ host -t a vm11.avswa.com localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Using domain server:
    Name: localhost
    Address: 127.0.0.1#53
    Aliases: 
    
    vm11.avswa.com has address 192.168.122.11
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ host -t a www1.avswa.com localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Using domain server:
    Name: localhost
    Address: 127.0.0.1#53
    Aliases: 
    
    www1.avswa.com is an alias for vm11.avswa.com.
    vm11.avswa.com has address 192.168.122.11
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ host -t ptr 192.168.122.11 localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Using domain server:
    Name: localhost
    Address: 127.0.0.1#53
    Aliases: 
    
    11.122.168.192.in-addr.arpa domain name pointer vm11.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ host -t mx mail.avswa.com localhost
    
    コマンドの実行結果
    --------------------------------------------------
    Using domain server:
    Name: localhost
    Address: 127.0.0.1#53
    Aliases: 
    
    mail.avswa.com mail is handled by 10 vm11.avswa.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ host -t soa avswa.com vm11 -> ホスト側からもコンテンツサーバーに問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm11
  Address: 192.168.122.11#53
  Aliases: 
  
  avswa.com has SOA record vm11.avswa.com. makoto.avswa.com. 2023061201 300 300 86400 86400
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t ns avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm11
  Address: 192.168.122.11#53
  Aliases: 
  
  avswa.com name server vm11.avswa.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t a vm11.avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm11
  Address: 192.168.122.11#53
  Aliases: 
  
  vm11.avswa.com has address 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t a www1.avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm11
  Address: 192.168.122.11#53
  Aliases: 
  
  www1.avswa.com is an alias for vm11.avswa.com.
  vm11.avswa.com has address 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t ptr 192.168.122.11 vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm11
  Address: 192.168.122.11#53
  Aliases: 
  
  11.122.168.192.in-addr.arpa domain name pointer vm11.example.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t mx mail.avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm11
  Address: 192.168.122.11#53
  Aliases: 
  
  mail.avswa.com mail is handled by 10 vm11.avswa.com.
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[004]
  クライアントコマンド - 03
  
[内容]
  ## 作業内容
    コマンド(host)でコンテンツサーバーに名前解決を依頼
  
  ## コマンド(dig)
    dig -x           : 逆引き名前解決を行う
    dig -p XX        : 問合先ポート(XX)を指定
    dig +norec       : 再帰問合せをしない
    dig +rec         : 再帰問合せをする
    dig +noall       : 全セクション非表示
    dig +all         : 全セクション表示
    dig +noquestion  : 質問セクション非表示
    dig +question    : 質問セクション表示
    dig +noanswer    : 回答セクション非表示
    dig +answer      : 回答セクション表示
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 12 22:12:43 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /etc/resolve.conf
    
    コマンドの実行結果
    --------------------------------------------------
    nameserver 192.168.122.1  // クライアントコマンドはコンテンツサーバーを参照しない
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost avswa.com soa -> 参照サーバーにコンテンツサーバーを指定
    
    コマンドの実行結果
    --------------------------------------------------
    ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @localhost avswa.com soa
    ; (2 servers found)
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 24785
    ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 2
    ;; WARNING: recursion requested but not available
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 1232
    ; COOKIE: a0f07c9969fc9af1f4bb609b648725423267c1da2fad2699 (good)

    ;; QUESTION SECTION:
    ;avswa.com. IN SOA
    
    ;; ANSWER SECTION:
    avswa.com. 86400 IN SOA vm11.avswa.com. makoto.avswa.com. 2023061201 300 300 86400 86400
    
    ;; AUTHORITY SECTION:
    avswa.com. 86400 IN NS vm11.avswa.com.
    
    ;; ADDITIONAL SECTION:
    vm11.avswa.com. 86400 IN A 192.168.122.11
    
    ;; Query time: 0 msec
    ;; SERVER: 127.0.0.1#53(127.0.0.1)
    ;; WHEN: 月  6月 12 23:01:38 JST 2023
    ;; MSG SIZE  rcvd: 144
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost avswa.com ns
    
    コマンドの実行結果
    --------------------------------------------------
    ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @localhost avswa.com ns
    ; (2 servers found)
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 53272
    ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2
    ;; WARNING: recursion requested but not available
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 1232
    ; COOKIE: eeeec54a8592a7527f9f4907648726ee8efa77dd2c99eaef (good)
    
    ;; QUESTION SECTION:
    ;avswa.com. IN NS
    
    ;; ANSWER SECTION:
    avswa.com. 86400 IN NS vm11.avswa.com.
    
    ;; ADDITIONAL SECTION:
    vm11.avswa.com. 86400 IN A 192.168.122.11
    
    ;; Query time: 0 msec
    ;; SERVER: 127.0.0.1#53(127.0.0.1)
    ;; WHEN: 月  6月 12 23:08:46 JST 2023
    ;; MSG SIZE  rcvd: 101
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost vm11.avswa.com a
    
    コマンドの実行結果
    --------------------------------------------------
    ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @localhost vm11.avswa.com a
    ; (2 servers found)
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 16294
    ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1
    ;; WARNING: recursion requested but not available
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 1232
    ; COOKIE: 96e03e441cfe7ceb4f3bd8ad648727e20f5cd5e28ad7935c (good)
    
    ;; QUESTION SECTION:
    ;vm11.avswa.com. IN A
    
    ;; ANSWER SECTION:
    vm11.avswa.com. 86400 IN A 192.168.122.11
    
    ;; AUTHORITY SECTION:
    avswa.com. 86400 IN NS vm11.avswa.com.
    
    ;; Query time: 0 msec
    ;; SERVER: 127.0.0.1#53(127.0.0.1)
    ;; WHEN: 月  6月 12 23:12:50 JST 2023
    ;; MSG SIZE  rcvd: 101
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost www1.avswa.com a
    
    コマンドの実行結果
    --------------------------------------------------
    ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @localhost www1.avswa.com a
    ; (2 servers found)
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 26508
    ;; flags: qr aa rd; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 1
    ;; WARNING: recursion requested but not available
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 1232
    ; COOKIE: a01a928ecb347656fe4bdf1c64872909b0e97340dc3558ee (good)
    
    ;; QUESTION SECTION:
    ;www1.avswa.com. IN A
    
    ;; ANSWER SECTION:
    www1.avswa.com. 86400 IN CNAME vm11.avswa.com.
    vm11.avswa.com. 86400 IN A 192.168.122.11
    
    ;; AUTHORITY SECTION:
    avswa.com. 86400 IN NS vm11.avswa.com.
    
    ;; Query time: 0 msec
    ;; SERVER: 127.0.0.1#53(127.0.0.1)
    ;; WHEN: 月  6月 12 23:17:45 JST 2023
    ;; MSG SIZE  rcvd: 120
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost -x 192.168.122.11 ptr
    
    コマンドの実行結果
    --------------------------------------------------
    ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @localhost -x 192.168.122.11 ptr
    ; (2 servers found)
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 63088
    ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1
    ;; WARNING: recursion requested but not available
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 1232
    ; COOKIE: efa2afdb7ce93c743de5884b64872b3b6d90fc5cf382454f (good)
    
    ;; QUESTION SECTION:
    ;11.122.168.192.in-addr.arpa. IN PTR
    
    ;; ANSWER SECTION:
    11.122.168.192.in-addr.arpa. 86400 IN PTR vm11.example.com.
    
    ;; AUTHORITY SECTION:
    122.168.192.in-addr.arpa. 86400 IN NS vm11.example.com.
    
    ;; Query time: 0 msec
    ;; SERVER: 127.0.0.1#53(127.0.0.1)
    ;; WHEN: 月  6月 12 23:27:07 JST 2023
    ;; MSG SIZE  rcvd: 128
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost mail.avswa.com mx
    
    コマンドの実行結果
    --------------------------------------------------
    ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @localhost mail.avswa.com mx
    ; (2 servers found)
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 21985
    ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 2
    ;; WARNING: recursion requested but not available
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 1232
    ; COOKIE: 50a05bb927fdf6b21d8856cb64872c36f44574d2a6334fa4 (good)
    
    ;; QUESTION SECTION:
    ;mail.avswa.com. IN MX
    
    ;; ANSWER SECTION:
    mail.avswa.com. 86400 IN MX 10 vm11.avswa.com.
    
    ;; AUTHORITY SECTION:
    avswa.com. 86400 IN NS vm11.avswa.com.
    
    ;; ADDITIONAL SECTION:
    vm11.avswa.com. 86400 IN A 192.168.122.11
    
    ;; Query time: 0 msec
    ;; SERVER: 127.0.0.1#53(127.0.0.1)
    ;; WHEN: 月  6月 12 23:31:18 JST 2023
    ;; MSG SIZE  rcvd: 122
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost +noall +answer www1.avswa.com a
    
    コマンドの実行結果
    --------------------------------------------------
    www1.avswa.com. 86400 IN CNAME vm11.avswa.com.
    vm11.avswa.com. 86400 IN A 192.168.122.11
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost +noall +answer -x 192.168.122.11 ptr
    
    コマンドの実行結果
    --------------------------------------------------
    11.122.168.192.in-addr.arpa. 86400 IN PTR vm11.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ dig @vm11 avswa.com soa -> ホスト側からもコンテンツサーバーに問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @vm11 avswa.com soa
  ; (1 server found)
  ;; global options: +cmd
  ;; Got answer:
  ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 23408
  ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 2
  ;; WARNING: recursion requested but not available
  
  ;; OPT PSEUDOSECTION:
  ; EDNS: version: 0, flags:; udp: 1232
  ; COOKIE: 2aa3fc3066dc512ac476a62b648738e9931f5a5cf19823ec (good)
  
  ;; QUESTION SECTION:
  ;avswa.com. IN SOA
  
  ;; ANSWER SECTION:
  avswa.com. 86400 IN SOA vm11.avswa.com. makoto.avswa.com. 2023061201 300 300 86400 86400
  
  ;; AUTHORITY SECTION:
  avswa.com. 86400 IN NS vm11.avswa.com.
  
  ;; ADDITIONAL SECTION:
  vm11.avswa.com. 86400 IN A 192.168.122.11
  
  ;; Query time: 2 msec
  ;; SERVER: 192.168.122.11#53(192.168.122.11)
  ;; WHEN: 火  6月 13 00:25:28 JST 2023
  ;; MSG SIZE  rcvd: 144
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm11 avswa.com ns
  
  コマンドの実行結果
  --------------------------------------------------
  ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @vm11 avswa.com ns
  ; (1 server found)
  ;; global options: +cmd
  ;; Got answer:
  ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 53818
  ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2
  ;; WARNING: recursion requested but not available
  
  ;; OPT PSEUDOSECTION:
  ; EDNS: version: 0, flags:; udp: 1232
  ; COOKIE: b7ee7dfcc2e4406f1ded27c164873ab2cc857467f7f2fed9 (good)
  
  ;; QUESTION SECTION:
  ;avswa.com. IN NS
  
  ;; ANSWER SECTION:
  avswa.com. 86400 IN NS vm11.avswa.com.
  
  ;; ADDITIONAL SECTION:
  vm11.avswa.com. 86400 IN A 192.168.122.11
  
  ;; Query time: 7 msec
  ;; SERVER: 192.168.122.11#53(192.168.122.11)
  ;; WHEN: 火  6月 13 00:33:06 JST 2023
  ;; MSG SIZE  rcvd: 101
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm11 vm11.avswa.com a
  
  コマンドの実行結果
  --------------------------------------------------
  ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @vm11 vm11.avswa.com a
  ; (1 server found)
  ;; global options: +cmd
  ;; Got answer:
  ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 61498
  ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1
  ;; WARNING: recursion requested but not available
  
  ;; OPT PSEUDOSECTION:
  ; EDNS: version: 0, flags:; udp: 1232
  ; COOKIE: add50a10150c3afe2d14704364873b27c1f11eb5aa81812e (good)
  
  ;; QUESTION SECTION:
  ;vm11.avswa.com. IN A
  
  ;; ANSWER SECTION:
  vm11.avswa.com. 86400 IN A 192.168.122.11
  
  ;; AUTHORITY SECTION:
  avswa.com. 86400 IN NS vm11.avswa.com.
  
  ;; Query time: 0 msec
  ;; SERVER: 192.168.122.11#53(192.168.122.11)
  ;; WHEN: 火  6月 13 00:35:03 JST 2023
  ;; MSG SIZE  rcvd: 101
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm11 www1.avswa.com a
  
  コマンドの実行結果
  --------------------------------------------------
  ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @vm11 www1.avswa.com a
  ; (1 server found)
  ;; global options: +cmd
  ;; Got answer:
  ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 18591
  ;; flags: qr aa rd; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 1
  ;; WARNING: recursion requested but not available
  
  ;; OPT PSEUDOSECTION:
  ; EDNS: version: 0, flags:; udp: 1232
  ; COOKIE: 5704a446246cd10268adab1f64873e13c3e93631fd670271 (good)
  
  ;; QUESTION SECTION:
  ;www1.avswa.com. IN A
  
  ;; ANSWER SECTION:
  www1.avswa.com. 86400 IN CNAME vm11.avswa.com.
  vm11.avswa.com. 86400 IN A 192.168.122.11
  
  ;; AUTHORITY SECTION:
  avswa.com. 86400 IN NS vm11.avswa.com.
  
  ;; Query time: 10 msec
  ;; SERVER: 192.168.122.11#53(192.168.122.11)
  ;; WHEN: 火  6月 13 00:47:31 JST 2023
  ;; MSG SIZE  rcvd: 120
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm11 -x 192.168.122.11 ptr
  
  コマンドの実行結果
  --------------------------------------------------
  ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @vm11 -x 192.168.122.11 ptr
  ; (1 server found)
  ;; global options: +cmd
  ;; Got answer:
  ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 29669
  ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1
  ;; WARNING: recursion requested but not available
  
  ;; OPT PSEUDOSECTION:
  ; EDNS: version: 0, flags:; udp: 1232
  ; COOKIE: b1ad880aa27a7b13c1128c3164873ee9c0edd0505b921363 (good)
  
  ;; QUESTION SECTION:
  ;11.122.168.192.in-addr.arpa. IN PTR
  
  ;; ANSWER SECTION:
  11.122.168.192.in-addr.arpa. 86400 IN PTR vm11.example.com.
  
  ;; AUTHORITY SECTION:
  122.168.192.in-addr.arpa. 86400 IN NS vm11.example.com.
  
  ;; Query time: 0 msec
  ;; SERVER: 192.168.122.11#53(192.168.122.11)
  ;; WHEN: 火  6月 13 00:51:05 JST 2023
  ;; MSG SIZE  rcvd: 128
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm11 mail.avswa.com mx
  
  コマンドの実行結果
  --------------------------------------------------
  ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @vm11 mail.avswa.com mx
  ; (1 server found)
  ;; global options: +cmd
  ;; Got answer:
  ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 42816
  ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 2
  ;; WARNING: recursion requested but not available
  
  ;; OPT PSEUDOSECTION:
  ; EDNS: version: 0, flags:; udp: 1232
  ; COOKIE: c9bf3ee3fee19ce1ef33c66f64873fda3dc3c0f8d78323e5 (good)
  
  ;; QUESTION SECTION:
  ;mail.avswa.com. IN MX
  
  ;; ANSWER SECTION:
  mail.avswa.com. 86400 IN MX 10 vm11.avswa.com.
  
  ;; AUTHORITY SECTION:
  avswa.com. 86400 IN NS vm11.avswa.com.
  
  ;; ADDITIONAL SECTION:
  vm11.avswa.com. 86400 IN A 192.168.122.11
  
  ;; Query time: 1 msec
  ;; SERVER: 192.168.122.11#53(192.168.122.11)
  ;; WHEN: 火  6月 13 00:55:06 JST 2023
  ;; MSG SIZE  rcvd: 122
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm11 +noall +answer www1.avswa.com a
  
  コマンドの実行結果
  --------------------------------------------------
  www1.avswa.com. 86400 IN CNAME vm11.avswa.com.
  vm11.avswa.com. 86400 IN A 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm11 +noall +answer -x 192.168.122.11 ptr
  
  コマンドの実行結果
  --------------------------------------------------
  11.122.168.192.in-addr.arpa. 86400 IN PTR vm11.example.com.
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[005]
  ゾーンファイルの記述省略
  
[内容]
  ## 作業内容
    ゾーンファイルの記述省略
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 12 23:00:33 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /var/named/chroot/var/named/avswa.com.zone -> 正引きファイル
    
    コマンドの実行結果
    --------------------------------------------------
    $ORIGIN avswa.com.
    $TTL 1D
    avswa.com. IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061201  ; serial
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
    avswa.com.       IN  NS     vm11.avswa.com.  ; Master
    vm11.avswa.com.  IN  A      192.168.122.11   ; Host1
    vm12.avswa.com.  IN  A      192.168.122.12   ; Host2
    vm13.avswa.com.  IN  A      192.168.122.13   ; Host3
    www1.avswa.com.  IN  CNAME  vm11.avswa.com.  ; Web Site1
    www2.avswa.com.  IN  CNAME  vm11.avswa.com.  ; Web Site2
    mail.avswa.com.  IN  MX 10  vm11.avswa.com.  ; Mail Server
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/avswa.com.zone -> 正引きファイルの記述省略
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11 makoto (
      2023061301  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                     IN  NS     vm11             ; Master
    vm11             IN  A      192.168.122.11   ; Host1
    vm12             IN  A      192.168.122.12   ; Host2
    vm13             IN  A      192.168.122.13   ; Host3
    www1             IN  CNAME  vm11             ; Web Site1
    www2             IN  CNAME  vm11             ; Web Site2
    mail             IN  MX 10  vm11             ; Mail Server
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot avswa.com /var/named/avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061301
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /var/named/chroot/var/named/rev.avswa.com.zone -> 逆引きファイル
    
    コマンドの実行結果
    --------------------------------------------------
    $ORIGIN avswa.com.
    $TTL 1D
    122.168.192.in-addr.arpa. IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061201  ; serial
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
    122.168.192.in-addr.arpa.     IN  NS   vm11.example.com.
    11.122.168.192.in-addr.arpa.  IN  PTR  vm11.example.com.
    12.122.168.192.in-addr.arpa.  IN  PTR  vm12.example.com.
    13.122.168.192.in-addr.arpa.  IN  PTR  vm13.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/rev.avswa.com.zone -> 逆引きファイルの省略記述
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061301  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                                  IN  NS   vm11.example.com.
    11                            IN  PTR  vm11.example.com.
    12                            IN  PTR  vm12.example.com.
    13                            IN  PTR  vm13.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot 122.168.192.in-addr.arpa /var/named/rev.avswa.com.zone -> ゾーン情報をチェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061301
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[006]
  アクセス制御リスト
  
[内容]
  ## 作業内容
    アクセス制御リスト
  
[確認]
  $ cd $HOME
  $ nslookup -type=soa avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm11
  Address: 192.168.122.11#53
  
  avswa.com
    origin = vm11.avswa.com
    mail addr = makoto.avswa.com
    serial = 2023061301
    refresh = 300
    retry = 300
    expire = 86400
    minimum = 86400
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun Jun 11 21:10:16 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ nslookup -type=soa avswa.com vm11
    
    コマンドの実行結果
    --------------------------------------------------
    Server: vm11
    Address: 192.168.122.11#53
    
    avswa.com
      origin = vm11.avswa.com
      mail addr = makoto.avswa.com
      serial = 2023061301
      refresh = 300
      retry = 300
      expire = 86400
      minimum = 86400
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 13 19:29:40 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/named.conf -> アクセス制御リストの追加
    
    コマンドの実行結果
    --------------------------------------------------
    ## アクセス制御リスト  // 追加 -> ホスト(192.168.1.X)からはアクセス不可
    acl accesible
    {
      192.168.122.11/32;
      192.168.122.12/32;
      localhost;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";       # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };       # Not Use IPv6
      recursion no;                 # Contents Server = no, Cache Server = yes
      version "unknown";            # Display Version
      allow-query { accesible; };   # Accesible Hosts  // 追加
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type master;                  # File Type
      file "avswa.com.zone";        # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type master;                  # File Type
      file "rev.avswa.com.zone";    # File Name
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ nslookup -type=soa avswa.com vm11
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm11
  Address: 192.168.122.11#53
  
  ** server can't find avswa.com: REFUSED
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 13 21:14:12 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ nslookup -type=soa avswa.com vm11
    
    コマンドの実行結果
    --------------------------------------------------
    Server: vm11
    Address: 192.168.122.11#53
    
    avswa.com
      origin = vm11.avswa.com
      mail addr = makoto.avswa.com
      serial = 2023061301
      refresh = 300
      retry = 300
      expire = 86400
      minimum = 86400
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 13 21:30:07 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/named.conf -> アクセス制御リストの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## アクセス制御リスト  // 修正 -> コンテンツサーバーは誰でもアクセス可能
    acl accesible
    {
      any;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";       # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };       # Not Use IPv6
      recursion no;                 # Contents Server = no, Cache Server = yes
      version "unknown";            # Display Version
      allow-query { accesible; };   # Accesible Hosts
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type master;                  # File Type
      file "avswa.com.zone";        # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type master;                  # File Type
      file "rev.avswa.com.zone";    # File Name
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[007]
  スレーブサーバー構築
  
[内容]
  ## 作業内容
    スレーブサーバー構築
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 13 22:01:44 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## ゾーン転送リスト  // 追加
    acl transfer
    {
      192.168.122.12/32;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";       # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };       # Not Use IPv6
      recursion no;                 # Contents Server = no, Cache Server = yes
      version "unknown";            # Display Version
      allow-query { accesible; };   # Accesible Hosts
      allow-transfer { transfer; }; # Zone Transfer Allowed Hosts          // 追加
      notify yes;                   # Notify Slave Server of Zone Updates  // 追加
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type master;                  # File Type
      file "avswa.com.zone";        # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type master;                  # File Type
      file "rev.avswa.com.zone";    # File Name
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 13 21:32:07 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo firewall-cmd --list-all
    
    コマンドの実行結果
    --------------------------------------------------
    public (active)
      target: default
      icmp-block-inversion: no
      interfaces: enp1s0
      sources: 
      services: cockpit dhcpv6-client dns ssh  // dns を確認
      ports: 12865/tcp 12866/tcp
      protocols: 
      forward: no
      masquerade: no
      forward-ports: 
      source-ports: 
      icmp-blocks: 
      rich rules: 
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo bash /usr/libexec/setup-named-chroot.sh /var/named/chroot on
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> スクリプトでchroot有効化
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo cp -p /var/named/chroot/etc/named.conf /var/named/chroot/etc/named.conf.org
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 設定ファイルをバックアップ
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイル修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";       # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };       # Not Use IPv6
      recursion no;                 # Contents Server = no, Cache Server = yes
      version "unknown";            # Display Version
      allow-query { accesible; };   # Accesible Hosts
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type slave;                   # File Type
      masters { 192.168.122.11; };  # Primary Server
      file "avswa.com.zone";        # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type slave;                   # File Type
      masters { 192.168.122.11; };  # Primary Server
      file "rev.avswa.com.zone";    # File Name
    };
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl is-enabled named
    
    コマンドの実行結果
    --------------------------------------------------
    disabled
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl is-active named
    
    コマンドの実行結果
    --------------------------------------------------
    inactive
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl is-enabled named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    disabled
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl is-active named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    inactive
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl enable named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    Created symlink /etc/systemd/system/multi-user.target.wants/named-chroot.service → /usr/lib/systemd/system/named-chroot.service.
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl start named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    ==================================================
                    ゾーン転送まで待機
    ==================================================
    
    vm12$ cd $HOME
    vm12$ sudo ls -lh /var/named/chroot/var/named | grep avswa -> ゾーン転送ファイル
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 named named  408  6月 14 13:16 avswa.com.zone      // 正引きファイル
    -rw-r--r-- 1 named named  330  6月 14 13:17 rev.avswa.com.zone  // 逆引きファイル
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-compilezone -> 正引きファイル
        > -f raw                                          // 変換前 -> バイナリ(デフォルト)
        > -F text                                         // 変換後 -> テキスト
        > -o /dev/stdout                                  // 出力先
        > avswa.com                                       // 対象ゾーン
        > /var/named/chroot/var/named/avswa.com.zone      // ファイル名
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061301
    avswa.com.        86400 IN SOA vm11.avswa.com. makoto.avswa.com. 2023061301 300 300 86400 86400
    avswa.com.        86400 IN NS vm11.avswa.com.
    mail.avswa.com.   86400 IN MX 10 vm11.avswa.com.
    vm11.avswa.com.   86400 IN A 192.168.122.11
    vm12.avswa.com.   86400 IN A 192.168.122.12
    vm13.avswa.com.   86400 IN A 192.168.122.13
    www1.avswa.com.   86400 IN CNAME vm11.avswa.com.
    www2.avswa.com.   86400 IN CNAME vm11.avswa.com.
    OK
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-compilezone -> 逆引きファイル
        > -f raw                                          // 変換前 -> バイナリ(デフォルト)
        > -F text                                         // 変換後 -> テキスト
        > -o /dev/stdout                                  // 出力先
        > 122.168.192.in-addr.arpa                        // 対象ゾーン
        > /var/named/chroot/var/named/rev.avswa.com.zone  // ファイル名
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061301
    122.168.192.in-addr.arpa.      86400 IN SOA vm11.avswa.com. makoto.avswa.com. 2023061301 300 300 86400 86400
    122.168.192.in-addr.arpa.      86400 IN NS vm11.example.com.
    11.122.168.192.in-addr.arpa.   86400 IN PTR vm11.example.com.
    12.122.168.192.in-addr.arpa.   86400 IN PTR vm12.example.com.
    13.122.168.192.in-addr.arpa.   86400 IN PTR vm13.example.com.
    OK
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[008]
  ゾーン転送の暗号化
  
[内容]
  ## 作業内容
    ゾーン転送の暗号化 => TSIG の使用
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun 14 12:21:22 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnssec-keygen -> TSIG用の鍵ファイル作成
        > -a HMAC-MD5   // アルゴリズム
        > -b 128        // 鍵長
        > -n HOST       // 所有者のタイプ
        > tsig-key      // 鍵の名前
    
    コマンドの実行結果
    --------------------------------------------------
    Ktsig-key.+157+57504
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh Ktsig-key* -> TSIG用の鍵ファイル確認
    
    コマンドの実行結果
    --------------------------------------------------
    -rw------- 1 makoto makoto  52  6月 14 14:25 Ktsig-key.+157+57504.key      // 公開鍵
    -rw------- 1 makoto makoto 165  6月 14 14:25 Ktsig-key.+157+57504.private  // 秘密鍵
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat Ktsig-key.+157+57504.key -> 公開鍵を確認
    
    コマンドの実行結果
    --------------------------------------------------
    tsig-key. IN KEY 512 3 157 P6wTpHsNIepDXl2MKpAfQQ==  // ゾーン転送時の共有鍵に使用する
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat Ktsig-key.+157+57504.private -> 秘密鍵を確認
    
    コマンドの実行結果
    --------------------------------------------------
    Private-key-format: v1.3
    Algorithm: 157 (HMAC_MD5)
    Key: P6wTpHsNIepDXl2MKpAfQQ==  // ゾーン転送時の共有鍵に使用する
    Bits: AAA=
    Created: 20230614052508
    Publish: 20230614052508
    Activate: 20230614052508
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/tsig.key
    
    コマンドの実行結果
    --------------------------------------------------
    key tsig-key
    {
      algorithm hmac-md5;               # 暗号化アルゴリズム
      secret P6wTpHsNIepDXl2MKpAfQQ==;  # 共有鍵
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード  // 追加
    include "/etc/tsig.key";
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## ゾーン転送リスト
    acl transfer
    {
      192.168.122.12/32;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";              # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };              # Not Use IPv6
      recursion no;                        # Contents Server = no, Cache Server = yes
      version "unknown";                   # Display Version
      allow-query { accesible; };          # Accesible Hosts
      allow-transfer { transfer; };        # Zone Transfer Allowed Hosts
      notify yes;                          # Notify Slave Server of Zone Updates
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type master;                         # File Type
      file "avswa.com.zone";               # File Name
      allow-transfer { key "tsig-key"; };  # TSIG Key  // 追加
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type master;                         # File Type
      file "rev.avswa.com.zone";           # File Name
      allow-transfer { key "tsig-key"; };  # TSIG Key  // 追加
    };
    
    ## ログ出力  // 追加
    logging
    {
      channel default_debug
      {
        file "data/named.run";
        severity dynamic;
      };
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/avswa.com.zone -> 正引きファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11 makoto (
      2023061402  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                     IN  NS     vm11             ; Master
    vm11             IN  A      192.168.122.11   ; Host1
    vm12             IN  A      192.168.122.12   ; Host2
    vm13             IN  A      192.168.122.13   ; Host3
    www1             IN  CNAME  vm11             ; Web Site1
    www2             IN  CNAME  vm11             ; Web Site2
    mail             IN  MX 10  vm11             ; Mail Server
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot avswa.com /var/named/avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061402
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/rev.avswa.com.zone -> 逆引きファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061402  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                                  IN  NS   vm11.example.com.
    11                            IN  PTR  vm11.example.com.
    12                            IN  PTR  vm12.example.com.
    13                            IN  PTR  vm13.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot 122.168.192.in-addr.arpa /var/named/rev.avswa.com.zone -> ゾーン情報をチェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061402
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun 14 18:40:33 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /var/named/chroot/etc/tsig.key
    
    コマンドの実行結果
    --------------------------------------------------
    key tsig-key
    {
      algorithm hmac-md5;               # 暗号化アルゴリズム
      secret P6wTpHsNIepDXl2MKpAfQQ==;  # 共有鍵
    };
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード  // 追加
    include "/etc/tsig.key";
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## 共有鍵  // 追加
    server 192.168.122.11
    {
      keys { "tsig-key"; };
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";       # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };       # Not Use IPv6
      recursion no;                 # Contents Server = no, Cache Server = yes
      version "unknown";            # Display Version
      allow-query { accesible; };   # Accesible Hosts
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type slave;                   # File Type
      masters { 192.168.122.11; };  # Primary Server
      file "avswa.com.zone";        # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type slave;                   # File Type
      masters { 192.168.122.11; };  # Primary Server
      file "rev.avswa.com.zone";    # File Name
    };
    
    ## ログ出力  // 追加
    logging
    {
      channel default_debug
      {
        file "data/named.run";
        severity dynamic;
      };
    };
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    ==================================================
                    ゾーン転送まで待機
    ==================================================
    
    vm12$ cd $HOME
    vm12$ sudo grep zone /var/named/chroot/var/named/data/named.run -> TSIG保護下のゾーン転送ログ
    
    コマンドの実行結果
    --------------------------------------------------
    ...
    zone 122.168.192.in-addr.arpa/IN: sending notifies (serial 2023061401)
    zone 122.168.192.in-addr.arpa/IN: Transfer started.
    zone 122.168.192.in-addr.arpa/IN: transferred serial 2023061402: TSIG 'tsig-key'
    zone 122.168.192.in-addr.arpa/IN: sending notifies (serial 2023061402)
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[009]
  サーバー管理用の管理コマンドの使用設定
  
[内容]
  ## 作業内容
    サーバー管理用の管理コマンドの使用設定 => RNDC の使用
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun 14 20:06:13 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnssec-keygen -> RNDC用の鍵ファイル作成
        > -a HMAC-MD5   // アルゴリズム
        > -b 128        // 鍵長
        > -n USER       // 所有者のタイプ
        > rndc-key      // 鍵の名前
    
    コマンドの実行結果
    --------------------------------------------------
    Krndc-key.+157+43105
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh Krndc-key* -> RNDC用の鍵ファイル確認
    
    コマンドの実行結果
    --------------------------------------------------
    -rw------- 1 makoto makoto  50  6月 15 16:52 Krndc-key.+157+43105.key      // 公開鍵
    -rw------- 1 makoto makoto 165  6月 15 16:52 Krndc-key.+157+43105.private  // 秘密鍵
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat Krndc-key.+157+43105.key -> 公開鍵を確認
    
    コマンドの実行結果
    --------------------------------------------------
    rndc-key. IN KEY 0 3 157 f78Jk6XTlJsWs/wefBlSFw==  // コマンド実行時の共有鍵に使用する
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat Krndc-key.+157+43105.private -> 秘密鍵を確認
    
    コマンドの実行結果
    --------------------------------------------------
    Private-key-format: v1.3
    Algorithm: 157 (HMAC_MD5)
    Key: f78Jk6XTlJsWs/wefBlSFw==  // コマンド実行時の共有鍵に使用する
    Bits: AAA=
    Created: 20230615075228
    Publish: 20230615075228
    Activate: 20230615075228
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cp -p /var/named/chroot/etc/rndc.key /var/named/chroot/etc/rndc.key.org
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/rndc.key
    
    コマンドの実行結果
    --------------------------------------------------
    key rndc-key
    {
      algorithm hmac-md5;                  # 暗号化アルゴリズム
      secret "f78Jk6XTlJsWs/wefBlSFw==";   # 共有鍵
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード
    include "/etc/tsig.key";
    include "/etc/rndc.key";  // 追加
    
    ## 操作可能ホスト  // 追加
    controls
    {
      inet 127.0.0.1 allow { localhost; } keys { "rndc-key"; };
      inet 192.168.122.11 allow { 192.168.122.0/24; } keys { "rndc-key"; };
    };
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## ゾーン転送リスト
    acl transfer
    {
      192.168.122.12/32;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";              # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };              # Not Use IPv6
      recursion no;                        # Contents Server = no, Cache Server = yes
      version "unknown";                   # Display Version
      allow-query { accesible; };          # Accesible Hosts
      allow-transfer { transfer; };        # Zone Transfer Allowed Hosts
      notify yes;                          # Notify Slave Server of Zone Updates
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type master;                         # File Type
      file "avswa.com.zone";               # File Name
      allow-transfer { key "tsig-key"; };  # TSIG Key
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type master;                         # File Type
      file "rev.avswa.com.zone";           # File Name
      allow-transfer { key "tsig-key"; };  # TSIG Key
    };
    
    ## ログ出力
    logging
    {
      channel default_debug
      {
        file "data/named.run";
        severity dynamic;
      };
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun 14 19:44:38 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo cp -p /var/named/chroot/etc/rndc.key /var/named/chroot/etc/rndc.key.org
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /var/named/chroot/etc/rndc.key
    
    コマンドの実行結果
    --------------------------------------------------
    key rndc-key
    {
      algorithm hmac-md5;                  # 暗号化アルゴリズム
      secret "f78Jk6XTlJsWs/wefBlSFw==";   # 共有鍵
    };
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード
    include "/etc/tsig.key";
    include "/etc/rndc.key";  // 追加
    
    ## 操作可能ホスト  // 追加
    controls
    {
      inet 127.0.0.1 allow { localhost; } keys { "rndc-key"; };
      inet 192.168.122.12 allow { 192.168.122.0/24; } keys { "rndc-key"; };
    };
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## 共有鍵
    server 192.168.122.11
    {
      keys { "tsig-key"; };
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";       # Full Path -> /var/named/chroot/var/named
      listen-on-v6 { none; };       # Not Use IPv6
      recursion no;                 # Contents Server = no, Cache Server = yes
      version "unknown";            # Display Version
      allow-query { accesible; };   # Accesible Hosts
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type slave;                   # File Type
      masters { 192.168.122.11; };  # Primary Server
      file "avswa.com.zone";        # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type slave;                   # File Type
      masters { 192.168.122.11; };  # Primary Server
      file "rev.avswa.com.zone";    # File Name
    };
    
    ## ログ出力
    logging
    {
      channel default_debug
      {
        file "data/named.run";
        severity dynamic;
      };
    };
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[010]
  管理コマンド - 01
  
[内容]
  ## 作業内容
    ステータス表示
  
  ## コマンド(rndc)
    rndc -b XX          : IPアドレス(XX)を指定
    rndc -c XX          : 設定ファイル(デフォルトは /etc/rndc.conf )を指定
    rndc -s XX          : ホスト名(XX)を指定
    rndc -p XX          : ポート番号(XX)を指定
    rndc -k XX          : 設定ファイル(XX)を指定
    rndc -y XX          : RNDCキー(XX)を指定
    rndc reload         : 設定ファイルとゾーン情報をリロード (シリアル番号更新時のみ)
    rndc reload XX      : ゾーン情報(XX)のみリロード (シリアル番号更新時のみ)
    rndc reconfig       : 設定ファイル(named.conf)と新規追加のゾーン情報のみリロード
    rndc stats          : 統計情報をファイル出力
    rndc status         : ステータス表示
    rndc dumpdb -all    : ゾーン情報をファイルにダンプ、ゾーンとキャッシュ両方
    rndc dumpdb -zones  : ゾーン情報をファイルにダンプ、ゾーンのみ
    rndc dumpdb -cache  : ゾーン情報をファイルにダンプ、キャッシュのみ
    rndc flush          : 全キャッシュを消去
    rndc flushname XX   : キャッシュレコード(XX)を消去
    rndc notify         : マスターからスレーブにゾーン更新を通知 (シリアル番号更新時のみ)
    rndc retransfer     : スレーブからマスターにゾーン情報の転送依頼 (シリアル番号を無視)
    rndc refresh        : スレーブからマスターにゾーン情報の転送強制 (シリアル番号を無視)
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 16:51:42 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rndc -k /var/named/chroot/etc/rndc.key status -> ステータス表示
    
    コマンドの実行結果
    --------------------------------------------------
    version                     : BIND 9.11.36-RedHat-9.11.36-8.el8 (Extended Support Version) <id:68dbd5b> (unknown)
    running on vm11             : Linux x86_64 4.20.1 #1 SMP Thu Jun 1 20:35:58 JST 2023
    boot time                   : Thu, 15 Jun 2023 08:03:27 GMT
    last configured             : Thu, 15 Jun 2023 08:03:27 GMT
    configuration file          : /etc/named.conf (/var/named/chroot/etc/named.conf)
    CPUs found                  : 1
    worker threads              : 1
    UDP listeners per interface : 1
    number of zones             : 3 (0 automatic)
    debug level                 : 0
    xfers running               : 0
    xfers deferred              : 0
    soa queries in progress     : 0
    query logging is OFF
    recursive clients           : 0/900/1000
    tcp clients                 : 2/150
    TCP high-water              : 2
    server is up and running
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 17:05:23 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo rndc -k /var/named/chroot/etc/rndc.key status -> ステータス表示
    
    コマンドの実行結果
    --------------------------------------------------
    version                     : BIND 9.11.36-RedHat-9.11.36-8.el8 (Extended Support Version) <id:68dbd5b> (unknown)
    running on vm12             : Linux x86_64 4.18.0-477.10.1.el8_8.x86_64 #1 SMP Tue May 16 11:38:37 UTC 2023
    boot time                   : Thu, 15 Jun 2023 08:08:35 GMT
    last configured             : Thu, 15 Jun 2023 08:08:35 GMT
    configuration file          : /etc/named.conf (/var/named/chroot/etc/named.conf)
    CPUs found                  : 1
    worker threads              : 1
    UDP listeners per interface : 1
    number of zones             : 3 (0 automatic)
    debug level                 : 0
    xfers running               : 0
    xfers deferred              : 0
    soa queries in progress     : 0
    query logging is OFF
    recursive clients           : 0/900/1000
    tcp clients                 : 2/150
    TCP high-water              : 2
    server is up and running
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[011]
  管理コマンド - 02
  
[内容]
  ## 作業内容
    統計情報をファイル出力
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 17:14:56 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード
    include "/etc/tsig.key";
    include "/etc/rndc.key";
    
    ## 操作可能ホスト
    controls
    {
      inet 127.0.0.1 allow { localhost; } keys { "rndc-key"; };
      inet 192.168.122.11 allow { 192.168.122.0/24; } keys { "rndc-key"; };
    };
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## ゾーン転送リスト
    acl transfer
    {
      192.168.122.12/32;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";              # Full Path -> /var/named/chroot/var/named
      statistics-file "data/named.stats";  # Stats File -> /var/named/chroot/var/named/data/named.stats  // 追加
      listen-on-v6 { none; };              # Not Use IPv6
      recursion no;                        # Contents Server = no, Cache Server = yes
      version "unknown";                   # Display Version
      allow-query { accesible; };          # Accesible Hosts
      allow-transfer { transfer; };        # Zone Transfer Allowed Hosts
      notify yes;                          # Notify Slave Server of Zone Updates
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type master;                         # File Type
      file "avswa.com.zone";               # File Name
      allow-transfer { key "tsig-key"; };  # TSIG Key
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type master;                         # File Type
      file "rev.avswa.com.zone";           # File Name
      allow-transfer { key "tsig-key"; };  # TSIG Key
    };
    
    ## ログ出力
    logging
    {
      channel default_debug
      {
        file "data/named.run";
        severity dynamic;
      };
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rndc -k /var/named/chroot/etc/rndc.key stats -> 統計情報をファイル出力
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo ls -lh /var/named/chroot/var/named/data
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 named named  28K  6月 15 18:18 named.run
    -rw-r--r-- 1 named named 3.8K  6月 15 18:18 named.stats  // 統計情報ファイル
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 17:55:02 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード
    include "/etc/tsig.key";
    include "/etc/rndc.key";
    
    ## 操作可能ホスト
    controls
    {
      inet 127.0.0.1 allow { localhost; } keys { "rndc-key"; };
      inet 192.168.122.12 allow { 192.168.122.0/24; } keys { "rndc-key"; };
    };
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## 共有鍵
    server 192.168.122.11
    {
      keys { "tsig-key"; };
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";              # Full Path -> /var/named/chroot/var/named
      statistics-file "data/named.stats";  # Stats File -> /var/named/chroot/var/named/data/named.stats  // 追加
      listen-on-v6 { none; };              # Not Use IPv6
      recursion no;                        # Contents Server = no, Cache Server = yes
      version "unknown";                   # Display Version
      allow-query { accesible; };          # Accesible Hosts
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type slave;                          # File Type
      masters { 192.168.122.11; };         # Primary Server
      file "avswa.com.zone";               # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type slave;                          # File Type
      masters { 192.168.122.11; };         # Primary Server
      file "rev.avswa.com.zone";           # File Name
    };
    
    ## ログ出力
    logging
    {
      channel default_debug
      {
        file "data/named.run";
        severity dynamic;
      };
    };
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo rndc -k /var/named/chroot/etc/rndc.key stats -> 統計情報をファイル出力
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo ls -lh /var/named/chroot/var/named/data
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 named named  27K  6月 15 18:39 named.run
    -rw-r--r-- 1 named named 3.9K  6月 15 18:39 named.stats  // 統計情報ファイル
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[012]
  管理コマンド - 03
  
[内容]
  ## 作業内容
    メモリ上のキャッシュをダンプ出力
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 18:10:52 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード
    include "/etc/tsig.key";
    include "/etc/rndc.key";
    
    ## 操作可能ホスト
    controls
    {
      inet 127.0.0.1 allow { localhost; } keys { "rndc-key"; };
      inet 192.168.122.11 allow { 192.168.122.0/24; } keys { "rndc-key"; };
    };
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## ゾーン転送リスト
    acl transfer
    {
      192.168.122.12/32;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";              # Full Path -> /var/named/chroot/var/named
      statistics-file "data/named.stats";  # Stats File -> /var/named/chroot/var/named/data/named.stats
      dump-file "data/named.dump";         # Dump File -> /var/named/chroot/var/named/data/named.dump  // 追加
      listen-on-v6 { none; };              # Not Use IPv6
      recursion no;                        # Contents Server = no, Cache Server = yes
      version "unknown";                   # Display Version
      allow-query { accesible; };          # Accesible Hosts
      allow-transfer { transfer; };        # Zone Transfer Allowed Hosts
      notify yes;                          # Notify Slave Server of Zone Updates
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type master;                         # File Type
      file "avswa.com.zone";               # File Name
      allow-transfer { key "tsig-key"; };  # TSIG Key
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type master;                         # File Type
      file "rev.avswa.com.zone";           # File Name
      allow-transfer { key "tsig-key"; };  # TSIG Key
    };
    
    ## ログ出力
    logging
    {
      channel default_debug
      {
        file "data/named.run";
        severity dynamic;
      };
    };
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rndc -k /var/named/chroot/etc/rndc.key dumpdb -> メモリ上のキャッシュをダンプ出力
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo ls -lh /var/named/chroot/var/named/data
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 named named  23K  6月 15 19:21 named.dump  // ダンプファイル
    -rw-r--r-- 1 named named  35K  6月 15 19:21 named.run
    -rw-r--r-- 1 named named 3.8K  6月 15 18:18 named.stats
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 18:37:05 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード
    include "/etc/tsig.key";
    include "/etc/rndc.key";
    
    ## 操作可能ホスト
    controls
    {
      inet 127.0.0.1 allow { localhost; } keys { "rndc-key"; };
      inet 192.168.122.12 allow { 192.168.122.0/24; } keys { "rndc-key"; };
    };
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## 共有鍵
    server 192.168.122.11
    {
      keys { "tsig-key"; };
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";              # Full Path -> /var/named/chroot/var/named
      statistics-file "data/named.stats";  # Stats File -> /var/named/chroot/var/named/data/named.stats
      dump-file "data/named.dump";         # Dump File -> /var/named/chroot/var/named/data/named.dump  // 追加
      listen-on-v6 { none; };              # Not Use IPv6
      recursion no;                        # Contents Server = no, Cache Server = yes
      version "unknown";                   # Display Version
      allow-query { accesible; };          # Accesible Hosts
    };
    
    ## ゾーンファイル(正引き)
    zone avswa.com IN
    {
      type slave;                          # File Type
      masters { 192.168.122.11; };         # Primary Server
      file "avswa.com.zone";               # File Name
    };
    
    ## ゾーンファイル(逆引き)
    zone 122.168.192.in-addr.arpa IN
    {
      type slave;                          # File Type
      masters { 192.168.122.11; };         # Primary Server
      file "rev.avswa.com.zone";           # File Name
    };
    
    ## ログ出力
    logging
    {
      channel default_debug
      {
        file "data/named.run";
        severity dynamic;
      };
    };
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo rndc -k /var/named/chroot/etc/rndc.key dumpdb -> メモリ上のキャッシュをダンプ出力
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo ls -lh /var/named/chroot/var/named/data
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 named named  22K  6月 15 19:40 named.dump  // ダンプファイル
    -rw-r--r-- 1 named named  33K  6月 15 19:40 named.run
    -rw-r--r-- 1 named named 3.9K  6月 15 18:39 named.stats
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[013]
  管理コマンド - 04
  
[内容]
  ## 作業内容
    ゾーン情報をリロード、ゾーン更新を通知
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 19:59:56 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/avswa.com.zone -> 正引きファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11 makoto (
      2023061501  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                     IN  NS     vm11             ; Master
    vm11             IN  A      192.168.122.11   ; Host1
    vm12             IN  A      192.168.122.12   ; Host2
    vm13             IN  A      192.168.122.13   ; Host3
    www1             IN  CNAME  vm11             ; Web Site1
    www2             IN  CNAME  vm11             ; Web Site2
    mail             IN  MX 10  vm11             ; Mail Server
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot avswa.com /var/named/avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061501
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/rev.avswa.com.zone -> 逆引きファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061501  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                                  IN  NS   vm11.example.com.
    11                            IN  PTR  vm11.example.com.
    12                            IN  PTR  vm12.example.com.
    13                            IN  PTR  vm11.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot 122.168.192.in-addr.arpa /var/named/rev.avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061501
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rndc -k /var/named/chroot/etc/rndc.key reload -> ゾーン情報をリロード
    
    コマンドの実行結果
    --------------------------------------------------
    server reload successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rndc -k /var/named/chroot/etc/rndc.key notify avswa.com -> ゾーン更新を通知
    
    コマンドの実行結果
    --------------------------------------------------
    zone notify queued
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rndc -k /var/named/chroot/etc/rndc.key notify 122.168.192.in-addr.arpa -> ゾーン更新を通知
    
    コマンドの実行結果
    --------------------------------------------------
    zone notify queued
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 19:38:19 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo grep zone /var/named/chroot/var/named/data/named.run -> ゾーン転送ログ
    
    コマンドの実行結果
    --------------------------------------------------
    ...
    zone avswa.com/IN: Transfer started.
    zone avswa.com/IN: transferred serial 2023061501: TSIG 'tsig-key'
    zone 122.168.192.in-addr.arpa/IN: Transfer started.
    zone 122.168.192.in-addr.arpa/IN: transferred serial 2023061501: TSIG 'tsig-key'
    zone 122.168.192.in-addr.arpa/IN: sending notifies (serial 2023061501)
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo ls -lh /var/named/chroot/var/named | grep avswa -> ゾーン転送ファイル
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 named named  408  6月 15 20:37 avswa.com.zone      // 正引きファイル
    -rw-r--r-- 1 named named  330  6月 15 20:38 rev.avswa.com.zone  // 逆引きファイル
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-compilezone -> 正引きファイル
        > -f raw                                          // 変換前 -> バイナリ(デフォルト)
        > -F text                                         // 変換後 -> テキスト
        > -o /dev/stdout                                  // 出力先
        > avswa.com                                       // 対象ゾーン
        > /var/named/chroot/var/named/avswa.com.zone      // ファイル名
        > | grep serial
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061501  // シリアル更新を確認
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-compilezone -> 逆引きファイル
        > -f raw                                          // 変換前 -> バイナリ(デフォルト)
        > -F text                                         // 変換後 -> テキスト
        > -o /dev/stdout                                  // 出力先
        > 122.168.192.in-addr.arpa                        // 対象ゾーン
        > /var/named/chroot/var/named/rev.avswa.com.zone  // ファイル名
        > | grep serial                                   // シリアル出力
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061501  // シリアル更新を確認
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[014]
  管理コマンド - 05
  
[内容]
  ## 作業内容
    ゾーン情報の転送依頼
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 20:27:18 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/avswa.com.zone -> 正引きファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11 makoto (
      2023061502  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                     IN  NS     vm11             ; Master
    vm11             IN  A      192.168.122.11   ; Host1
    vm12             IN  A      192.168.122.12   ; Host2
    vm13             IN  A      192.168.122.13   ; Host3
    www1             IN  CNAME  vm11             ; Web Site1
    www2             IN  CNAME  vm11             ; Web Site2
    mail             IN  MX 10  vm11             ; Mail Server
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot avswa.com /var/named/avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061502
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/rev.avswa.com.zone -> 逆引きファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061502  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                                  IN  NS   vm11.example.com.
    11                            IN  PTR  vm11.example.com.
    12                            IN  PTR  vm12.example.com.
    13                            IN  PTR  vm13.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot 122.168.192.in-addr.arpa /var/named/rev.avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061502
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rndc -k /var/named/chroot/etc/rndc.key reload -> ゾーン情報をリロード
    
    コマンドの実行結果
    --------------------------------------------------
    server reload successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 15 20:37:41 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo rndc -k /var/named/chroot/etc/rndc.key retransfer avswa.com -> ゾーン情報の転送依頼
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo rndc -k /var/named/chroot/etc/rndc.key retransfer 122.168.192.in-addr.arpa -> ゾーン情報の転送依頼
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo grep zone /var/named/chroot/var/named/data/named.run -> ゾーン転送ログ
    
    コマンドの実行結果
    --------------------------------------------------
    ...
    zone avswa.com/IN: Transfer started.
    zone avswa.com/IN: transferred serial 2023061502: TSIG 'tsig-key'
    zone avswa.com/IN: Transfer started.
    zone avswa.com/IN: transferred serial 2023061502: TSIG 'tsig-key'
    zone 122.168.192.in-addr.arpa/IN: Transfer started.
    zone 122.168.192.in-addr.arpa/IN: transferred serial 2023061502: TSIG 'tsig-key'
    zone 122.168.192.in-addr.arpa/IN: sending notifies (serial 2023061502)
    zone 122.168.192.in-addr.arpa/IN: Transfer started.
    zone 122.168.192.in-addr.arpa/IN: transferred serial 2023061502: TSIG 'tsig-key'
    zone 122.168.192.in-addr.arpa/IN: sending notifies (serial 2023061502)
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo ls -lh /var/named/chroot/var/named | grep avswa -> ゾーン転送ファイル
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 named named  408  6月 15 21:16 avswa.com.zone      // 正引きファイル
    -rw-r--r-- 1 named named  330  6月 15 21:17 rev.avswa.com.zone  // 逆引きファイル
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-compilezone -> 正引きファイル
        > -f raw                                          // 変換前 -> バイナリ(デフォルト)
        > -F text                                         // 変換後 -> テキスト
        > -o /dev/stdout                                  // 出力先
        > avswa.com                                       // 対象ゾーン
        > /var/named/chroot/var/named/avswa.com.zone      // ファイル名
        > | grep serial                                   // シリアル出力
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061502  // シリアル更新を確認
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo named-compilezone -> 逆引きファイル
        > -f raw                                          // 変換前 -> バイナリ(デフォルト)
        > -F text                                         // 変換後 -> テキスト
        > -o /dev/stdout                                  // 出力先
        > 122.168.192.in-addr.arpa                        // 対象ゾーン
        > /var/named/chroot/var/named/rev.avswa.com.zone  // ファイル名
        > | grep serial                                   // シリアル出力
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061502  // シリアル更新を確認
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[015]
  キャッシュサーバー構築
  
[内容]
  ## 作業内容
    キャッシュサーバー構築
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 16 14:31:25 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo firewall-cmd --list-all
    
    コマンドの実行結果
    --------------------------------------------------
    public (active)
      target: default
      icmp-block-inversion: no
      interfaces: enp1s0
      sources: 
      services: cockpit dhcpv6-client dns ssh  // dns を確認
      ports: 12865/tcp 12866/tcp
      protocols: 
      forward: no
      masquerade: no
      forward-ports: 
      source-ports: 
      icmp-blocks: 
      rich rules: 
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo bash /usr/libexec/setup-named-chroot.sh /var/named/chroot on
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> スクリプトでchroot有効化
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo cp -p /var/named/chroot/etc/named.conf /var/named/chroot/etc/named.conf.org
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 設定ファイルをバックアップ
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo vi /var/named/chroot/etc/rndc.key
    
    コマンドの実行結果
    --------------------------------------------------
    key rndc-key
    {
      algorithm hmac-md5;                  # 暗号化アルゴリズム
      secret "f78Jk6XTlJsWs/wefBlSFw==";   # 共有鍵
    };
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo vi /var/named/chroot/etc/named.conf -> 設定ファイル修正
    
    コマンドの実行結果
    --------------------------------------------------
    ## 追加設定ロード
    include "/etc/rndc.key";
    
    ## 操作可能ホスト
    controls
    {
      inet 127.0.0.1 allow { localhost; } keys { "rndc-key"; };
      inet 192.168.122.13 allow { 192.168.122.0/24; } keys { "rndc-key"; };
    };
    
    ## アクセス制御リスト
    acl accesible
    {
      any;
    };
    
    ## 詳細オプション
    options
    {
      directory "/var/named";              # Full Path -> /var/named/chroot/var/named
      statistics-file "data/named.stats";  # Stats File -> /var/named/chroot/var/named/data/named.stats
      dump-file "data/named.dump";         # Dump File -> /var/named/chroot/var/named/data/named.dump
      listen-on-v6 { none; };              # Not Use IPv6
      recursion yes;                       # Contents Server = no, Cache Server = yes
      recursive-clients 300;               # Accesible Clients for Recursive Queries
      version "unknown";                   # Display Version
      allow-query { accesible; };          # Accesible Hosts
      allow-recursion { accesible; };      # Hosts Allowed for Recursive Queries
      forward only;                        # Forward Only
      forwarders {                         # Forward Destination
        192.168.122.11;                    # Forward Destination - master server for avswa.com
        192.168.122.1;                     # Forward Destination - internet
      };
    };
    
    ## ルートサーバー情報
    zone "." IN
    {
      type hint;                           # Unknown
      file "named.ca";                     # Full Path -> /var/named/chroot/var/named/named.ca
    };
    
    ## ログ出力
    logging
    {
      channel default_debug
      {
        file "data/named.run";             # Full Path -> /var/named/chroot/var/named/data/named.run
        severity dynamic;                  # Priority
      };
    };
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo named-checkconf -t /var/named/chroot /etc/named.conf -> 設定ファイルの書式チェック
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl is-enabled named
    
    コマンドの実行結果
    --------------------------------------------------
    disabled
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl is-active named
    
    コマンドの実行結果
    --------------------------------------------------
    inactive
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl is-enabled named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    disabled
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl is-active named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    inactive
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl enable named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    Created symlink /etc/systemd/system/multi-user.target.wants/named-chroot.service → /usr/lib/systemd/system/named-chroot.service.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl restart named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[016]
  クライアントコマンド - 04
  
[内容]
  ## 作業内容
    コマンド(nslookup)でキャッシュサーバーに名前解決を依頼
  
[確認]
  $ cd $HOME
  $ nslookup -type=soa avswa.com vm13 -> 自前ゾーンを問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  avswa.com
    origin = vm11.avswa.com
    mail addr = makoto.avswa.com
    serial = 2023061502
    refresh = 300
    retry = 300
    expire = 86400
    minimum = 86400
  
  Authoritative answers can be found from:
  avswa.com nameserver = vm11.avswa.com.
  vm11.avswa.com internet address = 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=ns avswa.com vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  avswa.com nameserver = vm11.avswa.com.
  
  Authoritative answers can be found from:
  vm11.avswa.com internet address = 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=a vm11.avswa.com vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  Name: vm11.avswa.com
  Address: 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=a www1.avswa.com vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  www1.avswa.com canonical name = vm11.avswa.com.
  Name: vm11.avswa.com
  Address: 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=ptr 192.168.122.11 vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  11.122.168.192.in-addr.arpa name = vm11.example.com.
  
  Authoritative answers can be found from:
  122.168.192.in-addr.arpa nameserver = vm11.example.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=mx mail.avswa.com vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  mail.avswa.com mail exchanger = 10 vm11.avswa.com.
  
  Authoritative answers can be found from:
  avswa.com nameserver = vm11.avswa.com.
  vm11.avswa.com internet address = 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=soa yahoo.co.jp vm13 -> キャッシュサーバーにインターネット上のゾーンを問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  yahoo.co.jp
    origin = yahoo.co.jp
    mail addr = postmaster.yahoo.co.jp
    serial = 2306160028
    refresh = 1800
    retry = 900
    expire = 86400
    minimum = 900
  
  Authoritative answers can be found from:
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=ns yahoo.co.jp vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  yahoo.co.jp  nameserver = ns01.yahoo.co.jp.
  yahoo.co.jp  nameserver = ns11.yahoo.co.jp.
  yahoo.co.jp  nameserver = ns02.yahoo.co.jp.
  yahoo.co.jp  nameserver = ns12.yahoo.co.jp.
  
  Authoritative answers can be found from:
  ns01.yahoo.co.jp  internet address = 118.151.254.133  // このホスト名をサンプルにする
  ns02.yahoo.co.jp  internet address = 118.151.254.149
  ns11.yahoo.co.jp  internet address = 124.83.255.37
  ns12.yahoo.co.jp  internet address = 124.83.255.101
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=a ns01.yahoo.co.jp vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  Name: ns01.yahoo.co.jp
  Address: 118.151.254.133
  --------------------------------------------------
  
  $ cd $HOME
  $ nslookup -type=ptr 118.151.254.133 vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Server: vm13
  Address: 192.168.122.13#53
  
  Non-authoritative answer:
  133.254.151.118.in-addr.arpa name = ns01.yahoo.co.jp.
  
  Authoritative answers can be found from:
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[017]
  クライアントコマンド - 05
  
[内容]
  ## 作業内容
    コマンド(host)でキャッシュサーバーに名前解決を依頼
  
[確認]
  $ cd $HOME
  $ host -t soa avswa.com vm13 -> 自前ゾーンを問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  avswa.com has SOA record vm11.avswa.com. makoto.avswa.com. 2023061502 300 300 86400 86400
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t ns avswa.com vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  avswa.com name server vm11.avswa.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t a vm11.avswa.com vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  vm11.avswa.com has address 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t a www1.avswa.com vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  www1.avswa.com is an alias for vm11.avswa.com.
  vm11.avswa.com has address 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t ptr 192.168.122.11 vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  11.122.168.192.in-addr.arpa domain name pointer vm11.example.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t mx mail.avswa.com vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  mail.avswa.com mail is handled by 10 vm11.avswa.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t soa yahoo.co.jp vm13 -> キャッシュサーバーにインターネット上のゾーンを問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  yahoo.co.jp has SOA record yahoo.co.jp. postmaster.yahoo.co.jp. 2306160028 1800 900 86400 900
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t ns yahoo.co.jp vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  yahoo.co.jp name server ns02.yahoo.co.jp.
  yahoo.co.jp name server ns01.yahoo.co.jp.  // このホスト名をサンプルにする
  yahoo.co.jp name server ns11.yahoo.co.jp.
  yahoo.co.jp name server ns12.yahoo.co.jp.
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t a ns01.yahoo.co.jp vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  ns01.yahoo.co.jp has address 118.151.254.133
  --------------------------------------------------
  
  $ cd $HOME
  $ host -t ptr 118.151.254.133 vm13
  
  コマンドの実行結果
  --------------------------------------------------
  Using domain server:
  Name: vm13
  Address: 192.168.122.13#53
  Aliases: 
  
  133.254.151.118.in-addr.arpa domain name pointer ns01.yahoo.co.jp.
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[018]
  クライアントコマンド - 06
  
[内容]
  ## 作業内容
    コマンド(dig)でキャッシュサーバーに名前解決を依頼
  
[確認]
  $ cd $HOME
  $ dig @vm13 +noall +answer avswa.com soa -> 自前ゾーンを問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  avswa.com. 76913 IN SOA vm11.avswa.com. makoto.avswa.com. 2023061502 300 300 86400 86400
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer avswa.com ns
  
  コマンドの実行結果
  --------------------------------------------------
  avswa.com. 76844 IN NS vm11.avswa.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer vm11.avswa.com a
  
  コマンドの実行結果
  --------------------------------------------------
  vm11.avswa.com. 76718 IN A 192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer www1.avswa.com a
  
  コマンドの実行結果
  --------------------------------------------------
  www1.avswa.com. 82266 IN CNAME vm11.avswa.com.
  vm11.avswa.com. 76674 IN A     192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer -x 192.168.122.11 ptr
  
  コマンドの実行結果
  --------------------------------------------------
  11.122.168.192.in-addr.arpa. 76691 IN PTR vm11.example.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer mail.avswa.com mx
  
  コマンドの実行結果
  --------------------------------------------------
  mail.avswa.com. 76673 IN MX 10 vm11.avswa.com.
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer yahoo.co.jp soa -> キャッシュサーバーにインターネット上のゾーンを問合せ
  
  コマンドの実行結果
  --------------------------------------------------
  yahoo.co.jp. 900 IN SOA yahoo.co.jp. postmaster.yahoo.co.jp. 2306160028 1800 900 86400 900
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer yahoo.co.jp ns
  
  コマンドの実行結果
  --------------------------------------------------
  yahoo.co.jp. 900 IN NS ns11.yahoo.co.jp.
  yahoo.co.jp. 900 IN NS ns01.yahoo.co.jp.
  yahoo.co.jp. 900 IN NS ns12.yahoo.co.jp.
  yahoo.co.jp. 900 IN NS ns02.yahoo.co.jp.
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer ns01.yahoo.co.jp a
  
  コマンドの実行結果
  --------------------------------------------------
  ns01.yahoo.co.jp. 456 IN A 118.151.254.133
  --------------------------------------------------
  
  $ cd $HOME
  $ dig @vm13 +noall +answer -x 118.151.254.133 ptr
  
  コマンドの実行結果
  --------------------------------------------------
  133.254.151.118.in-addr.arpa. 900 IN PTR ns01.yahoo.co.jp.
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[019]
  管理コマンド - 06
  
[内容]
  ## 作業内容
    キャッシュを全消去
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun 17 12:39:49 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ dig @localhost +noall +answer +norec www.yahoo.co.jp a
    
    コマンドの実行結果
    --------------------------------------------------
    www.yahoo.co.jp. 521 IN CNAME edge12.g.yimg.jp.
    edge12.g.yimg.jp. 20 IN A     182.22.25.252
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo rndc -k /var/named/chroot/etc/rndc.key flush -> キャッシュを全消去
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ dig @localhost +noall +answer +norec www.yahoo.co.jp a
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[020]
  管理コマンド - 07
  
[内容]
  ## 作業内容
    キャッシュ中から特定レコードを消去
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun 17 15:34:37 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ dig @localhost +noall +answer +norec www1.avswa.com a
    
    コマンドの実行結果
    --------------------------------------------------
    www1.avswa.com. 86389 IN CNAME vm11.avswa.com.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ dig @localhost +noall +answer +norec www2.avswa.com a
    
    コマンドの実行結果
    --------------------------------------------------
    www2.avswa.com. 86371 IN CNAME vm11.avswa.com.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo rndc -k /var/named/chroot/etc/rndc.key flushname www1.avswa.com -> キャッシュ中から特定レコードを消去
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ dig @localhost +noall +answer +norec www1.avswa.com a
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ dig @localhost +noall +answer +norec www2.avswa.com a
    
    コマンドの実行結果
    --------------------------------------------------
    www2.avswa.com. 86310 IN CNAME vm11.avswa.com.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[021]
  ラウンドロビン
  
[内容]
  ## 作業内容
    ホスト名に対応するIPアドレスを複数返して負荷分散を図る
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun 17 16:09:18 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/avswa.com.zone -> 正引きファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11 makoto (
      2023061701  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                     IN  NS     vm11             ; Master
    vm11             IN  A      192.168.122.11   ; Host1
    vm12             IN  A      192.168.122.12   ; Host2
    vm13             IN  A      192.168.122.13   ; Host3
    www              IN  A      192.168.122.11   ; Web Site  // www.avswa.com に対応するIPアドレスが複数
    www              IN  A      192.168.122.12   ; Web Site  // www.avswa.com に対応するIPアドレスが複数
    www              IN  A      192.168.122.13   ; Web Site  // www.avswa.com に対応するIPアドレスが複数
    mail             IN  MX 10  vm11             ; Mail Server
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot avswa.com /var/named/avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone avswa.com/IN: loaded serial 2023061701
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/named/chroot/var/named/rev.avswa.com.zone -> 逆引きファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    $TTL 1D
    @ IN SOA vm11.avswa.com. makoto.avswa.com. (
      2023061701  ; serial  // シリアル更新
      5M          ; refresh
      5M          ; retry
      1D          ; expire
      1D          ; negative
    )
    
                                  IN  NS   vm11.example.com.
    11                            IN  PTR  vm11.example.com.
    12                            IN  PTR  vm12.example.com.
    13                            IN  PTR  vm13.example.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo named-checkzone -t /var/named/chroot 122.168.192.in-addr.arpa /var/named/rev.avswa.com.zone -> ゾーン情報チェック
    
    コマンドの実行結果
    --------------------------------------------------
    zone 122.168.192.in-addr.arpa/IN: loaded serial 2023061701
    OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rndc -k /var/named/chroot/etc/rndc.key reload -> ゾーン情報をリロード
    
    コマンドの実行結果
    --------------------------------------------------
    server reload successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost +noall +answer www.avswa.com a
    
    コマンドの実行結果
    --------------------------------------------------
    www.avswa.com.  86400  IN  A  192.168.122.12
    www.avswa.com.  86400  IN  A  192.168.122.13
    www.avswa.com.  86400  IN  A  192.168.122.11
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[022]
  ソフトウェア停止
  
[内容]
  ## 作業内容
    ソフトウェア停止
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun 17 17:10:23 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl stop named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl disable named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    Removed /etc/systemd/system/multi-user.target.wants/named-chroot.service.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 16 14:31:25 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl stop named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl disable named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    Removed /etc/systemd/system/multi-user.target.wants/named-chroot.service.
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm12 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun 17 15:48:03 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl stop named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl disable named-chroot
    
    コマンドの実行結果
    --------------------------------------------------
    Removed /etc/systemd/system/multi-user.target.wants/named-chroot.service.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm13 closed.
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X01]
  PowerDNS - 01
  
[内容]
  ## 作業内容
    コンテンツサーバー構築 => https://doc.powerdns.com/authoritative/guides/basic-database.html
  
  ## 備考
    バックエンドデータベース : SQLite3
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun 17 19:46:51 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ which sqlite3 -> コマンド確認
    
    コマンドの実行結果
    --------------------------------------------------
    /usr/bin/sqlite3
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo find / -name pdns.conf -> 設定ファイル確認
    
    コマンドの実行結果
    --------------------------------------------------
    /etc/pdns/pdns.conf
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/pdns/pdns.conf -> ファイル末尾に追加
    
    コマンドの実行結果
    --------------------------------------------------
    launch=gsqlite3
    gsqlite3-database=/var/lib/powerdns/pdns.sqlite3
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /var/lib/powerdns
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo sqlite3 /var/lib/powerdns/pdns.sqlite3 < /usr/share/doc/pdns/schema.sqlite3.sql -> バックエンドデータベース作成
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chown -R pdns:pdns /var/lib/powerdns
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl start pdns
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl is-active pdns
    
    コマンドの実行結果
    --------------------------------------------------
    active
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost www.example.com a -> サンプルレコード問合せ
    
    コマンドの実行結果
    --------------------------------------------------
    ; <<>> DiG 9.11.36-RedHat-9.11.36-8.el8 <<>> @localhost www.example.com a
    ; (2 servers found)
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: REFUSED, id: 33177  // REFUSED -> 該当レコードなし
    ;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1
    ;; WARNING: recursion requested but not available
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 1232
    ;; QUESTION SECTION:
    ;www.example.com. IN A
    
    ;; Query time: 11 msec
    ;; SERVER: ::1#53(::1)
    ;; WHEN: 日  6月 18 11:19:20 JST 2023
    ;; MSG SIZE  rcvd: 44
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo -u pdns pdnsutil create-zone avswa.com vm11.avswa.com -> ゾーン追加
    
    コマンドの実行結果
    --------------------------------------------------
    Creating empty zone 'avswa.com'
    Also adding one NS record
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo -u pdns pdnsutil clear-zone avswa.com -> ゾーン情報クリア(メンテナンス用に記述)
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME -> ゾーンにレコード登録
    vm11$ sudo -u pdns pdnsutil add-record avswa.com . SOA 'vm11.avswa.com. makoto.example.com. 2023061801 300 300 300 300'
    vm11$ sudo -u pdns pdnsutil add-record avswa.com 'vm11' A 192.168.122.11
    vm11$ sudo -u pdns pdnsutil add-record avswa.com 'vm12' A 192.168.122.12
    vm11$ sudo -u pdns pdnsutil add-record avswa.com 'vm13' A 192.168.122.13
    vm11$ sudo -u pdns pdnsutil add-record avswa.com 'www1' CNAME 'vm11.avswa.com'
    vm11$ sudo -u pdns pdnsutil add-record avswa.com 'www2' CNAME 'vm12.avswa.com'
    vm11$ sudo -u pdns pdnsutil add-record avswa.com 'mail' MX '10 vm11.avswa.com'
    
    コマンドの実行結果
    --------------------------------------------------
    // avswa.com
    New rrset:
    avswa.com. 3600 IN SOA vm11.avswa.com makoto.example.com 2023061801 300 300 300 300
    
    // vm11
    New rrset:
    vm11.avswa.com. 3600 IN A 192.168.122.11
    
    // vm12
    New rrset:
    vm12.avswa.com. 3600 IN A 192.168.122.12
    
    // vm13
    New rrset:
    vm13.avswa.com. 3600 IN A 192.168.122.13
    
    // www1
    New rrset:
    www1.avswa.com. 3600 IN CNAME vm11.avswa.com
    
    // www2
    New rrset:
    www2.avswa.com. 3600 IN CNAME vm12.avswa.com
    
    // mail
    New rrset:
    mail.avswa.com. 3600 IN MX 10 vm11.avswa.com
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo -u pdns pdnsutil list-zone avswa.com -> ゾーン情報
    
    コマンドの実行結果
    --------------------------------------------------
    $ORIGIN .
    avswa.com 3600 IN SOA vm11.avswa.com makoto.example.com 2023061801 300 300 300 300
    vm11.avswa.com 3600 IN A     192.168.122.11
    vm12.avswa.com 3600 IN A     192.168.122.12
    vm13.avswa.com 3600 IN A     192.168.122.13
    www1.avswa.com 3600 IN CNAME vm11.avswa.com.
    www2.avswa.com 3600 IN CNAME vm12.avswa.com.
    mail.avswa.com 3600 IN MX 10 vm11.avswa.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo -u pdns pdnsutil create-zone 122.168.192.in-addr.arpa vm11.avswa.com -> ゾーン追加
    
    コマンドの実行結果
    --------------------------------------------------
    Creating empty zone '122.168.192.in-addr.arpa'
    Also adding one NS record
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo -u pdns pdnsutil clear-zone 122.168.192.in-addr.arpa -> ゾーン情報クリア(メンテナンス用に記述)
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME -> ゾーンにレコード登録
    vm11$ sudo -u pdns pdnsutil add-record 122.168.192.in-addr.arpa . SOA 'vm11.avswa.com. makoto.example.com. 2023061801 300 300 300 300'
    vm11$ sudo -u pdns pdnsutil add-record 122.168.192.in-addr.arpa 11 PTR vm11.avswa.com
    vm11$ sudo -u pdns pdnsutil add-record 122.168.192.in-addr.arpa 12 PTR vm12.avswa.com
    vm11$ sudo -u pdns pdnsutil add-record 122.168.192.in-addr.arpa 13 PTR vm13.avswa.com
    
    コマンドの実行結果
    --------------------------------------------------
    // 122.168.192.in-addr.arpa
    New rrset:
    122.168.192.in-addr.arpa. 3600 IN SOA vm11.avswa.com makoto.example.com 2023061801 300 300 300 300
    
    // 192.168.122.11
    New rrset:
    11.122.168.192.in-addr.arpa. 3600 IN PTR vm11.avswa.com

    // 192.168.122.12
    New rrset:
    12.122.168.192.in-addr.arpa. 3600 IN PTR vm12.avswa.com
    
    // 192.168.122.13
    New rrset:
    13.122.168.192.in-addr.arpa. 3600 IN PTR vm13.avswa.com
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo -u pdns pdnsutil list-zone 122.168.192.in-addr.arpa -> ゾーン情報
    
    コマンドの実行結果
    --------------------------------------------------
    $ORIGIN .
    122.168.192.in-addr.arpa 3600 IN SOA vm11.avswa.com makoto.example.com 2023061801 300 300 300 300
    11.122.168.192.in-addr.arpa 3600 IN PTR vm11.avswa.com
    12.122.168.192.in-addr.arpa 3600 IN PTR vm12.avswa.com
    13.122.168.192.in-addr.arpa 3600 IN PTR vm13.avswa.com
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dig @localhost +short vm11.avswa.com a
    vm11$ dig @localhost +short vm12.avswa.com a
    vm11$ dig @localhost +short vm13.avswa.com a
    vm11$ dig @localhost +short www1.avswa.com a
    vm11$ dig @localhost +short www2.avswa.com a
    vm11$ dig @localhost +short mail.avswa.com mx
    vm11$ dig @localhost +short -x 192.168.122.11 ptr
    vm11$ dig @localhost +short -x 192.168.122.12 ptr
    vm11$ dig @localhost +short -x 192.168.122.13 ptr

    コマンドの実行結果
    --------------------------------------------------
    // vm11.avswa.com
    192.168.122.11
    
    // vm12.avswa.com
    192.168.122.12
    
    // vm13.avswa.com
    192.168.122.13
    
    // www1.avswa.com
    vm11.avswa.com.
    192.168.122.11

    // www2.avswa.com
    vm12.avswa.com.
    192.168.122.12
    
    // mail.avswa.com
    10 vm11.avswa.com.

    // 192.168.122.11
    vm11.avswa.com.

    // 192.168.122.12
    vm12.avswa.com.

    // 192.168.122.13
    vm13.avswa.com.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl stop pdns
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl disable pdns
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
