================================================================================
[01] ビルド練習 - 01
[02] ビルド練習 - 02
[03] カーネルバージョン - 01 (uname)
[04] カーネルバージョン - 02 (cat /proc/version)
[05] カーネルバージョン - 03 (Makefile)
[06] カーネルイメージ
[07] カーネルのコンパイルとインストール
[08] カーネルモジュール - 01 (FHS)
[09] カーネルモジュール - 02 (insmod)
[10] カーネルモジュール - 03 (rmmod)
[11] カーネルモジュール - 04 (modprobe)
[12] カーネルモジュール - 05 (depmod)
[13] カーネルモジュール - 06 (modinfo)
[14] カーネルモジュール - 07 (lsmod)
[15] カーネルモジュール - 08 (cat /proc/modules)
[16] カーネルモジュール - 09 (Parameter Set 1)
[17] カーネルモジュール - 10 (Parameter Set 2)
[18] カーネルパラメータの設定 - 01
[19] カーネルパラメータの設定 - 02
[20] カーネルパラメータの設定 - 03
[21] 初期RAMディスク - 01 (lsinitrd)
[22] 初期RAMディスク - 02 (mkinitrd)
[23] 仮想ファイルシステム(/proc) - 01 (cat /proc/cmdline)
[24] 仮想ファイルシステム(/proc) - 02 (cat /proc/cpuinfo)
[25] 仮想ファイルシステム(/proc) - 03 (cat /proc/filesystems)
[26] 仮想ファイルシステム(/proc) - 04 (cat /proc/swaps)
[27] 仮想ファイルシステム(/proc) - 05 (cat /proc/version)
[28] 仮想ファイルシステム(/proc) - 06 (ls -lh /proc/bus/pci)
[29] 仮想ファイルシステム(/proc) - 07 (ls -lh /proc/bus/usb)
[30] デバイスファイル
[31] ループバックデバイス
[32] 動的デバイス管理(udev) - 01 (/etc/udev/rules.d)
[33] 動的デバイス管理(udev) - 02 (udevadm info)
[34] 動的デバイス管理(udev) - 03 (udevadm monitor)
================================================================================
[01]
  ビルド練習 - 01
  
[内容]
  ## 作業内容
    簡単なプログラム作成後に、Makefileを使用せずビルド
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C sudo yum groups list (パッケージグループ一覧)
  
  コマンドの実行結果
  --------------------------------------------------
  Available Environment Groups:
    Minimal Install
    Compute Node
    Infrastructure Server
    File and Print Server
    Cinnamon Desktop
    MATE Desktop
    Basic Web Server
    Virtualization Host
    Server with GUI
    GNOME Desktop
    KDE Plasma Workspaces
    Development and Creative Workstation
  Available Groups:
    Cinnamon
    Compatibility Libraries
    Console Internet Tools
    Development Tools -> 開発ツール、これが必要
    Educational Software
    Electronic Lab
    Fedora Packager
    General Purpose Desktop
    Graphical Administration Tools
    Haskell
    LXQt Desktop
    Legacy UNIX Compatibility
    MATE
    Milkymist
    Scientific Support
    Security Tools
    Smart Card Support
    System Administration Tools
    System Management
    TurboGears application framework
    Xfce
  Done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo yum -y groupinstall 'Development Tools' (パッケージグループをインストール)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME/hello -> 先にディレクトリ作成
  vm11$ vi hello.h (ヘッダファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  #ifndef hello_h_
  
  void Hello1(void);  // 関数プロトタイプ宣言
  void Hello2(void);  // 関数プロトタイプ宣言
  
  #endif
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ vi hello.c (ソースファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  #include <stdio.h>
  #include "hello.h"
  
  void Hello1(void) { printf("Hello1\n"); }  // 関数実装
  void Hello2(void) { printf("Hello2\n"); }  // 関数実装
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ vi main.c (プログラム本体)
  
  コマンドの実行結果
  --------------------------------------------------
  #include "hello.h"
  
  int main(void)
  {
    Hello1();  // 関数呼出
    Hello2();  // 関数呼出
    return 0;
  }
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ gcc -o hello main.c hello.c (Makefileを使用せずビルド)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrwxr-x. 1 makoto makoto 8.3K  4月 16 07:39 hello
  -rw-rw-r--. 1 makoto makoto  123  4月 16 07:39 hello.c
  -rw-rw-r--. 1 makoto makoto   64  4月 16 07:34 hello.h
  -rw-rw-r--. 1 makoto makoto   75  4月 16 07:37 main.c
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ ./hello (ビルドされた実行ファイルを実行)
  
  コマンドの実行結果
  --------------------------------------------------
  Hello1
  Hello2
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ rm hello
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  ビルド練習 - 02
  
[内容]
  ## 作業内容
    Makefileによるビルドを行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME/hello
  vm11$ vi Makefile (Makefileを記述)
  
  コマンドの実行結果
  --------------------------------------------------
  // 単にmakeと実行した場合は一番上のターゲットが実行
  // ファイル行頭の空白はタブ
  
  PROG := hello
  OBJ1 := main.o
  OBJ2 := hello.o
  SRC1 := main.c
  SRC2 := hello.c
  COMP := gcc
  
  $(PROG): $(OBJ1) $(OBJ2)
    $(COMP) $(OBJ1) $(OBJ2) -o $(PROG)
  
  $(OBJ1): $(SRC1)
    $(COMP) -c $(SRC1)
  
  $(OBJ2): $(SRC2)
    $(COMP) -c $(SRC2)
  
  clean:
    rm -f $(PROG) $(OBJ1) $(OBJ2)
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ make -n (実行処理をシミューレート)
  
  コマンドの実行結果
  --------------------------------------------------
  gcc -c main.c
  gcc -c hello.c
  gcc main.o hello.o -o hello
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ make (Makefileによるビルド)
  
  コマンドの実行結果
  --------------------------------------------------
  gcc -c main.c
  gcc -c hello.c
  gcc main.o hello.o -o hello
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-rw-r--. 1 makoto makoto  265  4月 16 07:42 Makefile
  -rwxrwxr-x. 1 makoto makoto 8.3K  4月 16 07:43 hello
  -rw-rw-r--. 1 makoto makoto  123  4月 16 07:39 hello.c
  -rw-rw-r--. 1 makoto makoto   64  4月 16 07:34 hello.h
  -rw-rw-r--. 1 makoto makoto 1.7K  4月 16 07:43 hello.o
  -rw-rw-r--. 1 makoto makoto   75  4月 16 07:37 main.c
  -rw-rw-r--. 1 makoto makoto 1.4K  4月 16 07:43 main.o
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ ./hello (ビルドされた実行ファイルを実行)
  
  コマンドの実行結果
  --------------------------------------------------
  Hello1
  Hello2
  --------------------------------------------------
  
  vm11$ cd $HOME/hello
  vm11$ make clean (実行ファイルと中間ファイルを削除)
  
  コマンドの実行結果
  --------------------------------------------------
  rm -f hello main.o hello.o
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  カーネルバージョン - 01 (uname)
  
[内容]
  ## 作業内容
    カーネルバージョンをコマンド(uname)から調査
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ uname -r
  
  コマンドの実行結果
  --------------------------------------------------
  3.10.0-1160.el7.x86_64 -> 3(メジャー番号)、10(マイナー番号)、0(リリース番号)、-1160.el7.x86_64(エクストラ番号)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  カーネルバージョン - 02 (cat /proc/version)
  
[内容]
  ## 作業内容
    カーネルバージョンをコマンド(cat /proc/version)から調査
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ cat /proc/version
  
  コマンドの実行結果
  --------------------------------------------------
  Linux version 3.10.0-1160.el7.x86_64 (省略) -> コマンド(uname)と同一
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  カーネルバージョン - 03 (Makefile)
  
[内容]
  ## 作業内容
    カーネルバージョンをファイル(Makefile)から調査
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ ls -lh /usr/src/kernels (カーネルソースのディレクトリ)
  
  コマンドの実行結果
  --------------------------------------------------
  drwxr-xr-x. 22 root root 4.0K  4月 16 07:32 3.10.0-1160.88.1.el7.x86_64.debug
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/3.10.0-1160.88.1.el7.x86_64.debug
  vm11$ head -n 4 Makefile (ファイル(Makefile)を参照)
  
  コマンドの実行結果
  --------------------------------------------------
  VERSION = 3
  PATCHLEVEL = 10
  SUBLEVEL = 0
  EXTRAVERSION = -1160.88.1.el7.x86_64.debug
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[06]
  カーネルイメージ
  
[内容]
  ## 作業内容
    パス(/boot)からカーネルイメージを検索
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ ls -lh /boot | grep $(uname -r)
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-------. 1 root root 3.5M 10月 20  2020 System.map-3.10.0-1160.el7.x86_64
  -rw-r--r--. 1 root root 150K 10月 20  2020 config-3.10.0-1160.el7.x86_64
  -rw-------. 1 root root  21M  4月 15 12:11 initramfs-3.10.0-1160.el7.x86_64.img  // 初期RAMディスク
  -rw-------. 1 root root  13M  4月 15 18:12 initramfs-3.10.0-1160.el7.x86_64kdump.img
  -rw-r--r--. 1 root root 314K 10月 20  2020 symvers-3.10.0-1160.el7.x86_64.gz
  -rwxr-xr-x. 1 root root 6.5M 10月 20  2020 vmlinuz-3.10.0-1160.el7.x86_64  // カーネルイメージ
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[07]
  カーネルのコンパイルとインストール
  
[内容]
  ## 作業内容
    カーネル(4.15.3)のコンパイルとインストール
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install kernel-devel ncurses-devel elfutils-libelf-devel openssl-devel bc (パッケージのインストール)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels
  vm11$ sudo wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.15.3.tar.xz (カーネルソースのダウンロード)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels
  vm11$ sudo xz -d linux-4.15.3.tar.xz (カーネルソースの解凍)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> unxzコマンドでもOK
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels
  vm11$ sudo tar xf linux-4.15.3.tar (カーネルソースの展開)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels
  vm11$ ls -lh | grep linux | grep -E '^d'
  
  コマンドの実行結果
  --------------------------------------------------
  drwxrwxr-x. 24 root root 4.0K  2月 12  2018 linux-4.15.3 -> コンパイル対象のカーネル
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/linux-4.15.3
  vm11$ sudo make menuconfig (カーネルの設定変更)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> ツールを開いた直後に保存して終了 -> 設定内容がファイル「.config」に保存
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/linux-4.15.3
  vm11$ ls -lh .config (カーネルの設定ファイルを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 180K  4月 16 07:58 .config
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/linux-4.15.3
  vm11$ sudo nice -n -10 make (優先度「-10」を指定してカーネルをコンパイル)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 2.5時間程で完了
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/linux-4.15.3
  vm11$ sudo make modules_install (カーネルモジュールをインストール)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 5分程で完了
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/linux-4.15.3
  vm11$ sudo make install (カーネル本体をインストール)
  
  コマンドの実行結果
  --------------------------------------------------
  sh ./arch/x86/boot/install.sh 4.15.3 arch/x86/boot/bzImage System.map "/boot" -> 5分程で完了、圧縮形式はbzimage
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/linux-4.15.3
  vm11$ LANG=C df -mT (ディスク空き容量)
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      1M-blocks   Used  Available  Use%  Mounted on
  devtmpfs                      devtmpfs        884      0        884    0%  /dev
  tmpfs                         tmpfs           895      0        895    0%  /dev/shm
  tmpfs                         tmpfs           895      9        887    1%  /run
  tmpfs                         tmpfs           895      0        895    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs           17394  16173       1222   93%  / (空き容量がギリギリの状態)
  /dev/vda1                     xfs            1014    199        816   20%  /boot
  tmpfs                         tmpfs            99      0         99    0%  /run/user/1000
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/linux-4.15.3
  vm11$ sudo make clean (不要な中間ファイルを削除してディスク容量に空きを作る)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 設定ファイル(.config)は残る
  --------------------------------------------------
  
  vm11$ cd /usr/src/kernels/linux-4.15.3
  vm11$ LANG=C df -mT (ディスク空き容量)
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      1M-blocks   Used  Available  Use%  Mounted on
  devtmpfs                      devtmpfs        884      0        884    0%  /dev
  tmpfs                         tmpfs           895      0        895    0%  /dev/shm
  tmpfs                         tmpfs           895      9        887    1%  /run
  tmpfs                         tmpfs           895      0        895    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs           17394   6418      10977   37%  / (空き容量が10GB程度増えた)
  /dev/vda1                     xfs            1014    199        816   20%  /boot
  tmpfs                         tmpfs            99      0         99    0%  /run/user/1000
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo grub2-editenv list (デフォルト起動されるカーネル確認)
  
  コマンドの実行結果
  --------------------------------------------------
  saved_entry=CentOS Linux (3.10.0-1160.el7.x86_64) 7 (Core) -> デフォルト起動は旧パージョンのカーネルのまま
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo grep -E '^menuentry' /etc/grub2.cfg (起動可能なカーネルリストを番号表示)
  
  コマンドの実行結果
  --------------------------------------------------
  menuentry 'CentOS Linux (4.15.3) 7 (Core)' ...                                     // 0
  menuentry 'CentOS Linux (3.10.0-1160.el7.x86_64) 7 (Core)' ...                     // 1
  menuentry 'CentOS Linux (0-rescue-9a873402a94f4530a872af79d68bdeb7) 7 (Core)' ...  // 2
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo grub2-set-default 0 (デフォルト起動のカーネルを番号指定)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> デフォルト起動されるカーネルを新カーネル(4.15.3)に変更
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo grub2-editenv list (デフォルト起動されるカーネル確認)
  
  コマンドの実行結果
  --------------------------------------------------
  saved_entry=0 -> 新カーネル(4.15.3)の番号を確認
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo systemctl reboot (システム再起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> カーネル選択画面に新カーネル(4.15.3)が確認できた
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ uname -r
  
  コマンドの実行結果
  --------------------------------------------------
  4.15.3 -> 起動後に新カーネル(4.15.3)を確認
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[08]
  カーネルモジュール - 01 (FHS)
  
[内容]
  ## 作業内容
    カーネルモジュールの格納されているディレクトリ構成(FHS)を把握する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ uname -r
  
  コマンドの実行結果
  --------------------------------------------------
  4.15.3 -> 4(メジャー番号)、15(マイナー番号)、3(リリース番号)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo find /lib/modules -name $(uname -r) (カーネルモジュールのディレクトリを検索)
  
  コマンドの実行結果
  --------------------------------------------------
  /lib/modules/4.15.3
  --------------------------------------------------
  
  vm11$ cd /lib/modules/4.15.3
  vm11$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx.  1 root root   29  4月 16 10:36 build -> /usr/src/kernels/linux-4.15.3
  drwxr-xr-x. 12 root root  128  4月 16 10:38 kernel // カーネルモジュール格納場所
  -rw-r--r--.  1 root root 833K  4月 16 10:41 modules.alias // 別名ファイル
  -rw-r--r--.  1 root root 800K  4月 16 10:41 modules.alias.bin
  -rw-r--r--.  1 root root 7.7K  4月 16 10:36 modules.builtin
  -rw-r--r--.  1 root root  10K  4月 16 10:41 modules.builtin.bin
  -rw-r--r--.  1 root root 246K  4月 16 10:41 modules.dep // モジュール依存関係
  -rw-r--r--.  1 root root 352K  4月 16 10:41 modules.dep.bin
  -rw-r--r--.  1 root root  411  4月 16 10:41 modules.devname
  -rw-r--r--.  1 root root  97K  4月 16 10:36 modules.order
  -rw-r--r--.  1 root root  515  4月 16 10:41 modules.softdep
  -rw-r--r--.  1 root root 386K  4月 16 10:41 modules.symbols
  -rw-r--r--.  1 root root 472K  4月 16 10:41 modules.symbols.bin
  lrwxrwxrwx.  1 root root   29  4月 16 10:36 source -> /usr/src/kernels/linux-4.15.3
  --------------------------------------------------
  
  vm11$ cd /lib/modules/4.15.3/kernel
  vm11$ ls -lh (カーネルモジュール格納場所の内部確認)
  
  コマンドの実行結果
  --------------------------------------------------
  drwxr-xr-x.  3 root root   17  4月 16 10:36 arch    // アーキテクチャ
  drwxr-xr-x.  3 root root 4.0K  4月 16 10:36 crypto  // 暗号化
  drwxr-xr-x. 69 root root 4.0K  4月 16 10:38 drivers // デバイスドライバ
  drwxr-xr-x. 25 root root 4.0K  4月 16 10:38 fs      // ファイルシステム
  drwxr-xr-x.  3 root root   19  4月 16 10:38 kernel  // カーネル
  drwxr-xr-x.  5 root root  207  4月 16 10:38 lib     // ライブラリ
  drwxr-xr-x.  2 root root   32  4月 16 10:38 mm      // メモリ関連
  drwxr-xr-x. 35 root root 4.0K  4月 16 10:38 net     // ネットワーク
  drwxr-xr-x. 12 root root  167  4月 16 10:38 sound   // サウンド -> 仮想マシンには不要
  drwxr-xr-x.  3 root root   17  4月 16 10:38 virt    // 仮想環境 -> 仮想マシンには不要
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[09]
  カーネルモジュール - 02 (insmod)
  
[内容]
  ## 作業内容
    カーネルモジュールを作成して、コマンド(insmod)でロード
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME/sample1 -> 先にディレクトリ作成
  vm11$ vi base.c (ソースファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  #include <linux/module.h>
  #include <linux/init.h>
  
  // ライセンス情報
  MODULE_LICENSE("GPL");
  MODULE_AUTHOR("Makoto-Araki");
  MODULE_DESCRIPTION("base");
  
  // ロード時
  static int base_init(void)
  {
    printk(KERN_INFO "base init\n");
    return 0;
  }
  
  // アンロード時
  static void base_exit(void) { printk(KERN_INFO "base exit\n"); }
  
  // 関数定義
  void func1(void) { printk(KERN_INFO "func1 called\n"); }
  void func2(void) { printk(KERN_INFO "func2 called\n"); }
  
  // エクスポート
  EXPORT_SYMBOL(func1);
  EXPORT_SYMBOL(func2);
  
  module_init( base_init );
  module_exit( base_exit );
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ vi sample1.c (ソースファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  #include <linux/module.h>
  #include <linux/kernel.h>
  
  // プロトタイプ宣言
  void func1(void);
  void func2(void);
  
  // ライセンス情報
  MODULE_LICENSE("GPL");
  MODULE_AUTHOR("Makoto-Araki");
  MODULE_DESCRIPTION("sample1");
  
  // ロード時
  static int sample1_init(void)
  {
    printk( KERN_INFO "sample1 init\n" );
    func1();  // 他モジュールの関数実行
    func2();  // 他モジュールの関数実行
    return 0;
  }
  
  // アンロード時
  static void sample1_exit(void) { printk( KERN_INFO "sample1 exit\n" ); }
  
  module_init( sample1_init );
  module_exit( sample1_exit );
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ vi Makefile (Makefileを記述)
  
  コマンドの実行結果
  --------------------------------------------------
  // 既存ファイル(/lib/modules/4.15.3/build/Makefile)のターゲットを利用
  obj-m := sample1.o base.o
  
  all:
    make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) modules
  
  clean:
    make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) clean
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ make -n (実行処理をシミューレート)
  
  コマンドの実行結果
  --------------------------------------------------
  make -C /lib/modules/4.15.3/build M=/home/makoto/sample1 modules
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ make (ビルド実行)
  
  コマンドの実行結果
  --------------------------------------------------
  make -C /lib/modules/4.15.3/build M=/home/makoto/sample1 modules
  make[1]: ディレクトリ `/usr/src/kernels/linux-4.15.3' に入ります
    CC [M]  /home/makoto/sample1/sample1.o
    CC [M]  /home/makoto/sample1/base.o
    Building modules, stage 2.
    MODPOST 2 modules
    CC      /home/makoto/sample1/base.mod.o
    LD [M]  /home/makoto/sample1/base.ko
    CC      /home/makoto/sample1/sample1.mod.o
    LD [M]  /home/makoto/sample1/sample1.ko
  make[1]: ディレクトリ `/usr/src/kernels/linux-4.15.3' から出ます
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-rw-r--. 1 makoto makoto  176  4月 16 11:33 Makefile
  -rw-rw-r--. 1 makoto makoto  114  4月 16 11:34 Module.symvers
  -rw-rw-r--. 1 makoto makoto  592  4月 16 11:32 base.c
  -rw-rw-r--. 1 makoto makoto 124K  4月 16 11:34 base.ko -> カーネルモジュール
  -rw-rw-r--. 1 makoto makoto  853  4月 16 11:34 base.mod.c
  -rw-rw-r--. 1 makoto makoto  70K  4月 16 11:34 base.mod.o
  -rw-rw-r--. 1 makoto makoto  59K  4月 16 11:34 base.o
  -rw-rw-r--. 1 makoto makoto   75  4月 16 11:34 modules.order
  -rw-rw-r--. 1 makoto makoto  584  4月 16 11:32 sample1.c
  -rw-rw-r--. 1 makoto makoto 122K  4月 16 11:34 sample1.ko -> カーネルモジュール
  -rw-rw-r--. 1 makoto makoto  949  4月 16 11:34 sample1.mod.c
  -rw-rw-r--. 1 makoto makoto  70K  4月 16 11:34 sample1.mod.o
  -rw-rw-r--. 1 makoto makoto  56K  4月 16 11:34 sample1.o
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ modinfo base.ko (カーネルモジュールの詳細情報表示)
  
  コマンドの実行結果
  --------------------------------------------------
  filename:       /home/makoto/sample1/base.ko
  description:    base
  author:         Makoto-Araki
  license:        GPL
  srcversion:     F97D838A3F67D2B0738370E
  depends:        (依存モジュール無し)
  retpoline:      Y
  name:           base
  vermagic:       4.15.3 SMP mod_unload modversions 
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ modinfo sample1.ko (カーネルモジュールの詳細情報表示)
  
  コマンドの実行結果
  --------------------------------------------------
  filename:       /home/makoto/sample1/sample1.ko
  description:    sample1
  author:         Makoto-Araki
  license:        GPL
  srcversion:     F1D32A59A79F9BEB488D4E5
  depends:        base (baseモジュールに依存)
  retpoline:      Y
  name:           sample1
  vermagic:       4.15.3 SMP mod_unload modversions 
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ sudo insmod base.ko (カーネルモジュールのロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 2638.788717] base init -> 初回のみカーネルツリー外からのロードです、という意味の警告メッセージが出力
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ sudo insmod sample1.ko (カーネルモジュールのロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 2693.578594] sample1 init
  [ 2693.580103] func1 called  // baseモジュールの関数実行
  [ 2693.581408] func2 called  // baseモジュールの関数実行
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ sudo rmmod sample1.ko (カーネルモジュールのアンロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 2844.979185] sample1 exit
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ sudo rmmod base.ko (カーネルモジュールのアンロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 2890.677721] base exit
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ sudo cp -p *.ko /lib/modules/$(uname -r)/kernel/kernel (カーネルモジュールをシステム規定の場所にコピー)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 後のコマンド「modprobe」は依存関係ファイル(modules.dep)に記述が無いと動作しないため
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ sudo depmod (依存関係ファイルを更新)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> /lib/modules/$(uname -r)/modules.depを更新
  --------------------------------------------------
  
  vm11$ cd $HOME/sample1
  vm11$ sudo grep -E 'base|sample1' /lib/modules/$(uname -r)/modules.dep (依存関係ファイルを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  kernel/kernel/sample1.ko: kernel/kernel/base.ko
  kernel/kernel/base.ko:
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo modprobe sample1 (カーネルモジュールのロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 3090.930929] base init
  [ 3090.933586] sample1 init
  [ 3090.935034] func1 called
  [ 3090.936509] func2 called
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lsmod | grep -E 'base|sample1' (カーネルモジュールの一覧表示)
  
  コマンドの実行結果
  --------------------------------------------------
  sample1                16384  0 
  base                   16384  1 sample1 -> base は sample1 が参照している
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo cat /proc/modules | grep -E 'base|sample1' (カーネルモジュールの一覧表示)
  
  コマンドの実行結果
  --------------------------------------------------
  sample1 16384 0 - Live 0xffffffffc0681000 (OE)
  base 16384 1 sample1, Live 0xffffffffc067c000 (OE) -> base は sample1 が参照している
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo modprobe -r sample1 (カーネルモジュールのアンロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 3172.765596] sample1 exit
  [ 3172.768971] base exit -> baseモジュールまでアンロードされる仕様
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo modprobe --show-depends sample1 (カーネルモジュールの依存関係を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  insmod /lib/modules/4.15.3/kernel/kernel/base.ko 
  insmod /lib/modules/4.15.3/kernel/kernel/sample1.ko 
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[10]
  カーネルモジュール - 03 (rmmod)
  
[内容]
  ## 作業内容
    作成したカーネルモジュールをコマンド(rmmod)でアンロードする
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「09」を参照
  
================================================================================
[11]
  カーネルモジュール - 04 (modprobe)
  
[内容]
  ## 作業内容
    作成したカーネルモジュールをコマンド(modprobe)でロード・アンロードする
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「09」を参照
  
================================================================================
[12]
  カーネルモジュール - 05 (depmod)
  
[内容]
  ## 作業内容
    作成したカーネルモジュールをコマンド(depmod)で依存関係ファイル(modules.dep)に登録する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「09」を参照
  
================================================================================
[13]
  カーネルモジュール - 06 (modinfo)
  
[内容]
  ## 作業内容
    作成したカーネルモジュールの詳細情報をコマンド(modinfo)で表示する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「09」を参照
  
================================================================================
[14]
  カーネルモジュール - 07 (lsmod)
  
[内容]
  ## 作業内容
    作成したカーネルモジュールをコマンド(lsmod)で表示する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「09」を参照
  
================================================================================
[15]
  カーネルモジュール - 08 (cat /proc/modules)
  
[内容]
  ## 作業内容
    作成したカーネルモジュールをコマンド(cat /proc/modules)で表示する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「09」を参照
  
================================================================================
[16]
  カーネルモジュール - 09 (Parameter Set 1)
  
[内容]
  ## 作業内容
    カーネルモジュール起動時にパラメータ値を指定可能にする
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME/SAMP2 -> 先にディレクトリ作成
  vm12$ vi SAMP2.c (ソースファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  #include <linux/module.h>
  #include <linux/kernel.h>
  
  // ライセンス情報
  MODULE_LICENSE("GPL");
  MODULE_AUTHOR("Makoto-Araki");
  MODULE_DESCRIPTION("SAMP2");
  
  // パラメータ値をソース記述
  static int P1 = 11;
  static int P2 = 22;
  
  // カーネルモジュールにパラメータ組込
  module_param(P1, int, S_IWUSR);
  module_param(P2, int, S_IWUSR);
  
  // ロード時
  static int SAMP2_init(void)
  {
    printk( KERN_INFO "SAMP2 init\n" );
    printk( KERN_INFO "P1 = %d\n", P1);  // パラメータ値を表示
    printk( KERN_INFO "P2 = %d\n", P2);  // パラメータ値を表示
    return 0;
  }
  
  // アンロード時
  static void SAMP2_exit(void) { printk( KERN_INFO "SAMP2 exit\n" ); }
  
  module_init( SAMP2_init );
  module_exit( SAMP2_exit );
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ vi Makefile (Makefileを記述)
  
  コマンドの実行結果
  --------------------------------------------------
  // 既存ファイル(/lib/modules/4.15.3/build/Makefile)のターゲットを利用
  obj-m := SAMP2.o
  
  all:
    make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) modules
  
  clean:
    make -C /lib/modules/$(shell uname -r)/build M=$(shell pwd) clean
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ make -n (実行処理をシミューレート)
  
  コマンドの実行結果
  --------------------------------------------------
  make -C /lib/modules/4.15.3/build M=/home/makoto/SAMP2 modules
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ make (ビルド実行)
  
  コマンドの実行結果
  --------------------------------------------------
  make -C /lib/modules/4.15.3/build M=/home/makoto/SAMP2 modules
  make[1]: ディレクトリ `/usr/src/kernels/linux-4.15.3' に入ります
    CC [M]  /home/makoto/SAMP2/SAMP2.o
    Building modules, stage 2.
    MODPOST 1 modules
    CC      /home/makoto/SAMP2/SAMP2.mod.o
    LD [M]  /home/makoto/SAMP2/SAMP2.ko
  make[1]: ディレクトリ `/usr/src/kernels/linux-4.15.3' から出ます
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-rw-r--. 1 makoto makoto  167 12月 25 12:40 Makefile
  -rw-rw-r--. 1 makoto makoto    0 12月 25 12:42 Module.symvers
  -rw-rw-r--. 1 makoto makoto  748 12月 25 12:39 SAMP2.c
  -rw-rw-r--. 1 makoto makoto 140K 12月 25 12:42 SAMP2.ko  // カーネルモジュール
  -rw-rw-r--. 1 makoto makoto  907 12月 25 12:42 SAMP2.mod.c
  -rw-rw-r--. 1 makoto makoto  70K 12月 25 12:42 SAMP2.mod.o
  -rw-rw-r--. 1 makoto makoto  74K 12月 25 12:42 SAMP2.o
  -rw-rw-r--. 1 makoto makoto   35 12月 25 12:42 modules.order
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ modinfo SAMP2.ko (カーネルモジュールの詳細情報表示)
  
  コマンドの実行結果
  --------------------------------------------------
  filename:       /home/makoto/SAMP2/SAMP2.ko
  description:    SAMP2
  author:         Makoto-Araki
  license:        GPL
  srcversion:     630C08CBFDACE4CDD56E017
  depends:        (依存しているモジュールなし)
  retpoline:      Y
  name:           SAMP2
  vermagic:       4.15.3 SMP mod_unload modversions 
  parm:           P1:int  // 追加パラメータ
  parm:           P2:int  // 追加パラメータ
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ sudo insmod SAMP2.ko (カーネルモジュールのロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [15242.728079] SAMP2 init
  [15242.729467] P1 = 11  // 追加パラメータ
  [15242.730586] P2 = 22  // 追加パラメータ
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ sudo rmmod SAMP2.ko (カーネルモジュールのアンロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [15281.656053] SAMP2 exit
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ sudo cp -p *.ko /lib/modules/$(uname -r)/kernel/kernel (カーネルモジュールをコピー)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm12$ cd $HOME/SAMP2
  vm12$ sudo depmod (依存関係ファイルを更新)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 2分ほど時間がかかった
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo modprobe SAMP2 (カーネルモジュールのロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [15490.821975] SAMP2 init
  [15490.823478] P1 = 11  // 追加パラメータ
  [15490.824920] P2 = 22  // 追加パラメータ
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo modprobe -r SAMP2 (カーネルモジュールのアンロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [15539.678640] SAMP2 exit
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[17]
  カーネルモジュール - 10 (Parameter Set 2)
  
[内容]
  ## 作業内容
    カーネルモジュール起動時にパラメータ値を設定ファイルから指定可能にする
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd /etc/modprobe.d
  vm12$ sudo vi SAMP2.conf
  
  コマンドの実行結果
  --------------------------------------------------
  options SAMP2 P1=111
  options SAMP2 P2=222
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo modprobe SAMP2 (カーネルモジュールのロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [15765.190123] SAMP2 init
  [15765.191809] P1 = 111  // 設定ファイル値で起動
  [15765.193223] P2 = 222  // 設定ファイル値で起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo modprobe -r SAMP2 (カーネルモジュールのアンロード)
  
  コマンドの実行結果
  --------------------------------------------------
  [15806.350829] SAMP2 exit
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[18]
  カーネルパラメータの設定 - 01
  
[内容]
  ## 作業内容
    カーネルパラメータを閲覧・更新する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ cat /proc/sys/net/ipv4/ip_forward (カーネルパラメータ値を閲覧)
  
  コマンドの実行結果
  --------------------------------------------------
  0 -> IPv4のパケット転送禁止
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo echo 1 > /proc/sys/net/ipv4/ip_forward (カーネルパラメータ値を更新)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> rootユーザーにならないとエラー
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/sys/net/ipv4/ip_forward (カーネルパラメータ値を閲覧)
  
  コマンドの実行結果
  --------------------------------------------------
  1 -> IPv4のパケット転送許可
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[19]
  カーネルパラメータの設定 - 02
  
[内容]
  ## 作業内容
    カーネルパラメータを閲覧・更新する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ sysctl net/ipv4/ip_forward (カーネルパラメータ値を閲覧)
  
  コマンドの実行結果
  --------------------------------------------------
  net.ipv4.ip_forward = 0 -> IPv4のパケット転送禁止
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo sysctl -w net/ipv4/ip_forward=1 (カーネルパラメータ値を更新)
  
  コマンドの実行結果
  --------------------------------------------------
  net.ipv4.ip_forward = 1
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sysctl net/ipv4/ip_forward (カーネルパラメータ値を閲覧)
  
  コマンドの実行結果
  --------------------------------------------------
  net.ipv4.ip_forward = 1 -> IPv4のパケット転送許可
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[20]
  カーネルパラメータの設定 - 03
  
[内容]
  ## 作業内容
    カーネルパラメータを閲覧・(永続的に)更新する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ sysctl net/ipv4/ip_forward (カーネルパラメータ値を閲覧)
  
  コマンドの実行結果
  --------------------------------------------------
  net.ipv4.ip_forward = 0 -> IPv4のパケット転送禁止
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo vi /etc/sysctl.conf (設定ファイルでカーネルパラメータの永続化)
  
  コマンドの実行結果
  --------------------------------------------------
  net.ipv4.ip_forward=1
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo sysctl -p /etc/sysctl.conf (設定ファイルからカーネルパラメータ値を反映)
  
  コマンドの実行結果
  --------------------------------------------------
  net.ipv4.ip_forward = 1
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl reboot (システム再起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sysctl net/ipv4/ip_forward (カーネルパラメータ値を閲覧)
  
  コマンドの実行結果
  --------------------------------------------------
  net.ipv4.ip_forward = 1 -> IPv4のパケット転送許可
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[21]
  初期RAMディスク - 01 (lsinitrd)
  
[内容]
  ## 作業内容
    初期RAMディスクの内容を確認
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd /boot
  vm12$ ls -lh | grep -E 'vmlinuz|initramfs' (仮想マシン上のカーネルイメージと初期RAMディスクを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx. 1 root root   20 12月  4 15:46 vmlinuz -> /boot/vmlinuz-4.15.3       // システムは新カーネル(4.15.3)を起動
  -rw-------. 1 root root  21M 12月  1 19:41 initramfs-3.10.0-1160.el7.x86_64.img  // 初期RAMディスク(3.10.0)
  -rw-------. 1 root root  41M 12月  4 15:53 initramfs-4.15.3.img                  // 初期RAMディスク(4.15.3)
  -rwxr-xr-x. 1 root root 6.5M 10月 20  2020 vmlinuz-3.10.0-1160.el7.x86_64        // カーネルイメージ(3.10.0)
  -rw-r--r--. 1 root root 7.2M 12月  4 15:46 vmlinuz-4.15.3                        // カーネルイメージ(4.15.3)
  --------------------------------------------------
  
  vm12$ cd /boot
  vm12$ sudo lsinitrd initramfs-4.15.3.img | head -n 50 (初期RAMディスクの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  // 確認内容の初期RAMディスクとそのファイルサイズ
  Image: initramfs-4.15.3.img: 41M
  Version: dracut-033-572.el7
  
  // ファイル指定のオプション(-f)指定
  Arguments: -H -f
  
  // モジュール一覧
  dracut modules:
  bash
  nss-softokn
  i18n
  network
  ifcfg
  drm
  plymouth
  dm
  kernel-modules
  lvm
  qemu
  qemu-net
  resume
  rootfs-block
  terminfo
  udev-rules
  biosdevname
  systemd
  usrmount
  base
  fs-lib
  microcode_ctl-fw_dir_override
  shutdown
  
  // 初期RAMディスク内のファイル一覧(一部)
  drwxr-xr-x  12 root     root            0 Dec 25 00:41 .
  crw-r--r--   1 root     root       5,   1 Dec 25 00:35 dev/console
  crw-r--r--   1 root     root       1,  11 Dec 25 00:35 dev/kmsg
  crw-r--r--   1 root     root       1,   3 Dec 25 00:35 dev/null
  lrwxrwxrwx   1 root     root            7 Dec 25 00:35 bin -> usr/bin
  drwxr-xr-x   2 root     root            0 Dec 25 00:35 dev
  drwxr-xr-x  12 root     root            0 Dec 25 00:41 etc
  drwxr-xr-x   2 root     root            0 Dec 25 00:35 etc/cmdline.d
  drwxr-xr-x   2 root     root            0 Dec 25 00:41 etc/conf.d
  -rw-r--r--   1 root     root          124 Dec 25 00:41 etc/conf.d/systemd.conf
  -rw-r--r--   1 root     root          262 Oct  1  2020 etc/dhclient.conf
  -rw-r--r--   1 root     root            0 Dec 25 00:40 etc/fstab.empty
  -rw-r--r--   1 root     root          174 Dec 25 00:40 etc/group
  -rw-r--r--   1 root     root            5 Dec 22 17:22 etc/hostname
  -rw-r--r--   1 root     root          170 Dec 25 00:40 etc/initrd-release
  -rw-r--r--   1 root     root         8043 Dec 25 00:41 etc/ld.so.cache
  -rw-r--r--   1 root     root           28 Feb 28  2013 etc/ld.so.conf
  drwxr-xr-x   2 root     root            0 Dec 25 00:41 etc/ld.so.conf.d
  -rw-r--r--   1 root     root           26 Oct 14  2020 etc/ld.so.conf.d/bind-export-x86_64.conf
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[22]
  初期RAMディスク - 02 (mkinitrd)
  
[内容]
  ## 作業内容
    初期RAMディスクをコマンド(mkinitrd)で作成
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME/TEMP1 -> 先にディレクトリ作成
  vm12$ sudo mkinitrd BBB.img $(uname -r) (初期RAMディスクをコマンドで作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 5分程かかる
  --------------------------------------------------
  
  vm12$ cd $HOME/TEMP1
  vm12$ sudo lsinitrd BBB.img (初期RAMディスクの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 前記録を参照
  --------------------------------------------------
  
  vm12$ cd $HOME/TEMP1
  vm12$ sudo zcat BBB.img | cpio -i (初期RAMディスクを展開)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド(mknod)部分でエラー出力されたが続行
  --------------------------------------------------
  
  vm12$ cd $HOME/TEMP1
  vm12$ sudo rm BBB.img (初期RAMディスクを削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm12$ cd $HOME/TEMP1
  vm12$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx.  1 makoto makoto    7 12月  6 10:16 bin -> usr/bin
  drwxr-xr-x.  2 makoto makoto    6 12月  6 10:16 dev
  drwxr-xr-x. 12 makoto makoto 4.0K 12月  6 10:16 etc
  lrwxrwxrwx.  1 makoto makoto   23 12月  6 10:16 init -> usr/lib/systemd/systemd
  lrwxrwxrwx.  1 makoto makoto    7 12月  6 10:16 lib -> usr/lib
  lrwxrwxrwx.  1 makoto makoto    9 12月  6 10:16 lib64 -> usr/lib64
  drwxr-xr-x.  2 makoto makoto    6 12月  6 10:16 proc
  drwxr-xr-x.  2 makoto makoto    6 12月  6 10:16 root
  drwxr-xr-x.  2 makoto makoto    6 12月  6 10:16 run
  lrwxrwxrwx.  1 makoto makoto    8 12月  6 10:16 sbin -> usr/sbin
  -rwxr-xr-x.  1 makoto makoto 3.1K 12月  6 10:16 shutdown
  drwxr-xr-x.  2 makoto makoto    6 12月  6 10:16 sys
  drwxr-xr-x.  2 makoto makoto    6 12月  6 10:16 sysroot
  drwxr-xr-x.  2 makoto makoto    6 12月  6 10:16 tmp
  drwxr-xr-x.  7 makoto makoto   66 12月  6 10:16 usr
  drwxr-xr-x.  2 makoto makoto   29 12月  6 10:16 var
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[23]
  仮想ファイルシステム(/proc) - 01 (cat /proc/cmdline)
  
[内容]
  ## 作業内容
    システム起動時のカーネル引数を確認する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ cat /proc/cmdline (システム起動時のカーネル引数)
  
  コマンドの実行結果
  --------------------------------------------------
  BOOT_IMAGE=/vmlinuz-4.15.3         // カーネルイメージ(/boot/vmlinuz-4.15.3)
  root=/dev/mapper/centos_vm11-root  // 起動デバイス
  ro                                 // 読取専用
  crashkernel=auto                   // 不明
  rd.lvm.lv=centos_vm11/root         // 不明
  rd.lvm.lv=centos_vm11/swap         // 不明
  console=ttyS0,115200n8             // 仮想マシン作成時にブートローダーに指定したコンソール接続のためのパラメータ
  LANG=ja_JP.UTF-8                   // 言語・国・文字コード
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[24]
  仮想ファイルシステム(/proc) - 02 (cat /proc/cpuinfo)
  
[内容]
  ## 作業内容
    CPU情報を確認する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ cat /proc/cpuinfo (CPU情報を確認する)
  
  コマンドの実行結果
  --------------------------------------------------
  processor        : 0                                   // CPUのID
  vendor_id        : GenuineIntel                        // ベンダーID
  cpu family       : 6                                   // 不明
  model            : 26                                  // 不明
  model name       : Intel Core i7 9xx (Nehalem Core i7, IBRS update)
  stepping         : 3                                   // 不明
  microcode        : 0x1                                 // 不明
  cpu MHz          : 2394.414                            // 不明
  cache size       : 4096 KB                             // 不明
  physical id      : 0                                   // 不明
  siblings         : 1                                   // 不明
  core id          : 0                                   // 不明
  cpu cores        : 1                                   // CPU内のコア数
  apicid           : 0                                   // 不明
  initial apicid   : 0                                   // 不明
  fpu              : yes                                 // 不明
  fpu_exception    : yes                                 // 不明
  cpuid level      : 11                                  // 不明
  wp               : yes                                 // 不明
  flags            : fpu de pse tsc msr pae ..           // vmx -> CPUがKVMに対応している
  bugs             : cpu_meltdown spectre_v1 spectre_v2  // 不明
  bogomips         : 4788.82                             // 不明
  clflush size     : 64                                  // 不明
  cache_alignment  : 64                                  // 不明
  address sizes    : 36 bits physical, 48 bits virtual   // 不明
  power management :                                     // 不明
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[25]
  仮想ファイルシステム(/proc) - 03 (cat /proc/filesystems)
  
[内容]
  ## 作業内容
    ファイルシステム情報を確認する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ cat /proc/filesystems (ファイルシステム情報を確認する)
  
  コマンドの実行結果
  --------------------------------------------------
  nodev  sysfs
  nodev  rootfs
  nodev  ramfs
  nodev  bdev
  nodev  proc
  nodev  cpuset
  nodev  cgroup
  nodev  cgroup2
  nodev  tmpfs
  nodev  devtmpfs
  nodev  configfs
  nodev  debugfs
  nodev  tracefs
  nodev  securityfs
  nodev  sockfs
  nodev  dax
  nodev  bpf
  nodev  pipefs
  nodev  hugetlbfs
  nodev  devpts
  nodev  autofs
  nodev  pstore
  nodev  mqueue
  nodev  selinuxfs
         xfs  // システムで使用中
  --------------------------------------------------
  
  以下の確認に続く

================================================================================
[26]
  仮想ファイルシステム(/proc) - 04 (cat /proc/swaps)
  
[内容]
  ## 作業内容
    使用中のスワップ領域を確認する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ cat /proc/swaps (使用中のスワップ領域)
  
  コマンドの実行結果
  --------------------------------------------------
  Filename    Type         Size        Used     Priority
  /dev/dm-1   partition    2097148     268      -2
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[27]
  仮想ファイルシステム(/proc) - 05 (cat /proc/version)
  
[内容]
  ## 作業内容
    バージョン情報を確認する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ cat /proc/version (バージョン情報)
  
  コマンドの実行結果
  --------------------------------------------------
  Linux version 4.15.3 (root@vm12) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC))
  #1 SMP Sat Dec 4 10:54:37 JST 2021
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[28]
  仮想ファイルシステム(/proc) - 06 (ls -lh /proc/bus/pci)
  
[内容]
  ## 作業内容
    PCIバス情報を確認する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ sudo yum -y install pciutils (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ ls -lh /proc/bus/pci (PCIバス情報を確認する)
  
  コマンドの実行結果
  --------------------------------------------------
  dr-xr-xr-x. 2 root root 0 12月 25 20:19 00       // PCIバス「00」
  -r--r--r--. 1 root root 0 12月 25 20:19 devices  // 不明
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ ls -lh /proc/bus/pci/00 (PCIバス「00」のデバイスを確認する)
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 256 12月 25 20:26 00.0  // スロット「00」、デバイス「0」
  -rw-r--r--. 1 root root 256 12月 25 20:26 01.0  // スロット「01」、デバイス「0」
  -rw-r--r--. 1 root root 256 12月 25 20:26 01.1  // スロット「01」、デバイス「1」
  -rw-r--r--. 1 root root 256 12月 25 20:26 01.3
  -rw-r--r--. 1 root root 256 12月 25 20:26 03.0
  -rw-r--r--. 1 root root 256 12月 25 20:26 04.0
  -rw-r--r--. 1 root root 256 12月 25 20:26 04.1
  -rw-r--r--. 1 root root 256 12月 25 20:26 04.2
  -rw-r--r--. 1 root root 256 12月 25 20:26 04.7
  -rw-r--r--. 1 root root 256 12月 25 20:26 05.0
  -rw-r--r--. 1 root root 256 12月 25 20:26 06.0
  -rw-r--r--. 1 root root 256 12月 25 20:26 07.0
  -rw-r--r--. 1 root root 256 12月 25 20:26 08.0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ file /proc/bus/pci/00/00.0 (PCIバス「00」、スロット「00」のデバイス情報)
  
  コマンドの実行結果
  --------------------------------------------------
  /proc/bus/pci/00/00.0: data -> エディタで閲覧不可
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lspci | grep 00:00 (PCIバス「00」、スロット「00」のデバイス情報)
  
  コマンドの実行結果
  --------------------------------------------------
  00:00.0 Host bridge: Intel Corporation 440FX - 82441FX PMC [Natoma] (rev 02)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lspci -s 00:00 (PCIバス「00」、スロット「00」のデバイス情報)
  
  コマンドの実行結果
  --------------------------------------------------
  00:00.0 Host bridge: Intel Corporation 440FX - 82441FX PMC [Natoma] (rev 02)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[29]
  仮想ファイルシステム(/proc) - 07 (ls -lh /proc/bus/usb)
  
[内容]
  ## 作業内容
    USBバス情報を確認する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ sudo yum -y install usbutils (パッケージのインストール)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo find /proc -type d | grep -i usb (USBバス情報を検索する)
  
  コマンドの実行結果
  --------------------------------------------------
  /proc/irq/10/uhci_hcd:usb3 -> パス(/proc/bus/usb)が存在しない
  /proc/irq/10/uhci_hcd:usb4
  /proc/irq/11/ehci_hcd:usb1
  /proc/irq/11/uhci_hcd:usb2
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsusb (USBデバイスを検索)
  
  コマンドの実行結果
  --------------------------------------------------
  Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
  Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
  Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
  Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsusb -s 001:001 (USBバス「001」、デバイス「001」のデバイス情報)
  
  コマンドの実行結果
  --------------------------------------------------
  Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[30]
  デバイスファイル
  
[内容]
  ## 作業内容
    デバイスファイルの情報を追跡してみる
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ ls -lh /dev | grep -E '^b' (ブロック型デバイスファイル)
  
  コマンドの実行結果
  --------------------------------------------------
  brw-rw----. 1 root   disk    253,   0 12月  6 09:11 dm-0
  brw-rw----. 1 root   disk    253,   1 12月  6 09:11 dm-1
  brw-rw----. 1 root   cdrom    11,   0 12月  6 09:11 sr0
  brw-rw----. 1 root   disk    252,   0 12月  6 09:11 vda
  brw-rw----. 1 root   disk    252,   1 12月  6 09:11 vda1
  brw-rw----. 1 root   disk    252,   2 12月  6 09:11 vda2
  
  // 252 : メジャー番号
  // 0   : マイナー番号
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/devices | grep 252 (メジャー番号252が何を意味するか調査)
  
  コマンドの実行結果
  --------------------------------------------------
  252 dax      // 不明 -> おそらく関係ない
  252 virtblk  // 仮想ブロック(おそらく仮想マシン内の仮想ディスクを指す)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[31]
  ループバックデバイス
  
[内容]
  ## 作業内容
    ディスクイメージからループバックデバイス作成
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=image0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 レコード入力
  10+0 レコード出力
  10485760 バイト (10 MB) コピーされました、 0.0541071 秒、 194 MB/秒
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 image0.img (ディスクイメージからループバックデバイス作成)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 5755.538761] loop: module loaded
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -l (ループバックデバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME       SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE
  /dev/loop0         0      0         0  0 /home/makoto/image0.img
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mkfs -t ext4 /dev/loop0 (ループバックデバイスにファイルシステム構築)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> ブロック割当のメッセージが多数出力されるが成功
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mount -t ext4 /dev/loop0 /mnt (ループバックデバイスをマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 6136.444509] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ df -mT (ループバックデバイスを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  ファイルシス                 タイプ   1M-ブロック  使用 使用可 使用% マウント位置
  devtmpfs                     devtmpfs         466     0    466    0% /dev
  tmpfs                        tmpfs            489     0    489    0% /dev/shm
  tmpfs                        tmpfs            489     7    482    2% /run
  tmpfs                        tmpfs            489     0    489    0% /sys/fs/cgroup
  /dev/mapper/centos_vm11-root xfs            17394  5406  11989   32% /
  /dev/vda1                    xfs             1014   188    827   19% /boot
  tmpfs                        tmpfs             98     0     98    0% /run/user/1000
  /dev/loop0                   ext4               9     1      8    3% /mnt  // ループバックデバイス
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo umount /mnt (ループバックデバイスをアンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスを一括削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f image0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[32]
  動的デバイス管理(udev) - 01 (/etc/udev/rules.d)
  
[内容]
  ## 作業内容
    ループバックデバイス検出時にルール通りのコマンドが実行されるか確認する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ systemctl is-active systemd-udevd (プロセスの稼働状況を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  active -> プロセス(udevd)の実体はsystemd-udevd
  --------------------------------------------------
  
  vm12$ cd /etc/udev/rules.d
  vm12$ sudo vi 10-loopback.rules (ルール作成)
  
  コマンドの実行結果
  --------------------------------------------------
  // %k : デバイス名
  // %p : デバイスファイル(絶対パス)
  
  ## デバイス検出時にジャーナル記録
  KERNEL=="loop*", RUN="/bin/logger %k %p"
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=image0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 レコード入力
  10+0 レコード出力
  10485760 バイト (10 MB) コピーされました、 0.0378319 秒、 277 MB/秒
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 image0.img (ループバックデバイス作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> デバイス検知(sysfs) - デバイスファイル(udevd)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ journalctl --no-pager | grep loop0 (ジャーナルを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  12月 26 09:47:12 vm12 sudo[1667]: makoto : TTY=ttyS0 ; PWD=/home/makoto ; USER=root ; COMMAND=/sbin/losetup /dev/loop0 image0.img
  12月 26 09:47:12 vm12 root[1673]: loop0 /devices/virtual/block/loop0
  12月 26 09:47:12 vm12 root[1674]: loop0 /devices/virtual/block/loop0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスを一括削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f image0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[33]
  動的デバイス管理(udev) - 02 (udevadm info)
  
[内容]
  ## 作業内容
    ループバックデバイス検出をコマンド(udevadm info)でモニターする
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ systemctl is-active systemd-udevd (プロセスの稼働状況を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  active -> プロセス(udevd)の実体はsystemd-udevd
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=loop1.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 レコード入力
  10+0 レコード出力
  10485760 バイト (10 MB) コピーされました、 0.0378319 秒、 277 MB/秒
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop1 loop1.img (ループバックデバイス作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME (デバイス名(udevd)指定)
  vm12$ udevadm info -n /dev/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  P: /devices/virtual/block/loop1          // デバイス名(sysfs)
  N: loop1                                 // デバイス名(udevd)
  E: DEVNAME=/dev/loop1                    // プロパティ
  E: DEVPATH=/devices/virtual/block/loop1  // プロパティ
  E: DEVTYPE=disk                          // プロパティ
  E: MAJOR=7                               // プロパティ
  E: MINOR=1                               // プロパティ
  E: SUBSYSTEM=block                       // プロパティ
  E: TAGS=:systemd:                        // プロパティ
  E: USEC_INITIALIZED=36141906492          // プロパティ
  --------------------------------------------------
  
  vm12$ cd $HOME (デバイス名(sysfs)指定)
  vm12$ udevadm info -p /devices/virtual/block/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  P: /devices/virtual/block/loop1          // デバイス名(sysfs)
  N: loop1                                 // デバイス名(udevd)
  E: DEVNAME=/dev/loop1                    // プロパティ
  E: DEVPATH=/devices/virtual/block/loop1  // プロパティ
  E: DEVTYPE=disk                          // プロパティ
  E: MAJOR=7                               // プロパティ
  E: MINOR=1                               // プロパティ
  E: SUBSYSTEM=block                       // プロパティ
  E: TAGS=:systemd:                        // プロパティ
  E: USEC_INITIALIZED=36141906492          // プロパティ
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ udevadm info -n /dev/loop1 -q name (問合せ結果から名前のみ抽出)
  
  コマンドの実行結果
  --------------------------------------------------
  loop1
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ udevadm info -n /dev/loop1 -q property (問合せ結果からプロパティ表示)
  
  コマンドの実行結果
  --------------------------------------------------
  E: DEVNAME=/dev/loop1                    // プロパティ
  E: DEVPATH=/devices/virtual/block/loop1  // プロパティ
  E: DEVTYPE=disk                          // プロパティ
  E: MAJOR=7                               // プロパティ
  E: MINOR=1                               // プロパティ
  E: SUBSYSTEM=block                       // プロパティ
  E: TAGS=:systemd:                        // プロパティ
  E: USEC_INITIALIZED=36141906492          // プロパティ
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ udevadm info -n /dev/loop1 -q all (問合せ結果から全情報表示)
  
  コマンドの実行結果
  --------------------------------------------------
  P: /devices/virtual/block/loop1          // デバイス名(sysfs)
  N: loop1                                 // デバイス名(udevd)
  E: DEVNAME=/dev/loop1                    // プロパティ
  E: DEVPATH=/devices/virtual/block/loop1  // プロパティ
  E: DEVTYPE=disk                          // プロパティ
  E: MAJOR=7                               // プロパティ
  E: MINOR=1                               // プロパティ
  E: SUBSYSTEM=block                       // プロパティ
  E: TAGS=:systemd:                        // プロパティ
  E: USEC_INITIALIZED=36141906492          // プロパティ
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスを一括削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f loop1.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[34]
  動的デバイス管理(udev) - 03 (udevadm monitor)
  
[内容]
  ## 作業内容
    デバイス(USB)の自動検出をモニタリング
  
  ## 使用マシン
    HOST : localhost
    IPV4 : 192.168.1.3
    MEMO : ホスト
  
[確認]
  # cd $HOME
  # systemctl is-active systemd-udevd (プロセスの稼働状況を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  active
  --------------------------------------------------
  
  # cd $HOME
  # udevadm monitor (デバイス接続のモニタリング開始)
  
  コマンドの実行結果
  --------------------------------------------------
  monitor will print the received events for:
  UDEV   - the event which udev sends out after rule processing
  KERNEL - the kernel uevent
  
  // ここでUSBメモリ接続
  
  KERNEL[27052.818517] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.1 (usb)
  KERNEL[27052.819669] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.1/2-1.1:1.0 (usb)
    
    -- 省略 --
    
  KERNEL[27058.610690] add /module/vfat (module)
  UDEV  [27058.611319] add /module/vfat (module)
  --------------------------------------------------
  
  # cd $HOME
  # lsusb (デバイス(USB)をコマンドで調査)
  
  コマンドの実行結果
  --------------------------------------------------
  Bus 002 Device 008: ID 056e:6042 Elecom Co., Ltd  (USBメモリ)
  Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
  Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
  Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
  Bus 003 Device 002: ID 046d:c019 Logitech, Inc. Optical Tilt Wheel Mouse
  Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
  Bus 001 Device 003: ID 8086:0186 Intel Corp. WiMAX Connection 2400m
  Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
  Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
