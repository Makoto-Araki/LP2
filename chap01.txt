================================================================================
[01] Command - 1 (stress)
[02] Command - 2 (top)
[03] Command - 3 (vmstat)
[04] Command - 4 (iostat)
[05] Command - 5 (iptop)
================================================================================
[01]
  Command - 1 (stress)
  
[内容]
  ## コマンド
    stress -q     // 起動メッセージ非表示
    stress -t XX  // タイムアウト(XX秒後)
    stress -c XX  // CPU負荷の子プロセスの生成数(XX個)
    stress -m XX  // メモリ負荷の子プロセスの生成数(XX個)
    stress -d XX  // HDD負荷の子プロセスの生成数(XX個)
    stress -t XX  // タイムアウト(XX秒後)
  
  ## 作業内容
    コマンドの動作確認を行う
  
[確認]
  # cd $HOME
  # yum -y install stress
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> リポジトリ「EPEL」のインストールが必要
  --------------------------------------------------
  
  # cd $HOME
  # vi sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # CPU負荷1個、メモリ負荷1個、5秒後タイムアウト
  stress -c 1 -m 1 -t 5 &
  
  # 更新間隔1秒、更新回数9回、メガバイト単位
  vmstat 1 9 -S m
  --------------------------------------------------
  
  # cd $HOME
  # bash sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  // 負荷開始
  stress: info: [21295] dispatching hogs: 1 cpu, 0 io, 1 vm, 0 hdd
  
  // vmstat
  ## PROC ##  ######## Memory #########  ## Swap ##  ### IO ###  ## System ##  ###### CPU ######
     r  b     swpd   free   buff  cache   si    so     bi   bo     in     cs    us sy id wa st
     1  0      117   1278      0    768    0     0     50  336    251    236     8  2 90  0  0
     2  0      117   1185      0    770    0     0      0    0   2307    930    31 21 48  0  0
     2  0      117   1126      0    770    0     0      0    0   2278    929    30 21 49  0  0
     2  0      117   1102      0    770    0     0      0    0   2282   1037    30 21 49  0  0
     2  0      117   1225      0    770    0     0      0    0   2272    955    30 22 49  0  0
     1  0      117   1246      0    770    0     0      0    0   2265   1035    30 22 49  0  0
 
  // 負荷終了
  stress: info: [21295] successful run completed in 5s
  
  // vmstat -> PROC, CPU に変化あり
  ## PROC ##  ######## Memory #########  ## Swap ##  ### IO ###  ## System ##  ###### CPU ######
     r  b     swpd   free   buff  cache   si    so     bi   bo     in     cs    us sy id wa st
     0  0      117   1277      0    770    0     0      0   28    311    851     1  0 98  0  0
     0  0      117   1277      0    770    0     0      0    0    338    824     3  1 97  0  0
     0  0      117   1277      0    770    0     0      0  128    277    789     2  1 98  0  0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  Command - 2 (top)
  
[内容]
  ## コマンド ##
    top -b     // バッチモード
    top -d XX  // 更新間隔(XX 秒)
    top -n XX  // 更新回数(XX 回)を越えた後で自動的に終了
    top -u XX  // 指定ユーザーのプロセスのみ表示
    top -p XX  // 指定PIDのプロセスのみ表示
    top -w XX  // 出力幅(XX 桁数)
  
  ## 作業内容
    コマンドの動作確認を行う
  
[確認]
  # cd $HOME
  # top -> 対話モード
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 対話モードは各自で練習あるのみ！
  --------------------------------------------------
  
  # cd $HOME
  # vi sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # CPU負荷1個、5秒後タイムアウト、バックグラウンド
  stress -c 1 -t 5 &
  
  # バッチモード、更新間隔1秒、更新回数9回、出力幅100
  top -b -d 1 -n 9 -w 100 | grep stress
  --------------------------------------------------
  
  # cd $HOME
  # bash sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  // 負荷開始
  stress: info: [13104] dispatching hogs: 1 cpu, 0 io, 0 vm, 0 hdd
  
  // 1回目 -> 項目「%CPU」からCPU負荷を確認
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  13107 makoto    20   0    7312    100      0 R  94.1  0.0   0:00.18 stress
  13104 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 2回目
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  13107 makoto    20   0    7312    100      0 R 100.0  0.0   0:01.19 stress
  13104 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 3回目
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  13107 makoto    20   0    7312    100      0 R 100.0  0.0   0:02.20 stress
  13104 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 4回目
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  13107 makoto    20   0    7312    100      0 R 100.0  0.0   0:03.21 stress
  13104 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 5回目
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  13107 makoto    20   0    7312    100      0 R  99.0  0.0   0:04.22 stress
  13104 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 負荷終了
  stress: info: [13104] successful run completed in 5s
  --------------------------------------------------
  
  # cd $HOME
  # vi sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # メモリ負荷1個、5秒後タイムアウト、バックグラウンド
  stress -m 1 -t 5 &
  
  # バッチモード、更新間隔1秒、更新回数9回、出力幅100
  top -b -d 1 -n 9 -w 100 | grep stress
  --------------------------------------------------
  
  # cd $HOME
  # bash sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  // 負荷開始
  stress: info: [15517] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd
  
  // 1回目 -> 項目「%MEM」を見る限り、あまり負荷を掛けられていない
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  15520 makoto    20   0  269460 123708    128 R  80.0  3.3   0:00.19 stress
  15517 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 2回目
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  15520 makoto    20   0  269460 259996    128 R 100.0  6.9   0:01.20 stress
  15517 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 3回目
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  15520 makoto    20   0  269460  96320    128 R 100.0  2.6   0:02.21 stress
  15517 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 4回目
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  15520 makoto    20   0  269460 228056    128 R 100.0  6.1   0:03.22 stress
  15517 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 5回目
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
  15520 makoto    20   0  269460 262112    128 R 100.0  7.0   0:04.23 stress
  15517 makoto    20   0    7312    432    348 S   0.0  0.0   0:00.00 stress
  
  // 負荷終了
  stress: info: [15517] successful run completed in 5s
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  Command - 3 (vmstat)
  
[内容]
  ## コマンド
    vmstat XX YY       // 更新間隔(XX秒)、更新回数(YY回)
    vmstat XX YY -S k  // 更新間隔(XX秒)、更新回数(YY回)、キロバイト単位
    vmstat XX YY -S m  // 更新間隔(XX秒)、更新回数(YY回)、メガバイト単位
  
  ## 作業内容
    コマンドの動作確認を行う
  
[確認]
  # cd $HOME
  # vi sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # CPU負荷1個、メモリ負荷1個、5秒後タイムアウト、バックグラウンド
  stress -c 1 -m 1 -t 5 &
  
  # 更新間隔1秒、更新回数9回、メガバイト単位
  vmstat 1 9 -S m
  --------------------------------------------------
  
  # cd $HOME
  # bash sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  // 負荷開始
  stress: info: [21295] dispatching hogs: 1 cpu, 0 io, 1 vm, 0 hdd
  
  // vmstat
  ## PROC ##  ######## Memory #########  ## Swap ##  ### IO ###  ## System ##  ###### CPU ######
     r  b     swpd   free   buff  cache   si    so     bi   bo     in     cs    us sy id wa st
     1  0      117   1278      0    768    0     0     50  336    251    236     8  2 90  0  0
     2  0      117   1185      0    770    0     0      0    0   2307    930    31 21 48  0  0
     2  0      117   1126      0    770    0     0      0    0   2278    929    30 21 49  0  0
     2  0      117   1102      0    770    0     0      0    0   2282   1037    30 21 49  0  0
     2  0      117   1225      0    770    0     0      0    0   2272    955    30 22 49  0  0
     1  0      117   1246      0    770    0     0      0    0   2265   1035    30 22 49  0  0
 
  // 負荷終了
  stress: info: [21295] successful run completed in 5s
  
  // vmstat -> PROC, CPU に変化あり
  ## PROC ##  ######## Memory #########  ## Swap ##  ### IO ###  ## System ##  ###### CPU ######
     r  b     swpd   free   buff  cache   si    so     bi   bo     in     cs    us sy id wa st
     0  0      117   1277      0    770    0     0      0   28    311    851     1  0 98  0  0
     0  0      117   1277      0    770    0     0      0    0    338    824     3  1 97  0  0
     0  0      117   1277      0    770    0     0      0  128    277    789     2  1 98  0  0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  Command - 4 (iostat)
  
[内容]
  ## コマンド ##
    iostat -c     // CPU情報のみ出力
    iostat -d     // ディスクIOのみ出力
    iostat -k     // ブロック単位ではなくキロバイト単位
    iostat -m     // ブロック単位ではなくメガバイト単位
    iostat -t     // 時刻を表示
    iostat XX YY  // 更新間隔(XX秒)、更新回数(YY回)
  
  ## 作業内容
    コマンドの動作確認を行う
  
[確認]
  # cd $HOME
  # vi sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # HDD負荷1個、5秒後タイムアウト、バックグラウンド
  stress -d 1 -t 5 &
  
  # メガバイト単位、時刻表示、ディスクIO、更新間隔1秒、更新回数9回
  iostat -m -t -d 1 9
  --------------------------------------------------
  
  # cd $HOME
  # bash sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  // 負荷開始
  stress: info: [19526] dispatching hogs: 0 cpu, 0 io, 0 vm, 1 hdd
  
  // システム情報
  Linux 3.10.0-1160.45.1.el7.x86_64 (silver) 2021年11月24日 _x86_64_ (4 CPU)
  
  // 1回目(統計)
  2021年11月24日 21時35分35秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda              13.82         0.20         1.23       2538      15295
  dm-0              5.49         0.15         0.05       1896        676
  dm-1              2.51         0.00         0.01         13        109
  dm-2             10.68         0.05         1.17        598      14553
  
  // 2回目
  2021年11月24日 21時35分36秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda             459.00         0.00       224.09          0        224
  dm-0             11.00         0.00         0.07          0          0
  dm-1              0.00         0.00         0.00          0          0
  dm-2            588.00         0.00       289.08          0        289
  
  // 3回目
  2021年11月24日 21時35分37秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda             523.00         0.00       261.00          0        261
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  dm-2            528.00         0.00       263.50          0        263
  
  // 4回目
  2021年11月24日 21時35分38秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda             518.00         0.00       257.53          0        257
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  dm-2            519.00         0.00       240.36          0        240
  
  // 5回目
  2021年11月24日 21時35分39秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda             522.00         0.05       237.87          0        237
  dm-0              2.00         0.05         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  dm-2            529.00         0.00       263.51          0        263
  
  // 6回目
  2021年11月24日 21時35分40秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda             520.00         0.00       259.50          0        259
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  dm-2            499.00         0.00       249.00          0        249
  
  // 負荷終了
  stress: info: [19526] successful run completed in 5s
  
  // 7回目 -> 書込負荷が激減
  2021年11月24日 21時35分41秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda             146.00         0.00        73.00          0         73
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  dm-2             15.00         0.00         7.50          0          7
  
  // 8回目 -> 書込負荷が無くなる
  2021年11月24日 21時35分42秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda               0.00         0.00         0.00          0          0
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  dm-2              0.00         0.00         0.00          0          0
  
  // 9回目
  2021年11月24日 21時35分43秒
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  sda               0.00         0.00         0.00          0          0
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  dm-2              0.00         0.00         0.00          0          0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  Command - 5 (iptop)
  
[内容]
  ## コマンド ##
    iotop -b     // 対話モードでなくバッチモード
    iotop -d XX  // 更新間隔(XX 秒)
    iotop -n XX  // 更新回数(XX 回)を越えた後で自動的に終了
    iotop -u XX  // 指定ユーザーのプロセスのみ表示
    iotop -p XX  // 指定PIDのプロセスのみ表示
  
  ## 作業内容
    コマンドの動作確認を行う
  
[確認]
  # cd $HOME
  # iotop -> 対話モード
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 対話モードは各自で練習あるのみ！
  --------------------------------------------------
  
  # cd $HOME
  # vi sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # HDD負荷1個、5秒後タイムアウト、バックグラウンド
  stress -d 1 -t 5 &
  
  # バッチモード、更新間隔1秒、更新回数9回
  iotop -b -d 1 -n 9 | grep stress
  --------------------------------------------------
  
  # cd $HOME
  # bash sample.sh
  
  コマンドの実行結果
  --------------------------------------------------
  // 負荷開始
  stress: info: [23159] dispatching hogs: 0 cpu, 0 io, 0 vm, 1 hdd
  
  // 1回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23162  be/4  root     0.00 B/s   71.92 M/s   0.00 % 34.69 %    stress -d 1 -t 5
  23159  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    stress -d 1 -t 5
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  
  // 2回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23162  be/4  root     0.00 B/s  271.63 M/s   0.00 % 82.34 %    stress -d 1 -t 5
  23159  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    stress -d 1 -t 5
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  
  // 3回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23162  be/4  root     0.00 B/s  259.59 M/s   0.00 % 82.93 %    stress -d 1 -t 5
  23159  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    stress -d 1 -t 5
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  
  // 4回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23162  be/4  root     0.00 B/s  246.01 M/s   0.00 % 63.73 %    stress -d 1 -t 5
  23159  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    stress -d 1 -t 5
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  
  // 負荷終了
  stress: info: [23159] successful run completed in 5s
  
  // 5回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  
  // 6回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  
  // 7回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  
  // 8回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  
  // 9回目
    TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO>    COMMAND
  23161  be/4  root     0.00 B/s    0.00 B/s   0.00 %  0.00 %    grep stress
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
