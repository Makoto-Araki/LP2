================================================================================
[01] 総合的なリソース使用率の測定 - 01 (top)
[02] 総合的なリソース使用率の測定 - 02 (vmstat)
[03] 総合的なリソース使用率の測定 - 03 (vmstat)
[04] 総合的なリソース使用率の測定 - 04 (iostat)
[05] 総合的なリソース使用率の測定 - 05 (iotop)
[06] 総合的なリソース使用率の測定 - 06 (sysstat)
[07] 総合的なリソース使用率の測定 - 07 (sar)
[08] 総合的なリソース使用率の測定 - 08 (sar)
[09] 総合的なリソース使用率の測定 - 09 (sar)
[10] 総合的なリソース使用率の測定 - 10 (sar)
[11] 総合的なリソース使用率の測定 - 11 (sar)
[12] 総合的なリソース使用率の測定 - 12 (sar)
[13] 総合的なリソース使用率の測定 - 13 (sadf)
[14] 総合的なリソース使用率の測定 - 14 (uptime)
[15] 総合的なリソース使用率の測定 - 15 (w)
[16] CPU使用率の測定 - 01 (ps)
[17] CPU使用率の測定 - 02 (ps)
[18] CPU使用率の測定 - 03 (pstree)
[19] CPU使用率の測定 - 04 (lsof)
[20] メモリおよびスワップ使用量の測定 - 01 (free)
[21] メモリおよびスワップ使用量の測定 - 02 (cat /proc/meminfo)
[22] ディスク使用量の測定 - 01 (df)
[23] ディスク使用量の測定 - 02 (df)
[24] ネットワークトラフィックの測定 - 01 (netstat)
[25] ネットワークトラフィックの測定 - 02 (netstat)
[26] ネットワークトラフィックの測定 - 03 (ss)
[27] ネットワークトラフィックの測定 - 04 (ss)
[28] ネットワークトラフィックの測定 - 05 (netperf)
[29] ネットワークトラフィックの測定 - 06 (iptraf-ng)
================================================================================
[X01]
  準備 - 構築予定の仮想マシン一覧
  
[内容]
  ## ホスト
    HOST : rock
    IPV4 : dhcp
    MEMO : client1
  
  ## 仮想マシン1
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : server
  
  ## 仮想マシン2
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : client2
  
[確認]
  実機での確認なし
  
================================================================================
[X02]
  準備 - ホスト側の設定
  
[内容]
  ## 作業内容
    システム基本調査とホスト名の設定
  
[確認]
  $ cd $HOME
  $ cat /etc/redhat-release -> OSバージョン
  
  コマンドの実行結果
  --------------------------------------------------
  Rocky Linux release 8.8 (Green Obsidian)
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /etc/machine-id -> マシンID
  
  コマンドの実行結果
  --------------------------------------------------
  74e75651bd5b4069bb8767871ac6dbab
  --------------------------------------------------
  
  $ cd $HOME
  $ uname -r -> カーネルバージョン
  
  コマンドの実行結果
  --------------------------------------------------
  4.18.0-477.10.1.el8_8.x86_64
  --------------------------------------------------
  
  $ cd $HOME
  $ uname -m -> CPUアーキテクチャ
  
  コマンドの実行結果
  --------------------------------------------------
  x86_64
  --------------------------------------------------
  
  $ cd $HOME
  $ whoami -> ユーザー名
  
  コマンドの実行結果
  --------------------------------------------------
  makoto
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /etc/group | grep $(whoami) | grep wheel -> ユーザーがwheelグループ所属か確認
  
  コマンドの実行結果
  --------------------------------------------------
  wheel:x:10:makoto
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo visudo -> パスワード無しでsudoコマンドを実行可能にする
  
  コマンドの実行結果
  --------------------------------------------------
  %wheel   ALL=(ALL)   NOPASSWD: ALL -> コメントアウト解除
  --------------------------------------------------
  
  $ cd $HOME
  $ hostnamectl
  
  コマンドの実行結果
  --------------------------------------------------
   Static hostname: localhost.localdomain -> rockに変更する
         Icon name: computer-laptop
           Chassis: laptop
        Machine ID: 74e75651bd5b4069bb8767871ac6dbab
           Boot ID: a1214fe388ef4a0da9cc27fe1f76e473
  Operating System: Rocky Linux 8.8 (Green Obsidian)
       CPE OS Name: cpe:/o:rocky:rocky:8:GA
            Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
      Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ hostnamectl set-hostname rock
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  $ cd $HOME
  $ hostnamectl
  
  コマンドの実行結果
  --------------------------------------------------
   Static hostname: rock
         Icon name: computer-laptop
           Chassis: laptop
        Machine ID: 74e75651bd5b4069bb8767871ac6dbab
           Boot ID: a1214fe388ef4a0da9cc27fe1f76e473
  Operating System: Rocky Linux 8.8 (Green Obsidian)
       CPE OS Name: cpe:/o:rocky:rocky:8:GA
            Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
      Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ ip addr show -> NIC確認
  
  コマンドの実行結果
  --------------------------------------------------
  1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
      valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
      valid_lft forever preferred_lft forever
  
  2: enp0s25: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 70:58:12:26:ac:cf brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.4/24 brd 192.168.1.255 scope global dynamic noprefixroute enp0s25
      valid_lft 10600sec preferred_lft 10600sec
    inet6 2400:4052:20c0:bc00:7258:12ff:fe26:accf/64 scope global dynamic noprefixroute 
      valid_lft 14202sec preferred_lft 12402sec
    inet6 fe80::7258:12ff:fe26:accf/64 scope link noprefixroute 
      valid_lft forever preferred_lft forever
  
  3: wlp3s0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether ae:2f:c1:10:64:81 brd ff:ff:ff:ff:ff:ff permaddr 64:80:99:3b:2e:5c
  
  4: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:6f:51:3b brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
      valid_lft forever preferred_lft forever
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /etc/sysconfig/network-scripts/ifcfg-enp0s25
  
  コマンドの実行結果
  --------------------------------------------------
  TYPE=Ethernet
  PROXY_METHOD=none
  BROWSER_ONLY=no
  BOOTPROTO=dhcp -> 起動時にDHCPでIPV4の割当
  DEFROUTE=yes
  IPV4_FAILURE_FATAL=no
  IPV6INIT=yes
  IPV6_AUTOCONF=yes
  IPV6_DEFROUTE=yes
  IPV6_FAILURE_FATAL=no
  NAME=enp0s25
  UUID=2d5c2599-5e1e-4093-b26e-078d12c153ea
  DEVICE=enp0s25
  ONBOOT=yes
  IPV6_PRIVACY=no
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X02]
  準備 - 仮想環境のパッケージをインストール
  
[内容]
  ## 作業内容
    仮想環境のパッケージをインストール
  
[確認]
  $ cd $HOME
  $ grep -E 'svm|vmx' /proc/cpuinfo -> CPUの仮想環境(KVM)対応を確認
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 該当語句(vmx)が強調表示、CPUが仮想環境(KVM)に対応
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo dnf -y install qemu-kvm qemu-img libvirt virt-install virt-manager
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo systemctl start libvirtd
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo systemctl enable libvirtd
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X03]
  準備 - イメージファイル取得
  
[内容]
  ## 作業内容
    イメージファイル取得
  
[確認]
  $ cd $HOME
  $ sudo dnf -y install wget
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd /user/local/src
  $ sudo wget http://ftp.riken.jp/Linux/rocky/8.8/isos/x86_64/Rocky-8.8-x86_64-minimal.iso
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X04]
  準備 - キックスタートファイル作成
  
[内容]
  ## 作業内容
    キックスタートファイル作成
  
[確認]
  $ cd $HOME
  $ mkdir kickfile
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd $HOME
  $ vi kickfile/vm11-ks.cfg
  
  コマンドの実行結果
  --------------------------------------------------
  #version=RHEL8
  
  # Use text install
  text
  
  # License agreement
  eula --agreed
  
  # Package
  repo --name="Minimal" --baseurl=file:///run/install/sources/mount-0000-cdrom/Minimal
  
  %packages
  @^minimal-environment
  kexec-tools
  %end
  
  # Keyboard layouts
  keyboard --xlayouts='jp'
  
  # System language
  lang ja_JP.UTF-8
  
  # Network information
  network --hostname=vm11 --bootproto=static --device=enp1s0 --gateway=192.168.122.1 --ip=192.168.122.11 --nameserver=192.168.122.1 --netmask=255.255.255.0 --noipv6 --activate
  
  # Use CDROM installation media
  cdrom
  
  # Run the Setup Agent on first boot
  firstboot --enable
  
  # Ignore disk is vda
  ignoredisk --only-use=vda
  
  # System bootloader configuration
  autopart
  
  # Partition clearing information
  clearpart --none --initlabel
  
  # System timezone
  timezone Asia/Tokyo --isUtc --nontp
  
  # Root password
  rootpw --plaintext rt0122ma
  
  # User add
  user --groups=wheel --name=makoto --password=ma0122ma --gecos="makoto"
  
  # Disable SELinux
  selinux --disabled
  
  %addon ADDON_placeholder --enable --reserve-mb=auto
  %end
  
  %anaconda
  pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
  pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
  pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
  %end
  --------------------------------------------------
  
  $ cd $HOME
  $ vi kickfile/vm12-ks.cfg
  
  コマンドの実行結果
  --------------------------------------------------
  (IPV4を192.168.122.12に変更、vm11をvm12に変更)
  --------------------------------------------------
  
  $ cd $HOME
  $ ksvalidator kickfile/vm11-ks.cfg -> キックスタートファイル検証
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> OKの場合は何も出力されない
  --------------------------------------------------
  
  $ cd $HOME
  $ ksvalidator kickfile/vm12-ks.cfg -> キックスタートファイル検証
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> OKの場合は何も出力されない
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X05]
  準備 - スクリプト作成と仮想マシン構築
  
[内容]
  ## 作業内容
    スクリプト作成と仮想マシン構築
  
[確認]
  $ cd $HOME/kickfile
  $ vi vm11-mk.sh
  
  コマンドの実行結果
  --------------------------------------------------
  # オプション部分(--)は一行にまとめないとエラー
  
  virt-install                                            # 使用コマンド
  --name=vm11                                             # 仮想マシン名
  --location=/usr/local/src/Rocky-8.8-x86_64-minimal.iso  # イメージファイル
  --disk path=/home/vm11.qcow2,size=30,format=qcow2       # 仮想ディスク(30GB)
  --os-type=linux                                         # タイプ
  --os-variant=rocky8.6                                   # ディストリビューション
  --vcpus=1                                               # 仮想CPU数
  --ram=1600                                              # 割当メモリ量(MB) -> 1534以下ではエラー
  --network network=default                               # ネットワーク(default)
  --graphics none                                         # GUI不使用
  --initrd-inject /home/makoto/kickfile/vm11-ks.cfg       # キックスタートファイル
  --extra-args                                            # 追加パラメータ
    "ks=file:vm11-ks.cfg                                  # 追加パラメータ -> キックスタートファイル
    console=tty0 console=ttyS0,115200n8"                  # 追加パラメータ -> コンソール接続
  --------------------------------------------------
  
  $ cd $HOME/kickfile
  $ vi vm12-mk.sh
  
  コマンドの実行結果
  --------------------------------------------------
  (vm11をvm12に変更)
  --------------------------------------------------
  
  $ cd $HOME/kickfile
  $ sudo bash vm11-mk.sh
  
  コマンドの実行結果
  --------------------------------------------------
  (コマンド実行後に自動インストール開始 -> ログイン画面 -> makotoでログイン)
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ hostname
    
    コマンドの実行結果
    --------------------------------------------------
    vm11
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ip addr show
    
    コマンドの実行結果
    --------------------------------------------------
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
      link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
      inet 127.0.0.1/8 scope host lo
        valid_lft forever preferred_lft forever
      inet6 ::1/128 scope host 
        valid_lft forever preferred_lft forever
    
    2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
      link/ether 52:54:00:3a:2d:5f brd ff:ff:ff:ff:ff:ff
      inet 192.168.122.11/24 brd 192.168.122.255 scope global noprefixroute enp1s0
        valid_lft forever preferred_lft forever
      inet6 fe80::5054:ff:fe3a:2d5f/64 scope link 
        valid_lft forever preferred_lft forever
    --------------------------------------------------
    
    vm11# cd $HOME
    vm11# ping -c 3 192.168.1.1 -> 家庭用ルーターまでパケット到達
    
    コマンドの実行結果
    --------------------------------------------------
    PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.
    64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=1.45 ms
    64 bytes from 192.168.1.1: icmp_seq=2 ttl=254 time=1.13 ms
    64 bytes from 192.168.1.1: icmp_seq=3 ttl=254 time=1.19 ms
    
    --- 192.168.1.1 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2004ms
    rtt min/avg/max/mdev = 1.133/1.255/1.446/0.139 ms
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl is-active sshd -> SSH確認
    
    コマンドの実行結果
    --------------------------------------------------
    active
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ vi .vimrc
    
    コマンドの実行結果
    --------------------------------------------------
    set tabstop=2 -> タブ幅の修正
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo visudo -> パスワード無しでsudoコマンドを実行可能にする
    
    コマンドの実行結果
    --------------------------------------------------
    %wheel   ALL=(ALL)   NOPASSWD: ALL -> コメントアウト解除
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト -> ログインプロンプト表示 -> 「Ctrl + ]」 でホスト側のシェルに戻る
    --------------------------------------------------
    
  $ cd $HOME/kickfile
  $ sudo bash vm12-mk.sh
  
  コマンドの実行結果
  --------------------------------------------------
  (コマンド実行後に自動インストール開始 -> ログイン画面 -> makotoでログイン)
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ hostname
    
    コマンドの実行結果
    --------------------------------------------------
    vm12
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ ip addr show
    
    コマンドの実行結果
    --------------------------------------------------
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
      link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
      inet 127.0.0.1/8 scope host lo
        valid_lft forever preferred_lft forever
      inet6 ::1/128 scope host 
        valid_lft forever preferred_lft forever
    
    2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
      link/ether 52:54:00:e5:eb:ba brd ff:ff:ff:ff:ff:ff
      inet 192.168.122.12/24 brd 192.168.122.255 scope global noprefixroute enp1s0
        valid_lft forever preferred_lft forever
      inet6 fe80::5054:ff:fee5:ebba/64 scope link 
        valid_lft forever preferred_lft forever
    --------------------------------------------------
    
    vm12# cd $HOME
    vm12# ping -c 3 192.168.1.1 -> 家庭用ルーターまでパケット到達
    
    コマンドの実行結果
    --------------------------------------------------
    PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.
    64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=1.83 ms
    64 bytes from 192.168.1.1: icmp_seq=2 ttl=254 time=1.27 ms
    64 bytes from 192.168.1.1: icmp_seq=3 ttl=254 time=1.23 ms
    
    --- 192.168.1.1 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2003ms
    rtt min/avg/max/mdev = 1.226/1.439/1.826/0.275 ms
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ systemctl is-active sshd -> SSH確認
    
    コマンドの実行結果
    --------------------------------------------------
    active
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ vi .vimrc
    
    コマンドの実行結果
    --------------------------------------------------
    set tabstop=2 -> タブ幅の修正
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo visudo -> パスワード無しでsudoコマンドを実行可能にする
    
    コマンドの実行結果
    --------------------------------------------------
    %wheel   ALL=(ALL)   NOPASSWD: ALL -> コメントアウト解除
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト -> ログインプロンプト表示 -> 「Ctrl + ]」 でホスト側のシェルに戻る
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X06]
  準備 - 仮想マシンへSSH接続
  
[内容]
  ## 作業内容
    仮想マシンへSSH接続
  
[確認]
  $ cd $HOME
  $ sudo vi /etc/hosts -> 仮想マシンのエントリ追加
  
  コマンドの実行結果
  --------------------------------------------------
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  192.168.122.11 vm11 -> 追加
  192.168.122.12 vm12 -> 追加
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh-keygen
  
  コマンドの実行結果
  --------------------------------------------------
  Generating public/private rsa key pair.
  Enter file in which to save the key (/home/makoto/.ssh/id_rsa): (Enter)
  Enter passphrase (empty for no passphrase): (Enter)             -> パスフレーズ無し
  Enter same passphrase again: (Enter)                            -> パスフレーズ無し
  Your identification has been saved in /home/makoto/.ssh/id_rsa. -> 秘密鍵
  Your public key has been saved in /home/makoto/.ssh/id_rsa.pub. -> 公開鍵
  The key fingerprint is:
  SHA256:z2YWBSFA/dZwjyignp3w4+RVJApkK1xyUM85GetFwy0 makoto@rock
  The key's randomart image is:
  ...
  --------------------------------------------------
  
  $ cd $HOME
  $ scp .ssh/id_rsa.pub makoto@vm11:id_rsa.pub -> 公開鍵を仮想マシンにSSH転送
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 初回接続時のみホスト認証用鍵をvm11から受取 -> .ssh/known_hostsに保存
  
  makoto@vm11's password: (makotoパスワード)
  id_rsa.pub               100%  565   308.2KB/s   00:00
  --------------------------------------------------
  
  $ cd $HOME
  $ scp .ssh/id_rsa.pub makoto@vm12:id_rsa.pub -> 公開鍵を仮想マシンにSSH転送
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 初回接続時のみホスト認証用鍵をvm11から受取 -> .ssh/known_hostsに保存
  
  makoto@vm12's password: (makotoパスワード)
  id_rsa.pub               100%  565   308.2KB/s   00:00
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm11 -> パスワード認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  makoto@vm11's password: (makotoパスワード)
  Last login: Sun May 28 11:49:44 2023
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ mkdir .ssh
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ chmod 700 .ssh -> 規定ファイルのアクセス権をmakotoのみ読書可能に設定
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat id_rsa.pub >> .ssh/authorized_keys -> 転送した公開鍵を規定ファイルに書き込む
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ chmod 600 .ssh/authorized_keys -> 規定ファイルのアクセス権をrootのみ読書可能に設定
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/ssh/sshd_config -> 設定ファイルの編集
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11# cd $HOME
    vm11# cat /etc/ssh/sshd_config | grep -vE '^#|^$'
    
    コマンドの実行結果
    --------------------------------------------------
    HostKey /etc/ssh/ssh_host_rsa_key
    HostKey /etc/ssh/ssh_host_ecdsa_key
    HostKey /etc/ssh/ssh_host_ed25519_key
    SyslogFacility AUTHPRIV
    
    PermitRootLogin yes -> 変更前
    PermitRootLogin no  -> 変更後
    
    #PubkeyAuthentication yes -> 変更前
    PubkeyAuthentication yes  -> 変更後 - 公開鍵認証を有効化
    
    // 公開鍵格納用の規定ファイル
    AuthorizedKeysFile .ssh/authorized_keys
    
    PasswordAuthentication yes -> 変更前
    PasswordAuthentication no  -> 変更後 - パスワード認証を無効化
    
    ChallengeResponseAuthentication no
    GSSAPIAuthentication yes
    GSSAPICleanupCredentials no
    UsePAM yes
    X11Forwarding yes
    PrintMotd no
    AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
    AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
    AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
    AcceptEnv XMODIFIERS
    Subsystem sftp /usr/libexec/openssh/sftp-server
    --------------------------------------------------
    
    vm11# cd $HOME
    vm11# sudo systemctl reload sshd -> 設定ファイルを読み込み
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11# cd $HOME
    vm11# exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> パスワード認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  makoto@vm12's password: (makotoパスワード)
  Last login: Sun May 28 11:49:44 2023
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ mkdir .ssh
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ chmod 700 .ssh -> 規定ファイルのアクセス権をmakotoのみ読書可能に設定
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ cat id_rsa.pub >> .ssh/authorized_keys -> 転送した公開鍵を規定ファイルに書き込む
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ chmod 600 .ssh/authorized_keys -> 規定ファイルのアクセス権をrootのみ読書可能に設定
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /etc/ssh/sshd_config -> 設定ファイルの編集
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm12# cd $HOME
    vm12# cat /etc/ssh/sshd_config | grep -vE '^#|^$'
    
    コマンドの実行結果
    --------------------------------------------------
    HostKey /etc/ssh/ssh_host_rsa_key
    HostKey /etc/ssh/ssh_host_ecdsa_key
    HostKey /etc/ssh/ssh_host_ed25519_key
    SyslogFacility AUTHPRIV
    
    PermitRootLogin yes -> 変更前
    PermitRootLogin no  -> 変更後
    
    #PubkeyAuthentication yes -> 変更前
    PubkeyAuthentication yes  -> 変更後 - 公開鍵認証を有効化
    
    // 公開鍵格納用の規定ファイル
    AuthorizedKeysFile .ssh/authorized_keys
    
    PasswordAuthentication yes -> 変更前
    PasswordAuthentication no  -> 変更後 - パスワード認証を無効化
    
    ChallengeResponseAuthentication no
    GSSAPIAuthentication yes
    GSSAPICleanupCredentials no
    UsePAM yes
    X11Forwarding yes
    PrintMotd no
    AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
    AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
    AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
    AcceptEnv XMODIFIERS
    Subsystem sftp /usr/libexec/openssh/sftp-server
    --------------------------------------------------
    
    vm12# cd $HOME
    vm12# sudo systemctl reload sshd -> 設定ファイルを読み込み
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12# cd $HOME
    vm12# exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ sudo virsh list --all -> 仮想マシン一覧
  
  コマンドの実行結果
  --------------------------------------------------
  Id   名前   状態
  2    vm11   実行中
  4    vm12   実行中
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo virsh destroy vm11 -> 仮想マシン停止
  
  コマンドの実行結果
  --------------------------------------------------
  Domain 'vm11' destroyed
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo virsh destroy vm12 -> 仮想マシン停止
  
  コマンドの実行結果
  --------------------------------------------------
  Domain 'vm12' destroyed
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo virsh start vm11 -> 仮想マシン起動
  
  コマンドの実行結果
  --------------------------------------------------
  Domain 'vm11' started
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo virsh start vm12 -> 仮想マシン起動
  
  コマンドの実行結果
  --------------------------------------------------
  Domain 'vm12' started
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun May 28 14:34:52 2023 from 192.168.122.1 -> パスワード入力が要求されなくなる
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun May 28 14:34:07 2023 -> パスワード入力が要求されなくなる
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X07]
  準備 - 構成管理ツールをインストール
  
[内容]
  ## 作業内容
    構成管理ツールをインストール
  
[確認]
  $ cd $HOME
  $ sudo dnf -y install ansible
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 自分の環境では競合エラーが発生
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo ansible --version -> 本コマンドでパッケージを個別にインストールしていくことができた
  
  コマンドの実行結果
  --------------------------------------------------
  ansible [core 2.14.2]
    config file = /etc/ansible/ansible.cfg
    configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
    ansible python module location = /usr/lib/python3.11/site-packages/ansible
    ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections
    executable location = /usr/bin/ansible
    python version = 3.11.2 (main, Feb 18 2023, 08:12:16) [GCC 8.5.0 20210514 (Red Hat 8.5.0-18)] (/usr/bin/python3.11)
    jinja version = 3.1.2
    libyaml = True
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X08]
  準備 - コマンドラインで仮想マシンへ指示
  
[内容]
  ## 作業内容
    構成管理ツール(Ansible)からコマンドラインで仮想マシンへ指示
  
[確認]
  $ cd $HOME
  $ sudo vi /etc/ansible/hosts -> インベントリ修正
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /etc/ansible/hosts | grep -vE '^#|^$'
  
  コマンドの実行結果
  --------------------------------------------------
  [vms]
  192.168.122.11
  192.168.122.12
  
  [server1]
  192.168.122.11
  
  [client2]
  192.168.122.12
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vms --list-hosts -> 所属ホストを出力
  
  コマンドの実行結果
  --------------------------------------------------
  hosts (2):
    192.168.122.11
    192.168.122.12
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible server1 --list-hosts -> 所属ホストを出力
  
  コマンドの実行結果
  --------------------------------------------------
  hosts (1):
    192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible client2 --list-hosts -> 所属ホストを出力
  
  コマンドの実行結果
  --------------------------------------------------
  hosts (1):
    192.168.122.12
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vms -m ping -> 所属ホストにPing
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.12 | SUCCESS => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
  }
  
  192.168.122.11 | SUCCESS => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible server1 -m ping -> 所属ホストにPing
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.11 | SUCCESS => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible client2 -m ping -> 所属ホストにPing
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.12 | SUCCESS => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible server1 -m setup -> 所属ホストから情報取得
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.11 | SUCCESS => {
    "ansible_facts": {
      "ansible_all_ipv4_addresses": [
        "192.168.122.11"
      ],
      "ansible_all_ipv6_addresses": [
        "fe80::5054:ff:fe3a:2d5f"
      ],
      ...
    }
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vms -m command -a 'hostnamectl' -> 所属ホストでコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  
  192.168.122.12 | CHANGED | rc=0 >>
    Static hostname: vm12
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 9e52818a469b4bec95fdf15bcac46f9a
            Boot ID: 98911c1d7e564a3c8b5d38a10370180c
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X09]
  準備 - インベントリ作成
  
[内容]
  ## 作業内容
    インベントリ作成
  
[確認]
  $ cd $HOME
  $ mkdir ansible
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/myhost.yml -> YAML形式でインベントリ作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---                                 # 開始宣言 "---"
  all:                                # グループ "all" を宣言
    hosts:                            # グループ "all" の所属ホスト
      vm11:                           # ホスト名
        ansible_host: 192.168.122.11  # IPアドレス
        ansible_user: makoto          # ユーザー
        ansible_password: ma0122ma    # パスワード
      vm12:                           # ホスト名
        ansible_host: 192.168.122.12  # IPアドレス
        ansible_user: makoto          # ユーザー
        ansible_password: ma0122ma    # パスワード
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible all -i ansible/myhost.yml -m command -a 'hostnamectl' -> グループ全体にコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  vm12 | CHANGED | rc=0 >>
    Static hostname: vm12
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 9e52818a469b4bec95fdf15bcac46f9a
            Boot ID: 98911c1d7e564a3c8b5d38a10370180c
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  
  vm11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m command -a 'hostnamectl' -> 指定ホストのみにコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm12 -i ansible/myhost.yml -m command -a 'hostnamectl' -> 指定ホストのみにコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  vm12 | CHANGED | rc=0 >>
    Static hostname: vm12
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 9e52818a469b4bec95fdf15bcac46f9a
            Boot ID: 98911c1d7e564a3c8b5d38a10370180c
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X10]
  準備 - モジュールを正式名称で指定
  
[内容]
  ## 作業内容
    モジュールを正式名称で指定
  
[確認]
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m command -a 'hostnamectl'
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'hostnamectl' -> モジュールを正式名称で指定
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X11]
  準備 - パイプで処理をつなげるとエラー
  
[内容]
  ## 作業内容
    パイプで処理をつなげるとエラー
  
[確認]
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'cat /etc/passwd | head -n 5'
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) '|': No such file or directory -> パイプの解釈ができない？
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X12]
  準備 - 管理者権限でコマンド実行
  
[内容]
  ## 作業内容
    管理者権限でコマンド実行
  
[確認]
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'cat /etc/shadow'
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | FAILED | rc=1 >>
  cat: /etc/shadow: Permission deniednon-zero return code
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'cat /etc/shadow' -b -> 管理者権限でコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
  root:$6$VOR.vNeNpwLfqJTp$Qbwu0LtTrfh...dq2lpJd4Hsi4JmTiwhIdxiNuUWjqEiCi.::0:99999:7:::
  ...
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X13]
  準備 - ファイルコピーのモジュール使用
  
[内容]
  ## 作業内容
    ファイルコピーのモジュール使用
  
[確認]
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'ls -l'
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
  合計 4
  -rw-r--r-- 1 makoto makoto 565  5月 28 12:52 id_rsa.pub
  --------------------------------------------------
  
  $ cd $HOME
  $ vi sample.txt
  
  コマンドの実行結果
  --------------------------------------------------
  Hello World
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.copy -a "src='./sample.txt' dest='~/'" -> ファイルコピーのモジュール使用
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": true,
    "checksum": "648a6a6ffffdaa0badb23b8baf90b6168dd16b3a",
    "dest": "/home/makoto/sample.txt",
    "gid": 1000,
    "group": "makoto",
    "md5sum": "e59ff97941044f85df5297e1c302d260",
    "mode": "0664",
    "owner": "makoto",
    "size": 12,
    "src": "/home/makoto/.ansible/tmp/ansible-tmp-1685267941.3333616-24592-201430333515689/source",
    "state": "file",
    "uid": 1000
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'ls -l'
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
  合計 8
  -rw-r--r-- 1 makoto makoto 565  5月 28 12:52 id_rsa.pub
  -rw-rw-r-- 1 makoto makoto  12  5月 28 18:59 sample.txt -> ファイルコピー確認
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X14]
  準備 - プレイブック作成(01)
  
[内容]
  ## 作業内容
    プレイブック作成(01)
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun May 28 19:00:41 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnf list installed | grep -i net-tools -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnf list installed | grep -i traceroute -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun May 28 18:41:41 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ dnf list installed | grep -i net-tools -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ dnf list installed | grep -i traceroute -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm12 closed.
    --------------------------------------------------
  
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---                                 # 開始宣言 "---"
  all:                                # グループ "all" を宣言
    hosts:                            # グループ "all" の所属ホスト
      vm11:                           # ホスト名
        ansible_host: 192.168.122.11  # IPアドレス
        ansible_user: makoto          # ユーザー
        ansible_password: ma0122ma    # パスワード
      vm12:                           # ホスト名
        ansible_host: 192.168.122.12  # IPアドレス
        ansible_user: makoto          # ユーザー
        ansible_password: ma0122ma    # パスワード
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook01.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages                # 手順名
    hosts: all                            # 対象ホスト -> インベントリ参照
    gather_facts: no                      # ファクト変数の収集なし
  
    tasks:
      - name: Install net-tools package   # タスク名
        ansible.builtin.dnf:              # モジュール
          name: net-tools                 # パッケージ
          state: present                  # 未インストール時のみインストール
        become: yes                       # 管理者権限で実行
      
      - name: Install traceroute package  # タスク名
        ansible.builtin.dnf:              # モジュール
          name: traceroute                # パッケージ
          state: present                  # 未インストール時のみインストール
        become: yes                       # 管理者権限で実行
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook01.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install net-tools package]
  changed: [vm11]
  changed: [vm12]
  
  TASK [Install traceroute package]
  changed: [vm12]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  vm12 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook01.yml -> 再実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install net-tools package]
  ok: [vm11] -> 既にインストールされているためokと出力
  ok: [vm12] -> 既にインストールされているためokと出力
  
  TASK [Install traceroute package]
  ok: [vm11] -> 既にインストールされているためokと出力
  ok: [vm12] -> 既にインストールされているためokと出力
  
  PLAY RECAP
  vm11 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  vm12 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon May 29 08:37:22 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnf list installed | grep -i net-tools -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    net-tools.x86_64   2.0-0.52.20160912git.el8   @baseos
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnf list installed | grep -i traceroute -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    traceroute.x86_64   3:2.1.0-6.el8   @baseos 
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon May 29 08:37:22 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ dnf list installed | grep -i net-tools -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    net-tools.x86_64   2.0-0.52.20160912git.el8   @baseos
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ dnf list installed | grep -i traceroute -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    traceroute.x86_64   3:2.1.0-6.el8   @baseos 
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X15]
  準備 - プレイブック作成(02)
  
[内容]
  ## 作業内容
    プレイブック作成(02)
  
[確認]
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook02.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages
    hosts: all
    gather_facts: no
  
    tasks:
      - name: Install epel-release package
        ansible.builtin.dnf:
          name: epel-release
          state: present
        become: yes
      
      - name: Install wget package
        ansible.builtin.dnf:
          name: wget
          state: present
        become: yes
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook02.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install epel-release package]
  changed: [vm12]
  changed: [vm11]
  
  TASK [Install wget package]
  changed: [vm12]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  vm12 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X16]
  準備 - プレイブック作成(03)
  
[内容]
  ## 作業内容
    プレイブック作成(03)
  
[確認]
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook03.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages
    hosts: vm11  // 対象はvm11のみ注意！
    gather_facts: no
  
    tasks:
      - name: Install stress package
        ansible.builtin.dnf:
          name: stress
          state: present
        become: yes
      
      - name: Install sysstat package
        ansible.builtin.dnf:
          name: sysstat
          state: present
        become: yes
      
      - name: Install iotop package
        ansible.builtin.dnf:
          name: iotop
          state: present
        become: yes
      
      - name: Install psmisc package
        ansible.builtin.dnf:
          name: psmisc
          state: present
        become: yes
      
      - name: Install lsof package
        ansible.builtin.dnf:
          name: lsof
          state: present
        become: yes
      
      - name: Install iptraf-ng package
        ansible.builtin.dnf:
          name: iptraf-ng
          state: present
        become: yes
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook03.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install stress package]
  changed: [vm11]
  
  TASK [Install sysstat package]
  changed: [vm11]
  
  TASK [Install iotop package]
  changed: [vm11]
  
  TASK [Install psmisc package]
  ok: [vm11] -> 既にインストール済みだった模様
  
  TASK [Install lsof package]
  changed: [vm11]
  
  TASK [Install iptraf-ng package]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=6    changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[01]
  総合的なリソース使用率の測定 - 01 (top)
  
[内容]
  ## 作業内容
    プロセスをコマンド(top)で測定する
  
  ## コマンド
    top -b     : バッチモード
    top -d XX  : 更新間隔(XX 秒)
    top -n XX  : 更新回数(XX 回)を越えた後で自動的に終了
    top -u XX  : 指定ユーザーのプロセスのみ表示
    top -p XX  : 指定PIDのプロセスのみ表示
    top -w XX  : 出力幅(XX 桁数)
  
[確認]
  $ cd $HOME
  $ top -> 対話モード
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 対話モードは練習あるのみ！
  --------------------------------------------------
  
  $ cd $HOME
  $ mkdir scripts
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  $ cd $HOME
  $ vi scripts/script01.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # 既存ログファイル削除
  if test -f script.log ; then
    rm -f script.log
  fi
  
  # 無限ループ
  while :(ヌルコマンド)
  do
    echo AAA >> script.log
    sleep 1  // プロセス内では「echo」より「sleep」の時間が圧倒的に長い
  done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ bash script01.sh & -> バックグラウンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  [1] 1264
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ top
      > -b           // バッチモード
      > -u makoto    // ユーザー指定
      > -d 1         // 更新間隔１秒
      > -n 9         // 更新回数９回
      > -w 100       // 出力幅100
      > | grep 1264  // 該当プロセスのみ表示
  
  コマンドの実行結果
  --------------------------------------------------
  PID  USER      PR  NI    VIRT    RES    SHR S %CPU %MEM   TIME+   COMMAND
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  1264 makoto    20   0  113284   1384   1196 S  0.0  0.1   0:00.04 bash
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ top
      > -b           // バッチモード
      > -p 1264      // プロセスID指定
      > -d 1         // 更新間隔１秒
      > -n 9         // 更新回数９回
      > | grep 1264  // プロセス欄のみ表示
  
  コマンドの実行結果
  --------------------------------------------------
  1264 makoto    20   0  113284   1388   1196 S  0.0  0.1   0:00.13 bash
  1264 makoto    20   0  113284   1388   1196 S  0.0  0.1   0:00.13 bash
  1264 makoto    20   0  113284   1388   1196 S  0.0  0.1   0:00.13 bash
  1264 makoto    20   0  113284   1388   1196 S  0.0  0.1   0:00.13 bash
  1264 makoto    20   0  113284   1388   1196 S  0.0  0.1   0:00.13 bash
  1264 makoto    20   0  113284   1388   1196 S  0.0  0.1   0:00.13 bash
  1264 makoto    20   0  113284   1388   1196 S  0.0  0.1   0:00.13 bash
  1264 makoto    20   0  113284   1388   1196 S  1.0  0.1   0:00.14 bash
  1264 makoto    20   0  113284   1388   1196 S  0.0  0.1   0:00.14 bash
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ kill -term(15) 1264
  
  コマンドの実行結果
  --------------------------------------------------
  [1]+  Terminated              bash script01.sh
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  総合的なリソース使用率の測定 - 02 (vmstat)
  
[内容]
  ## 作業内容
    CPU負荷をコマンド(vmstat)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    vmstat XX YY       : 更新間隔(XX秒)、更新回数(YY回)
    vmstat XX YY -S k  : 更新間隔(XX秒)、更新回数(YY回)、キロバイト単位
    vmstat XX YY -S m  : 更新間隔(XX秒)、更新回数(YY回)、メガバイト単位
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install epel-release
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> リポジトリ「EPEL」のインストール
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo yum -y install stress
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ vi script02.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # CPU負荷プロセス、5秒後タイムアウト、起動メッセージ非表示、バックグラウンド実行
  stress -c 1 -t 5 -q &
  
  # 更新間隔1秒、更新回数9回、メガバイト単位
  vmstat 1 9 -S m
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ bash script02.sh
  
  コマンドの実行結果
  --------------------------------------------------
  ## PROC ##  ######## Memory #########  ## Swap ##  ### IO ###  ## System ##  ###### CPU ######
     r  b     swpd   free   buff  cache   si   so     bi    bo     in   cs      us sy id wa st
     1  0        0    371      2    477    0    0     52    66     29   44       0  0 99  0  0
     1  0        0    371      2    477    0    0      0     0   1008   53      98  0  0  0  2  // CPU負荷
     1  0        0    371      2    477    0    0      0     0   1010   52     100  0  0  0  0  // CPU負荷
     1  0        0    371      2    477    0    0      0    19   1026   72     100  0  0  0  0  // CPU負荷
     2  0        0    371      2    477    0    0      0     0   1010   58     100  0  0  0  0  // CPU負荷
     0  0        0    371      2    477    0    0      0     0    975   63      94  0  6  0  0  // CPU負荷
     0  0        0    371      2    477    0    0      0     0     37   58       0  1 99  0  0
     0  0        0    371      2    477    0    0      0     0     32   52       1  0 99  0  0
     0  0        0    371      2    477    0    0      0     0     34   54       0  0 99  0  1
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  総合的なリソース使用率の測定 - 03 (vmstat)
  
[内容]
  ## 作業内容
    メモリ負荷をコマンド(vmstat)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ vi script03.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # メモリ負荷プロセス、5秒後タイムアウト、起動メッセージ非表示、バックグラウンド実行
  stress -m 1 -t 5 -q &
  
  # 更新間隔1秒、更新回数9回、メガバイト単位
  vmstat 1 9 -S m
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ bash script03.sh
  
  コマンドの実行結果
  --------------------------------------------------
  ## PROC ##  ######## Memory #########  ## Swap ##  ### IO ###  ## System ##  ###### CPU ######
     r  b     swpd   free   buff  cache   si   so     bi    bo     in   cs      us sy id wa st
     2  0        0    371      2    477    0    0     44    56     27   40       0  0 99  0  0
     1  0        0    112      2    477    0    0      0     0    812   76       4 91  2  0  2  // メモリ負荷
     1  0        0    131      2    477    0    0      0     0   1068  132       3 95  0  0  2  // メモリ負荷
     1  0        0    167      2    477    0    0      0     0   1052  129       6 92  0  0  2  // メモリ負荷
     1  0        0    171      2    477    0    0      0     0   1062  133       6 92  0  0  2  // メモリ負荷
     0  0        0    371      2    477    0    0      0     0   1024  136       5 91  3  0  2  // メモリ負荷
     0  0        0    371      2    477    0    0      0     0     12   10       1  0 99  0  0
     0  0        0    371      2    477    0    0      0     0     11   10       1  0 99  0  0
     0  0        0    371      2    477    0    0      0     0     17   17       1  0 99  0  0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  総合的なリソース使用率の測定 - 04 (iostat)
  
[内容]
  ## 作業内容
    HDD負荷をコマンド(iostat)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    iostat -c     : CPU情報のみ出力
    iostat -d     : ディスクIOのみ出力
    iostat -k     : ブロック単位ではなくキロバイト単位
    iostat -m     : ブロック単位ではなくメガバイト単位
    iostat -t     : 時刻を表示
    iostat XX YY  : 更新間隔(XX秒)、更新回数(YY回)
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install sysstat
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk (ディスク情報) -> デバイスマッピングが使われている
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  sr0                          11:0     1  1024M   0  rom   
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  vdb                         252:16    0     2G   0  disk  
   |-- vdb1                   252:17    0     1G   0  part  
   |-- vdb2                   252:18    0   975M   0  part  
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ls -lh /dev/mapper
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx. 1 root root       7  4月 15 18:17 centos_vm11-root -> ../dm-0  (/dev/dm-0)
  lrwxrwxrwx. 1 root root       7  4月 15 18:17 centos_vm11-swap -> ../dm-1  (/dev/dm-1)
  crw-------. 1 root root 10, 236  4月 15 18:17 control
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ vi script04.sh
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  
  # HDD負荷プロセス、5秒後タイムアウト、起動メッセージ非表示、バックグラウンド実行
  stress -d 1 -t 5 -q &
  
  # 数秒待機
  sleep 1
  
  # 起動からの統計省略、メガバイト単位、更新間隔1秒、更新回数9回
  iostat -y -m 1 9
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ bash script04.sh
  
  コマンドの実行結果
  --------------------------------------------------
  Linux 4.15.3 (vm11) 2023年05月04日 _x86_64_ (1 CPU)
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             0.00    0.00   98.28    0.00    1.72    0.00 -> HDD負荷開始で「%system」の数値上昇
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda             165.52         0.00       165.52          0         96 -> 書込リクエストがルートファイルシステムに殺到
  vdb               0.00         0.00         0.00          0          0
  dm-0             84.48         0.00       165.52          0         96 -> 書込リクエストがルートファイルシステムに殺到
  dm-1              0.00         0.00         0.00          0          0
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             0.00    0.00   94.64    0.00    5.36    0.00
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda             207.14         0.00       207.47          0        116
  vdb               0.00         0.00         0.00          0          0
  dm-0            107.14         0.00       207.47          0        116
  dm-1              0.00         0.00         0.00          0          0
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             0.00    0.00   92.19    0.00    7.81    0.00
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda             200.00         0.00       200.00          0        128
  vdb               0.00         0.00         0.00          0          0
  dm-0            101.56         0.00       200.00          0        128
  dm-1              0.00         0.00         0.00          0          0
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             0.00    0.00   93.18    0.00    2.27    4.55
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda              72.73         0.00        72.73          0         64
  vdb               0.00         0.00         0.00          0          0
  dm-0             37.50         0.00        72.73          0         64
  dm-1              0.00         0.00         0.00          0          0
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             1.00    0.00    2.00    0.00    0.00   97.00 -> HDD負荷終了で「%idle」の数値上昇
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda               0.00         0.00         0.00          0          0 -> 書込リクエストも無くなる
  vdb               0.00         0.00         0.00          0          0
  dm-0              0.00         0.00         0.00          0          0 -> 書込リクエストも無くなる
  dm-1              0.00         0.00         0.00          0          0
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             0.00    0.00    2.02    0.00    1.01   96.97
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda               0.00         0.00         0.00          0          0
  vdb               0.00         0.00         0.00          0          0
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             0.00    0.00    1.02    0.00    0.00   98.98
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda               0.00         0.00         0.00          0          0
  vdb               0.00         0.00         0.00          0          0
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             0.00    0.00    1.02    0.00    0.00   98.98
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda               0.00         0.00         0.00          0          0
  vdb               0.00         0.00         0.00          0          0
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  
  avg-cpu:  %user   %nice %system %iowait  %steal   %idle
             0.00    0.00    2.04    0.00    0.00   97.96
  
  Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
  vda               0.00         0.00         0.00          0          0
  vdb               0.00         0.00         0.00          0          0
  dm-0              0.00         0.00         0.00          0          0
  dm-1              0.00         0.00         0.00          0          0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  総合的なリソース使用率の測定 - 05 (iotop)
  
[内容]
  ## 作業内容
    プロセスをコマンド(iotop)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    iotop -b     : 対話モードでなくバッチモード
    iotop -d XX  : 更新間隔(XX 秒)
    iotop -n XX  : 更新回数(XX 回)を越えた後で自動的に終了
    iotop -u XX  : 指定ユーザーのプロセスのみ表示
    iotop -p XX  : 指定PIDのプロセスのみ表示
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install iotop
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo iotop -> 対話モード、root権限が必要
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 対話モードは練習あるのみ！
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ bash script01.sh & -> バックグラウンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  [1] 16205
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo iotop
      > -b            // バッチモード
      > -u makoto     // ユーザー指定
      > -d 1          // 更新間隔１秒
      > -n 9          // 更新回数９回
      > | grep 16205  // 該当プロセスのみ表示
      > | grep -v grep
  
  コマンドの実行結果
  --------------------------------------------------
  TID    PRIO  USER    DISK-READ  DISK-WRITE  SWAPIN  IO      COMMAND
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    0.00 %  0.00 %  bash script01.sh
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo iotop
      > -b            // バッチモード
      > -p 16205      // プロセスID指定
      > -d 1          // 更新間隔１秒
      > -n 9          // 更新回数９回
      > | grep 16205  // 該当プロセスのみ表示
      > | grep -v grep
  
  コマンドの実行結果
  --------------------------------------------------
  TID    PRIO  USER    DISK-READ  DISK-WRITE  SWAPIN  IO     COMMAND
  16205  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash script01.sh
  16205  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash script01.sh
  16205  be/4  makoto  0.00 B/s   3.99 K/s    ?unavailable?  bash script01.sh
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ kill -term(15) 16205
  
  コマンドの実行結果
  --------------------------------------------------
  [1]+  Terminated              bash script01.sh
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[06]
  総合的なリソース使用率の測定 - 06 (sysstat)
  
[内容]
  ## 作業内容
    パッケージ「sysstat」の調査を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## 調査内容
    /etc/sysconfig/sysstat  : 設定ファイル
    /etc/cron.d/sysstat     : CRON
    /var/log/sa/saXX        : 収集データの格納先
    sar                     : コマンド - 収集データのレポート作成
    sadf                    : コマンド - 収集データのレポート書式変更
  
[確認]
  vm11$ cd $HOME
  vm11$ yum list installed | grep sysstat
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> パッケージのインストール確認
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /etc/sysconfig/sysstat | grep -vE '^#|^$' -> 設定ファイル確認
  
  コマンドの実行結果
  --------------------------------------------------
  HISTORY=28              // デフォルトで28日保存
  COMPRESSAFTER=31        // 31日経過で圧縮
  SADC_OPTIONS="-S DISK"  // データ収集コマンドのオプション設定
  ZIP="bzip2"             // 圧縮形式
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo grep -vE '^#|^$' /etc/cron.d/sysstat -> 設定ファイル確認
  
  コマンドの実行結果
  --------------------------------------------------
  */10 *  *  *  *  root  /usr/lib64/sa/sa1 1 1  // 10分毎に「sa1 1 1」実行
  53   23 *  *  *  root  /usr/lib64/sa/sa2 -A   // 毎日23時53分に「sa2 -A」で一日分の集計処理
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ls -lh /var/log/sa
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 13K  4月 15 20:30 sa15
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ which sar
  
  コマンドの実行結果
  --------------------------------------------------
  /bin/sar
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ which sadf
  
  コマンドの実行結果
  --------------------------------------------------
  /bin/sadf
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[07]
  総合的なリソース使用率の測定 - 07 (sar)
  
[内容]
  ## 作業内容
    収集データからCPU統計のレポートを作成
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    sar XX YY       : 更新間隔(XX秒)、更新回数(YY回)
    sar -o XX       : 出力ファイル(XX)を指定
    sar -u          : CPU
    sar -r          : メモリ
    sar -W          : スワップ
    sar -b          : ディスクIO
    sar -n DEV      : NIC
    sar -n EDEV     : NICエラー
    sar -f XX       : ログファイル(XX)を指定
    sar -s XX -e YY : 時刻XX(HH:MM:SS)から時刻YY(HH:MM:SS)を指定
  
[確認]
  vm11$ cd $HOME
  vm11$ ls -lh /var/log/sa
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 13K  4月 15 20:30 sa15
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C
      > sar
      > -u                   // 統計対象(CPU)
      > -f /var/log/sa/sa15  // ログファイル
      > -s 19:40:00          // 開始時刻
      > -e 20:40:00          // 終了時刻
      > 1200                 // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  Linux 3.10.0-1160.el7.x86_64 (vm11) 04/15/23 _x86_64_ (1 CPU)
  
  19:50:01        CPU     %user     %nice   %system   %iowait    %steal     %idle
  20:10:01        all      0.12      0.00      0.28      0.08      0.06     99.46
  20:30:02        all      0.09      0.00      0.19      0.00      0.11     99.61
  Average:        all      0.10      0.00      0.24      0.04      0.08     99.53
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[08]
  総合的なリソース使用率の測定 - 08 (sar)
  
[内容]
  ## 作業内容
    収集データからメモリ統計のレポートを作成
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C
      > sar
      > -r                   // 統計対象(メモリ)
      > -f /var/log/sa/sa15  // ログファイル
      > -s 19:40:00          // 開始時刻
      > -e 20:40:00          // 終了時刻
      > 1200                 // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  Linux 3.10.0-1160.el7.x86_64 (vm11) 04/15/23 _x86_64_ (1 CPU)
  
  19:50:01   kbmemfree  kbmemused  %memused  kbbuffers  kbcached  kbcommit  %commit  kbactive  kbinact  kbdirty
  20:10:01      425680     587776     58.00       2104    367108    284756     9.15    373528    58720        4
  20:30:02      426472     586984     57.92       2104    367216    283440     9.11    373056    58724        0
  Average:      426076     587380     57.96       2104    367162    284098     9.13    373292    58722        2
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[09]
  総合的なリソース使用率の測定 - 09 (sar)
  
[内容]
  ## 作業内容
    収集データからスワップ統計のレポートを作成
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C
      > sar
      > -W                   // 統計対象(スワップ)
      > -f /var/log/sa/sa15  // ログファイル
      > -s 19:40:00          // 開始時刻
      > -e 20:40:00          // 終了時刻
      > 1200                 // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  Linux 3.10.0-1160.el7.x86_64 (vm11) 04/15/23 _x86_64_ (1 CPU)
  
  19:50:01  pswpin/s  pswpout/s
  20:10:01      0.00       0.00
  20:30:02      0.00       0.00
  Average:      0.00       0.00
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[10]
  総合的なリソース使用率の測定 - 10 (sar)
  
[内容]
  ## 作業内容
    収集データからディスクIO統計のレポートを作成
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C
      > sar
      > -b                   // 統計対象(ディスクIO)
      > -f /var/log/sa/sa15  // ログファイル
      > -s 19:40:00          // 開始時刻
      > -e 20:40:00          // 終了時刻
      > 1200                 // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  Linux 3.10.0-1160.el7.x86_64 (vm11) 04/15/23 _x86_64_ (1 CPU)
  
  19:50:01       tps      rtps      wtps   bread/s   bwrtn/s
  20:10:01      3.05      0.52      2.53     37.89   2228.68
  20:30:02      0.16      0.00      0.15      0.13      1.30
  Average:      1.60      0.26      1.34     19.00   1114.45
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[11]
  総合的なリソース使用率の測定 - 11 (sar)
  
[内容]
  ## 作業内容
    収集データからネットワーク統計のレポートを作成
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C
      > sar
      > -n DEV               // 統計対象(ネットワーク)
      > -f /var/log/sa/sa15  // ログファイル
      > -s 19:40:00          // 開始時刻
      > -e 20:40:00          // 終了時刻
      > 1200                 // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  Linux 3.10.0-1160.el7.x86_64 (vm11) 04/15/23 _x86_64_ (1 CPU)
  
  19:50:01     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
  20:10:01      eth0      0.78      0.37      0.10      0.03      0.00      0.00      0.00
  20:10:01        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  20:30:02      eth0      0.54      0.01      0.03      0.00      0.00      0.00      0.00
  20:30:02        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  Average:      eth0      0.66      0.19      0.06      0.01      0.00      0.00      0.00
  Average:        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[12]
  総合的なリソース使用率の測定 - 12 (sar)
  
[内容]
  ## 作業内容
    収集データからネットワークエラー統計のレポートを作成
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C
      > sar
      > -n EDEV              // 統計対象(ネットワークエラー)
      > -f /var/log/sa/sa15  // ログファイル
      > -s 19:40:00          // 開始時刻
      > -e 20:40:00          // 終了時刻
      > 1200                 // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  Linux 3.10.0-1160.el7.x86_64 (vm11) 04/15/23 _x86_64_ (1 CPU)
  
  19:50:01     IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s
  20:10:01      eth0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  20:10:01        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  20:30:02      eth0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  20:30:02        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  Average:      eth0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  Average:        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[13]
  総合的なリソース使用率の測定 - 13 (sadf)
  
[内容]
  ## 作業内容
    収集データからネットワーク統計のレポートをJSON形式で作成
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    sadf -j XX -- sarコマンドのオプション  : 出力形式(JSON)
    sadf -x XX -- sarコマンドのオプション  : 出力形式(XML)
    sadf -t XX -- sarコマンドのオプション  : ローカル日時
  
[確認]
  vm11$ cd $HOME
  vm11$ sar
      > -u                   // CPU使用率
      > -f /var/log/sa/sa30  // ログファイル
      > -s 19:40:00          // 開始時刻
      > -e 20:40:00          // 終了時刻
      > 1200                 // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  Linux 4.15.3 (vm11) 04/30/23 _x86_64_ (1 CPU)
  
  19:40:01        CPU     %user     %nice   %system   %iowait    %steal     %idle
  20:00:01        all      0.04      0.00      0.05      0.00      0.02     99.88
  20:20:01        all      0.04      0.00      0.03      0.00      0.04     99.90
  Average:        all      0.04      0.00      0.04      0.00      0.03     99.89
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sadf              // CSV形式
      > -t                // ローカル時刻
      > /var/log/sa/sa30  // ログファイル
      > --                // 以降はコマンド(sar)のオプション
      > -u                // 統計対象(CPU)
      > -s 19:40:00       // 開始時刻
      > -e 20:40:00       // 終了時刻
      > 1200              // 1200秒(20分)単位
      > | tr '\t' ','     // タブ文字をカンマに変換
  
  コマンドの実行結果
  --------------------------------------------------
  vm11,1198,2023-04-30 20:00:01,all,%user,0.04
  vm11,1198,2023-04-30 20:00:01,all,%nice,0.00
  vm11,1198,2023-04-30 20:00:01,all,%system,0.05
  vm11,1198,2023-04-30 20:00:01,all,%iowait,0.00
  vm11,1198,2023-04-30 20:00:01,all,%steal,0.02
  vm11,1198,2023-04-30 20:00:01,all,%idle,99.88
  vm11,1199,2023-04-30 20:20:01,all,%user,0.04
  vm11,1199,2023-04-30 20:20:01,all,%nice,0.00
  vm11,1199,2023-04-30 20:20:01,all,%system,0.03
  vm11,1199,2023-04-30 20:20:01,all,%iowait,0.00
  vm11,1199,2023-04-30 20:20:01,all,%steal,0.04
  vm11,1199,2023-04-30 20:20:01,all,%idle,99.90 -> 上記と比較して最後の「Average」部分が存在しない模様
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sadf
      > -j                // 出力形式(JSON)
      > -t                // ローカル時刻
      > /var/log/sa/sa30  // ログファイル
      > --                // 以降はコマンド(sar)のオプション
      > -u                // 統計対象(CPU)
      > -s 19:40:00       // 開始時刻
      > -e 20:40:00       // 終了時刻
      > 1200              // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  {
    "sysstat": {
      "sysdata-version": 2.16,
      "hosts": [
        {
          "nodename": "vm11",
          "sysname": "Linux",
          "release": "4.15.3",
          "machine": "x86_64",
          "number-of-cpus": 1,
          "file-date": "2023-04-30",
          "statistics": [
            {
              // 空オブジェクト
            },
            {
              "timestamp": { "date": "2023-04-30", "time": "20:00:01", "utc": 0, "interval": 1198 },
              "cpu-load": [
                {
                  "cpu": "all",
                  "user": 0.04,
                  "nice": 0.00,
                  "system": 0.05,
                  "iowait": 0.00,
                  "steal": 0.02,
                  "idle": 99.88
                }
              ]
            },
            {
              // 空オブジェクト
            },
            {
              "timestamp": { "date": "2023-04-30", "time": "20:20:01", "utc": 0, "interval": 1199 },
              "cpu-load": [
                {
                  "cpu": "all",
                  "user": 0.04,
                  "nice": 0.00,
                  "system": 0.03,
                  "iowait": 0.00,
                  "steal": 0.04,
                  "idle": 99.90
                }
              ]
            },
            {
              // 空オブジェクト
            },
            {
              // 空オブジェクト
            }
          ],
          "restarts": []
        }
      ]
    }
  }
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sadf
      > -x                // 出力形式(XML)
      > -t                // ローカル時刻
      > /var/log/sa/sa30  // ログファイル
      > --                // 以降はコマンド(sar)のオプション
      > -u                // 統計対象(CPU)
      > -s 19:40:00       // 開始時刻
      > -e 20:40:00       // 終了時刻
      > 1200              // 1200秒(20分)単位
  
  コマンドの実行結果
  --------------------------------------------------
  <?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE sysstat PUBLIC "DTD v2.16 sysstat //EN"
  "http://pagesperso-orange.fr/sebastien.godard/sysstat-2.16.dtd">
  <sysstat>
    <sysdata-version>2.16</sysdata-version>
    <host nodename="vm11">
      <sysname>Linux</sysname>
      <release>4.15.3</release>
      <machine>x86_64</machine>
      <number-of-cpus>1</number-of-cpus>
      <file-date>2023-04-30</file-date>
      <statistics>
        <timestamp date="2023-04-30" time="20:00:01" utc="0" interval="1198">
          <cpu-load>
            <cpu number="all" user="0.04" nice="0.00" system="0.05" iowait="0.00" steal="0.02" idle="99.88"/>
          </cpu-load>
        </timestamp>
        <timestamp date="2023-04-30" time="20:20:01" utc="0" interval="1199">
          <cpu-load>
            <cpu number="all" user="0.04" nice="0.00" system="0.03" iowait="0.00" steal="0.04" idle="99.90"/>
          </cpu-load>
        </timestamp>
      </statistics>
      <restarts>
      </restarts>
    </host>
  </sysstat>
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[14]
  総合的なリソース使用率の測定 - 14 (uptime)
  
[内容]
  ## 作業内容
    システム稼働時間、ログインユーザー数、平均負荷を観察する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    uptime
  
[確認]
  vm11$ cd $HOME
  vm11$ uptime
  
  コマンドの実行結果
  --------------------------------------------------
  21:23:37 up  3:11,  1 user,  load average: 0.00, 0.01, 0.05
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[15]
  総合的なリソース使用率の測定 - 15 (w)
  
[内容]
  ## 作業内容
    指定ユーザー(makoto)のプロセス情報を出力
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    w XX     : ユーザー(XX)のプロセス情報を出力
    w -h XX  : ヘッダを非表示
    w -s XX  : ログイン時刻、JCPU、PCPUを非表示
  
  ## 項目説明
    TTY    : 端末名
    FROM   : リモートホスト名
    LOGIN@ : ログイン時刻
    IDLE   : アイドル時間
    JCPU   : 端末から実行されている全プロセスが消費したCPU時間
    PCPU   : WHAT欄のプロセスが消費したCPU時間
    WHAT   : 実行コマンド
  
[確認]
  vm11$ cd $HOME
  vm11$ systemctl is-active sshd
  
  コマンドの実行結果
  --------------------------------------------------
  active
  --------------------------------------------------
    
    $ cd $HOME
    $ ssh makoto@192.168.122.11 -> ホスト側から仮想マシンにログイン
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
  vm11$ cd $HOME
  vm11$ w
  
  コマンドの実行結果
  --------------------------------------------------
  21:28:27 up  3:16,  2 users,  load average: 0.00, 0.01, 0.05
  
  USER     TTY     FROM      LOGIN@   IDLE     JCPU    PCPU    WHAT
  makoto   ttyS0             18:12    3.00s    1.42s   0.01s   w
  makoto   pts/0   gateway   21:27    32.00s   0.02s   0.02s   -bash
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[16]
  CPU使用率の測定 - 01 (ps)
  
[内容]
  ## 作業内容
    プロセスをコマンド(ps)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    ps a      : 端末上の全プロセス表示
    ps u      : 実行ユーザー表示
    ps x      : 制御端末を持たないプロセスも表示
    ps e      : 環境変数も表示
    ps r      : 実行中プロセスのみ表示
    ps l      : 長フォーマット
    ps -e     : 全プロセス表示
    ps -f     : 引数も含めた完全フォーマットで表示
    ps -l     : 長フォーマット
    ps -p XX  : XX(PID)を指定
    ps -u XX  : XX(UID)を指定
  
  ## 項目説明
    PID     : プロセスID
    PPID    : 親プロセスのPID
    %CPU    : CPU使用率
    %MEM    : メモリ使用率
    VSZ     : プロセスが使用するメモリ量
    RSS     : 現時点で使用中のメモリ量
    TTY     : 制御端末名
    STAT    : プロセス状態(S:スリープ、D:割込不可、R:実行状態、T:トレースまたは停止、Z:消滅状態、W:スワップアウト)
    START   : 実行開始時刻
    TIME    : 消費したCPU時間
    COMMAND : 実行コマンド
  
[確認]
  vm11$ cd $HOME
  vm11$ bash script01.sh & -> バックグラウンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  [1] 17508
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ps aux | grep script01 | grep -v grep
  
  コマンドの実行結果
  --------------------------------------------------
  USER       PID  %CPU  %MEM     VSZ   RSS  TTY    STAT  START  TIME  COMMAND
  makoto   17508  0.0   0.1   113284  1384  ttyS0  S     21:34  0:00  bash script01.sh
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ kill -term 17508
  
  コマンドの実行結果
  --------------------------------------------------
  [1]+  Terminated              bash script01.sh
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[17]
  CPU使用率の測定 - 02 (ps)
  
[内容]
  ## 作業内容
    プロセスをコマンド(ps)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ bash script01.sh & -> バックグラウンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  [1] 1490
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ps -ef | grep script01 | grep -v grep
  
  コマンドの実行結果
  --------------------------------------------------
  UID     PID   PPID  C  STIME  TTY    TIME      CMD
  makoto  1490  1468  0  06:38  ttyS0  00:00:00  bash script01.sh
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ kill -term 1490
  
  コマンドの実行結果
  --------------------------------------------------
  [1]+  Terminated              bash script01.sh
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[18]
  CPU使用率の測定 - 03 (pstree)
  
[内容]
  ## 作業内容
    プロセスの親子関係をコマンド(pstree)で確認する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド ##
    pstree XX  : PID(XX)の親子関係をツリー状で表示
    pstree -l  : 長フォーマット
    pstree -p  : PID表示
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install psmisc
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ps -ef | grep -i NetworkManager
  
  コマンドの実行結果
  --------------------------------------------------
  UID   PID  PPID  C  STIME  TTY  TIME      CMD
  root  669  1     0  06:37  ?    00:00:00  /usr/sbin/NetworkManager --no-daemon
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ pstree -p 669
  
  コマンドの実行結果
  --------------------------------------------------
  NetworkManager(669) -------- {NetworkManager}(676)
                         |---- {NetworkManager}(680)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[19]
  CPU使用率の測定 - 04 (lsof)
  
[内容]
  ## 作業内容
    ネットワーク通信をコマンド(lsof)で測定する
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
  ## コマンド
    lsof        : プロセス情報をリスト表示
    lsof -c XX  : コマンド(XX)に一致するプロセスのみ表示
    lsof -i:XX  : ポート番号(XX)へ通信しているプロセスのみ表示
    lsof -n     : DNS名前解決を行わない
    lsof -p XX  : PID(XX)のプロセスのみ表示
    lsof -u XX  : UID(XX)のプロセスのみ表示
  
[確認]
  $ cd $HOME
  $ sudo yum -y install lsof
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  $ cd $HOME
  $ lsof -i:https -n -> HTTPS通信を測定
  
  コマンドの実行結果
  --------------------------------------------------
  COMMAND   PID    USER    FD  TYPE  DEVICE  SIZE/OFF  NODE  NAME
  code     3368  makoto   42u  IPV4  301529       0t0   TCP  192.168.1.3:38862 -> 40.77.226.250:https (SYN_SENT)
  firefox  3563  makoto   49u  IPV4  301406       0t0   TCP  192.168.1.3:41428 -> 133.152.62.71:https (ESTABLISHED)
  firefox  3563  makoto   53u  IPV4  263699       0t0   TCP  192.168.1.3:55368 -> 133.152.42.207:https (ESTABLISHED)
  firefox  3563  makoto  103u  IPV4   46986       0t0   TCP  192.168.1.3:51332 -> 52.35.145.245:https (ESTABLISHED)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[20]
  メモリおよびスワップ使用量の測定 - 01 (free)
  
[内容]
  ## 作業内容
    メモリとスワップの使用量を確認する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    free        : メモリとスワップの情報を表示
    free -b     : バイト単位で表示
    free -k     : キロバイト単位で表示
    free -m     : メガバイト単位で表示
    free -t     : 物理メモリとスワップの合計行も表示
    free -s XX  : 更新間隔(XX)を指定
    free -c XX  : 更新回数(XX)を指定
  
[確認]
  vm11$ cd $HOME
  vm11$ free -m -> メガバイト単位
  
  コマンドの実行結果
  --------------------------------------------------
                total        used        free      shared  buff/cache   available
  Mem:            989         176         558           8         254         665
  Swap:          2047           0        2047
  
  // total(989) = used(176) + buff/cache(254) + free(558) -> used(176)以外からavailable(665)を捻出
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[21]
  メモリおよびスワップ使用量の測定 - 02 (cat /proc/meminfo)
  
[内容]
  ## 作業内容
    メモリ容量をコマンド(cat /proc/meminfo)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ cat /proc/meminfo
  
  コマンドの実行結果
  --------------------------------------------------
  MemTotal:        1013456 kB
  MemFree:          572196 kB
  MemAvailable:     681372 kB
  Buffers:            2108 kB
  Cached:           235040 kB
  SwapCached:            0 kB
  Active:           172540 kB
  Inactive:         128512 kB
  Active(anon):      64156 kB
  Inactive(anon):     8452 kB
  Active(file):     108384 kB
  Inactive(file):   120060 kB
  Unevictable:           0 kB
  Mlocked:               0 kB
  SwapTotal:       2097148 kB
  SwapFree:        2097148 kB
  Dirty:                 0 kB
  Writeback:             0 kB
  AnonPages:         63924 kB
  Mapped:            22292 kB
  Shmem:              8704 kB
  Slab:              48092 kB
  SReclaimable:      23404 kB
  SUnreclaim:        24688 kB
  KernelStack:        1808 kB
  PageTables:         3508 kB
  NFS_Unstable:          0 kB
  Bounce:                0 kB
  WritebackTmp:          0 kB
  CommitLimit:     2603876 kB
  Committed_AS:     272724 kB
  VmallocTotal:   34359738367 kB
  VmallocUsed:      270100 kB
  VmallocChunk:   34358947836 kB
  Percpu:              520 kB
  HardwareCorrupted:     0 kB
  AnonHugePages:     10240 kB
  CmaTotal:              0 kB
  CmaFree:               0 kB
  HugePages_Total:       0
  HugePages_Free:        0
  HugePages_Rsvd:        0
  HugePages_Surp:        0
  Hugepagesize:       2048 kB
  DirectMap4k:       61284 kB
  DirectMap2M:     1986560 kB
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[22]
  ディスク使用量の測定 - 01 (df)
  
[内容]
  ## 作業内容
    ディスク使用量をコマンド(df)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    df     : ディスク使用量の表示
    df -a  : 全ファイルシステムのディスク使用量を表示
    df -h  : 1MB=1024KB
    df -H  : 1MB=1000KB
    df -i  : iノードの使用状況
    df -m  : メガバイト単位で表示
    df -T  : ファイルシステムタイプを表示
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C
      > df
      > -H  // 1MB=1000KB
      > -m  // メガバイト単位
      > -T  // ファイルシステムタイプ表示
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      1M-blocks  Used  Available  Use%  Mounted on
  devtmpfs                      devtmpfs        701     0        701    0%  /dev
  tmpfs                         tmpfs           723     0        723    0%  /dev/shm
  tmpfs                         tmpfs           723     1        722    1%  /run
  tmpfs                         tmpfs           723     0        723    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs           17394  6328      11067   37%  /
  /dev/vda1                     xfs            1014   197        818   20%  /boot
  tmpfs                         tmpfs           105     0        105    0%  /run/user/1000
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[23]
  ディスク使用量の測定 - 02 (df)
  
[内容]
  ## 作業内容
    iノード使用状況をコマンド(df)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C 
      > df
      > -H  // 1MB=1000KB
      > -i  // 使用状況(iノード)
      > -T  // ファイルシステムタイプ表示
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      Inodes  IUsed  IFree  IUse%  Mounted on
  devtmpfs                      devtmpfs    180k    351   179k     1%  /dev
  tmpfs                         tmpfs       185k      1   185k     1%  /dev/shm
  tmpfs                         tmpfs       185k    455   185k     1%  /run
  tmpfs                         tmpfs       185k     14   185k     1%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs         9.0M   149k   8.8M     2%  /
  /dev/vda1                     xfs         525k    333   524k     1%  /boot
  tmpfs                         tmpfs       134k      1   134k     1%  /run/user/1000
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[24]
  ネットワークトラフィックの測定 - 01 (netstat)
  
[内容]
  ## 作業内容
    NIC情報をコマンド(netstat)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド
    netstat -i     : 全NIC情報を出力
    netstat -I=XX  : NIC(XX)の情報を出力
    netstat -s     : プロトコル毎の統計情報
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install net-tools
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ netstat -i
  
  コマンドの実行結果
  --------------------------------------------------
  Kernel Interface table
  Iface      MTU    RX-OK    RX-ERR    RX-DRP    RX-OVR    TX-OK    TX-ERR    TX-DRP    TX-OVR     Flg
  eth0      1500     1496         0         9         0      698         0         0         0    BMRU
  lo       65536       32         0         0         0       32         0         0         0     LRU
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ netstat -I=eth0
  
  コマンドの実行結果
  --------------------------------------------------
  Kernel Interface table
  Iface      MTU    RX-OK    RX-ERR    RX-DRP    RX-OVR    TX-OK    TX-ERR    TX-DRP    TX-OVR     Flg
  eth0      1500     1580         0         9         0      706         0         0         0    BMRU
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[25]
  ネットワークトラフィックの測定 - 02 (netstat)
  
[内容]
  ## 作業内容
    プロトコル毎の統計情報をコマンド(netstat)で測定する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ netstat -s
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> IP, ICMP, TCP, UDP ... の統計情報を確認
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[26]
  ネットワークトラフィックの測定 - 03 (ss)
  
[内容]
  ## 作業内容
    TCP接続とUDP接続を表示
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
  ## コマンド
    ss -t  : TCP接続を表示
    ss -u  : UDP接続を表示
    ss -s  : プロトコル毎の統計情報を表示
  
[確認]
  $ cd $HOME
  $ ss -t -> TCP接続
  
  コマンドの実行結果
  --------------------------------------------------
  State    Recv-Q    Send-Q    Local Address:Port    Peer Address:Port                
  ESTAB    0         0         192.168.1.4:51332     52.35.145.245:https                
  ESTAB    0         0         192.168.1.4:57674     133.152.42.207:https                
  ESTAB    0         0         192.168.1.4:50576     133.152.40.171:https  
  --------------------------------------------------
  
  $ cd $HOME
  $ ss -u -> UDP接続
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 列見出しのみ出力、該当データなし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[27]
  ネットワークトラフィックの測定 - 04 (ss)
  
[内容]
  ## 作業内容
    接続状態の統計を表示
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
[確認]
  $ cd $HOME
  $ ss -s -> プロトコル毎の統計情報
  
  コマンドの実行結果
  --------------------------------------------------
  Total: 1154
  TCP: 14 (estab 1, closed 6, orphaned 0, timewait 0)
  
  Transport  Total     IP        IPv6
  RAW        1         0         1        
  UDP        12        8         4        
  TCP        8         4         4        
  INET       21        12        9        
  FRAG       0         0         0        
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[28]
  ネットワークトラフィックの測定 - 05 (netperf)
  
[内容]
  ## 作業内容
    ホスト間でネットワークのスループット測定
  
  ## 使用マシン1
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## 仮想マシン2
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install wget
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ wget http://repo.iotti.biz/CentOS/7/x86_64/netperf-2.7.0-1.el7.lux.x86_64.rpm
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo rpm -ivh netperf-2.7.0-1.el7.lux.x86_64.rpm
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo firewall-cmd --add-port=12865/tcp --permanent
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo firewall-cmd --add-port=12866/tcp --permanent
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo firewall-cmd --reload
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo netserver -> サーバー起動
  
  コマンドの実行結果
  --------------------------------------------------
  Starting netserver with host 'IN(6)ADDR_ANY' port '12865' and family AF_UNSPEC
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo yum -y install wget
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ wget http://repo.iotti.biz/CentOS/7/x86_64/netperf-2.7.0-1.el7.lux.x86_64.rpm
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo rpm -ivh netperf-2.7.0-1.el7.lux.x86_64.rpm
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ netperf -H 192.168.122.11 -p 12865 -- -P 12866
    
    コマンドの実行結果
    --------------------------------------------------
    MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 12866 AF_INET to 192.168.122.12 () port 12866 AF_INET

    Recv   Send    Send                          
    Socket Socket  Message  Elapsed              
    Size   Size    Size     Time     Throughput
    bytes  bytes   bytes    secs.    10^6bits/sec

    87380  16384   16384    10.00    6297.77 -> 6300M(Bits) / 8 -> 787M(Bytes) / 秒
    --------------------------------------------------
    
  vm11$ cd $HOME
  vm11$ sudo pkill netserver -> サーバー停止
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[29]
  ネットワークトラフィックの測定 - 06 (iptraf-ng)
  
[内容]
  ## 作業内容
    ネットワークトラフィックのモニタリング
  
  ## 使用マシン1
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## 仮想マシン2
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install iptraf-ng
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo iptraf-ng -> モニタリング開始
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> Main Menu -> [IP traffic monitor] -> [eth0]
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ ping -c 3 vm11
    
    コマンドの実行結果
    --------------------------------------------------
    PING vm11 (192.168.122.11) 56(84) bytes of data.
    64 bytes from vm11 (192.168.122.11): icmp_seq=1 ttl=64 time=1.90 ms
    64 bytes from vm11 (192.168.122.11): icmp_seq=2 ttl=64 time=0.719 ms
    64 bytes from vm11 (192.168.122.11): icmp_seq=3 ttl=64 time=1.51 ms
    
    --- vm11 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2003ms
    rtt min/avg/max/mdev = 0.719/1.379/1.904/0.494 ms
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
