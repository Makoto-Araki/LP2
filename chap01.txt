================================================================================
[X01] 準備 - 構築予定の仮想マシン一覧
[X02] 準備 - ホスト側の設定
[X03] 準備 - 仮想環境のパッケージをインストール
[X04] 準備 - イメージファイル取得
[X05] 準備 - キックスタートファイル作成
[X06] 準備 - スクリプト作成と仮想マシン構築
[X07] 準備 - 仮想マシンへSSH接続
[X08] 準備 - 構成管理ツールをインストール
[X09] 準備 - コマンドラインで仮想マシンへ指示
[X10] 準備 - インベントリ作成
[X11] 準備 - モジュールを正式名称で指定
[X12] 準備 - パイプで処理をつなげるとエラー
[X13] 準備 - 管理者権限でコマンド実行
[X14] 準備 - ファイルコピーのモジュール使用
[X15] 準備 - プレイブック作成 - 01
[X16] 準備 - プレイブック作成 - 02
[X17] 準備 - プレイブック作成 - 03
[X18] 準備 - プレイブック作成 - 04
[X19] 準備 - プレイブック作成 - 05
[X20] 準備 - プレイブック作成 - 06
[001] 総合的なリソース使用率の測定 - 01 (top)
[002] 総合的なリソース使用率の測定 - 02 (vmstat)
[003] 総合的なリソース使用率の測定 - 03 (vmstat)
[004] 総合的なリソース使用率の測定 - 04 (iostat)
[005] 総合的なリソース使用率の測定 - 05 (iotop)
[006] 総合的なリソース使用率の測定 - 06 (sar)
[007] 総合的なリソース使用率の測定 - 07 (sar)
[008] 総合的なリソース使用率の測定 - 08 (sar)
[009] 総合的なリソース使用率の測定 - 09 (sar)
[010] 総合的なリソース使用率の測定 - 10 (sar)
[011] 総合的なリソース使用率の測定 - 11 (sar)
[012] 総合的なリソース使用率の測定 - 12 (sadf)
[013] 総合的なリソース使用率の測定 - 13 (uptime)
[014] 総合的なリソース使用率の測定 - 14 (w)
[015] CPU使用率の測定 - 01 (ps)
[016] CPU使用率の測定 - 02 (ps)
[017] CPU使用率の測定 - 03 (pstree)
[018] CPU使用率の測定 - 04 (lsof)
[019] メモリおよびスワップ使用量の測定 - 01 (free)
[020] メモリおよびスワップ使用量の測定 - 02 (cat /proc/meminfo)
[021] ディスク使用量の測定 - 01 (df)
[022] ディスク使用量の測定 - 02 (df)
[023] ネットワークトラフィックの測定 - 01 (netstat)
[024] ネットワークトラフィックの測定 - 02 (netstat)
[025] ネットワークトラフィックの測定 - 03 (ss)
[026] ネットワークトラフィックの測定 - 04 (ss)
[027] ネットワークトラフィックの測定 - 05 (netperf)
[028] ネットワークトラフィックの測定 - 06 (iptraf-ng)
================================================================================
[X01]
  準備 - 構築予定の仮想マシン一覧
  
[内容]
  ## ホスト
    HOST : rock
    IPV4 : dhcp
    MEMO : client1
  
  ## 仮想マシン1
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : server
  
  ## 仮想マシン2
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : client2
  
[確認]
  実機での確認なし
  
================================================================================
[X02]
  準備 - ホスト側の設定
  
[内容]
  ## 作業内容
    システム基本調査とホスト名の設定
  
[確認]
  $ cd $HOME
  $ cat /etc/redhat-release -> OSバージョン
  
  コマンドの実行結果
  --------------------------------------------------
  Rocky Linux release 8.8 (Green Obsidian)
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /etc/machine-id -> マシンID
  
  コマンドの実行結果
  --------------------------------------------------
  74e75651bd5b4069bb8767871ac6dbab
  --------------------------------------------------
  
  $ cd $HOME
  $ uname -r -> カーネルバージョン
  
  コマンドの実行結果
  --------------------------------------------------
  4.18.0-477.10.1.el8_8.x86_64
  --------------------------------------------------
  
  $ cd $HOME
  $ uname -m -> CPUアーキテクチャ
  
  コマンドの実行結果
  --------------------------------------------------
  x86_64
  --------------------------------------------------
  
  $ cd $HOME
  $ whoami -> ユーザー名
  
  コマンドの実行結果
  --------------------------------------------------
  makoto
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /etc/group | grep $(whoami) | grep wheel -> ユーザーがwheelグループ所属か確認
  
  コマンドの実行結果
  --------------------------------------------------
  wheel:x:10:makoto
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo visudo -> パスワード無しでsudoコマンドを実行可能にする
  
  コマンドの実行結果
  --------------------------------------------------
  %wheel   ALL=(ALL)   NOPASSWD: ALL -> コメントアウト解除
  --------------------------------------------------
  
  $ cd $HOME
  $ hostnamectl
  
  コマンドの実行結果
  --------------------------------------------------
   Static hostname: localhost.localdomain -> rockに変更する
         Icon name: computer-laptop
           Chassis: laptop
        Machine ID: 74e75651bd5b4069bb8767871ac6dbab
           Boot ID: a1214fe388ef4a0da9cc27fe1f76e473
  Operating System: Rocky Linux 8.8 (Green Obsidian)
       CPE OS Name: cpe:/o:rocky:rocky:8:GA
            Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
      Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ hostnamectl set-hostname rock
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  $ cd $HOME
  $ hostnamectl
  
  コマンドの実行結果
  --------------------------------------------------
   Static hostname: rock
         Icon name: computer-laptop
           Chassis: laptop
        Machine ID: 74e75651bd5b4069bb8767871ac6dbab
           Boot ID: a1214fe388ef4a0da9cc27fe1f76e473
  Operating System: Rocky Linux 8.8 (Green Obsidian)
       CPE OS Name: cpe:/o:rocky:rocky:8:GA
            Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
      Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ ip addr show -> NIC確認
  
  コマンドの実行結果
  --------------------------------------------------
  1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
      valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
      valid_lft forever preferred_lft forever
  
  2: enp0s25: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 70:58:12:26:ac:cf brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.4/24 brd 192.168.1.255 scope global dynamic noprefixroute enp0s25
      valid_lft 10600sec preferred_lft 10600sec
    inet6 2400:4052:20c0:bc00:7258:12ff:fe26:accf/64 scope global dynamic noprefixroute 
      valid_lft 14202sec preferred_lft 12402sec
    inet6 fe80::7258:12ff:fe26:accf/64 scope link noprefixroute 
      valid_lft forever preferred_lft forever
  
  3: wlp3s0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether ae:2f:c1:10:64:81 brd ff:ff:ff:ff:ff:ff permaddr 64:80:99:3b:2e:5c
  
  4: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:6f:51:3b brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
      valid_lft forever preferred_lft forever
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /etc/sysconfig/network-scripts/ifcfg-enp0s25
  
  コマンドの実行結果
  --------------------------------------------------
  TYPE=Ethernet
  PROXY_METHOD=none
  BROWSER_ONLY=no
  BOOTPROTO=dhcp -> 起動時にDHCPでIPV4の割当
  DEFROUTE=yes
  IPV4_FAILURE_FATAL=no
  IPV6INIT=yes
  IPV6_AUTOCONF=yes
  IPV6_DEFROUTE=yes
  IPV6_FAILURE_FATAL=no
  NAME=enp0s25
  UUID=2d5c2599-5e1e-4093-b26e-078d12c153ea
  DEVICE=enp0s25
  ONBOOT=yes
  IPV6_PRIVACY=no
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X03]
  準備 - 仮想環境のパッケージをインストール
  
[内容]
  ## 作業内容
    仮想環境のパッケージをインストール
  
[確認]
  $ cd $HOME
  $ grep -E 'svm|vmx' /proc/cpuinfo -> CPUの仮想環境(KVM)対応を確認
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 該当語句(vmx)が強調表示、CPUが仮想環境(KVM)に対応
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo dnf -y install qemu-kvm qemu-img libvirt virt-install virt-manager
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo systemctl start libvirtd
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo systemctl enable libvirtd
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X04]
  準備 - イメージファイル取得
  
[内容]
  ## 作業内容
    イメージファイル取得
  
[確認]
  $ cd $HOME
  $ sudo dnf -y install wget
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd /user/local/src
  $ sudo wget http://ftp.riken.jp/Linux/rocky/8.8/isos/x86_64/Rocky-8.8-x86_64-minimal.iso
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X05]
  準備 - キックスタートファイル作成
  
[内容]
  ## 作業内容
    キックスタートファイル作成
  
[確認]
  $ cd $HOME
  $ mkdir kickfile
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd $HOME
  $ vi kickfile/vm11-ks.cfg
  
  コマンドの実行結果
  --------------------------------------------------
  #version=RHEL8
  
  # Use text install
  text
  
  # License agreement
  eula --agreed
  
  # Package
  repo --name="Minimal" --baseurl=file:///run/install/sources/mount-0000-cdrom/Minimal
  
  %packages
  @^minimal-environment
  kexec-tools
  %end
  
  # Keyboard layouts
  keyboard --xlayouts='jp'
  
  # System language
  lang ja_JP.UTF-8
  
  # Network information -> オプション部分(--)は一行にまとめないとエラー
  network
    --hostname=vm11
    --bootproto=static
    --device=enp1s0
    --gateway=192.168.122.1
    --ip=192.168.122.11
    --nameserver=192.168.122.1
    --netmask=255.255.255.0
    --noipv6
    --activate
  
  # Use CDROM installation media
  cdrom
  
  # Run the Setup Agent on first boot
  firstboot --enable
  
  # Ignore disk is vda
  ignoredisk --only-use=vda
  
  # System bootloader configuration
  autopart
  
  # Partition clearing information
  clearpart --none --initlabel
  
  # System timezone
  timezone Asia/Tokyo --isUtc --nontp
  
  # Root password
  rootpw --plaintext rt0122ma
  
  # User add
  user --groups=wheel --name=makoto --password=ma0122ma --gecos="makoto"
  
  # Disable SELinux
  selinux --disabled
  
  %addon ADDON_placeholder --enable --reserve-mb=auto
  %end
  
  %anaconda
  pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
  pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
  pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
  %end
  --------------------------------------------------
  
  $ cd $HOME
  $ cp kickfile/vm11-ks.cfg kickfile/vm12-ks.cfg
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  $ cd $HOME
  $ vi kickfile/vm12-ks.cfg
  
  コマンドの実行結果
  --------------------------------------------------
  (IPV4を192.168.122.12に変更、vm11をvm12に変更)
  --------------------------------------------------
  
  $ cd $HOME
  $ ksvalidator kickfile/vm11-ks.cfg -> キックスタートファイル検証
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> OKの場合は何も出力されない
  --------------------------------------------------
  
  $ cd $HOME
  $ ksvalidator kickfile/vm12-ks.cfg -> キックスタートファイル検証
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> OKの場合は何も出力されない
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X06]
  準備 - スクリプト作成と仮想マシン構築
  
[内容]
  ## 作業内容
    スクリプト作成と仮想マシン構築
  
[確認]
  $ cd $HOME/kickfile
  $ vi vm11-mk.sh
  
  コマンドの実行結果
  --------------------------------------------------
  virt-install                                            # オプション部分(--)は一行にまとめないとエラー
  --name=vm11                                             # 仮想マシン名
  --location=/usr/local/src/Rocky-8.8-x86_64-minimal.iso  # イメージファイル
  --disk path=/home/vm11.qcow2,size=30,format=qcow2       # 仮想ディスク(30GB)
  --os-type=linux                                         # タイプ
  --os-variant=rocky8.6                                   # ディストリビューション
  --vcpus=1                                               # 仮想CPU数
  --ram=1600                                              # 割当メモリ量(MB) -> 1534以下ではエラー
  --network network=default                               # ネットワーク(default)
  --graphics none                                         # GUI不使用
  --initrd-inject /home/makoto/kickfile/vm11-ks.cfg       # キックスタートファイル
  --extra-args                                            # 追加パラメータ
    "ks=file:vm11-ks.cfg                                  # 追加パラメータ -> キックスタートファイル
    console=tty0 console=ttyS0,115200n8"                  # 追加パラメータ -> コンソール接続
  --------------------------------------------------
  
  $ cd $HOME/kickfile
  $ vi vm12-mk.sh
  
  コマンドの実行結果
  --------------------------------------------------
  (vm11をvm12に変更)
  --------------------------------------------------
  
  $ cd $HOME/kickfile
  $ sudo bash vm11-mk.sh
  
  コマンドの実行結果
  --------------------------------------------------
  (コマンド実行後に自動インストール開始 -> ログイン画面 -> makotoでログイン)
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ hostname
    
    コマンドの実行結果
    --------------------------------------------------
    vm11
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ip addr show
    
    コマンドの実行結果
    --------------------------------------------------
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
      link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
      inet 127.0.0.1/8 scope host lo
        valid_lft forever preferred_lft forever
      inet6 ::1/128 scope host 
        valid_lft forever preferred_lft forever
    
    2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
      link/ether 52:54:00:3a:2d:5f brd ff:ff:ff:ff:ff:ff
      inet 192.168.122.11/24 brd 192.168.122.255 scope global noprefixroute enp1s0
        valid_lft forever preferred_lft forever
      inet6 fe80::5054:ff:fe3a:2d5f/64 scope link 
        valid_lft forever preferred_lft forever
    --------------------------------------------------
    
    vm11# cd $HOME
    vm11# ping -c 3 192.168.1.1 -> 家庭用ルーターまでパケット到達
    
    コマンドの実行結果
    --------------------------------------------------
    PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.
    64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=1.45 ms
    64 bytes from 192.168.1.1: icmp_seq=2 ttl=254 time=1.13 ms
    64 bytes from 192.168.1.1: icmp_seq=3 ttl=254 time=1.19 ms
    
    --- 192.168.1.1 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2004ms
    rtt min/avg/max/mdev = 1.133/1.255/1.446/0.139 ms
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl is-active sshd -> SSH稼働
    
    コマンドの実行結果
    --------------------------------------------------
    active
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ vi .vimrc
    
    コマンドの実行結果
    --------------------------------------------------
    set tabstop=2 -> タブ幅の修正
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo visudo -> パスワード無しでsudoコマンドを実行可能にする
    
    コマンドの実行結果
    --------------------------------------------------
    %wheel   ALL=(ALL)   NOPASSWD: ALL -> コメントアウト解除
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/hosts -> 仮想マシンのエントリ追加
    
    コマンドの実行結果
    --------------------------------------------------
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    192.168.122.11 vm11 -> 追加
    192.168.122.12 vm12 -> 追加
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト -> ログインプロンプト表示 -> 「Ctrl + ]」 でホスト側のシェルに戻る
    --------------------------------------------------
    
  $ cd $HOME/kickfile
  $ sudo bash vm12-mk.sh
  
  コマンドの実行結果
  --------------------------------------------------
  (コマンド実行後に自動インストール開始 -> ログイン画面 -> makotoでログイン)
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ hostname
    
    コマンドの実行結果
    --------------------------------------------------
    vm12
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ ip addr show
    
    コマンドの実行結果
    --------------------------------------------------
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
      link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
      inet 127.0.0.1/8 scope host lo
        valid_lft forever preferred_lft forever
      inet6 ::1/128 scope host 
        valid_lft forever preferred_lft forever
    
    2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
      link/ether 52:54:00:e5:eb:ba brd ff:ff:ff:ff:ff:ff
      inet 192.168.122.12/24 brd 192.168.122.255 scope global noprefixroute enp1s0
        valid_lft forever preferred_lft forever
      inet6 fe80::5054:ff:fee5:ebba/64 scope link 
        valid_lft forever preferred_lft forever
    --------------------------------------------------
    
    vm12# cd $HOME
    vm12# ping -c 3 192.168.1.1 -> 家庭用ルーターまでパケット到達
    
    コマンドの実行結果
    --------------------------------------------------
    PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.
    64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=1.83 ms
    64 bytes from 192.168.1.1: icmp_seq=2 ttl=254 time=1.27 ms
    64 bytes from 192.168.1.1: icmp_seq=3 ttl=254 time=1.23 ms
    
    --- 192.168.1.1 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2003ms
    rtt min/avg/max/mdev = 1.226/1.439/1.826/0.275 ms
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ systemctl is-active sshd -> SSH稼働
    
    コマンドの実行結果
    --------------------------------------------------
    active
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ vi .vimrc
    
    コマンドの実行結果
    --------------------------------------------------
    set tabstop=2 -> タブ幅の修正
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo visudo -> パスワード無しでsudoコマンドを実行可能にする
    
    コマンドの実行結果
    --------------------------------------------------
    %wheel   ALL=(ALL)   NOPASSWD: ALL -> コメントアウト解除
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /etc/hosts -> 仮想マシンのエントリ追加
    
    コマンドの実行結果
    --------------------------------------------------
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    192.168.122.11 vm11 -> 追加
    192.168.122.12 vm12 -> 追加
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト -> ログインプロンプト表示 -> 「Ctrl + ]」 でホスト側のシェルに戻る
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X07]
  準備 - 仮想マシンへSSH接続
  
[内容]
  ## 作業内容
    仮想マシンへSSH接続
  
[確認]
  $ cd $HOME
  $ sudo vi /etc/hosts -> 仮想マシンのエントリ追加
  
  コマンドの実行結果
  --------------------------------------------------
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  192.168.122.11 vm11 -> 追加
  192.168.122.12 vm12 -> 追加
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh-keygen
  
  コマンドの実行結果
  --------------------------------------------------
  Generating public/private rsa key pair.
  Enter file in which to save the key (/home/makoto/.ssh/id_rsa): (Enter)
  Enter passphrase (empty for no passphrase): (Enter)             -> パスフレーズ無し
  Enter same passphrase again: (Enter)                            -> パスフレーズ無し
  Your identification has been saved in /home/makoto/.ssh/id_rsa. -> 秘密鍵
  Your public key has been saved in /home/makoto/.ssh/id_rsa.pub. -> 公開鍵
  The key fingerprint is:
  SHA256:z2YWBSFA/dZwjyignp3w4+RVJApkK1xyUM85GetFwy0 makoto@rock
  The key's randomart image is:
  ...
  --------------------------------------------------
  
  $ cd $HOME
  $ scp .ssh/id_rsa.pub makoto@vm11:id_rsa.pub -> 公開鍵を仮想マシンにSSH転送
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 初回接続時のみホスト認証用鍵をvm11から受取 -> .ssh/known_hostsに保存
  
  makoto@vm11's password: (makotoパスワード)
  id_rsa.pub  100%  565   308.2KB/s   00:00
  --------------------------------------------------
  
  $ cd $HOME
  $ scp .ssh/id_rsa.pub makoto@vm12:id_rsa.pub -> 公開鍵を仮想マシンにSSH転送
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 初回接続時のみホスト認証用鍵をvm11から受取 -> .ssh/known_hostsに保存
  
  makoto@vm12's password: (makotoパスワード)
  id_rsa.pub  100%  565   308.2KB/s   00:00
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm11 -> パスワード認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  makoto@vm11's password: (makotoパスワード)
  Last login: Sun May 28 11:49:44 2023
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ mkdir .ssh
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ chmod 700 .ssh -> アクセス権をmakotoのみ読書可能に設定
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat id_rsa.pub >> .ssh/authorized_keys -> 転送した公開鍵を規定ファイルに書き込む
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ chmod 600 .ssh/authorized_keys -> アクセス権をmakotoのみ読書可能に設定
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/ssh/sshd_config -> 設定ファイルの編集
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11# cd $HOME
    vm11# cat /etc/ssh/sshd_config | grep -vE '^#|^$'
    
    コマンドの実行結果
    --------------------------------------------------
    HostKey /etc/ssh/ssh_host_rsa_key
    HostKey /etc/ssh/ssh_host_ecdsa_key
    HostKey /etc/ssh/ssh_host_ed25519_key
    SyslogFacility AUTHPRIV
    PermitRootLogin no                      // YESからNOに変更
    PubkeyAuthentication yes                // コメントアウト解除
    AuthorizedKeysFile .ssh/authorized_keys // 公開鍵保存ファイルはそのまま
    PasswordAuthentication no               // YESからNOに変更
    ChallengeResponseAuthentication no
    GSSAPIAuthentication yes
    GSSAPICleanupCredentials no
    UsePAM yes
    X11Forwarding yes
    PrintMotd no
    AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
    AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
    AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
    AcceptEnv XMODIFIERS
    Subsystem sftp /usr/libexec/openssh/sftp-server
    --------------------------------------------------
    
    vm11# cd $HOME
    vm11# sudo systemctl reload sshd -> 設定ファイルを再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11# cd $HOME
    vm11# exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> パスワード認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  makoto@vm12's password: (makotoパスワード)
  Last login: Sun May 28 11:49:44 2023
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ mkdir .ssh
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ chmod 700 .ssh -> アクセス権をmakotoのみ読書可能に設定
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ cat id_rsa.pub >> .ssh/authorized_keys -> 転送した公開鍵を規定ファイルに書き込む
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ chmod 600 .ssh/authorized_keys -> アクセス権をmakotoのみ読書可能に設定
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /etc/ssh/sshd_config -> 設定ファイルの編集
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm12# cd $HOME
    vm12# cat /etc/ssh/sshd_config | grep -vE '^#|^$'
    
    コマンドの実行結果
    --------------------------------------------------
    HostKey /etc/ssh/ssh_host_rsa_key
    HostKey /etc/ssh/ssh_host_ecdsa_key
    HostKey /etc/ssh/ssh_host_ed25519_key
    SyslogFacility AUTHPRIV
    PermitRootLogin no                      // YESからNOに変更
    PubkeyAuthentication yes                // コメントアウト解除
    AuthorizedKeysFile .ssh/authorized_keys // 公開鍵保存ファイルはそのまま
    PasswordAuthentication no               // YESからNOに変更
    ChallengeResponseAuthentication no
    GSSAPIAuthentication yes
    GSSAPICleanupCredentials no
    UsePAM yes
    X11Forwarding yes
    PrintMotd no
    AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
    AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
    AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
    AcceptEnv XMODIFIERS
    Subsystem sftp /usr/libexec/openssh/sftp-server
    --------------------------------------------------
    
    vm12# cd $HOME
    vm12# sudo systemctl reload sshd -> 設定ファイルを再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12# cd $HOME
    vm12# exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ sudo virsh list --all -> 仮想マシン一覧
  
  コマンドの実行結果
  --------------------------------------------------
  Id   名前   状態
  2    vm11   実行中
  4    vm12   実行中
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo virsh destroy vm11 -> 仮想マシン停止
  
  コマンドの実行結果
  --------------------------------------------------
  Domain 'vm11' destroyed
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo virsh destroy vm12 -> 仮想マシン停止
  
  コマンドの実行結果
  --------------------------------------------------
  Domain 'vm12' destroyed
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo virsh start vm11 -> 仮想マシン起動
  
  コマンドの実行結果
  --------------------------------------------------
  Domain 'vm11' started
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo virsh start vm12 -> 仮想マシン起動
  
  コマンドの実行結果
  --------------------------------------------------
  Domain 'vm12' started
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun May 28 14:34:52 2023 from 192.168.122.1 -> パスワード入力が要求されなくなる
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun May 28 14:34:07 2023 -> パスワード入力が要求されなくなる
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X08]
  準備 - 構成管理ツールをインストール
  
[内容]
  ## 作業内容
    構成管理ツールをインストール
  
[確認]
  $ cd $HOME
  $ sudo dnf -y install ansible
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 自分の環境では競合エラーが発生
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo ansible --version -> 本コマンドでパッケージを個別にインストールしていくことができた
  
  コマンドの実行結果
  --------------------------------------------------
  ansible [core 2.14.2]
    config file = /etc/ansible/ansible.cfg
    configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
    ansible python module location = /usr/lib/python3.11/site-packages/ansible
    ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections
    executable location = /usr/bin/ansible
    python version = 3.11.2 (main, Feb 18 2023, 08:12:16) [GCC 8.5.0 20210514 (Red Hat 8.5.0-18)] (/usr/bin/python3.11)
    jinja version = 3.1.2
    libyaml = True
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo ansible-galaxy collection install ansible.posix -> 追加モジュールをインストール
  
  コマンドの実行結果
  --------------------------------------------------
  Starting galaxy collection install process
  Process install dependency map
  Starting collection install process
  Downloading https://galaxy.ansible.com/download/ansible-posix-1.5.4.tar.gz to /home/makoto/.ansible/tmp/ansible-local-22257csqns1ry/tmpg37_88ft/ansible-posix-1.5.4-8zmbodjl
  Installing 'ansible.posix:1.5.4' to '/home/makoto/.ansible/collections/ansible_collections/ansible/posix'
  ansible.posix:1.5.4 was installed successfully
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X09]
  準備 - コマンドラインで仮想マシンへ指示
  
[内容]
  ## 作業内容
    構成管理ツール(Ansible)からコマンドラインで仮想マシンへ指示
  
[確認]
  $ cd $HOME
  $ sudo vi /etc/ansible/hosts -> インベントリ修正
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /etc/ansible/hosts | grep -vE '^#|^$'
  
  コマンドの実行結果
  --------------------------------------------------
  [vms]
  192.168.122.11
  192.168.122.12
  
  [server1]
  192.168.122.11
  
  [client2]
  192.168.122.12
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vms --list-hosts -> 所属ホストを出力
  
  コマンドの実行結果
  --------------------------------------------------
  hosts (2):
    192.168.122.11
    192.168.122.12
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible server1 --list-hosts -> 所属ホストを出力
  
  コマンドの実行結果
  --------------------------------------------------
  hosts (1):
    192.168.122.11
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible client2 --list-hosts -> 所属ホストを出力
  
  コマンドの実行結果
  --------------------------------------------------
  hosts (1):
    192.168.122.12
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vms -m ping -> 所属ホストにPing
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.12 | SUCCESS => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
  }
  
  192.168.122.11 | SUCCESS => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible server1 -m ping -> 所属ホストにPing
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.11 | SUCCESS => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible client2 -m ping -> 所属ホストにPing
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.12 | SUCCESS => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible server1 -m setup -> 所属ホストから情報取得
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.11 | SUCCESS => {
    "ansible_facts": {
      "ansible_all_ipv4_addresses": [
        "192.168.122.11"
      ],
      "ansible_all_ipv6_addresses": [
        "fe80::5054:ff:fe3a:2d5f"
      ],
      ...
    }
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vms -m command -a 'hostnamectl' -> 所属ホストでコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.122.11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  
  192.168.122.12 | CHANGED | rc=0 >>
    Static hostname: vm12
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 9e52818a469b4bec95fdf15bcac46f9a
            Boot ID: 98911c1d7e564a3c8b5d38a10370180c
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X10]
  準備 - インベントリ作成
  
[内容]
  ## 作業内容
    インベントリ作成
  
[確認]
  $ cd $HOME
  $ mkdir ansible
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/myhost.yml -> YAML形式でインベントリ作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---                                 # 開始宣言 "---"
  all:                                # グループ "all" を宣言
    hosts:                            # グループ "all" の所属ホスト
      vm11:                           # ホスト名
        ansible_host: 192.168.122.11  # IPアドレス
        ansible_user: makoto          # ユーザー
        ansible_password: ma0122ma    # パスワード
      vm12:                           # ホスト名
        ansible_host: 192.168.122.12  # IPアドレス
        ansible_user: makoto          # ユーザー
        ansible_password: ma0122ma    # パスワード
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible all -i ansible/myhost.yml -m command -a 'hostnamectl' -> グループ全体にコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  vm12 | CHANGED | rc=0 >>
    Static hostname: vm12
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 9e52818a469b4bec95fdf15bcac46f9a
            Boot ID: 98911c1d7e564a3c8b5d38a10370180c
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  
  vm11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m command -a 'hostnamectl' -> 指定ホストのみにコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm12 -i ansible/myhost.yml -m command -a 'hostnamectl' -> 指定ホストのみにコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  vm12 | CHANGED | rc=0 >>
    Static hostname: vm12
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 9e52818a469b4bec95fdf15bcac46f9a
            Boot ID: 98911c1d7e564a3c8b5d38a10370180c
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X11]
  準備 - モジュールを正式名称で指定
  
[内容]
  ## 作業内容
    モジュールを正式名称で指定
  
[確認]
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m command -a 'hostnamectl'
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'hostnamectl' -> モジュールを正式名称で指定
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
    Static hostname: vm11
          Icon name: computer-vm
            Chassis: vm
         Machine ID: 92d5bec8979048b0b1af10ed812a4356
            Boot ID: 6c733aba0ffe4ebab2b0ced124110419
     Virtualization: kvm
   Operating System: Rocky Linux 8.8 (Green Obsidian)
        CPE OS Name: cpe:/o:rocky:rocky:8:GA
             Kernel: Linux 4.18.0-477.10.1.el8_8.x86_64
       Architecture: x86-64
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X12]
  準備 - パイプで処理をつなげるとエラー
  
[内容]
  ## 作業内容
    パイプで処理をつなげるとエラー
  
[確認]
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'cat /etc/passwd | head -n 5'
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) '|': No such file or directory -> パイプの解釈ができない？
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X13]
  準備 - 管理者権限でコマンド実行
  
[内容]
  ## 作業内容
    管理者権限でコマンド実行
  
[確認]
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'cat /etc/shadow'
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | FAILED | rc=1 >>
  cat: /etc/shadow: Permission deniednon-zero return code
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'cat /etc/shadow' -b -> 管理者権限でコマンド実行
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
  root:$6$VOR.vNeNpwLfqJTp$Qbwu0LtTrfh...dq2lpJd4Hsi4JmTiwhIdxiNuUWjqEiCi.::0:99999:7:::
  ...
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X14]
  準備 - ファイルコピーのモジュール使用
  
[内容]
  ## 作業内容
    ファイルコピーのモジュール使用
  
[確認]
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'ls -l'
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
  合計 4
  -rw-r--r-- 1 makoto makoto 565  5月 28 12:52 id_rsa.pub
  --------------------------------------------------
  
  $ cd $HOME
  $ vi sample.txt
  
  コマンドの実行結果
  --------------------------------------------------
  Hello World
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.copy -a "src='./sample.txt' dest='~/'" -> ファイルコピーのモジュール使用
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED => {
    "ansible_facts": {
      "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": true,
    "checksum": "648a6a6ffffdaa0badb23b8baf90b6168dd16b3a",
    "dest": "/home/makoto/sample.txt",
    "gid": 1000,
    "group": "makoto",
    "md5sum": "e59ff97941044f85df5297e1c302d260",
    "mode": "0664",
    "owner": "makoto",
    "size": 12,
    "src": "/home/makoto/.ansible/tmp/ansible-tmp-1685267941.3333616-24592-201430333515689/source",
    "state": "file",
    "uid": 1000
  }
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible vm11 -i ansible/myhost.yml -m ansible.builtin.command -a 'ls -l'
  
  コマンドの実行結果
  --------------------------------------------------
  vm11 | CHANGED | rc=0 >>
  合計 8
  -rw-r--r-- 1 makoto makoto 565  5月 28 12:52 id_rsa.pub
  -rw-rw-r-- 1 makoto makoto  12  5月 28 18:59 sample.txt -> ファイルコピー確認
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X15]
  準備 - プレイブック作成 - 01
  
[内容]
  ## 作業内容
    プレイブック作成 - 01
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun May 28 19:00:41 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnf list installed | grep -i net-tools -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnf list installed | grep -i traceroute -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun May 28 18:41:41 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ dnf list installed | grep -i net-tools -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ dnf list installed | grep -i traceroute -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm12 closed.
    --------------------------------------------------
  
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook01.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages                # 手順名
    hosts: all                            # 対象ホスト -> インベントリ参照
    gather_facts: no                      # ファクト変数の収集なし
  
    tasks:
      - name: Install net-tools package   # タスク名
        ansible.builtin.dnf:              # モジュール
          name: net-tools                 # パッケージ
          state: present                  # 未インストール時のみインストール
        become: yes                       # 管理者権限で実行
      
      - name: Install traceroute package  # タスク名
        ansible.builtin.dnf:              # モジュール
          name: traceroute                # パッケージ
          state: present                  # 未インストール時のみインストール
        become: yes                       # 管理者権限で実行
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook01.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install net-tools package]
  changed: [vm11]
  changed: [vm12]
  
  TASK [Install traceroute package]
  changed: [vm12]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  vm12 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook01.yml -> 再実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install net-tools package]
  ok: [vm11] -> 既にインストールされているためokと出力
  ok: [vm12] -> 既にインストールされているためokと出力
  
  TASK [Install traceroute package]
  ok: [vm11] -> 既にインストールされているためokと出力
  ok: [vm12] -> 既にインストールされているためokと出力
  
  PLAY RECAP
  vm11 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  vm12 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  --------------------------------------------------
  
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon May 29 08:37:22 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnf list installed | grep -i net-tools -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    net-tools.x86_64   2.0-0.52.20160912git.el8   @baseos
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dnf list installed | grep -i traceroute -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    traceroute.x86_64   3:2.1.0-6.el8   @baseos 
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon May 29 08:37:22 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ dnf list installed | grep -i net-tools -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    net-tools.x86_64   2.0-0.52.20160912git.el8   @baseos
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ dnf list installed | grep -i traceroute -> パッケージのインストール確認
    
    コマンドの実行結果
    --------------------------------------------------
    traceroute.x86_64   3:2.1.0-6.el8   @baseos 
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X16]
  準備 - プレイブック作成 - 02
  
[内容]
  ## 作業内容
    プレイブック作成 - 02
  
[確認]
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook02.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages
    hosts: all
    gather_facts: no
  
    tasks:
      - name: Install epel-release package
        ansible.builtin.dnf:
          name: epel-release
          state: present
        become: yes
      
      - name: Install wget package
        ansible.builtin.dnf:
          name: wget
          state: present
        become: yes
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook02.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install epel-release package]
  changed: [vm12]
  changed: [vm11]
  
  TASK [Install wget package]
  changed: [vm12]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  vm12 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X17]
  準備 - プレイブック作成 - 03
  
[内容]
  ## 作業内容
    プレイブック作成 - 03
  
[確認]
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook03.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages
    hosts: vm11  // 対象はvm11のみ！
    gather_facts: no
  
    tasks:
      - name: Install stress package
        ansible.builtin.dnf:
          name: stress
          state: present
        become: yes
      
      - name: Install sysstat package
        ansible.builtin.dnf:
          name: sysstat
          state: present
        become: yes
      
      - name: Install iotop package
        ansible.builtin.dnf:
          name: iotop
          state: present
        become: yes
      
      - name: Install psmisc package
        ansible.builtin.dnf:
          name: psmisc
          state: present
        become: yes
      
      - name: Install lsof package
        ansible.builtin.dnf:
          name: lsof
          state: present
        become: yes
      
      - name: Install iptraf-ng package
        ansible.builtin.dnf:
          name: iptraf-ng
          state: present
        become: yes
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook03.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install stress package]
  changed: [vm11]
  
  TASK [Install sysstat package]
  changed: [vm11]
  
  TASK [Install iotop package]
  changed: [vm11]
  
  TASK [Install psmisc package]
  ok: [vm11] -> 既にインストール済みの模様
  
  TASK [Install lsof package]
  changed: [vm11]
  
  TASK [Install iptraf-ng package]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=6    changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X18]
  準備 - プレイブック作成 - 04
  
[内容]
  ## 作業内容
    プレイブック作成 - 04
  
[確認]
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook04.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages and Open Ports
    hosts: all
    gather_facts: no
    
    tasks:
      - name: Install netperf package
        ansible.builtin.dnf:
          name: netperf
          state: present
        become: yes
    
      - name: Open port 12865
        ansible.posix.firewalld:
          port: 12865/tcp
          permanent: yes
          state: enabled
        become: yes
      
      - name: Open port 12866
        ansible.posix.firewalld:
          port: 12866/tcp
          permanent: yes
          state: enabled
        become: yes
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook04.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install netperf package]
  changed: [vm12]
  changed: [vm11]
  
  TASK [Open port 12865]
  changed: [vm11]
  changed: [vm12]
  
  TASK [Open port 12866]
  changed: [vm12]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  vm12 : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X19]
  準備 - プレイブック作成 - 05
  
[内容]
  ## 作業内容
    プレイブック作成 - 05
  
[確認]
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook05.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Group Package
    hosts: vm11
    gather_facts: no
    
    tasks:
      - name: Install group package
        ansible.builtin.dnf:
          name: '@Development Tools'
          state: present
        become: yes
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook05.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install group package]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X20]
  準備 - プレイブック作成 - 06
  
[内容]
  ## 作業内容
    プレイブック作成 - 06
  
[確認]
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.20.1.tar.xz -> カーネルソースのダウンロード
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook06.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages
    hosts: vm11
    gather_facts: no
    
    tasks:
      - name: Install kernel-devel package
        ansible.builtin.dnf:
          name: kernel-devel
          state: present
        become: yes
      
      - name: Install ncurses-devel package
        ansible.builtin.dnf:
          name: ncurses-devel
          state: present
        become: yes
      
      - name: Install elfutils-libelf-devel package
        ansible.builtin.dnf:
          name: elfutils-libelf-devel
          state: present
        become: yes
      
      - name: Install openssl-devel package
        ansible.builtin.dnf:
          name: openssl-devel
          state: present
        become: yes
      
      - name: Install bc package
        ansible.builtin.dnf:
          name: bc
          state: present
        become: yes
      
      - name: Copy kernel source
        ansible.builtin.copy:
          remote_src: false  // ローカルからリモートへコピー
          src: /home/makoto/linux-4.20.1.tar.xz
          dest: /usr/local/src
        become: yes
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook06.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install kernel-devel package]
  ok: [vm11]
  
  TASK [Install ncurses-devel package]
  changed: [vm11]
  
  TASK [Install elfutils-libelf-devel package]
  ok: [vm11]
  
  TASK [Install openssl-devel package]
  ok: [vm11]
  
  TASK [Install bc package]
  changed: [vm11]
  
  TASK [Copy kernel source]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[X21]
  準備 - プレイブック作成 - 07
  
[内容]
  ## 作業内容
    プレイブック作成 - 07
  
[確認]
  $ cd $HOME
  $ cat ansible/myhost.yml -> インベントリ確認
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  all:
    hosts:
      vm11:
        ansible_host: 192.168.122.11
        ansible_user: makoto
        ansible_password: ma0122ma
      vm12:
        ansible_host: 192.168.122.12
        ansible_user: makoto
        ansible_password: ma0122ma
  --------------------------------------------------
  
  $ cd $HOME
  $ vi ansible/mybook07.yml -> プレイブック作成
  
  コマンドの実行結果
  --------------------------------------------------
  ---
  - name: Install Packages
    hosts: vm11
    gather_facts: no
    
    tasks:
      - name: Install pciutils package
        ansible.builtin.dnf:
          name: pciutils
          state: present
        become: yes
      
      - name: Install usbutils package
        ansible.builtin.dnf:
          name: usbutils
          state: present
        become: yes
  --------------------------------------------------
  
  $ cd $HOME
  $ ansible-playbook -i ansible/myhost.yml ansible/mybook07.yml -> プレイブック実行
  
  コマンドの実行結果
  --------------------------------------------------
  TASK [Install pciutils package]
  changed: [vm11]
  
  TASK [Install usbutils package]
  changed: [vm11]
  
  PLAY RECAP
  vm11 : ok=2    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[001]
  総合的なリソース使用率の測定 - 01 (top)
  
[内容]
  ## 作業内容
    プロセスをコマンド(top)で測定する
  
  ## コマンド
    top -b     : バッチモード
    top -d XX  : 更新間隔(XX 秒)
    top -n XX  : 更新回数(XX 回)を越えた後で自動的に終了
    top -u XX  : 指定ユーザーのプロセスのみ表示
    top -p XX  : 指定PIDのプロセスのみ表示
    top -w XX  : 出力幅(XX 桁数)
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 08:23:41 2023
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ top -> 対話モード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 対話モードは練習あるのみ！
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ mkdir scripts
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ vi scripts/script01.sh
    
    コマンドの実行結果
    --------------------------------------------------
    #!/bin/bash
    
    if test -f script.log ; then
      rm -f script.log
      touch script.log
    fi
    
    while :
    do
      echo $(date +%Y/%m/%d-%H:%M:%S) >> script.log
      sleep 1
    done
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script01.sh & -> バックグラウンド実行
    
    コマンドの実行結果
    --------------------------------------------------
    [1] 1542
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ top
        > -b           // バッチモード
        > -u makoto    // ユーザー指定
        > -d 1         // 更新間隔１秒
        > -n 9         // 更新回数９回
        > -w 100       // 出力幅100
        > | grep 1542  // 該当プロセスのみ表示
    
    コマンドの実行結果
    --------------------------------------------------
    PID   USER    PR  NI  VIRT    RES   SHR   S  %CPU  %MEM  TIME+    COMMAND
    1542  makoto  20   0  222532  3060  2796  S  0.0   0.2   0:00.08  bash
    1542  makoto  20   0  222532  3060  2796  S  0.0   0.2   0:00.08  bash
    1542  makoto  20   0  222532  3060  2796  S  0.0   0.2   0:00.08  bash
    1542  makoto  20   0  222532  3060  2796  S  0.0   0.2   0:00.08  bash
    1542  makoto  20   0  222532  3060  2796  S  0.0   0.2   0:00.08  bash
    1542  makoto  20   0  222532  3060  2796  S  1.0   0.2   0:00.09  bash
    1542  makoto  20   0  222532  3060  2796  S  0.0   0.2   0:00.09  bash
    1542  makoto  20   0  222532  3060  2796  S  0.0   0.2   0:00.09  bash
    1542  makoto  20   0  222532  3060  2796  S  0.0   0.2   0:00.09  bash
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ top
        > -b           // バッチモード
        > -p 1542      // プロセスID指定
        > -d 1         // 更新間隔１秒
        > -n 9         // 更新回数９回
        > | grep 1542  // プロセス欄のみ表示
    
    コマンドの実行結果
    --------------------------------------------------
    1542  makoto  20  0  222532  3060  2796  S  0.0   0.2   0:00.62  bash
    1542  makoto  20  0  222532  3060  2796  S  0.0   0.2   0:00.62  bash
    1542  makoto  20  0  222532  3060  2796  S  0.0   0.2   0:00.62  bash
    1542  makoto  20  0  222532  3060  2796  R  0.0   0.2   0:00.62  bash
    1542  makoto  20  0  222532  3060  2796  S  0.0   0.2   0:00.62  bash
    1542  makoto  20  0  222532  3060  2796  S  1.0   0.2   0:00.63  bash
    1542  makoto  20  0  222532  3060  2796  S  0.0   0.2   0:00.63  bash
    1542  makoto  20  0  222532  3060  2796  S  0.0   0.2   0:00.63  bash
    1542  makoto  20  0  222532  3060  2796  S  0.0   0.2   0:00.63  bash
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ kill -term(15) 1542
    
    コマンドの実行結果
    --------------------------------------------------
    [1]+  Terminated  bash  scripts/script01.sh
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[002]
  総合的なリソース使用率の測定 - 02 (vmstat)
  
[内容]
  ## 作業内容
    CPU負荷をコマンド(vmstat)で測定する
  
  ## コマンド
    vmstat XX YY       : 更新間隔(XX秒)、更新回数(YY回)
    vmstat XX YY -S k  : 更新間隔(XX秒)、更新回数(YY回)、キロバイト単位
    vmstat XX YY -S m  : 更新間隔(XX秒)、更新回数(YY回)、メガバイト単位
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 08:50:32 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ vi scripts/script02.sh
    
    コマンドの実行結果
    --------------------------------------------------
    #!/bin/bash
    
    # CPU負荷プロセス、5秒後タイムアウト、起動メッセージ非表示、バックグラウンド実行
    stress -c 1 -t 5 -q &
    
    # 更新間隔1秒、更新回数9回、メガバイト単位
    vmstat 1 9 -S m
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script02.sh
    
    コマンドの実行結果
    --------------------------------------------------
    ## PROC ##  ######## Memory #########  ## Swap ##  ### IO ###  ## System ##  ###### CPU ######
       r  b     swpd   free   buff  cache   si   so     bi    bo     in   cs      us sy id wa st
       1  0        0    371      2    477    0    0     52    66     29   44       0  0 99  0  0
       1  0        0    371      2    477    0    0      0     0   1008   53      98  0  0  0  2  // CPU負荷
       1  0        0    371      2    477    0    0      0     0   1010   52     100  0  0  0  0  // CPU負荷
       1  0        0    371      2    477    0    0      0    19   1026   72     100  0  0  0  0  // CPU負荷
       2  0        0    371      2    477    0    0      0     0   1010   58     100  0  0  0  0  // CPU負荷
       0  0        0    371      2    477    0    0      0     0    975   63      94  0  6  0  0  // CPU負荷
       0  0        0    371      2    477    0    0      0     0     37   58       0  1 99  0  0
       0  0        0    371      2    477    0    0      0     0     32   52       1  0 99  0  0
       0  0        0    371      2    477    0    0      0     0     34   54       0  0 99  0  1
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[003]
  総合的なリソース使用率の測定 - 03 (vmstat)
  
[内容]
  ## 作業内容
    メモリ負荷をコマンド(vmstat)で測定する
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 09:15:22 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ vi scripts/script03.sh
    
    コマンドの実行結果
    --------------------------------------------------
    #!/bin/bash
    
    # メモリ負荷プロセス、5秒後タイムアウト、起動メッセージ非表示、バックグラウンド実行
    stress -m 1 -t 5 -q &
    
    # 更新間隔1秒、更新回数9回、メガバイト単位
    vmstat 1 9 -S m
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script03.sh
    
    コマンドの実行結果
    --------------------------------------------------
    ## PROC ##  ######## Memory #########  ## Swap ##  ### IO ###  ## System ##  ###### CPU ######
       r  b     swpd   free   buff  cache   si   so     bi    bo     in   cs      us sy id wa st
       2  0        0    371      2    477    0    0     44    56     27   40       0  0 99  0  0
       1  0        0    112      2    477    0    0      0     0    812   76       4 91  2  0  2  // メモリ負荷
       1  0        0    131      2    477    0    0      0     0   1068  132       3 95  0  0  2  // メモリ負荷
       1  0        0    167      2    477    0    0      0     0   1052  129       6 92  0  0  2  // メモリ負荷
       1  0        0    171      2    477    0    0      0     0   1062  133       6 92  0  0  2  // メモリ負荷
       0  0        0    371      2    477    0    0      0     0   1024  136       5 91  3  0  2  // メモリ負荷
       0  0        0    371      2    477    0    0      0     0     12   10       1  0 99  0  0
       0  0        0    371      2    477    0    0      0     0     11   10       1  0 99  0  0
       0  0        0    371      2    477    0    0      0     0     17   17       1  0 99  0  0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[004]
  総合的なリソース使用率の測定 - 04 (iostat)
  
[内容]
  ## 作業内容
    HDD負荷をコマンド(iostat)で測定する
  
  ## コマンド
    iostat -c     : CPU情報のみ出力
    iostat -d     : ディスクIOのみ出力
    iostat -k     : ブロック単位ではなくキロバイト単位
    iostat -m     : ブロック単位ではなくメガバイト単位
    iostat -t     : 時刻を表示
    iostat XX YY  : 更新間隔(XX秒)、更新回数(YY回)
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 09:18:30 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ lsblk (ディスク情報) -> デバイスマッピングが使われている
    
    コマンドの実行結果
    --------------------------------------------------
    NAME                    MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
    sr0                      11:0     1  1024M   0  rom   
    vda                     252:0     0    30G   0  disk  
     |-- vda1               252:1     0     1G   0  part  /boot
     |-- vda2               252:2     0    29G   0  part  
          |-- rl_vm11-root  253:0     0    26G   0  lvm   /       // 実体は/dev/dm-0
          |-- rl_vm11-swap  253:1     0     3G   0  lvm   [SWAP]  // 実体は/dev/dm-1
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /dev/mapper | grep vm11
    
    コマンドの実行結果
    --------------------------------------------------
    lrwxrwxrwx 1 root root       7  5月 31 08:21 rl_vm11-root -> ../dm-0  // 実体は/dev/dm-0
    lrwxrwxrwx 1 root root       7  5月 31 08:21 rl_vm11-swap -> ../dm-1  // 実体は/dev/dm-1
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /dev | grep dm-
    
    コマンドの実行結果
    --------------------------------------------------
    brw-rw---- 1 root disk    253,   0  5月 31 08:21 dm-0  // デバイスファイルは実在
    brw-rw---- 1 root disk    253,   1  5月 31 08:21 dm-1  // デバイスファイルは実在
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ vi scripts/script04.sh
    
    コマンドの実行結果
    --------------------------------------------------
    #!/bin/bash
    
    # HDD負荷プロセス、5秒後タイムアウト、起動メッセージ非表示、バックグラウンド実行
    stress -d 1 -t 5 -q &
    
    # 数秒待機
    sleep 1
    
    # 起動からの統計省略、メガバイト単位、更新間隔1秒、更新回数9回
    iostat -y -m 1 9
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script04.sh
    
    コマンドの実行結果
    --------------------------------------------------
    Linux 4.15.3 (vm11) 2023年05月04日 _x86_64_ (1 CPU)
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               0.00    0.00   98.28    0.00    1.72    0.00 -> HDD負荷開始で「%system」の数値上昇
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda             165.52         0.00       165.52          0         96 -> リクエストがデバイスに殺到
    vdb               0.00         0.00         0.00          0          0
    dm-0             84.48         0.00       165.52          0         96 -> リクエストがデバイスに殺到
    dm-1              0.00         0.00         0.00          0          0
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               0.00    0.00   94.64    0.00    5.36    0.00
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda             207.14         0.00       207.47          0        116
    vdb               0.00         0.00         0.00          0          0
    dm-0            107.14         0.00       207.47          0        116
    dm-1              0.00         0.00         0.00          0          0
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               0.00    0.00   92.19    0.00    7.81    0.00
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda             200.00         0.00       200.00          0        128
    vdb               0.00         0.00         0.00          0          0
    dm-0            101.56         0.00       200.00          0        128
    dm-1              0.00         0.00         0.00          0          0
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               0.00    0.00   93.18    0.00    2.27    4.55
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda              72.73         0.00        72.73          0         64
    vdb               0.00         0.00         0.00          0          0
    dm-0             37.50         0.00        72.73          0         64
    dm-1              0.00         0.00         0.00          0          0
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               1.00    0.00    2.00    0.00    0.00   97.00 -> HDD負荷終了で「%idle」の数値上昇
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda               0.00         0.00         0.00          0          0 -> 書込リクエストも無くなる
    vdb               0.00         0.00         0.00          0          0
    dm-0              0.00         0.00         0.00          0          0 -> 書込リクエストも無くなる
    dm-1              0.00         0.00         0.00          0          0
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               0.00    0.00    2.02    0.00    1.01   96.97
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda               0.00         0.00         0.00          0          0
    vdb               0.00         0.00         0.00          0          0
    dm-0              0.00         0.00         0.00          0          0
    dm-1              0.00         0.00         0.00          0          0
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               0.00    0.00    1.02    0.00    0.00   98.98
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda               0.00         0.00         0.00          0          0
    vdb               0.00         0.00         0.00          0          0
    dm-0              0.00         0.00         0.00          0          0
    dm-1              0.00         0.00         0.00          0          0
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               0.00    0.00    1.02    0.00    0.00   98.98
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda               0.00         0.00         0.00          0          0
    vdb               0.00         0.00         0.00          0          0
    dm-0              0.00         0.00         0.00          0          0
    dm-1              0.00         0.00         0.00          0          0
    
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               0.00    0.00    2.04    0.00    0.00   97.96
    
    Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn
    vda               0.00         0.00         0.00          0          0
    vdb               0.00         0.00         0.00          0          0
    dm-0              0.00         0.00         0.00          0          0
    dm-1              0.00         0.00         0.00          0          0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[005]
  総合的なリソース使用率の測定 - 05 (iotop)
  
[内容]
  ## 作業内容
    プロセスをコマンド(iotop)で測定する
  
  ## コマンド
    iotop -b     : 対話モードでなくバッチモード
    iotop -d XX  : 更新間隔(XX 秒)
    iotop -n XX  : 更新回数(XX 回)を越えた後で自動的に終了
    iotop -u XX  : 指定ユーザーのプロセスのみ表示
    iotop -p XX  : 指定PIDのプロセスのみ表示
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 09:22:46 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo iotop -> 対話モード、root権限が必要
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 対話モードは練習あるのみ！
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script01.sh & -> バックグラウンド実行
    
    コマンドの実行結果
    --------------------------------------------------
    [1] 2882
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo iotop
        > -b            // バッチモード
        > -u makoto     // ユーザー指定
        > -d 1          // 更新間隔１秒
        > -n 9          // 更新回数９回
        > | grep 2882   // 該当プロセスのみ表示
        > | grep -v grep
    
    コマンドの実行結果
    --------------------------------------------------
    TID   PRIO  USER    DISK-READ  DISK-WRITE  SWAPIN  IO     COMMAND
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   3.90 K/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo iotop
        > -b            // バッチモード
        > -p 2882       // プロセスID指定
        > -d 1          // 更新間隔１秒
        > -n 9          // 更新回数９回
        > | grep 2882   // 該当プロセスのみ表示
        > | grep -v grep
    
    コマンドの実行結果
    --------------------------------------------------
    TID   PRIO  USER    DISK-READ  DISK-WRITE  SWAPIN  IO     COMMAND
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   3.98 K/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   0.00 B/s    ?unavailable?  bash scripts/script01.sh'
    2882  be/4  makoto  0.00 B/s   3.98 K/s    ?unavailable?  bash scripts/script01.sh'
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ kill -term(15) 2882
    
    コマンドの実行結果
    --------------------------------------------------
    [1]+  Terminated  bash scripts/script01.sh
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[006]
  総合的なリソース使用率の測定 - 06 (sar)
  
[内容]
  ## 作業内容
    収集データからCPU統計のレポートを作成
  
  ## コマンド
    sar XX YY       : 更新間隔(XX秒)、更新回数(YY回)
    sar -o XX       : 出力ファイル(XX)を指定
    sar -u          : CPU
    sar -r          : メモリ
    sar -W          : スワップ
    sar -b          : ディスクIO
    sar -n DEV      : NIC
    sar -n EDEV     : NICエラー
    sar -f XX       : ログファイル(XX)を指定
    sar -s XX -e YY : 時刻XX(HH:MM:SS)から時刻YY(HH:MM:SS)を指定
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 09:39:24 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /var/log/sa
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 root root 14K  5月 31 09:50 sa31
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C
        > sar
        > -u                   // 統計対象(CPU)
        > -f /var/log/sa/sa31  // ログファイル
        > -s 08:30:00          // 開始時刻
        > -e 09:30:00          // 終了時刻
        > 1200                 // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    Linux 4.18.0-477.10.1.el8_8.x86_64 (vm11) 05/31/23 _x86_64_ (1 CPU)
    
    08:30:03        CPU     %user     %nice   %system   %iowait    %steal     %idle
    08:50:03        all      0.41      0.00      0.39      0.00      0.21     98.98
    09:10:03        all      0.60      0.96      0.98      0.05      0.23     97.18
    Average:        all      0.51      0.48      0.69      0.02      0.22     98.08
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[007]
  総合的なリソース使用率の測定 - 07 (sar)
  
[内容]
  ## 作業内容
    収集データからメモリ統計のレポートを作成
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 09:57:16 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C
        > sar
        > -r                   // 統計対象(メモリ)
        > -f /var/log/sa/sa31  // ログファイル
        > -s 08:30:00          // 開始時刻
        > -e 09:30:00          // 終了時刻
        > 1200                 // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    Linux 4.18.0-477.10.1.el8_8.x86_64 (vm11) 05/31/23 _x86_64_ (1 CPU)
    
    08:30:03  kbmemfree  kbavail  kbmemused  %memused  kbbuffers  kbcached  kbcommit  %commit  kbactive  kbinact  kbdirty
    08:50:03    1088664  1100492     280000     20.46       4204    134380    211600     4.69     75636   123656        0
    09:10:03     984532  1091180     384132     28.07       4204    228396    239276     5.30    115556   183016        4
    Average:    1036598  1095836     332066     24.26       4204    181388    225438     4.99     95596   153336        2
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[008]
  総合的なリソース使用率の測定 - 08 (sar)
  
[内容]
  ## 作業内容
    収集データからスワップ統計のレポートを作成
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 10:00:57 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C
        > sar
        > -W                   // 統計対象(スワップ)
        > -f /var/log/sa/sa31  // ログファイル
        > -s 08:30:00          // 開始時刻
        > -e 09:30:00          // 終了時刻
        > 1200                 // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    Linux 4.18.0-477.10.1.el8_8.x86_64 (vm11) 05/31/23 _x86_64_ (1 CPU)
    
    08:30:03  pswpin/s  pswpout/s
    08:50:03      0.00       0.00
    09:10:03      0.00       0.00
    Average:      0.00       0.00
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[009]
  総合的なリソース使用率の測定 - 09 (sar)
  
[内容]
  ## 作業内容
    収集データからディスクIO統計のレポートを作成
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 10:13:53 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C
        > sar
        > -b                   // 統計対象(ディスクIO)
        > -f /var/log/sa/sa31  // ログファイル
        > -s 08:30:00          // 開始時刻
        > -e 09:30:00          // 終了時刻
        > 1200                 // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    Linux 4.18.0-477.10.1.el8_8.x86_64 (vm11) 05/31/23 _x86_64_ (1 CPU)
    
    08:30:03       tps      rtps      wtps   bread/s   bwrtn/s
    08:50:03      0.03      0.00      0.03      0.14      0.19
    09:10:03      0.98      0.56      0.42     48.43    120.88
    Average:      0.51      0.28      0.22     24.29     60.54
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[010]
  総合的なリソース使用率の測定 - 10 (sar)
  
[内容]
  ## 作業内容
    収集データからネットワーク統計のレポートを作成
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 10:17:29 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C
        > sar
        > -n DEV               // 統計対象(ネットワーク)
        > -f /var/log/sa/sa31  // ログファイル
        > -s 08:30:00          // 開始時刻
        > -e 09:30:00          // 終了時刻
        > 1200                 // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    Linux 4.18.0-477.10.1.el8_8.x86_64 (vm11) 05/31/23 _x86_64_ (1 CPU)
    
    08:30:03     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil
    08:50:03        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
    08:50:03    enp1s0      0.54      0.00      0.03      0.00      0.00      0.00      0.00      0.00
    09:10:03        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
    09:10:03    enp1s0      4.61      2.20     22.59      0.19      0.00      0.00      0.00      0.00
    Average:        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
    Average:    enp1s0      2.57      1.10     11.31      0.10      0.00      0.00      0.00      0.00
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[011]
  総合的なリソース使用率の測定 - 11 (sar)
  
[内容]
  ## 作業内容
    収集データからネットワークエラー統計のレポートを作成
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 12:26:25 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C
        > sar
        > -n EDEV              // 統計対象(ネットワークエラー)
        > -f /var/log/sa/sa31  // ログファイル
        > -s 08:30:00          // 開始時刻
        > -e 09:30:00          // 終了時刻
        > 1200                 // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    Linux 4.18.0-477.10.1.el8_8.x86_64 (vm11) 05/31/23 _x86_64_ (1 CPU)
    
    08:30:03     IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s
    08:50:03        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
    08:50:03    enp1s0      0.00      0.00      0.00      0.50      0.00      0.00      0.00      0.00      0.00
    09:10:03        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
    09:10:03    enp1s0      0.00      0.00      0.00      0.50      0.00      0.00      0.00      0.00      0.00
    Average:        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
    Average:    enp1s0      0.00      0.00      0.00      0.50      0.00      0.00      0.00      0.00      0.00
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[012]
  総合的なリソース使用率の測定 - 12 (sadf)
  
[内容]
  ## 作業内容
    収集データからネットワーク統計のレポートをJSON形式で作成
  
  ## コマンド
    sadf -j XX -- sarコマンドのオプション  : 出力形式(JSON)
    sadf -x XX -- sarコマンドのオプション  : 出力形式(XML)
    sadf -t XX -- sarコマンドのオプション  : ローカル日時
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 12:35:42 2023 from 192.168.122.1
  --------------------------------------------------
  
    vm11$ cd $HOME
    vm11$ LANG=C
        > sar
        > -u                   // CPU使用率
        > -f /var/log/sa/sa31  // ログファイル
        > -s 08:30:00          // 開始時刻
        > -e 09:30:00          // 終了時刻
        > 1200                 // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    Linux 4.18.0-477.10.1.el8_8.x86_64 (vm11) 05/31/23 _x86_64_ (1 CPU)
    
    08:30:03        CPU     %user     %nice   %system   %iowait    %steal     %idle
    08:50:03        all      0.41      0.00      0.39      0.00      0.21     98.98
    09:10:03        all      0.60      0.96      0.98      0.05      0.23     97.18
    Average:        all      0.51      0.48      0.69      0.02      0.22     98.08
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sadf              // CSV形式
        > -t                // ローカル時刻
        > /var/log/sa/sa31  // ログファイル
        > --                // 以降はコマンド(sar)のオプション
        > -u                // 統計対象(CPU)
        > -s 08:30:00       // 開始時刻
        > -e 09:30:00       // 終了時刻
        > 1200              // 1200秒(20分)単位
        > | tr '\t' ','     // タブ文字をカンマに変換
    
    コマンドの実行結果
    --------------------------------------------------
    vm11, 1200, 2023-05-31 08:50:03, all, %user,    0.41
    vm11, 1200, 2023-05-31 08:50:03, all, %nice,    0.00
    vm11, 1200, 2023-05-31 08:50:03, all, %system,  0.39
    vm11, 1200, 2023-05-31 08:50:03, all, %iowait,  0.00
    vm11, 1200, 2023-05-31 08:50:03, all, %steal,   0.21
    vm11, 1200, 2023-05-31 08:50:03, all, %idle,   98.98
    vm11, 1200, 2023-05-31 09:10:03, all, %user,    0.60
    vm11, 1200, 2023-05-31 09:10:03, all, %nice,    0.96
    vm11, 1200, 2023-05-31 09:10:03, all, %system,  0.98
    vm11, 1200, 2023-05-31 09:10:03, all, %iowait,  0.05
    vm11, 1200, 2023-05-31 09:10:03, all, %steal,   0.23
    vm11, 1200, 2023-05-31 09:10:03, all, %idle,   97.18
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sadf
        > -j                // JSON形式
        > -t                // ローカル時刻
        > /var/log/sa/sa31  // ログファイル
        > --                // 以降はコマンド(sar)のオプション
        > -u                // 統計対象(CPU)
        > -s 08:30:00       // 開始時刻
        > -e 09:30:00       // 終了時刻
        > 1200              // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    {
      "sysstat": {
          "hosts": [
            {
              "nodename": "vm11",
              "sysname": "Linux",
              "release": "4.15.3",
              "machine": "x86_64",
              ...
            }
          ]
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sadf
        > -x                // 出力形式(XML)
        > -t                // ローカル時刻
        > /var/log/sa/sa31  // ログファイル
        > --                // 以降はコマンド(sar)のオプション
        > -u                // 統計対象(CPU)
        > -s 08:30:00       // 開始時刻
        > -e 09:30:00       // 終了時刻
        > 1200              // 1200秒(20分)単位
    
    コマンドの実行結果
    --------------------------------------------------
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE sysstat PUBLIC "DTD v3.4 sysstat //EN" "...">
    <sysstat ...>
      ...
    </sysstat>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[013]
  総合的なリソース使用率の測定 - 13 (uptime)
  
[内容]
  ## 作業内容
    システム稼働時間、ログインユーザー数、平均負荷を観察する
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 12:40:25 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ uptime
    
    コマンドの実行結果
    --------------------------------------------------
    13:19:42 up  4:57,  1 user,  load average: 0.04, 0.03, 0.00
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[014]
  総合的なリソース使用率の測定 - 14 (w)
  
[内容]
  ## 作業内容
    指定ユーザーのプロセス情報を出力
  
  ## コマンド
    w XX     : ユーザー(XX)のプロセス情報を出力
    w -h XX  : ヘッダを非表示
    w -s XX  : ログイン時刻、JCPU、PCPUを非表示
  
  ## 項目説明
    TTY    : 端末名
    FROM   : リモートホスト名
    LOGIN@ : ログイン時刻
    IDLE   : アイドル時間
    JCPU   : 端末から実行されている全プロセスが消費したCPU時間
    PCPU   : WHAT欄のプロセスが消費したCPU時間
    WHAT   : 実行コマンド
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 13:19:28 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ w -h
    
    コマンドの実行結果
    --------------------------------------------------
    USER     TTY     FROM            LOGIN@   IDLE    JCPU    PCPU    WHAT
    makoto   pts/0   192.168.122.1   13:28    0.00s   0.07s   0.05s   w -h
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[015]
  CPU使用率の測定 - 01 (ps)
  
[内容]
  ## 作業内容
    プロセスをコマンド(ps)で測定する
  
  ## コマンド
    ps a      : 端末上の全プロセス表示
    ps u      : 実行ユーザー表示
    ps x      : 制御端末を持たないプロセスも表示
    ps e      : 環境変数も表示
    ps r      : 実行中プロセスのみ表示
    ps l      : 長フォーマット
    ps -e     : 全プロセス表示
    ps -f     : 引数も含めた完全フォーマットで表示
    ps -l     : 長フォーマット
    ps -p XX  : XX(PID)を指定
    ps -u XX  : XX(UID)を指定
  
  ## 項目説明
    PID     : プロセスID
    PPID    : 親プロセスのPID
    %CPU    : CPU使用率
    %MEM    : メモリ使用率
    VSZ     : プロセスが使用するメモリ量
    RSS     : 現時点で使用中のメモリ量
    TTY     : 制御端末名
    STAT    : プロセス状態(S:スリープ、D:割込不可、R:実行状態、T:トレースまたは停止、Z:消滅状態、W:スワップアウト)
    START   : 実行開始時刻
    TIME    : 消費したCPU時間
    COMMAND : 実行コマンド
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 13:28:02 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script01.sh & -> バックグラウンド実行
    
    コマンドの実行結果
    --------------------------------------------------
    [1] 4963
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ps aux | grep script01 | grep -v grep
    
    コマンドの実行結果
    --------------------------------------------------
    USER    PID   %CPU  %MEM  VSZ     RSS   TTY    STAT  START  TIME  COMMAND
    makoto  4963  0.1   0.2   222532  3316  pts/0  S     13:43  0:00  bash scripts/script01.sh
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ kill -term 4963
    
    コマンドの実行結果
    --------------------------------------------------
    [1]+  Terminated  bash scripts/script01.sh
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[016]
  CPU使用率の測定 - 02 (ps)
  
[内容]
  ## 作業内容
    プロセスをコマンド(ps)で測定する
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 13:43:07 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script01.sh & -> バックグラウンド実行
    
    コマンドの実行結果
    --------------------------------------------------
    [1] 5680
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ps -ef | grep script01 | grep -v grep
    
    コマンドの実行結果
    --------------------------------------------------
    UID     PID   PPID  C  STIME  TTY    TIME      CMD
    makoto  5680  5650  0  14:37  pts/0  00:00:00  bash scripts/script01.sh
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ kill -term 5680
    
    コマンドの実行結果
    --------------------------------------------------
    [1]+  Terminated  bash scripts/script01.sh
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[017]
  CPU使用率の測定 - 03 (pstree)
  
[内容]
  ## 作業内容
    プロセスの親子関係をコマンド(pstree)で確認する
  
  ## コマンド ##
    pstree XX  : PID(XX)の親子関係をツリー状で表示
    pstree -l  : 長フォーマット
    pstree -p  : PID表示
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 14:36:28 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ps -ef | grep -i NetworkManager | grep -v grep
    
    コマンドの実行結果
    --------------------------------------------------
    UID   PID  PPID  C  STIME  TTY  TIME      CMD
    root  724  1     0  08:21  ?    00:00:00  /usr/sbin/NetworkManager --no-daemon
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ pstree 724
    
    コマンドの実行結果
    --------------------------------------------------
    NetworkManager───2*[{NetworkManager}]
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ pstree -p 724
    
    コマンドの実行結果
    --------------------------------------------------
    NetworkManager(724) ------- {NetworkManager}(731)
                           |--- {NetworkManager}(732)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[018]
  CPU使用率の測定 - 04 (lsof)
  
[内容]
  ## 作業内容
    ネットワーク通信をコマンド(lsof)で測定する
  
  ## コマンド
    lsof        : プロセス情報をリスト表示
    lsof -c XX  : コマンド(XX)に一致するプロセスのみ表示
    lsof -i:XX  : ポート番号(XX)へ通信しているプロセスのみ表示
    lsof -n     : DNS名前解決を行わない
    lsof -p XX  : PID(XX)のプロセスのみ表示
    lsof -u XX  : UID(XX)のプロセスのみ表示
  
[確認]
  $ cd $HOME
  $ lsof -i:https -n -> HTTPS通信を測定
  
  コマンドの実行結果
  --------------------------------------------------
  COMMAND   PID    USER    FD  TYPE  DEVICE  SIZE/OFF  NODE  NAME
  code     3368  makoto   42u  IPV4  301529       0t0   TCP  192.168.1.3:38862 -> 40.77.226.250:https (SYN_SENT)
  firefox  3563  makoto   49u  IPV4  301406       0t0   TCP  192.168.1.3:41428 -> 133.152.62.71:https (ESTABLISHED)
  firefox  3563  makoto  103u  IPV4   46986       0t0   TCP  192.168.1.3:51332 -> 52.35.145.245:https (ESTABLISHED)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[019]
  メモリおよびスワップ使用量の測定 - 01 (free)
  
[内容]
  ## 作業内容
    メモリとスワップの使用量を確認する
  
  ## コマンド
    free        : メモリとスワップの情報を表示
    free -b     : バイト単位で表示
    free -k     : キロバイト単位で表示
    free -m     : メガバイト単位で表示
    free -t     : 物理メモリとスワップの合計行も表示
    free -s XX  : 更新間隔(XX)を指定
    free -c XX  : 更新回数(XX)を指定
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 14:51:13 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ free -mt -> メガバイト単位
    
    コマンドの実行結果
    --------------------------------------------------
                  total        used        free      shared  buff/cache   available
    Mem:           1336         125         949           8         262        1065
    Swap:          3071           0        3071
    Total:         4408         125        4021
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[020]
  メモリおよびスワップ使用量の測定 - 02 (cat /proc/meminfo)
  
[内容]
  ## 作業内容
    メモリ容量をコマンド(cat /proc/meminfo)で測定する
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 15:12:04 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /proc/meminfo
    
    コマンドの実行結果
    --------------------------------------------------
    MemTotal:        1368664 kB
    MemFree:          971668 kB
    MemAvailable:    1090216 kB
    Buffers:            4204 kB
    Cached:           239496 kB
    SwapCached:            0 kB
    Active:           144768 kB
    Inactive:         164492 kB
    Active(anon):        304 kB
    Inactive(anon):    73896 kB
    Active(file):     144464 kB
    Inactive(file):    90596 kB
    Unevictable:           0 kB
    Mlocked:               0 kB
    SwapTotal:       3145724 kB
    SwapFree:        3145724 kB
    Dirty:                 4 kB
    Writeback:             0 kB
    AnonPages:         65564 kB
    Mapped:            47028 kB
    Shmem:              8640 kB
    KReclaimable:      25004 kB
    Slab:              46784 kB
    SReclaimable:      25004 kB
    SUnreclaim:        21780 kB
    KernelStack:        1868 kB
    PageTables:         4144 kB
    NFS_Unstable:          0 kB
    Bounce:                0 kB
    WritebackTmp:          0 kB
    CommitLimit:     3830056 kB
    Committed_AS:     238100 kB
    VmallocTotal:   34359738367 kB
    VmallocUsed:       15156 kB
    VmallocChunk:          0 kB
    Percpu:              420 kB
    HardwareCorrupted:     0 kB
    AnonHugePages:     16384 kB
    ShmemHugePages:        0 kB
    ShmemPmdMapped:        0 kB
    FileHugePages:         0 kB
    FilePmdMapped:         0 kB
    HugePages_Total:       0
    HugePages_Free:        0
    HugePages_Rsvd:        0
    HugePages_Surp:        0
    Hugepagesize:       2048 kB
    Hugetlb:               0 kB
    DirectMap4k:       77680 kB
    DirectMap2M:     1560576 kB
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[021]
  ディスク使用量の測定 - 01 (df)
  
[内容]
  ## 作業内容
    ディスク使用量をコマンド(df)で測定する
  
  ## コマンド
    df     : ディスク使用量の表示
    df -a  : 全ファイルシステムのディスク使用量を表示
    df -h  : 1MB=1024KB
    df -H  : 1MB=1000KB
    df -i  : iノードの使用状況
    df -m  : メガバイト単位で表示
    df -T  : ファイルシステムタイプを表示
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 15:19:57 2023 from 192.168.122.1
  --------------------------------------------------
  
    vm11$ cd $HOME
    vm11$ LANG=C
        > df
        > -h  // 1MB=1024KB
        > -m  // メガバイト単位
        > -T  // ファイルシステムタイプ表示
    
    コマンドの実行結果
    --------------------------------------------------
    Filesystem                Type      1M-blocks  Used  Available  Use%  Mounted on
    devtmpfs                  devtmpfs        650     0        650    0%  /dev
    tmpfs                     tmpfs           669     0        669    0%  /dev/shm
    tmpfs                     tmpfs           669     9        660    2%  /run
    tmpfs                     tmpfs           669     0        669    0%  /sys/fs/cgroup
    /dev/mapper/rl_vm11-root  xfs           26608  2088      24520    8%  /
    /dev/vda1                 xfs            1014   191        824   19%  /boot
    tmpfs                     tmpfs           134     0        134    0%  /run/user/1000
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[022]
  ディスク使用量の測定 - 02 (df)
  
[内容]
  ## 作業内容
    iノード使用状況をコマンド(df)で測定する
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 18:48:27 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C 
        > df
        > -h  // 1MB=1024KB
        > -i  // 使用状況(iノード)
        > -T  // ファイルシステムタイプ表示
    
    コマンドの実行結果
    --------------------------------------------------
    Filesystem                Type      Inodes  IUsed  IFree  IUse%  Mounted on
    devtmpfs                  devtmpfs    163K    336   162K     1%  /dev
    tmpfs                     tmpfs       168K      1   168K     1%  /dev/shm
    tmpfs                     tmpfs       168K    462   167K     1%  /run
    tmpfs                     tmpfs       168K     17   168K     1%  /sys/fs/cgroup
    /dev/mapper/rl_vm11-root  xfs          13M    33K    13M     1%  /
    /dev/vda1                 xfs         512K    310   512K     1%  /boot
    tmpfs                     tmpfs       168K      5   168K     1%  /run/user/1000
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[023]
  ネットワークトラフィックの測定 - 01 (netstat)
  
[内容]
  ## 作業内容
    NIC情報をコマンド(netstat)で測定する
  
  ## コマンド
    netstat -i     : 全NIC情報を出力
    netstat -I=XX  : NIC(XX)の情報を出力
    netstat -s     : プロトコル毎の統計情報
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 18:55:34 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ netstat -i
    
    コマンドの実行結果
    --------------------------------------------------
    Kernel Interface table
    Iface      MTU    RX-OK    RX-ERR    RX-DRP    RX-OVR    TX-OK    TX-ERR    TX-DRP    TX-OVR     Flg
    enp1s0    1500    27384         0     14798         0     6149         0         0         0    BMRU
    lo       65536        0         0         0         0        0         0         0         0     LRU
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ netstat -I=enp1s0
    
    コマンドの実行結果
    --------------------------------------------------
    Kernel Interface table
    Iface      MTU    RX-OK    RX-ERR    RX-DRP    RX-OVR    TX-OK    TX-ERR    TX-DRP    TX-OVR     Flg
    enp1s0    1500    27551         0     14903         0     6177         0         0         0    BMRU
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[024]
  ネットワークトラフィックの測定 - 02 (netstat)
  
[内容]
  ## 作業内容
    プロトコル毎の統計情報をコマンド(netstat)で測定する
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 19:09:51 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ netstat -s
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> IP, ICMP, TCP, UDP ... の統計情報を確認
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[025]
  ネットワークトラフィックの測定 - 03 (ss)
  
[内容]
  ## 作業内容
    TCP接続とUDP接続を表示
  
  ## コマンド
    ss -t  : TCP接続を表示
    ss -u  : UDP接続を表示
    ss -s  : プロトコル毎の統計情報を表示
  
[確認]
  $ cd $HOME
  $ ss -t -> TCP接続
  
  コマンドの実行結果
  --------------------------------------------------
  State    Recv-Q    Send-Q    Local Address:Port    Peer Address:Port                
  ESTAB    0         0         192.168.1.4:51332     52.35.145.245:https                
  ESTAB    0         0         192.168.1.4:57674     133.152.42.207:https                
  ESTAB    0         0         192.168.1.4:50576     133.152.40.171:https  
  --------------------------------------------------
  
  $ cd $HOME
  $ ss -u -> UDP接続
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 列見出しのみ出力、該当データなし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[026]
  ネットワークトラフィックの測定 - 04 (ss)
  
[内容]
  ## 作業内容
    接続状態の統計を表示
  
[確認]
  $ cd $HOME
  $ ss -s -> プロトコル毎の統計情報
  
  コマンドの実行結果
  --------------------------------------------------
  Total: 1154
  TCP: 14 (estab 1, closed 6, orphaned 0, timewait 0)
  
  Transport    Total     IP        IPv6
  RAW          1         0         1        
  UDP          12        8         4        
  TCP          8         4         4        
  INET         21        12        9        
  FRAG         0         0         0        
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[027]
  ネットワークトラフィックの測定 - 05 (netperf)
  
[内容]
  ## 作業内容
    ホスト間でネットワークのスループット測定
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 21:12:30 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo netserver -> サーバー起動
    
    コマンドの実行結果
    --------------------------------------------------
    Starting netserver with host 'IN(6)ADDR_ANY' port '12865' and family AF_UNSPEC
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo firewall-cmd --reload
    
    コマンドの実行結果
    --------------------------------------------------
    success -> プレイブックの記述方法が不明
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 21:12:30 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ netperf -H 192.168.122.11 -p 12865 -- -P 12866
    
    コマンドの実行結果
    --------------------------------------------------
    MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 12866 AF_INET to 192.168.122.11 () port 12866 AF_INET ...
    
    Recv    Send    Send                          
    Socket  Socket  Message  Elapsed              
    Size    Size    Size     Time     Throughput  
    bytes   bytes   bytes    secs.    10^6bits/sec  
    
    87380   16384   16384    10.00    3219.92 -> 3200M(Bits) / 8 -> 400MB
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm12 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 21:58:23 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo pkill netserver -> サーバー停止
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[028]
  ネットワークトラフィックの測定 - 06 (iptraf-ng)
  
[内容]
  ## 作業内容
    ネットワークトラフィックのモニタリング
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 22:14:24 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo iptraf-ng -> モニタリング開始
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> リアルタイムでパケット受信状況が確認できる
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed May 31 21:12:30 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ ping -c 3 vm11
    
    コマンドの実行結果
    --------------------------------------------------
    PING vm11 (192.168.122.11) 56(84) bytes of data.
    64 bytes from vm11 (192.168.122.11): icmp_seq=1 ttl=64 time=1.90 ms
    64 bytes from vm11 (192.168.122.11): icmp_seq=2 ttl=64 time=0.719 ms
    64 bytes from vm11 (192.168.122.11): icmp_seq=3 ttl=64 time=1.51 ms
    
    --- vm11 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2003ms
    rtt min/avg/max/mdev = 0.719/1.379/1.904/0.494 ms
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm12 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
