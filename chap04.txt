================================================================================
[01] File System - 1 (設定ファイルの書式)
[02] File System - 2 (設定ファイルの確認)
[03] File System - 3 (UUID)
[04] File System - 4 (カーネルサポートのファイルシステム)
[05] File System - 5 (マウント済みのファイルシステム)
[06] File System - 6 (マウント)
================================================================================
[01]
  File System - 1 (設定ファイルの書式)
  
[内容]
  ## 設定ファイル(/etc/fstab)の書式
  --------------------------------------------------
  デバイス名(UUID名)/ラベル名  マウントポイント  ファイルシステム  マウントオプション  DUMP対象  FSCK順序
  
  (設定例)
  /dev/sda1  /boot  ext2  defaults  0  2
  
  ファイルシステム
    EXT2      : EXTの拡張版
    EXT3      : ジャーナリング機能付加
    EXT4      : 機能拡張
    ReiserFS  : Linux用ジャーナリングファイルシステム
    JFS       : IBM製ジャーナリングファイルシステム
    XFS       : SGI製ジャーナリングファイルシステム -> CentOS7のデフォルト
    btrfs     : 先進的ファイルシステム
    ISO9660   : CD-ROM用
    UDF       : DVD用
    F2FS      : SSD用
    MSDOS     : MS-DOS用
    FAT/FAT32 : フラッシュメモリ用(USB)
    NTFS      : WindowsNT/2000以降
    HPFS      : OS/2用
    HFS       : MacOS用
    HFS+      : MacOS8.1以降
    NFS       : ファイル共有(Linux)
    CIFS      : ファイル共有(Windows)
    procfs    : プロセス情報を扱う仮想ファイルシステム(/proc)
    sysfs     : デバイス情報を扱う仮想ファイルシステム
    tmpfs     : 仮想メモリを扱う仮想ファイルシステム
    devpts    : 疑似端末制御のための仮想ファイルシステム
    usbfs     : USBデバイス監視用
    cramfs    : 組込システム用
  
  マウントオプション
    async     : 入出力同期  // 非同期
    sync      : 入出力同期  // 同期
    atime     : Iノードアクセス時刻更新  // 更新
    relatime  : Iノードアクセス時刻更新  // 一定時間後に更新
    noatime   : Iノードアクセス時刻更新  // 更新しない(ディスクアクセス高速化)
    auto      : コマンド「mount -a」の実行時の動作  // マウント
    noauto    : コマンド「mount -a」の実行時の動作  // マウントしない
    exec      : バイナリ実行を許可
    noexec    : バイナリ実行を禁止
    suid      : SUID, SGID
    nosuid    : SUID, SGID
    ro        : 読み取り専用
    rw        : 書き込み可能
    user      : 一般ユーザーのマウント  // 一般ユーザーマウント許可、アンマウントはマウント操作したユーザーのみ
    users     : 一般ユーザーのマウント  // 一般ユーザーマウント許可、アンマウントもマウント操作したユーザー以外で許可
    nouser    : 一般ユーザーのマウント  // 一般ユーザーマウント禁止
    owner     : その他  // デバイスファイル所有者のマウント許可
    defaults  : その他  // async, auto, dev, exec, nouser, rw, suid
    dev       : その他  // ファイルシステム上のデバイスファイル使用可
    group     : その他  // 条件「ユーザーのグループ = デバイスファイルの所有グループ」が満たされた場合にマウント許可
    uid=UID   : その他  // 全ファイル所有者を指定UIDにする
    gid=GID   : その他  // 全ファイル所有グループを指定GIDにする
  
  DUMP対象
    0         : バックアップ対象外
    1-9       : バックアップ対象
  
  FSCK順序
    0         : チェック対象外
    1-9       : チェック順序(数字順)
  --------------------------------------------------
  
[確認]
  なし

  以下の確認に続く
  
================================================================================
[02]
  File System - 2 (設定ファイルの確認)
  
[内容]
  ## 仮想マシン
    HOST : vm12
    IPv4 : 192.168.122.12
    GW   : 192.168.122.1
    DNS  : 192.168.122.1
  
  ## 作業内容
    設定ファイル(/etc/fstab)を確認
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス表示)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  vda                     252:0    0   20G  0 disk 
  ├─vda2                  252:2    0   19G  0 part 
  │ ├─centos_vm11-swap    253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root    253:0    0   17G  0 lvm  /
  └─vda1                  252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /etc/fstab | grep -vE '^#|^$' (設定ファイルを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  Device                                      MountPoint   FileSystem   MountOption   DUMP   FSCK
  /dev/mapper/centos_vm11-root                /            xfs          defaults      0      0
  /dev/mapper/centos_vm11-swap                swap         swap         defaults      0      0
  UUID=1d5e0998-fe61-4a82-83be-96a01cfbbd31   /boot        xfs          defaults      0      0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  File System - 3 (UUID)
  
[内容]
  ## 仮想マシン
    HOST : vm12
    IPv4 : 192.168.122.12
    GW   : 192.168.122.1
    DNS  : 192.168.122.1
  
  ## 作業内容
    デバイスのUUIDを確認
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス表示)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  vda                     252:0    0   20G  0 disk 
  ├─vda2                  252:2    0   19G  0 part 
  │ ├─centos_vm11-swap    253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root    253:0    0   17G  0 lvm  /
  └─vda1                  252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  UUID
  ==================================================
  ・デバイスを一意に識別する文字列
  ・コマンド「tune2fs -U」で変更可能
  ・コマンド「uuidgen」で新規UUIDを作成可能
  ==================================================
  
  vm12$ cd $HOME
  vm12$ sudo blkid (デバイスのUUIDを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/vda1: UUID="1d5e0998-fe61-4a82-83be-96a01cfbbd31" TYPE="xfs" 
  /dev/vda2: UUID="FK1d1f-u6jH-Qd2L-OSNi-2gZL-os7w-fHojuw" TYPE="LVM2_member" 
  /dev/mapper/centos_vm11-root: UUID="90cf6fa5-58ac-4e14-89d1-909a3f537aa6" TYPE="xfs" 
  /dev/mapper/centos_vm11-swap: UUID="1475fefd-1dec-469a-b0c9-4f6be3f66ba9" TYPE="swap" 
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  File System - 4 (カーネルサポートのファイルシステム)
  
[内容]
  ## 仮想マシン
    HOST : vm12
    IPv4 : 192.168.122.12
    GW   : 192.168.122.1
    DNS  : 192.168.122.1
  
  ## 作業内容
    カーネルサポートのファイルシステムを表示
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/filesystems (カーネルサポートのファイルシステムを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  nodev     sysfs
  nodev     tmpfs
  nodev     bdev
  nodev     proc
  nodev     cgroup
  nodev     cgroup2
  nodev     cpuset
  nodev     devtmpfs
  nodev     configfs
  nodev     debugfs
  nodev     tracefs
  nodev     securityfs
  nodev     sockfs
  nodev     bpf
  nodev     pipefs
  nodev     ramfs
  nodev     hugetlbfs
  nodev     devpts
  nodev     autofs
  nodev     mqueue
  nodev     selinuxfs
  nodev     pstore
            xfs
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  File System - 5 (マウント済みのファイルシステム)
  
[内容]
  ## 仮想マシン
    HOST : vm12
    IPv4 : 192.168.122.12
    GW   : 192.168.122.1
    DNS  : 192.168.122.1
  
  ## 作業内容
    マウント済みのファイルシステムを表示
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /etc/mtab (マウント済みのファイルシステムを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  sysfs /sys sysfs rw,seclabel,nosuid,nodev,noexec,relatime 0 0
  proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0
  pstore /sys/fs/pstore pstore rw,seclabel,nosuid,nodev,noexec,relatime 0 0
  devtmpfs /dev devtmpfs rw,seclabel,nosuid,size=476688k,nr_inodes=119172,mode=755 0 0
  securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0
  devpts /dev/pts devpts rw,seclabel,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0
  cgroup /sys/fs/cgroup/systemd cgroup rw,seclabel,nosuid,nodev,noexec,relatime,xattr ... 0 0
  cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,seclabel,nosuid,nodev,noexec,relatime,cpu,cpuacct 0 0
  cgroup /sys/fs/cgroup/net_cls cgroup rw,seclabel,nosuid,nodev,noexec,relatime,net_cls 0 0
  cgroup /sys/fs/cgroup/devices cgroup rw,seclabel,nosuid,nodev,noexec,relatime,devices 0 0
  cgroup /sys/fs/cgroup/freezer cgroup rw,seclabel,nosuid,nodev,noexec,relatime,freezer 0 0
  cgroup /sys/fs/cgroup/pids cgroup rw,seclabel,nosuid,nodev,noexec,relatime,pids 0 0
  cgroup /sys/fs/cgroup/cpuset cgroup rw,seclabel,nosuid,nodev,noexec,relatime,cpuset 0 0
  cgroup /sys/fs/cgroup/hugetlb cgroup rw,seclabel,nosuid,nodev,noexec,relatime,hugetlb 0 0
  cgroup /sys/fs/cgroup/perf_event cgroup rw,seclabel,nosuid,nodev,noexec,relatime,perf_event 0 0
  cgroup /sys/fs/cgroup/memory cgroup rw,seclabel,nosuid,nodev,noexec,relatime,memory 0 0
  cgroup /sys/fs/cgroup/blkio cgroup rw,seclabel,nosuid,nodev,noexec,relatime,blkio 0 0
  configfs /sys/kernel/config configfs rw,relatime 0 0
  selinuxfs /sys/fs/selinux selinuxfs rw,relatime 0 0
  systemd-1 /proc/sys/fs/binfmt_misc autofs rw,relatime,fd=26,pgrp=1,timeout=0,minproto=5,maxproto=5,direct 0 0
  debugfs /sys/kernel/debug debugfs rw,seclabel,relatime 0 0
  hugetlbfs /dev/hugepages hugetlbfs rw,seclabel,relatime,pagesize=2M 0 0
  mqueue /dev/mqueue mqueue rw,seclabel,relatime 0 0
  /dev/mapper/centos_vm11-root / xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  /dev/vda1 /boot xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  tmpfs /dev/shm tmpfs rw,seclabel,nosuid,nodev 0 0
  tmpfs /run tmpfs rw,seclabel,nosuid,nodev,mode=755 0 0
  tmpfs /sys/fs/cgroup tmpfs ro,seclabel,nosuid,nodev,noexec,mode=755 0 0
  tmpfs /run/user/1000 tmpfs rw,seclabel,nosuid,nodev,relatime,size=100008k,mode=700,uid=1000,gid=1000 0 0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/mounts (マウント済みのファイルシステムを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  sysfs /sys sysfs rw,seclabel,nosuid,nodev,noexec,relatime 0 0
  proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0
  pstore /sys/fs/pstore pstore rw,seclabel,nosuid,nodev,noexec,relatime 0 0
  devpts /dev/pts devpts rw,seclabel,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0
  devtmpfs /dev devtmpfs rw,seclabel,nosuid,size=476688k,nr_inodes=119172,mode=755 0 0
  securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0
  cgroup /sys/fs/cgroup/systemd cgroup rw,seclabel,nosuid,nodev,noexec,relatime,xattr ... 0 0
  cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,seclabel,nosuid,nodev,noexec,relatime,cpu,cpuacct 0 0
  cgroup /sys/fs/cgroup/net_cls cgroup rw,seclabel,nosuid,nodev,noexec,relatime,net_cls 0 0
  cgroup /sys/fs/cgroup/devices cgroup rw,seclabel,nosuid,nodev,noexec,relatime,devices 0 0
  cgroup /sys/fs/cgroup/freezer cgroup rw,seclabel,nosuid,nodev,noexec,relatime,freezer 0 0
  cgroup /sys/fs/cgroup/pids cgroup rw,seclabel,nosuid,nodev,noexec,relatime,pids 0 0
  cgroup /sys/fs/cgroup/cpuset cgroup rw,seclabel,nosuid,nodev,noexec,relatime,cpuset 0 0
  cgroup /sys/fs/cgroup/hugetlb cgroup rw,seclabel,nosuid,nodev,noexec,relatime,hugetlb 0 0
  cgroup /sys/fs/cgroup/perf_event cgroup rw,seclabel,nosuid,nodev,noexec,relatime,perf_event 0 0
  cgroup /sys/fs/cgroup/memory cgroup rw,seclabel,nosuid,nodev,noexec,relatime,memory 0 0
  cgroup /sys/fs/cgroup/blkio cgroup rw,seclabel,nosuid,nodev,noexec,relatime,blkio 0 0
  configfs /sys/kernel/config configfs rw,relatime 0 0
  selinuxfs /sys/fs/selinux selinuxfs rw,relatime 0 0
  systemd-1 /proc/sys/fs/binfmt_misc autofs rw,relatime,fd=26,pgrp=1,timeout=0,minproto=5,maxproto=5,direct 0 0
  debugfs /sys/kernel/debug debugfs rw,seclabel,relatime 0 0
  hugetlbfs /dev/hugepages hugetlbfs rw,seclabel,relatime,pagesize=2M 0 0
  mqueue /dev/mqueue mqueue rw,seclabel,relatime 0 0
  /dev/vda1 /boot xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  /dev/mapper/centos_vm11-root / xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  tmpfs /dev/shm tmpfs rw,seclabel,nosuid,nodev 0 0
  tmpfs /run tmpfs rw,seclabel,nosuid,nodev,mode=755 0 0
  tmpfs /sys/fs/cgroup tmpfs ro,seclabel,nosuid,nodev,noexec,mode=755 0 0
  tmpfs /run/user/1000 tmpfs rw,seclabel,nosuid,nodev,relatime,size=100008k,mode=700,uid=1000,gid=1000 0 0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[06]
  File System - 6 (マウント)
  
[内容]
  ## コマンド(mount)
    mount -a      // 設定ファイル(/etc/fstab)の全ファイルシステムをマウント
    mount -o XX   // マウントオプション(XX)を指定
    mount -U XX   // UUID(XX)を指定
    mount -n      // 設定ファイル(/etc/mtab)に書き込まない
    mount -r      // mount -o ro と同一
    mount -w      // mount -o rw と同一
    mount -t XX   // ファイルシステム種類(XX)を指定
  
  ## コマンド(umount)
    umount -a     // 設定ファイル(/etc/mtab)の全ファイルシステムをアンマウント
    umount -t XX  // ファイルシステム種類(XX)を指定
  
  ## 作業内容
    ファイルシステムのマウントを行う
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=loop0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 レコード入力
  10+0 レコード出力
  10485760 バイト (10 MB) コピーされました、 0.0224628 秒、 467 MB/秒
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -f (使用可能なループバックデバイス名を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 -> loop0, loop1, loop2 のように使用状況によってインクリメント
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 loop0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 6974.873458] loop: module loaded
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mkfs.ext4 /dev/loop0 (ループバックデバイスにファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mount -o defaults -t ext4 /dev/loop0 /mnt (デフォルト、ファイルシステム指定でマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  [ 7066.252257] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 on /mnt type ext4 (rw,relatime,seclabel,data=ordered)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /etc/mtab | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 /mnt ext4 rw,seclabel,relatime,data=ordered 0 0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/mounts | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 /mnt ext4 rw,seclabel,relatime,data=ordered 0 0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                 MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                   11:0    1 1024M  0 rom  
  loop0                  7:0    0   10M  0 loop /mnt (マウントしたループバックデバイス)
  vda                  252:0    0   20G  0 disk 
  ├─vda2               252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1               252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
	vm12$ sudo umount /mnt (ループバックデバイスをアンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f loop0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
