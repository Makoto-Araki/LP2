================================================================================
[01] ファイルシステムの情報 - 01 (cat /etc/fstab)
[02] ファイルシステムの情報 - 02 (blkid)
[03] ファイルシステムの情報 - 03 (cat /proc/filesystems)
[04] ファイルシステムの情報 - 04 (cat /etc/mtab)
[05] ファイルシステムの情報 - 05 (cat /proc/mounts)
[06] マウントとアンマウント - 01 (mount)
[07] マウントとアンマウント - 02 (umount)
[08] スワップ - 01 (mkswap)
[09] スワップ - 02 (swapon)
[10] スワップ - 03 (swapoff)
[11] ファイルシステム作成 - 01 (ext2)
[12] ファイルシステム作成 - 02 (ext3)
[13] ファイルシステム作成 - 03 (ext4)
[07] File System - 07 (自動マウント)
[09] File System - 09 (ファイルシステム作成)
[10] File System - 10 (ISOイメージ作成)
[11] File System - 11 (暗号化ファイルシステム)
[12] File System - 12 (ファイルシステムチェック)
[13] File System - 13 (不良ブロックの検索)
[14] File System - 14 (ファイルシステムデバッグ)
================================================================================
[01]
  ファイルシステムの情報 - 01 (cat /etc/fstab)
  
[内容]
  ## 作業内容
    システムのファイルシステムの情報をコマンド(cat /etc/fstab)から確認
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## 設定ファイル(/etc/fstab)の書式
  --------------------------------------------------
  (デバイス名 or UUID or ラベル名)  (マウントポイント)  (ファイルシステム)  (マウントオプション)  (DUMP対象)  (FSCK順序)
  
  -- 設定例1 --
  /dev/sda1  /boot  xfs  defaults  0  0
  /dev/sda2  /      xfs  defaults  0  0
  
  -- 設定例2 --
  UUID=1d5e0998-fe61-4a82-83be-96a01cfbbd31  /boot  xfs  defaults  0  0
  UUID=1d5e0998-fe61-4a82-83be-96a01cfbbd99  /      xfs  defaults  0  0
  
  ファイルシステム
    EXT2      : EXTの拡張版
    EXT3      : ジャーナリング機能付加
    EXT4      : 機能拡張
    ReiserFS  : Linux用ジャーナリングファイルシステム
    JFS       : IBM製ジャーナリングファイルシステム
    XFS       : SGI製ジャーナリングファイルシステム -> CentOS7のデフォルト
    btrfs     : 先進的ファイルシステム
    ISO9660   : CD-ROM用
    UDF       : DVD用
    F2FS      : SSD用
    MSDOS     : MS-DOS用
    FAT/FAT32 : フラッシュメモリ用(USB)
    NTFS      : WindowsNT/2000以降
    HPFS      : OS/2用
    HFS       : MacOS用
    HFS+      : MacOS8.1以降
    NFS       : ファイル共有(Linux)
    CIFS      : ファイル共有(Windows)
    procfs    : プロセス情報を扱う仮想ファイルシステム(/proc)
    sysfs     : デバイス情報を扱う仮想ファイルシステム
    tmpfs     : 仮想メモリを扱う仮想ファイルシステム
    devpts    : 疑似端末制御のための仮想ファイルシステム
    usbfs     : USBデバイス監視用
    cramfs    : 組込システム用
  
  マウントオプション
    async     : 入出力同期  // 非同期
    sync      : 入出力同期  // 同期
    atime     : Iノードアクセス時刻更新  // 更新
    relatime  : Iノードアクセス時刻更新  // 一定時間後に更新
    noatime   : Iノードアクセス時刻更新  // 更新しない(ディスクアクセス高速化)
    auto      : コマンド「mount -a」の実行時の動作  // マウント
    noauto    : コマンド「mount -a」の実行時の動作  // マウントしない
    exec      : バイナリ実行を許可
    noexec    : バイナリ実行を禁止
    suid      : SUID, SGID
    nosuid    : SUID, SGID
    ro        : 読み取り専用
    rw        : 書き込み可能
    user      : 一般ユーザーのマウント  // 一般ユーザーマウント許可、アンマウントはマウント操作したユーザーのみ
    users     : 一般ユーザーのマウント  // 一般ユーザーマウント許可、アンマウントもマウント操作したユーザー以外で許可
    nouser    : 一般ユーザーのマウント  // 一般ユーザーマウント禁止
    owner     : その他  // デバイスファイル所有者のマウント許可
    defaults  : その他  // async, auto, dev, exec, nouser, rw, suid
    dev       : その他  // ファイルシステム上のデバイスファイル使用可
    group     : その他  // 条件「ユーザーのグループ = デバイスファイルの所有グループ」が満たされた場合にマウント許可
    uid=UID   : その他  // 全ファイル所有者を指定UIDにする
    gid=GID   : その他  // 全ファイル所有グループを指定GIDにする
  
  DUMP対象
    0         : バックアップ対象外
    1-9       : バックアップ対象
  
  FSCK順序
    0         : チェック対象外
    1-9       : チェック順序(数字順)
  --------------------------------------------------
  
[確認]
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス表示)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /etc/fstab | grep -vE '^#|^$' (設定ファイルを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  UUID=1d5e0998-fe61-4a82-83be-96a01cfbbd31  /boot   xfs    defaults   0 0
  /dev/mapper/centos_vm11-root               /       xfs    defaults   0 0
  /dev/mapper/centos_vm11-swap               swap    swap   defaults   0 0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  ファイルシステムの情報 - 02 (blkid)
  
[内容]
  ## 作業内容
    デバイスのUUIDを確認
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
[確認]
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス表示)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo blkid (デバイスのUUIDを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/vda1: UUID="1d5e0998-fe61-4a82-83be-96a01cfbbd31" TYPE="xfs" 
  /dev/vda2: UUID="FK1d1f-u6jH-Qd2L-OSNi-2gZL-os7w-fHojuw" TYPE="LVM2_member" 
  /dev/mapper/centos_vm11-root: UUID="90cf6fa5-58ac-4e14-89d1-909a3f537aa6" TYPE="xfs" 
  /dev/mapper/centos_vm11-swap: UUID="1475fefd-1dec-469a-b0c9-4f6be3f66ba9" TYPE="swap" 
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  ファイルシステムの情報 - 03 (cat /proc/filesystems)
  
[内容]
  ## 作業内容
    カーネルサポートのファイルシステムを表示
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
[確認]
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス表示)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/filesystems (カーネルサポートのファイルシステムを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  nodev sysfs
  nodev rootfs
  nodev ramfs
  nodev bdev
  nodev proc
  nodev cpuset
  nodev cgroup
  nodev cgroup2
  nodev tmpfs
  nodev devtmpfs
  nodev configfs
  nodev debugfs
  nodev tracefs
  nodev securityfs
  nodev sockfs
  nodev dax
  nodev bpf
  nodev pipefs
  nodev hugetlbfs
  nodev devpts
  nodev autofs
  nodev pstore
  nodev mqueue
  nodev selinuxfs
        xfs   // システムのデフォルト
        ext3  // ループバックデバイス作成時に使用したファイルシステム
        ext2  // ループバックデバイス作成時に使用したファイルシステム
        ext4  // ループバックデバイス作成時に使用したファイルシステム
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  ファイルシステムの情報 - 04 (cat /etc/mtab)
  
[内容]
  ## 作業内容
    マウント済みのファイルシステムを表示
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
[確認]
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス表示)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /etc/mtab | grep vda (マウント済みのファイルシステムを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/vda1 /boot xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  ファイルシステムの情報 - 05 (cat /proc/mounts)
  
[内容]
  ## 作業内容
    マウント済みのファイルシステムを表示
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
[確認]
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス表示)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/mounts | grep vda (マウント済みのファイルシステムを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/vda1 /boot xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[06]
  マウントとアンマウント - 01 (mount)
  
[内容]
  ## 作業内容
    指定ファイルシステムでデバイスをマウントする
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(mount)
    mount -a      // 設定ファイル(/etc/fstab)の全ファイルシステムをマウント
    mount -o XX   // マウントオプション(XX)を指定
    mount -U XX   // UUID(XX)を指定
    mount -n      // 設定ファイル(/etc/mtab)に書き込まない
    mount -r      // mount -o ro
    mount -w      // mount -o rw
    mount -t XX   // ファイルシステム種類(XX)を指定
  
[確認]
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=image0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 レコード入力
  10+0 レコード出力
  10485760 バイト (10 MB) コピーされました、 0.0319155 秒、 329 MB/秒
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -f (使用可能なループバックデバイス名を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 image0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  [16227.921753] loop: module loaded
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mkfs.ext4 /dev/loop0 (ループバックデバイスにファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> ブロック割当のメッセージが多数出力されるが成功
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mount -o defaults -t ext4 /dev/loop0 /mnt (マウントオプションはデフォルト、ファイルシステム指定でマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  [16381.302418] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  loop0                     7:0    0   10M  0 loop /mnt (マウントされたループバックデバイス)
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 on /mnt type ext4 (rw,relatime,seclabel,data=ordered)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /etc/mtab | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 /mnt ext4 rw,seclabel,relatime,data=ordered 0 0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/mounts | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 /mnt ext4 rw,seclabel,relatime,data=ordered 0 0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo umount /mnt (ループバックデバイスをアンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f image0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[07]
  マウントとアンマウント - 02 (umount)
  
[内容]
  ## 作業内容
    指定ファイルシステムでデバイスをマウントする
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(umount)
    umount -a     // 設定ファイル(/etc/mtab)の全ファイルシステムをアンマウント
    umount -t XX  // ファイルシステム種類(XX)を指定
  
[確認]
  上記の「06」を参照
  
================================================================================
[08]
  スワップ - 01 (mkswap)
  
[内容]
  ## 作業内容
    指定デバイスをスワップ領域化する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(mkswap)
    mkswap XX     // スワップ領域(XX)を作成
    mkswap -c     // 不良ブロックをチェック
    mkswap -L XX  // ラベル(XX)を付与
  
[確認]
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=image0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 レコード入力
  10+0 レコード出力
  10485760 バイト (10 MB) コピーされました、 0.0576488 秒、 182 MB/秒
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -f (使用可能なループバックデバイス名を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 image0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mkswap -c -L swap0 /dev/loop0 (不良ブロックのチェック、ラベル名指定でスワップ領域を作成)
  
  コマンドの実行結果
  --------------------------------------------------
  0 bad pages スワップ空間バージョン1を設定します、サイズ = 10236 KiB
  LABEL=swap0, UUID=e6d531e3-b968-4450-808f-1fc726055ddf
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo swapon /dev/loop0 (スワップ領域の有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  [18730.962465] Adding 10236k swap on /dev/loop0.  Priority:-3 extents:1 across:10236k FS
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ swapon -s (有効なスワップ領域を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  Filename     Type        Size      Used   Priority
  /dev/dm-1    partition   2097148   0      -2
  /dev/loop0   partition   10236     0      -3
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cat /proc/swaps (仮想ファイルで確認)
  
  コマンドの実行結果
  --------------------------------------------------
  Filename     Type        Size      Used   Priority
  /dev/dm-1    partition   2097148   0      -2
  /dev/loop0   partition   10236     0      -3
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイスを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  loop0                     7:0    0   10M  0 loop [SWAP] (作成したスワップ領域)
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo swapoff /dev/loop0 (スワップ領域の無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f image0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[09]
  スワップ - 02 (swapon)
  
[内容]
  ## 作業内容
    指定デバイスをスワップ領域化する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(swapon)
    swapon XX     // スワップ領域(XX)を有効化
    swapon -a     // 設定ファイル(/etc/fstab)の全スワップ領域を有効化
    swapon -s     // 有効なスワップ領域を表示
  
[確認]
  上記の「08」を参照
  
================================================================================
[10]
  スワップ - 03 (swapoff)
  
[内容]
  ## 作業内容
    指定デバイスをスワップ領域化する
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(swapoff)
    swapoff XX    // スワップ領域(XX)を無効化
    swapoff -a    // 設定ファイル(/etc/fstab)の全スワップ領域を無効化
  
[確認]
  上記の「08」を参照
  
================================================================================
[11]
  ファイルシステム作成 - 01 (ext2)
  
[内容]
  ## 作業内容
    デバイスにファイルシステム(ext2)をコマンド(mke2fs)で作成してマウントする
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(mke2fs)
    mke2fs -b XX    // ブロックサイズ(XX)
    mke2fs -c       // 不良ブロックのチェック
    mke2fs -i XX    // iノードあたりのバイト数
    mke2fs -j       // ファイルシステム(ext3)を作成
    mke2fs -J       // ファイルシステム(ext4)を作成
    mke2fs -m XX %  // root用の管理領域の割合(XX)%
    mke2fs -n       // 動作のシミュレートのみ
    mke2fs -t XX    // ファイルシステムの種類(ext2,ext3,ext4)

[確認]
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=image0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 レコード入力
  10+0 レコード出力
  10485760 バイト (10 MB) コピーされました、 0.0380447 秒、 276 MB/秒
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -f (使用可能なループバックデバイス名を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 image0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mke2fs -b 4096 -c -m 1 /dev/loop0 -n (動作のシミュレートのみ)
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Filesystem label=
  OS type: Linux
  Block size=4096 (log=2) // 4096バイト
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  2560 inodes, 2560 blocks
  25 blocks (0.98%) reserved for the super user // 管理領域の割合は「1%」
  First data block=0
  1 block group
  32768 blocks per group, 32768 fragments per group
  2560 inodes per group
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mke2fs -b 4096 -c -m 1 /dev/loop0 (ファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Filesystem label=
  OS type: Linux
  Block size=4096 (log=2)
  Fragment size=4096 (log=2) // 4096バイト
  Stride=0 blocks, Stripe width=0 blocks
  2560 inodes, 2560 blocks
  25 blocks (0.98%) reserved for the super user // 管理領域の割合は「1%」
  First data block=0
  1 block group
  32768 blocks per group, 32768 fragments per group
  2560 inodes per group
  
  Checking for bad blocks (read-only test): 0.00% done, 0:00 elapsed. (0/0/0 errdone                                                 
  Allocating group tables: done                            
  Writing inode tables: done                            
  Writing superblocks and filesystem accounting information: done
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mount -o defaults -t ext2 /dev/loop0 /mnt (マウントオプションはデフォルト、ファイルシステム指定でマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  [37126.506249] EXT4-fs (loop0): mounting ext2 file system using the ext4 subsystem
  [37126.605345] EXT4-fs (loop0): mounted filesystem without journal. Opts: (null)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  loop0                     7:0    0   10M  0 loop /mnt (マウントされたループバックデバイス)
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 on /mnt type ext2 (rw,relatime,seclabel,block_validity,barrier,user_xattr,acl)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo umount /mnt (ループバックデバイスをアンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f image0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[12]
  ファイルシステム作成 - 02 (ext3)
  
[内容]
  ## 作業内容
    デバイスにファイルシステム(ext3)をコマンド(mke2fs)で作成してマウントする
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(mke2fs)
    mke2fs -b XX    // ブロックサイズ(XX)
    mke2fs -c       // 不良ブロックのチェック
    mke2fs -i XX    // iノードあたりのバイト数
    mke2fs -j       // ファイルシステム(ext3)を作成
    mke2fs -J       // ファイルシステム(ext4)を作成
    mke2fs -m XX %  // root用の管理領域の割合(XX)%
    mke2fs -n       // 動作のシミュレートのみ
    mke2fs -t XX    // ファイルシステムの種類(ext2,ext3,ext4)

[確認]
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=image0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 レコード入力
  10+0 レコード出力
  10485760 バイト (10 MB) コピーされました、 0.0144837 秒、 724 MB/秒
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -f (使用可能なループバックデバイス名を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 image0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mke2fs -j -b 4096 -c -m 1 /dev/loop0 -n (動作のシミュレートのみ)
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Filesystem label=
  OS type: Linux
  Block size=4096 (log=2) // 4096バイト
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  2560 inodes, 2560 blocks
  25 blocks (0.98%) reserved for the super user // 管理領域の割合は「1%」
  First data block=0
  1 block group
  32768 blocks per group, 32768 fragments per group
  2560 inodes per group
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mke2fs -j -b 4096 -c -m 1 /dev/loop0 (ファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Filesystem label=
  OS type: Linux
  Block size=4096 (log=2)
  Fragment size=4096 (log=2) // 4096バイト
  Stride=0 blocks, Stripe width=0 blocks
  2560 inodes, 2560 blocks
  25 blocks (0.98%) reserved for the super user // 管理領域の割合は「1%」
  First data block=0
  1 block group
  32768 blocks per group, 32768 fragments per group
  2560 inodes per group
  
  Checking for bad blocks (read-only test):   0.00% done, 0:00 elapsed. (0/0/0 errdone                                                 
  Allocating group tables: done                            
  Writing inode tables: done                            
  Creating journal (1024 blocks): done // ジャーナル領域が作成
  Writing superblocks and filesystem accounting information: done
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mount -o defaults -t ext3 /dev/loop0 /mnt (マウントオプションはデフォルト、ファイルシステム指定でマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  [38238.995688] EXT4-fs (loop0): mounting ext3 file system using the ext4 subsystem
  [38239.149263] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  loop0                     7:0    0   10M  0 loop /mnt (マウントされたループバックデバイス)
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 on /mnt type ext3 (rw,relatime,seclabel,data=ordered)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo umount /mnt (ループバックデバイスをアンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f image0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[13]
  ファイルシステム作成 - 03 (ext4)
  
[内容]
  ## 作業内容
    デバイスにファイルシステム(ext4)をコマンド(mke2fs)で作成してマウントする
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(mke2fs)
    mke2fs -b XX    // ブロックサイズ(XX)
    mke2fs -c       // 不良ブロックのチェック
    mke2fs -i XX    // iノードあたりのバイト数
    mke2fs -j       // ファイルシステム(ext3)を作成
    mke2fs -J       // ファイルシステム(ext4)を作成
    mke2fs -m XX %  // root用の管理領域の割合(XX)%
    mke2fs -n       // 動作のシミュレートのみ
    mke2fs -t XX    // ファイルシステムの種類(ext2,ext3,ext4)

[確認]
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=image0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -f (使用可能なループバックデバイス名を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 image0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mke2fs -J -b 4096 -c -m 1 /dev/loop0 -n (動作のシミュレートのみ)
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Filesystem label=
  OS type: Linux
  Block size=4096 (log=2) // 4096バイト
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  2560 inodes, 2560 blocks
  25 blocks (0.98%) reserved for the super user // 管理領域の割合は「1%」
  First data block=0
  1 block group
  32768 blocks per group, 32768 fragments per group
  2560 inodes per group
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mke2fs -J -b 4096 -c -m 1 /dev/loop0 (ファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Filesystem label=
  OS type: Linux
  Block size=4096 (log=2)
  Fragment size=4096 (log=2) // 4096バイト
  Stride=0 blocks, Stripe width=0 blocks
  2560 inodes, 2560 blocks
  25 blocks (0.98%) reserved for the super user // 管理領域の割合は「1%」
  First data block=0
  1 block group
  32768 blocks per group, 32768 fragments per group
  2560 inodes per group
  
  Checking for bad blocks (read-only test):   0.00% done, 0:00 elapsed. (0/0/0 errdone                                                 
  Allocating group tables: done                            
  Writing inode tables: done                            
  Creating journal (1024 blocks): done // ジャーナル領域が作成
  Writing superblocks and filesystem accounting information: done
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mount -o defaults -t ext4 /dev/loop0 /mnt (マウントオプションはデフォルト、ファイルシステム指定でマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  [38238.995688] EXT4-fs (loop0): mounting ext3 file system using the ext4 subsystem
  [38239.149263] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
  sr0                      11:0    1 1024M  0 rom  
  loop0                     7:0    0   10M  0 loop /mnt (マウントされたループバックデバイス)
  vda                     252:0    0   20G  0 disk 
  ├─vda2                252:2    0   19G  0 part 
  │ ├─centos_vm11-swap 253:1    0    2G  0 lvm  [SWAP]
  │ └─centos_vm11-root 253:0    0   17G  0 lvm  /
  └─vda1                252:1    0    1G  0 part /boot
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount | grep loop0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 on /mnt type ext3 (rw,relatime,seclabel,data=ordered)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo umount /mnt (ループバックデバイスをアンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f image0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[07]
  File System - 07 (自動マウント)
  
[内容]
  ## 作業内容
    ディレクトリ「/mnt/auto/dir0」に移動時にデバイス「/dev/loop0」を自動マウントする
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=loop0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -f (使用可能なループバックデバイス名を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup /dev/loop0 loop0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo mkfs.ext4 /dev/loop0 (ループバックデバイスにファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo vi /etc/auto.master (設定ファイルの修正)
  
  コマンドの実行結果
  --------------------------------------------------
  /misc	/etc/auto.misc
  /net  -hosts
  +dir:/etc/auto.master.d
  +auto.master
  /mnt/auto	/etc/auto.dir  // 追加 -> ディレクトリ「/mnt/auto」移動時に設定ファイル「/etc/auto.dir」の内容でマウント
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo vi /etc/auto.dir (設定ファイルの追加)
  
  コマンドの実行結果
  --------------------------------------------------
  dir0  -fstype=ext4,rw  :/dev/loop0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl restart autofs (サービス再起動)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (オートマウント前を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cd /mnt/auto/dir0 (ディレクトリ移動)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (オートマウント後を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo umount /mnt/auto/dir0 (アンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f loop0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo vi /etc/auto.master (設定ファイル編集)
  
  コマンドの実行結果
  --------------------------------------------------
  /misc	/etc/auto.misc
  /net  -hosts
  +dir:/etc/auto.master.d
  +auto.master
  # /mnt/auto	/etc/auto.dir  // コメントアウト
  --------------------------------------------------
  
  vm12$ cd /etc
  vm12$ sudo rm auto.dir (追加した設定ファイル削除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd /mnt
  vm12$ sudo rm -rf auto (マウントポイント削除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl restart autofs (サービス再起動)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[09]
  File System - 09 (ファイルシステム作成)
  
[内容]
  ## コマンド(mkfs)
    mkswap -c     // 不良ブロックをチェック
    mkswap -t XX  // ファイルシステム(XX)を指定
  
  ## 作業内容
    指定デバイスにファイルシステム作成を行う
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=loop0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup /dev/loop0 loop0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mkfs -c -t ext3 /dev/loop0 (不良ブロックのチェック、ファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount -o defaults -t ext3 /dev/loop0 /mnt (マウント)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount | grep loop (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ blkid | grep loop (デバイスファイルからファイルシステムを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo umount /mnt (アンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f loop0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[10]
  File System - 10 (ISOイメージ作成)
  
[内容]
  ## コマンド(mkisofs)
    mkisofs -b     // ブート可能CD
    mkisofs -o XX  // CD(ISO9660)またはDVD(UDF)用イメージ(XX)を作成
    mkisofs -J     // Microsoft用フォーマット
    mkisofs -r(R)  // ロングネーム用フォーマット
    mkisofs -udf   // DVD
  
  ## 作業内容
    ISOイメージ作成を行う
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ yum -y install mkisofs (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mkdir HISTORY (ISOイメージ化するディレクトリ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME/HISTORY
  vm12$ vi AAA.txt (ディレクトリ内部のファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  1582年 本能寺の変
  1600年 関ヶ原の戦い
  1615年 大坂夏の陣
  --------------------------------------------------
  
  vm12$ cd $HOME/HISTORY
  vm12$ vi BBB.txt (ディレクトリ内部のファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  1894年 日清戦争
  1904年 日露戦争
  1914年 第一次世界大戦
  --------------------------------------------------
  
  vm12$ cd $HOME/HISTORY
  vm12$ vi CCC.txt (ディレクトリ内部のファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  1923年 関東大震災
  1941年 太平洋戦争の開始
  1945年 太平洋戦争の終了
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mkisofs -o HISTORY-CDROM.iso -r(-R) HISTORY (CD用イメージ、ロングネーム対応でISOイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mkisofs -udf -o HISTORY-DVD.iso -r(-R) HISTORY (DVD用イメージ、ロングネーム対応でISOイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd /mnt
  vm12$ sudo mkdir cdrom dvd (マウントポイント作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount -r -t iso9660 HISTORY-CDROM.iso /mnt/cdrom (CD用イメージを読取専用でマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd /mnt/cdrom
  vm12$ ls -lh (CD用イメージを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount -r -t udf HISTORY-DVD.iso /mnt/dvd (DVD用イメージを読取専用でマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd /mnt/dvd
  vm12$ ls -lh (DVD用イメージを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount | grep -E 'cdrom|dvd' (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ blkid | grep loop (デバイスファイル確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ umount /mnt/cdrom /mnt/dvd (アンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd /mnt
  vm12$ sudo rmdir cdrom dvd (マウントポイント削除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f *.iso (ISOイメージファイル削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[11]
  File System - 11 (暗号化ファイルシステム)
  
[内容]
  ## 仮想マシン
    HOST : vm12
    IPv4 : 192.168.122.12
    GW   : 192.168.122.1
    DNS  : 192.168.122.1
  
  ## 作業内容
    暗号化ファイルシステムを作成してみる
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ yum -y install cryptsetup (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=loop0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup /dev/loop0 loop0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cryptsetup create sec0(暗号化デバイス名) /dev/loop0 (ループバックデバイスを暗号化デバイスに変換)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter passphrase for /dev/loop0: (mikotoと入力)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (暗号化デバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mkfs -t ext4 /dev/mapper/sec0 (暗号化デバイスにファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount -o defaults -t ext4 /dev/mapper/sec0 /mnt (暗号化デバイスファイルをマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mount | grep sec0 (マウント状況およびマウントオプションを確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ blkid | grep sec0 (デバイスファイル確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ lsblk (ブロックデバイス確認)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ umount /mnt (暗号化デバイスをアンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ cryptsetup remove sec0 (暗号化デバイスからループバックデバイスに戻す)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f loop0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[12]
  File System - 12 (ファイルシステムチェック)
  
[内容]
  ## コマンド(fsck)
    fsck -r     // 対話的に修復を実行
    fsck -t XX  // ファイルシステム種類(XX)のみ実行
    fsck -A     // ファイル「/etc/fstab」の全ファイルシステムに実行
    fsck -N     // 動作のシミュレートのみ
  
  ## 作業内容
    ファイルシステムチェックを行う
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=loop0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup /dev/loop0 loop0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mkfs -t ext4 /dev/loop0 (ファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ fsck -N -t ext4 /dev/loop0 (動作のシミュレートのみ行う)
  
  コマンドの実行結果
  --------------------------------------------------
  // アンマウントまたは読取専用でマウントの状態でチェックしないとファイルシステムが壊れる
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ fsck -r -t ext4 /dev/loop0 (ファイルシステムチェック)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f loop0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[13]
  File System - 13 (不良ブロックの検索)
  
[内容]
  ## コマンド(badblocks)
    badblocks -b XX  // ブロックサイズ(XX)を指定
    badblocks -o XX  // 結果をファイル(XX)に出力
    badblocks -w     // 書込モードでテスト
  
  ## 作業内容
    不良ブロックの検索を行う
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=loop0.img bs=1M count=10 (ディスクイメージ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup /dev/loop0 loop0.img (ディスクイメージとループバックデバイスを紐づけ)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ mkfs -t ext4 /dev/loop0 (ファイルシステム作成)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ badblocks -b 1024 /dev/loop0 (ブロックサイズ指定で不良ブロックを検索)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ losetup -D (ループバックデバイスとディスクイメージの紐づけ解除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ rm -f loop0.img (ディスクイメージ削除)
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[14]
  File System - 14 (ファイルシステムデバッグ)
  
[内容]
  ## コマンド(debugfs)
    debugfs -w     // 読書可能モードでファイルシステムを開く(デフォルトは読取専用)
    debugfs -s XX  // スーパーブロック(XX)を指定
  
  ## サブコマンド(debugfs)
    cat XX         // ファイル(XX)のiノードを表示
    cd XX          // ディレクトリ(XX)に移動
    chroot XX      // ルートディレクトリ変更
    close          // ファイルシステムを閉じる
    dump XX YY     // ファイル(XX)の内容をファイル(YY)として保存
    freei XX       // ファイル(XX)のiノードを消去
    ls             // ファイル一覧を表示
    mkdir XX       // ディレクトリ(XX)を作成
    open XX        // デバイス(XX)のファイルシステムを開く
    pwd            // カレントディレクトリを表示
    rm XX          // ファイル(XX)を削除
    rmdir XX       // ディレクトリ(XX)を削除
    stat XX        // ファイル(XX)のiノードを表示
    quit           // 終了する
  
  ## 作業内容
    ファイルシステムデバッグを行う
  
[確認]
  $ cd $HOME
  $ sudo virsh start vm12 --console
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 仮想マシンの起動
  --------------------------------------------------
  
  ディスクイメージ作成
  vm12$ cd $HOME
  vm12$ dd if=/dev/zero of=loop0.img bs=1M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  ディスクイメージとループバックデバイスを紐づけ
  vm12$ cd $HOME
  vm12$ losetup /dev/loop0 loop0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  ファイルシステム「ext3」を作成
  vm12$ cd $HOME
  vm12$ mkfs -t ext3 /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  ループバックデバイスをマウント
  vm12$ cd $HOME
  vm12$ mount -o defaults -t ext3 /dev/loop0 /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [ 6552.071958] EXT4-fs (loop0): mounting ext3 file system using the ext4 subsystem
  [ 6552.096314] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null)
  [ 6552.098492] ext3 filesystem being mounted at /mnt supports timestamps until 2038 (0x7fffffff)
  --------------------------------------------------
  
  マウントポイント(/mnt)配下のディレクトリ構成
  --------------------------------------------------
  /マウントポイント
  	|----file1
  	|----file2
  	|----/dir1
  					|----file3
  					|----file4
  	|----/dir2
  					|----file5
  					|----file6
  --------------------------------------------------
  
  ファイル作成
  vm12$ cd /mnt
  vm12$ touch file1 file2
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  ファイル書込
  vm12$ cd /mnt
  vm12$ vi file1
  
  コマンドの実行結果
  --------------------------------------------------
  710 平城京に遷都
  784 長岡京に遷都
  794 平安京に遷都
  --------------------------------------------------
  
  ディレクトリ作成
  vm12$ cd /mnt
  vm12$ mkdir dir1 dir2
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  ファイル作成
  vm12$ cd /mnt/dir1
  vm12$ touch file3 file4
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  ファイル作成
  vm12$ cd /mnt/dir2
  vm12$ touch file5 file6
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  ループバックデバイスをアンマウント
  vm12$ cd $HOME
  vm12$ umount /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  読書可能モードでファイルシステムをデバッグ
  vm12$ cd $HOME
  vm12$ debugfs -w
  
  コマンドの実行結果
  --------------------------------------------------
  debugfs 1.42.9 (28-Dec-2013)
  
  // サブコマンド「open」
  debugfs:  open /dev/loop0
  
  (出力なし)
  
  // サブコマンド「ls」
  debugfs:  ls -l
  
        2   40755 (2)      0      0    1024 28-Jan-2020 10:15 .
        2   40755 (2)      0      0    1024 28-Jan-2020 10:15 ..
       11   40700 (2)      0      0   12288 28-Jan-2020 10:01 lost+found
       15  100644 (1)      0      0      95 28-Jan-2020 10:15 file1
       13  100644 (1)      0      0       0 28-Jan-2020 10:02 file2
     1281   40755 (2)      0      0    1024 28-Jan-2020 10:02 dir1
     1282   40755 (2)      0      0    1024 28-Jan-2020 10:02 dir2
  
  // サブコマンド「stat」
  debugfs:  stat file1
  
  Inode: 15   Type: regular    Mode:  0644   Flags: 0x0
  Generation: 491304123    Version: 0x00000001
  User:     0   Group:     0   Size: 95
  File ACL: 1247    Directory ACL: 0
  Links: 1   Blockcount: 4
  Fragment:  Address: 0    Number: 0    Size: 0
  ctime: 0x5e2f8b40 -- Tue Jan 28 10:15:44 2020
  atime: 0x5e2f8b53 -- Tue Jan 28 10:16:03 2020
  mtime: 0x5e2f8b40 -- Tue Jan 28 10:15:44 2020
  BLOCKS:
  (0):1549
  TOTAL: 1
  
  // サブコマンド「cat」
  debugfs:  cat file1
  
  710 平城京に遷都
  784 長岡京に遷都
  794 平安京に遷都
  
  // サブコマンド「mkdir」
  debugfs:  mkdir dir3
  
  mkdir: Filesystem opened read/only → 再マウント後に確認したが未反映、読取専用でオープン
  
  // サブコマンド「rmdir」
  debugfs:  rmdir dir2
  
  mkdir: Filesystem opened read/only → 再マウント後に確認したが未反映、読取専用でオープン
  
  // サブコマンド「cd」
  debugfs:  cd dir1
  
  (出力なし)
  
  // サブコマンド「ls」
  debugfs:  ls -l
  
     1281   40755 (2)      0      0    1024 28-Jan-2020 10:02 .
        2   40755 (2)      0      0    1024 28-Jan-2020 10:15 ..
     1283  100644 (1)      0      0       0 28-Jan-2020 10:02 file3
     1284  100644 (1)      0      0       0 28-Jan-2020 10:02 file4
  
  // サブコマンド「pwd」
  debugfs:  pwd
  
  [pwd]   INODE:   1281  PATH: /dir1
  [root]  INODE:      2  PATH: /
  
  // サブコマンド「close」
  debugfs:  close
  
  (出力なし)
  
  // サブコマンド「quit」
  debugfs:  quit
  
  (OSプロンプトに戻る)
  --------------------------------------------------
  
  ループバックデバイスをマウント
  vm12$ cd $HOME
  vm12$ mount -o defaults -t ext3 /dev/loop0 /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [ 6552.071958] EXT4-fs (loop0): mounting ext3 file system using the ext4 subsystem
  [ 6552.096314] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null)
  [ 6552.098492] ext3 filesystem being mounted at /mnt supports timestamps until 2038 (0x7fffffff)
  --------------------------------------------------
  
  ファイルとディレクトリを確認
  vm12$ cd /mnt
  vm12$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  drwxr-xr-x. 2 root root 1.0K  2月 12 00:30 dir1
  drwxr-xr-x. 2 root root 1.0K  2月 12 00:30 dir2
  -rw-r--r--. 1 root root   69  2月 12 00:30 file1
  -rw-r--r--. 1 root root    0  2月 12 00:28 file2
  
  // 追加ディレクトリ「dir3」が反映されていない → 読取専用でオープン
  // 削除ディレクトリ「dir2」が反映されていない → 読取専用でオープン
  --------------------------------------------------
  
  ループバックデバイスをアンマウント
  vm12$ cd $HOME
  vm12$ umount /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  ループバックデバイスとディスクイメージの紐づけ解除
  vm12$ cd $HOME
  vm12$ losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  ディスクイメージ削除
  vm12$ cd $HOME
  vm12$ rm -f loop0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
