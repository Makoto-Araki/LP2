================================================================================
[01] ファイルシステムの情報 - 01 (cat /etc/fstab)
[02] ファイルシステムの情報 - 02 (blkid)
[03] ファイルシステムの情報 - 03 (cat /proc/filesystems)
[04] ファイルシステムの情報 - 04 (cat /etc/mtab)
[05] ファイルシステムの情報 - 05 (cat /proc/mounts)
[06] マウントとアンマウント - 01 (mount)
[07] マウントとアンマウント - 02 (umount)
[08] スワップ - 01 (mkswap)
[09] スワップ - 02 (swapon)
[10] スワップ - 03 (swapoff)
[11] ファイルシステム作成 - 01 (ext2)
[12] ファイルシステム作成 - 02 (ext3)
[13] ファイルシステム作成 - 03 (ext4)
[14] ファイルシステム作成 - 04 (ext3 -> ext4)
[15] ファイルシステム作成 - 05 (xfs)
[16] ファイルシステム作成 - 06 (btrfs)
[17] コマンド(mkfs)
[18] CD/DVD作成 - 01
[19] CD/DVD作成 - 02
[20] 暗号化デバイス
[21] スーパーブロック
[22] ファイルシステムチェック - 01 (fsck)
[23] ファイルシステムチェック - 02 (e2fsck)
[24] ファイルシステムチェック - 03 (xfs_repair)
[25] ファイルシステム管理(ext2,ext3,ext4) - 01 (tune2fs)
[26] ファイルシステム管理(ext2,ext3,ext4) - 02 (badblocks)
[27] ファイルシステム管理(ext2,ext3,ext4) - 03 (debugfs)
[28] S.M.A.R.T
[29] ファイルシステム管理(xfs) - 01 (xfs_admin)
[30] ファイルシステム管理(xfs) - 02 (xfs_info)
[31] ファイルシステム管理(xfs) - 03 (xfsdump)
[32] ファイルシステム管理(xfs) - 04 (xfsrestore)
[33] ファイルシステム管理(xfs) - 05 (xfs_repair)
[34] ファイルシステム管理(btrfs) - 01 (btrfs)
[35] ファイルシステム管理(btrfs) - 02 (btrfs-convert)
[36] オートマウント
================================================================================
[01]
  ファイルシステムの情報 - 01 (cat /etc/fstab)
  
[内容]
  ## 作業内容
    システムのファイルシステムの情報をコマンド(cat /etc/fstab)から確認
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## 設定ファイル(/etc/fstab)の書式
  --------------------------------------------------
  書式
    [デバイス名 or UUID or ラベル名]  [マウントポイント]  [ファイルシステム]  [オプション]  [DUMP対象]  [FSCK順序]
  
  設定例01
    /dev/sda1  /boot  xfs  defaults  0  0
    /dev/sda2  /      xfs  defaults  0  0
  
  設定例02
    UUID=1d5e0998-fe61-4a82-83be-96a01cfbbd31  /boot  xfs  defaults  0  0
    UUID=1d5e0998-fe61-4a82-83be-96a01cfbbd99  /      xfs  defaults  0  0
  
  設定例03
    LABEL=sda1  /boot  xfs  defaults  0  0
    LABEL=sda2  /      xfs  defaults  0  0
  
  入出力同期
    async     : 非同期
    sync      : 同期
  
  アクセス時刻更新
    atime     : 更新
    relatime  : 一定時間後に更新
    noatime   : 更新しない -> ディスクアクセス高速化
  
  自動マウント
    auto      : コマンド(mount -a)でマウント
    noauto    : コマンド(mount -a)でマウントしない
  
  バイナリ実行
    exec      : 許可
    noexec    : 禁止
  
  SUID/SGID
    suid      : 許可
    nosuid    : 禁止
  
  読取専用
    ro        : 読取専用
    rw        : 書込可能
  
  マウント操作
    user      : マウント許可、アンマウントは該当ユーザーのみ
    users     : マウント許可、アンマウントも該当ユーザー以外で許可
    nouser    : マウント禁止
    owner     : デバイス所有者のマウント許可
    group     : マウント許可 -> 条件がある
  
  その他
    defaults  : その他  // async, auto, dev, exec, nouser, rw, suid
    dev       : その他  // ファイルシステム上のデバイスファイル使用可
    uid=UID   : その他  // 全ファイル所有者を指定UIDにする
    gid=GID   : その他  // 全ファイル所有グループを指定GIDにする
  
  DUMP対象
    0         : バックアップ対象外
    1-9       : バックアップ対象
  
  FSCK順序
    0         : チェック対象外
    1-9       : チェック順序(数字順)
  --------------------------------------------------
  
[確認]
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /etc/fstab | grep -vE '^#|^$' -> 仮想マシンの設定ファイル(/etc/fstab)を確認
  
  コマンドの実行結果
  --------------------------------------------------
  UUID=7c5f5868-f985-4022-8bfc-c748dde563db  /boot  xfs   defaults  0  0
  /dev/mapper/centos_vm11-root               /      xfs   defaults  0  0
  /dev/mapper/centos_vm11-swap               swap   swap  defaults  0  0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo blkid -> デバイスのUUIDを確認
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/vda1: UUID="7c5f5868-f985-4022-8bfc-c748dde563db" TYPE="xfs" 
  /dev/vda2: UUID="z5NZEY-ZvKV-c9Bj-wR3e-Vhbl-uJ38-I6zSS2" TYPE="LVM2_member" 
  /dev/mapper/centos_vm11-root: UUID="1569367e-31dd-4f04-b615-f0d5faa31eed" TYPE="xfs" 
  /dev/mapper/centos_vm11-swap: UUID="9731028d-89e7-42c4-bb1e-b2fc27ba45b8" TYPE="swap" 
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /proc/filesystems -> カーネルサポートのファイルシステム表示
  
  コマンドの実行結果
  --------------------------------------------------
  nodev  sysfs
  nodev  rootfs
  nodev  ramfs
  nodev  bdev
  nodev  proc
  nodev  cpuset
  nodev  cgroup
  nodev  cgroup2
  nodev  tmpfs
  nodev  devtmpfs
  nodev  configfs
  nodev  debugfs
  nodev  tracefs
  nodev  securityfs
  nodev  sockfs
  nodev  dax
  nodev  bpf
  nodev  pipefs
  nodev  hugetlbfs
  nodev  devpts
  nodev  autofs
  nodev  pstore
  nodev  mqueue
  nodev  selinuxfs
         xfs
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /etc/mtab | grep vda -> マウント済みのファイルシステムを表示
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/vda1 /boot xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /proc/mounts | grep vda -> マウント済みのファイルシステムを表示
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/vda1 /boot xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  ファイルシステムの情報 - 02 (blkid)
  
[内容]
  ## 作業内容
    デバイスのUUIDを確認
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記「01」を参照
  
================================================================================
[03]
  ファイルシステムの情報 - 03 (cat /proc/filesystems)
  
[内容]
  ## 作業内容
    カーネルサポートのファイルシステムを表示
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記「01」を参照
  
================================================================================
[04]
  ファイルシステムの情報 - 04 (cat /etc/mtab)
  
[内容]
  ## 作業内容
    マウント済みのファイルシステムを表示
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記「01」を参照
  
================================================================================
[05]
  ファイルシステムの情報 - 05 (cat /proc/mounts)
  
[内容]
  ## 作業内容
    マウント済みのファイルシステムを表示
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記「01」を参照
  
================================================================================
[06]
  マウントとアンマウント - 01 (mount)
  
[内容]
  ## 作業内容
    指定ファイルシステムでデバイスマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(mount)
    mount -a      : 設定ファイル(/etc/fstab)の全ファイルシステムをマウント
    mount -o XX   : マウントオプション(XX)を指定
    mount -U XX   : UUID(XX)を指定
    mount -n      : 設定ファイル(/etc/mtab)に書き込まない
    mount -r      : mount -o ro
    mount -w      : mount -o rw
    mount -t XX   : ファイルシステム種類(XX)を指定
  
[確認]
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t ext4 /dev/vdb1 -> ファイルシステム作成
  vm11$ sudo mkfs -t ext4 /dev/vdb2 -> ファイルシステム作成
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkdir -p /mnt/mp1 -> マウントポイント作成
  vm11$ sudo mkdir -p /mnt/mp2 -> マウントポイント作成
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vi /etc/fstab -> 設定ファイル(/etc/fstab)を編集
  
  コマンドの実行結果
  --------------------------------------------------
  UUID=7c5f5868-f985-4022-8bfc-c748dde563db  /boot     xfs   defaults  0  0
  /dev/mapper/centos_vm11-root               /         xfs   defaults  0  0
  /dev/mapper/centos_vm11-swap               swap      swap  defaults  0  0
  /dev/vdb1                                  /mnt/mp1  ext4  defaults  0  0  (追加)
  /dev/vdb2                                  /mnt/mp2  ext4  defaults  0  0  (追加)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -at ext4 -> 設定ファイル(/etc/fstab)上のファイルシステム(ext4)をマウント
  
  コマンドの実行結果
  --------------------------------------------------
  [ 3643.371102] EXT4-fs (vdb1): mounted filesystem with ordered data mode. Opts: (null)
  [ 3643.390767] EXT4-fs (vdb2): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  /mnt/mp2 (マウント確認)
   |-- vdb1                   252:17    0     1G   0  part  /mnt/mp1 (マウント確認)
  sr0                          11:0     1  1024M   0  rom   
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount -at ext4 -> 設定ファイル(/etc/fstab)上のファイルシステム(ext4)をアンマウント
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  (アンマウント確認)
   |-- vdb1                   252:17    0     1G   0  part  (アンマウント確認)
  sr0                          11:0     1  1024M   0  rom   
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo systemctl reboot -> 再起動後に設定ファイル(etc/fstab)のオプション(auto)通りにマウントされるか確認
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> makotoでログイン
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  /mnt/mp2 (マウント確認)
   |-- vdb1                   252:17    0     1G   0  part  /mnt/mp1 (マウント確認)
  sr0                          11:0     1  1024M   0  rom   
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[07]
  マウントとアンマウント - 02 (umount)
  
[内容]
  ## 作業内容
    指定ファイルシステムでデバイスマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(umount)
    umount -a     : 設定ファイル(/etc/mtab)の全ファイルシステムをアンマウント
    umount -t XX  : ファイルシステム種類(XX)を指定
  
[確認]
  上記の「06」を参照
  
================================================================================
[08]
  スワップ - 01 (mkswap)
  
[内容]
  ## 作業内容
    指定デバイスをスワップ領域化する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(mkswap)
    mkswap XX     : スワップ領域(XX)を作成
    mkswap -c     : 不良ブロックをチェック
    mkswap -L XX  : ラベル(XX)を付与
  
[確認]
  vm11$ cd $HOME
  vm11$ dd if=/dev/zero of=image0.img bs=10M count=10
  vm11$ dd if=/dev/zero of=image1.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  // image0.img
  10+0 レコード入力
  10+0 レコード出力
  104857600 バイト (105 MB) コピーされました、 0.145578 秒、 720 MB/秒

  // image1.img
  10+0 レコード入力
  10+0 レコード出力
  104857600 バイト (105 MB) コピーされました、 0.145578 秒、 720 MB/秒
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ losetup -f
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  vm11$ sudo losetup /dev/loop1 image1.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkswap /dev/loop0  -> スワップ領域を作成
  vm11$ sudo mkswap /dev/loop1  -> スワップ領域を作成
  
  コマンドの実行結果
  --------------------------------------------------
  // loop0
  スワップ空間バージョン1を設定します、サイズ = 102396 KiB
  ラベルはありません, UUID=cd28706a-7911-49aa-8778-fb92b66228de
  
  // loop1
  スワップ空間バージョン1を設定します、サイズ = 102396 KiB
  ラベルはありません, UUID=5fbf5f62-a566-4e3e-a2de-32e181f6cdae
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  /mnt/mp2
   |-- vdb1                   252:17    0     1G   0  part  /mnt/mp1
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  (スワップ領域予定)
  loop1                         7:1     0   100M   0  loop  (スワップ領域予定)
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo swapon /dev/loop0 -> スワップ領域の有効化
  vm11$ sudo swapon /dev/loop1 -> スワップ領域の有効化
  
  コマンドの実行結果
  --------------------------------------------------
  // loop0
  [ 4092.146551] Adding 102396k swap on /dev/loop0.  Priority:-3 extents:1 across:102396k FS
  
  // loop1
  [ 4121.141813] Adding 102396k swap on /dev/loop1.  Priority:-4 extents:1 across:102396k FS
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  /mnt/mp2
   |-- vdb1                   252:17    0     1G   0  part  /mnt/mp1
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  [SWAP] -> スワップ領域
  loop1                         7:1     0   100M   0  loop  [SWAP] -> スワップ領域
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ swapon -s -> 有効なスワップ領域を表示
  
  コマンドの実行結果
  --------------------------------------------------
  Filename     Type        Size      Used   Priority
  /dev/dm-1    partition   2097148   0      -2
  /dev/loop0   partition   10236     0      -3
  /dev/loop1   partition   10236     0      -4
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /proc/swaps -> 有効なスワップ領域を表示
  
  コマンドの実行結果
  --------------------------------------------------
  Filename     Type        Size      Used   Priority
  /dev/dm-1    partition   2097148   0      -2
  /dev/loop0   partition   10236     0      -3
  /dev/loop1   partition   10236     0      -4
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo swapoff /dev/loop0 -> スワップ領域の無効化
  vm11$ sudo swapoff /dev/loop1 -> スワップ領域の無効化
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  /mnt/mp2
   |-- vdb1                   252:17    0     1G   0  part  /mnt/mp1
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  (スワップ領域を無効化)
  loop1                         7:1     0   100M   0  loop  (スワップ領域を無効化)
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-1].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[09]
  スワップ - 02 (swapon)
  
[内容]
  ## 作業内容
    指定デバイスをスワップ領域化する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(swapon)
    swapon XX  : スワップ領域(XX)を有効化
    swapon -a  : 設定ファイル(/etc/fstab)の全スワップ領域を有効化
    swapon -s  : 有効なスワップ領域を表示
  
[確認]
  上記の「08」を参照
  
================================================================================
[10]
  スワップ - 03 (swapoff)
  
[内容]
  ## 作業内容
    指定デバイスのスワップ領域化を解除する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(swapoff)
    swapoff XX  : スワップ領域(XX)を無効化
    swapoff -a  : 設定ファイル(/etc/fstab)の全スワップ領域を無効化
  
[確認]
  上記の「08」を参照
  
================================================================================
[11]
  ファイルシステム作成 - 01 (ext2)
  
[内容]
  ## 作業内容
    ファイルシステム(ext2)をコマンド(mke2fs)で作成してマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(mke2fs)
    mke2fs -b XX    : ブロックサイズ(XX)
    mke2fs -c       : 不良チェック
    mke2fs -L XX    : ボリュームラベル(XX)
    mke2fs -i XX    : iノードあたりのバイト数
    mke2fs -j       : ファイルシステム(ext3)を作成
    mke2fs -m XX %  : 管理領域の割合(XX)%
    mke2fs -n       : 動作のシミュレートのみ
    mke2fs -t XX    : ファイルシステムの種類(ext2,ext3,ext4)
  
[確認]
  vm11$ cd $HOME
  vm11$ dd if=/dev/zero of=image0.img bs=10M count=10 -> ext2
  vm11$ dd if=/dev/zero of=image1.img bs=10M count=10 -> ext3
  vm11$ dd if=/dev/zero of=image2.img bs=10M count=10 -> ext4
  vm11$ dd if=/dev/zero of=image3.img bs=10M count=10 -> xfs
  vm11$ dd if=/dev/zero of=image4.img bs=10M count=10 -> btrfs
  
  コマンドの実行結果
  --------------------------------------------------
  // image0.img
  10+0 レコード入力
  10+0 レコード出力
  104857600 バイト (105 MB) コピーされました、 1.28711 秒、 81.5 MB/秒

  // image1.img
  10+0 レコード入力
  10+0 レコード出力
  104857600 バイト (105 MB) コピーされました、 0.553625 秒、 189 MB/秒

  // image2.img
  10+0 レコード入力
  10+0 レコード出力
  104857600 バイト (105 MB) コピーされました、 0.18012 秒、 582 MB/秒

  // image3.img
  10+0 レコード入力
  10+0 レコード出力
  104857600 バイト (105 MB) コピーされました、 0.277572 秒、 378 MB/秒
  
  // image4.img
  10+0 レコード入力
  10+0 レコード出力
  104857600 バイト (105 MB) コピーされました、 0.365677 秒、 287 MB/秒
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ losetup -f
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img -> ext2
  vm11$ sudo losetup /dev/loop1 image1.img -> ext3
  vm11$ sudo losetup /dev/loop2 image2.img -> ext4
  vm11$ sudo losetup /dev/loop3 image3.img -> xfs
  vm11$ sudo losetup /dev/loop4 image4.img -> btrfs
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkdir -p /mnt/loop0 -> ext2
  vm11$ sudo mkdir -p /mnt/loop1 -> ext3
  vm11$ sudo mkdir -p /mnt/loop2 -> ext4
  vm11$ sudo mkdir -p /mnt/loop3 -> xfs
  vm11$ sudo mkdir -p /mnt/loop4 -> btrfs
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mke2fs
      > -b 4096        // ブロックサイズ
      > -c             // 不良チェック
      > -L loop0-ext2  // ラベル
      > -m 1           // 管理領域(1%)
      > -n             // 動作シミュレートのみ
      > /dev/loop0     // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem label=loop0-ext2 -> ラベル
  OS type: Linux
  Block size=4096 (log=2) -> ブロックサイズ(4096)
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  25600 inodes, 25600 blocks
  256 blocks (1.00%) reserved for the super user
  First data block=0
  Maximum filesystem blocks=29360128
  1 block group
  32768 blocks per group, 32768 fragments per group
  25600 inodes per group
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mke2fs
      > -b 4096        // ブロックサイズ
      > -c             // 不良チェック
      > -L loop0-ext2  // ラベル
      > -m 1           // 管理領域(1%)
      > /dev/loop0     // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Discarding device blocks: done
  Filesystem label=loop0-ext2 -> ラベル
  OS type: Linux
  Block size=4096 (log=2) -> ブロックサイズ(4096)
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  25600 inodes, 25600 blocks
  256 blocks (1.00%) reserved for the super user -> 管理領域(1%)
  First data block=0
  Maximum filesystem blocks=29360128
  1 block group
  32768 blocks per group, 32768 fragments per group
  25600 inodes per group
  
  Checking for bad blocks (read-only test): 0.00% done, 0:00 elapsed. -> 不良チェック
  Allocating group tables: done
  Writing inode tables: done
  Writing superblocks and filesystem accounting information: done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo dumpe2fs /dev/loop0 -> スーパーブロックの内容確認
  
  コマンドの実行結果
  --------------------------------------------------
  dumpe2fs 1.42.9 (28-Dec-2013)
  Filesystem volume name:   loop0-ext2 -> ラベル
  Last mounted on:          <not available>
  Filesystem UUID:          6702150a-53af-475e-9000-8e157c2bbd2e
  Filesystem magic number:  0xEF53
  Filesystem revision #:    1 (dynamic)
  Filesystem features:      ext_attr resize_inode dir_index filetype sparse_super large_file
  Filesystem flags:         signed_directory_hash 
  Default mount options:    user_xattr acl
  Filesystem state:         clean -> これが dirty なら整合性チェックでエラー
  Errors behavior:          Continue
  Filesystem OS type:       Linux
  Inode count:              25600
  Block count:              25600
  Reserved block count:     256
  Free blocks:              24784
  Free inodes:              25589
  First block:              0
  Block size:               4096 -> ブロックサイズ(4096)
  Fragment size:            4096
  Reserved GDT blocks:      6
  Blocks per group:         32768
  Fragments per group:      32768
  Inodes per group:         25600
  Inode blocks per group:   800
  Filesystem created:       Sat May  6 12:02:41 2023
  Last mount time:          n/a
  Last write time:          Sat May  6 12:02:41 2023
  Mount count:              0
  Maximum mount count:      -1
  Last checked:             Sat May  6 12:02:41 2023
  Check interval:           0 (<none>)
  Reserved blocks uid:      0 (user root)
  Reserved blocks gid:      0 (group root)
  First inode:              11
  Inode size:               128
  Default directory hash:   half_md4
  Directory Hash Seed:      14688dd2-c39d-4bae-8b18-07dffb78c6e0
  
  Group 0: (Blocks 0-25599)
    Primary superblock at 0, Group descriptors at 1-1
    Reserved GDT blocks at 2-7
    Block bitmap at 8 (+8), Inode bitmap at 9 (+9)
    Inode table at 10-809 (+10)
    24784 free blocks, 25589 free inodes, 2 directories
    Free blocks: 816-25599
    Free inodes: 12-25600
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -l /dev/loop0 -> スーパーブロックの内容確認
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  Filesystem volume name:   loop0-ext2
  Last mounted on:          <not available>
  Filesystem UUID:          6702150a-53af-475e-9000-8e157c2bbd2e
  Filesystem magic number:  0xEF53
  Filesystem revision #:    1 (dynamic)
  Filesystem features:      ext_attr resize_inode dir_index filetype sparse_super large_file
  Filesystem flags:         signed_directory_hash 
  Default mount options:    user_xattr acl
  Filesystem state:         clean
  Errors behavior:          Continue
  Filesystem OS type:       Linux
  Inode count:              25600
  Block count:              25600
  Reserved block count:     256
  Free blocks:              24784
  Free inodes:              25589
  First block:              0
  Block size:               4096
  Fragment size:            4096
  Reserved GDT blocks:      6
  Blocks per group:         32768
  Fragments per group:      32768
  Inodes per group:         25600
  Inode blocks per group:   800
  Filesystem created:       Sat May  6 12:02:41 2023
  Last mount time:          n/a
  Last write time:          Sat May  6 12:02:41 2023
  Mount count:              0
  Maximum mount count:      -1
  Last checked:             Sat May  6 12:02:41 2023
  Check interval:           0 (<none>)
  Reserved blocks uid:      0 (user root)
  Reserved blocks gid:      0 (group root)
  First inode:              11
  Inode size:               128
  Default directory hash:   half_md4
  Directory Hash Seed:      14688dd2-c39d-4bae-8b18-07dffb78c6e0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs
      > -L loop0-ext2-tuned  // ラベル変更
      > -U $(uuidgen)        // UUID
      > -m 5                 // 管理領域(5%)
      > /dev/loop0           // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  Setting reserved blocks percentage to 5% (1280 blocks)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo dumpe2fs /dev/loop0 -> スーパーブロックの内容確認
  
  コマンドの実行結果
  --------------------------------------------------
  dumpe2fs 1.42.9 (28-Dec-2013)
  Filesystem volume name:   loop0-ext2-tuned -> 変更を確認
  Last mounted on:          <not available>
  Filesystem UUID:          c619cd77-f338-47d3-ab57-1b19773e8145 -> 変更を確認
  Filesystem magic number:  0xEF53
  Filesystem revision #:    1 (dynamic)
  Filesystem features:      ext_attr resize_inode dir_index filetype sparse_super large_file
  Filesystem flags:         signed_directory_hash 
  Default mount options:    user_xattr acl
  Filesystem state:         clean
  Errors behavior:          Continue
  Filesystem OS type:       Linux
  Inode count:              25600
  Block count:              25600
  Reserved block count:     1280 -> 変更を確認
  Free blocks:              24784
  Free inodes:              25589
  First block:              0
  Block size:               4096
  Fragment size:            4096
  Reserved GDT blocks:      6
  Blocks per group:         32768
  Fragments per group:      32768
  Inodes per group:         25600
  Inode blocks per group:   800
  Filesystem created:       Sat May  6 12:02:41 2023
  Last mount time:          n/a
  Last write time:          Sat May  6 12:50:47 2023
  Mount count:              0
  Maximum mount count:      -1
  Last checked:             Sat May  6 12:02:41 2023
  Check interval:           0 (<none>)
  Reserved blocks uid:      0 (user root)
  Reserved blocks gid:      0 (group root)
  First inode:              11
  Inode size:               128
  Default directory hash:   half_md4
  Directory Hash Seed:      14688dd2-c39d-4bae-8b18-07dffb78c6e0
  
  Group 0: (Blocks 0-25599)
    Primary superblock at 0, Group descriptors at 1-1
    Reserved GDT blocks at 2-7
    Block bitmap at 8 (+8), Inode bitmap at 9 (+9)
    Inode table at 10-809 (+10)
    24784 free blocks, 25589 free inodes, 2 directories
    Free blocks: 816-25599
    Free inodes: 12-25600
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -l /dev/loop0 -> スーパーブロックの内容確認
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  Filesystem volume name:   loop0-ext2-tuned -> 変更を確認
  Last mounted on:          <not available>
  Filesystem UUID:          c619cd77-f338-47d3-ab57-1b19773e8145 -> 変更を確認
  Filesystem magic number:  0xEF53
  Filesystem revision #:    1 (dynamic)
  Filesystem features:      ext_attr resize_inode dir_index filetype sparse_super large_file
  Filesystem flags:         signed_directory_hash 
  Default mount options:    user_xattr acl
  Filesystem state:         clean
  Errors behavior:          Continue
  Filesystem OS type:       Linux
  Inode count:              25600
  Block count:              25600
  Reserved block count:     1280 -> 変更を確認
  Free blocks:              24784
  Free inodes:              25589
  First block:              0
  Block size:               4096
  Fragment size:            4096
  Reserved GDT blocks:      6
  Blocks per group:         32768
  Fragments per group:      32768
  Inodes per group:         25600
  Inode blocks per group:   800
  Filesystem created:       Sat May  6 12:02:41 2023
  Last mount time:          n/a
  Last write time:          Sat May  6 12:50:47 2023
  Mount count:              0
  Maximum mount count:      -1
  Last checked:             Sat May  6 12:02:41 2023
  Check interval:           0 (<none>)
  Reserved blocks uid:      0 (user root)
  Reserved blocks gid:      0 (group root)
  First inode:              11
  Inode size:               128
  Default directory hash:   half_md4
  Directory Hash Seed:      14688dd2-c39d-4bae-8b18-07dffb78c6e0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults /dev/loop0 /mnt/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  [ 5466.913933] EXT4-fs (loop0): mounting ext2 file system using the ext4 subsystem
  [ 5466.930251] EXT4-fs (loop0): mounted filesystem without journal. Opts: (null)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mke2fs
      > -b 4096        // ブロックサイズ
      > -j             // ext3
      > -c             // 不良チェック
      > -L loop1-ext3  // ラベル
      > -m 1           // 管理領域(1%)
      > -n             // 動作シミュレートのみ
      > /dev/loop1     // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Filesystem label=loop1-ext3 -> ラベル
  OS type: Linux
  Block size=4096 (log=2) -> ブロックサイズ
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  25600 inodes, 25600 blocks
  256 blocks (1.00%) reserved for the super user -> 管理領域(1%)
  First data block=0
  Maximum filesystem blocks=29360128
  1 block group
  32768 blocks per group, 32768 fragments per group
  25600 inodes per group
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mke2fs
      > -b 4096        // ブロックサイズ
      > -j             // ext3
      > -c             // 不良チェック
      > -L loop1-ext3  // ラベル
      > -m 1           // 管理領域(1%)
      > /dev/loop1     // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Discarding device blocks: done
  Filesystem label=loop1-ext3 -> ラベル
  OS type: Linux
  Block size=4096 (log=2) -> ブロックサイズ(4096)
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  25600 inodes, 25600 blocks
  256 blocks (1.00%) reserved for the super user -> 管理領域(1%)
  First data block=0
  Maximum filesystem blocks=29360128
  1 block group
  32768 blocks per group, 32768 fragments per group
  25600 inodes per group
  
  Checking for bad blocks (read-only test): 0.00% done, 0:00 elapsed.
  Allocating group tables: done
  Writing inode tables: done
  Creating journal (1024 blocks): done
  Writing superblocks and filesystem accounting information: done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs
      > -L loop1-ext3-tuned  // ラベル変更
      > -U $(uuidgen)        // UUID
      > -m 5                 // 管理領域(5%)
      > /dev/loop1           // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  Setting reserved blocks percentage to 5% (1280 blocks)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults /dev/loop1 /mnt/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  [ 6903.129064] EXT4-fs (loop1): mounting ext3 file system using the ext4 subsystem
  [ 6903.141801] EXT4-fs (loop1): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mke2fs
      > -b 4096        // ブロックサイズ
      > -t ext4        // ext4
      > -c             // 不良チェック
      > -L loop2-ext4  // ラベル
      > -m 1           // 管理領域(1%)
      > -n             // 動作シミュレートのみ
      > /dev/loop2     // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Filesystem label=loop2-ext4 -> ラベル
  OS type: Linux
  Block size=4096 (log=2) -> ブロックサイズ(4096)
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  25600 inodes, 25600 blocks
  256 blocks (1.00%) reserved for the super user -> 管理領域(1%)
  First data block=0
  Maximum filesystem blocks=27262976
  1 block group
  32768 blocks per group, 32768 fragments per group
  25600 inodes per group
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mke2fs
      > -b 4096        // ブロックサイズ
      > -t ext4        // ext4
      > -c             // 不良チェック
      > -L loop2-ext4  // ラベル
      > -m 1           // 管理領域(1%)
      > /dev/loop2     // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  mke2fs 1.42.9 (28-Dec-2013)
  Discarding device blocks: done
  Filesystem label=loop2-ext4 -> ラベル
  OS type: Linux
  Block size=4096 (log=2) -> ブロックサイズ(4096)
  Fragment size=4096 (log=2)
  Stride=0 blocks, Stripe width=0 blocks
  25600 inodes, 25600 blocks
  256 blocks (1.00%) reserved for the super user -> 管理領域(1%)
  First data block=0
  Maximum filesystem blocks=27262976
  1 block group
  32768 blocks per group, 32768 fragments per group
  25600 inodes per group
  
  Checking for bad blocks (read-only test):   0.00% done, 0:00 elapsed. -> 不良チェック
  Allocating group tables: done
  Writing inode tables: done
  Creating journal (1024 blocks): done
  Writing superblocks and filesystem accounting information: done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs
      > -L loop2-ext4-tuned  // ラベル変更
      > -U $(uuidgen)        // UUID
      > -m 5                 // 管理領域(5%)
      > /dev/loop2           // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  Setting reserved blocks percentage to 5% (1280 blocks)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults /dev/loop2 /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  [ 8857.817503] EXT4-fs (loop2): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/loop3 -> ファイルシステム(xfs)を作成
  
  コマンドの実行結果
  --------------------------------------------------
  Discarding blocks...Done.
  meta-data=/dev/loop3    isize=512    agcount=4, agsize=6400 blks
           =              sectsz=512   attr=2, projid32bit=1
           =              crc=1        finobt=0, sparse=0
  data     =              bsize=4096   blocks=25600, imaxpct=25
           =              sunit=0      swidth=0 blks
  naming   =version 2     bsize=4096   ascii-ci=0 ftype=1
  log      =internal log  bsize=4096   blocks=855, version=2
           =              sectsz=512   sunit=0 blks, lazy-count=1
  realtime =none          extsz=4096   blocks=0, rtextents=0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_info /dev/loop3 -> ファイルシステム(xfs)を調査
  
  コマンドの実行結果
  --------------------------------------------------
  xfs_info: /dev/loop3 is not a mounted XFS filesystem -> マウント状態でないと失敗する
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults /dev/loop3 /mnt/loop3 -> ファイルシステム(xfs)をマウント
  
  コマンドの実行結果
  --------------------------------------------------
  [10950.660730] XFS (loop3): Mounting V5 Filesystem
  [10950.669486] XFS (loop3): Ending clean mount
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_admin
      > -L loop3-xfs-tuned  // ラベル変更
      > -U $(uuidgen)       // UUID
      > /dev/loop3          // デバイスファイル
  
  コマンドの実行結果
  --------------------------------------------------
  writing all SBs
  xfs_admin: truncating label length from 15 to 12
  new label = "loop3-xfs-tu"
  Clearing log and setting UUID
  writing all SBs
  new UUID = 70c758db-82f1-4208-aedd-e1494d355543
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_info /dev/loop3 -> ファイルシステム(xfs)を調査
  
  コマンドの実行結果
  --------------------------------------------------
  meta-data=/dev/loop3  isize=512    agcount=4, agsize=6400 blks
           =            sectsz=512   attr=2, projid32bit=1
           =            crc=1        finobt=0 spinodes=0
  data     =            bsize=4096   blocks=25600, imaxpct=25
           =            sunit=0      swidth=0 blks
  naming   =version 2   bsize=4096   ascii-ci=0 ftype=1
  log      =internal    bsize=4096   blocks=855, version=2
           =            sectsz=512   sunit=0 blks, lazy-count=1
  realtime =none        extsz=4096   blocks=0, rtextents=0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t btrfs /dev/loop4 -> ファイルシステム(btrfs)を作成
  
  コマンドの実行結果
  --------------------------------------------------
  btrfs-progs v4.9.1
  See http://btrfs.wiki.kernel.org for more information.
  
  ERROR: superblock magic doesn't match
  Performing full device TRIM /dev/loop4 (100.00MiB) ...
  Label:              (null)
  UUID:               0df21d86-4c41-4f5e-8bc9-031cbc6c76b5
  Node size:          16384
  Sector size:        4096
  Filesystem size:    100.00MiB
  Block group profiles:
    Data:             single            8.00MiB
    Metadata:         DUP              32.00MiB
    System:           DUP               8.00MiB
  SSD detected:       no
  Incompat features:  extref, skinny-metadata
  Number of devices:  1
  Devices:
    ID        SIZE  PATH
    1    100.00MiB  /dev/loop4
  
  [13340.493112] raid6: sse2x1   gen()  8265 MB/s
  [13340.511096] raid6: sse2x1   xor()  6384 MB/s
  [13340.529120] raid6: sse2x2   gen()  9179 MB/s
  [13340.547111] raid6: sse2x2   xor()  6910 MB/s
  [13340.565098] raid6: sse2x4   gen() 10246 MB/s
  [13340.583119] raid6: sse2x4   xor()  6076 MB/s
  [13340.584791] raid6: using algorithm sse2x4 gen() 10246 MB/s
  [13340.586655] raid6: .... xor() 6076 MB/s, rmw enabled
  [13340.588579] raid6: using ssse3x2 recovery algorithm
  [13340.717246] xor: automatically using best checksumming function   avx       
  [13341.751379] Btrfs loaded, crc32c=crc32c-intel
  [13341.753459] BTRFS: device fsid 0df21d86-4c41-4f5e-8bc9-031cbc6c76b5 devid 1 transid 5 /dev/loop4
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults /dev/loop4 /mnt/loop4
  
  コマンドの実行結果
  --------------------------------------------------
  [14599.366219] BTRFS info (device loop4): disk space caching is enabled
  [14599.369263] BTRFS info (device loop4): has skinny extents
  [14599.371252] BTRFS info (device loop4): flagging fs with big metadata feature
  [14599.375616] BTRFS info (device loop4): creating UUID tree
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  /mnt/mp2
   |-- vdb1                   252:17    0     1G   0  part  /mnt/mp1
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  /mnt/loop0 -> ext2
  loop1                         7:1     0   100M   0  loop  /mnt/loop1 -> ext3
  loop2                         7:2     0   100M   0  loop  /mnt/loop2 -> ext4
  loop3                         7:3     0   100M   0  loop  /mnt/loop3 -> xfs
  loop4                         7:4     0   100M   0  loop  /mnt/loop4 -> btrfs
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C df -mHT
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      Size   Used  Avail  Use%  Mounted on
  devtmpfs                      devtmpfs  735M      0   735M    0%  /dev
  tmpfs                         tmpfs     758M      0   758M    0%  /dev/shm
  tmpfs                         tmpfs     758M   562k   757M    1%  /run
  tmpfs                         tmpfs     758M      0   758M    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs        19G   6.7G    12G   37%  /
  /dev/vdb2                     ext4      990M   2.6M   920M    1%  /mnt/mp2
  /dev/vdb1                     ext4      1.1G   2.7M   951M    1%  /mnt/mp1
  /dev/vda1                     xfs       1.1G   207M   857M   20%  /boot
  tmpfs                         tmpfs     110M      0   110M    0%  /run/user/1000
  /dev/loop0                    ext2      102M    50k    97M    1%  /mnt/loop0
  /dev/loop1                    ext3       98M    54k    93M    1%  /mnt/loop1
  /dev/loop2                    ext4       98M    74k    90M    1%  /mnt/loop2
  /dev/loop3                    xfs       102M   5.5M    96M    6%  /mnt/loop3
  /dev/loop4                    btrfs     105M    18M    20M   47%  /mnt/loop4
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ mount | grep loop[0-4]
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 on /mnt/loop0 type ext2 (rw,relatime,seclabel,block_validity,barrier,user_xattr,acl)
  /dev/loop1 on /mnt/loop1 type ext3 (rw,relatime,seclabel,data=ordered)
  /dev/loop2 on /mnt/loop2 type ext4 (rw,relatime,seclabel,data=ordered)
  /dev/loop3 on /mnt/loop3 type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
  /dev/loop4 on /mnt/loop4 type btrfs (rw,relatime,seclabel,space_cache,subvolid=5,subvol=/)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /etc/mtab | grep loop[0-4]
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 /mnt/loop0 ext2 rw,seclabel,relatime,block_validity,barrier,user_xattr,acl 0 0
  /dev/loop1 /mnt/loop1 ext3 rw,seclabel,relatime,data=ordered 0 0
  /dev/loop2 /mnt/loop2 ext4 rw,seclabel,relatime,data=ordered 0 0
  /dev/loop3 /mnt/loop3 xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  /dev/loop4 /mnt/loop4 btrfs rw,seclabel,relatime,space_cache,subvolid=5,subvol=/ 0 0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /proc/mounts | grep loop[0-4]
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0 /mnt/loop0 ext2 rw,seclabel,relatime,block_validity,barrier,user_xattr,acl 0 0
  /dev/loop1 /mnt/loop1 ext3 rw,seclabel,relatime,data=ordered 0 0
  /dev/loop2 /mnt/loop2 ext4 rw,seclabel,relatime,data=ordered 0 0
  /dev/loop3 /mnt/loop3 xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
  /dev/loop4 /mnt/loop4 btrfs rw,seclabel,relatime,space_cache,subvolid=5,subvol=/ 0 0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/loop0 /mnt/loop1 /mnt/loop2 /mnt/loop3 /mnt/loop4
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-4].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[12]
  ファイルシステム作成 - 02 (ext3)
  
[内容]
  ## 作業内容
    ファイルシステム(ext3)をコマンド(mke2fs)で作成してマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「11」を参照
  
================================================================================
[13]
  ファイルシステム作成 - 03 (ext4)
  
[内容]
  ## 作業内容
    ファイルシステム(ext4)をコマンド(mke2fs)で作成してマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「11」を参照
  
================================================================================
[14]
  ファイルシステム作成 - 04 (ext3 -> ext4)
  
[内容]
  ## 作業内容
    ファイルシステム(ext3)をコマンド(tune2fs)でアップグレード(ext4)後にマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(tune2fs)
    tune2fs -c XX  : 最大マウント回数(XX)に達したらファイルシステムチェック -> 0の場合はチェックしない
    tune2fs -C XX  : 現在のマウント回数を設定
    tune2fs -i XX  : ファイルシステムチェック間隔(XX日) -> 0の場合はチェックしない
    tune2fs -j     : ext2 -> ext3
    tune2fs -O     : ext3 -> ext4
    tune2fs -m XX  : root用予約領域(XX%)
    tune2fs -l     : スーパーブロック内容を表示
    tune2fs -L XX  : ファイルシステムのボリュームラベル(XX)
    tune2fs -U XX  : UUID(XX)
  
[確認]
  上記の「11」を参照
  
================================================================================
[15]
  ファイルシステム作成 - 05 (xfs)
  
[内容]
  ## 作業内容
    ファイルシステム(xfs)を作成後にマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「11」を参照
  
================================================================================
[16]
  ファイルシステム作成 - 06 (btrfs)
  
[内容]
  ## 作業内容
    ファイルシステム(btrfs)を作成後にマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「11」を参照
  
================================================================================
[17]
  コマンド(mkfs)
  
[内容]
  ## 作業内容
    コマンド(mkfs)で指定ファイルシステムを作成後にマウント
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(mkfs)
    mkfs -t XX  : ファイルシステム(XX)を指定
    mkfs -c     : 不良ブロックをチェック
  
[確認]
  上記の「11」を参照
  
================================================================================
[18]
  CD/DVD作成 - 01
  
[内容]
  ## 作業内容
    CD-ROM用のISOイメージ作成を行い、システムにマウント後にチェックする
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(mkisofs)
    mkisofs -b     : ブート可能CD
    mkisofs -o XX  : イメージファイル(XX)を指定
    mkisofs -J     : Windows
    mkisofs -r(R)  : UNIX(LongName)
    mkisofs -udf   : DVD
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install mkisofs
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ mkdir history
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME/history
  vm11$ vi 1234567890.12345
  
  コマンドの実行結果
  --------------------------------------------------
  1582年 本能寺の変
  1600年 関ヶ原の戦い
  1615年 大坂夏の陣
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ mkisofs -o history-cdrom1.iso history -> ISOイメージ(CD-ROM)を作成
  
  コマンドの実行結果
  --------------------------------------------------
  I: -input-charset not specified, using utf-8 (detected in locale settings)
  Total translation table size: 0
  Total rockridge attributes bytes: 0
  Total directory bytes: 0
  Path table size(bytes): 10
  Max brk space used 0
  175 extents written (0 MB)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ mkisofs -o history-cdrom2.iso -r(-R) history -> ISOイメージ(LongName, CD-ROM)を作成
  
  コマンドの実行結果
  --------------------------------------------------
  I: -input-charset not specified, using utf-8 (detected in locale settings)
  Total translation table size: 0
  Total rockridge attributes bytes: 257
  Total directory bytes: 0
  Path table size(bytes): 10
  Max brk space used 0
  176 extents written (0 MB)
  --------------------------------------------------
  
  vm11$ cd /mnt
  vm11$ sudo mkdir cdrom1 cdrom2 -> マウントポイント作成
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -r -t iso9660 history-cdrom1.iso /mnt/cdrom1 -> 読取専用でマウント
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -r -t iso9660 history-cdrom2.iso /mnt/cdrom2 -> 読取専用でマウント
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   350K   1  loop  /mnt/cdrom1 -> ISOイメージ
  loop1                         7:1     0   352K   1  loop  /mnt/cdrom2 -> ISOイメージ
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C df -mT
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      1M-blocks  Used  Available  Use%  Mounted on
  devtmpfs                      devtmpfs        947     0        947    0%  /dev
  tmpfs                         tmpfs           969     0        969    0%  /dev/shm
  tmpfs                         tmpfs           969     1        968    1%  /run
  tmpfs                         tmpfs           969     0        969    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs           17394  6439      10956   38%  /
  /dev/vda1                     xfs            1014   199        816   20%  /boot
  tmpfs                         tmpfs           114     0        114    0%  /run/user/1000
  /dev/loop0                    iso9660           1     1          0  100%  /mnt/cdrom1 -> ISOイメージ
  /dev/loop1                    iso9660           1     1          0  100%  /mnt/cdrom2 -> ISOイメージ
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ls -lh /mnt/cdrom[1-2] -> イメージ内を確認
  
  コマンドの実行結果
  --------------------------------------------------
  // cdrom1 -> ファイル名が「8.3」形式に制限
  -r-xr-xr-x. 1 root root 75  4月 18 11:00 12345678.123
  
  // cdrom2
  -r--r--r--. 1 root root 75  4月 18 11:00 1234567890.12345
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /mnt/cdrom[1-2]/* -> ファイル内容を確認
  
  コマンドの実行結果
  --------------------------------------------------
  // 12345678.123
  1582年 本能寺の変
  1600年 関ヶ原の戦い
  1615年 大坂夏の陣
  
  // 1234567890.12345
  1582年 本能寺の変
  1600年 関ヶ原の戦い
  1615年 大坂夏の陣
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/cdrom1 /mnt/cdrom2
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f *.iso
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[19]
  CD/DVD作成 - 02
  
[内容]
  ## 作業内容
    DVD-ROM用のISOイメージ作成を行い、システムにマウント後にチェックする
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ mkisofs -udf -o history-dvdrom1.iso history -> ISOイメージ(DVD-ROM)を作成
  
  コマンドの実行結果
  --------------------------------------------------
  I: -input-charset not specified, using utf-8 (detected in locale settings)
  Total translation table size: 0
  Total rockridge attributes bytes: 0
  Total directory bytes: 0
  Path table size(bytes): 10
  Max brk space used 0
  419 extents written (0 MB)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ mkisofs -udf -o history-dvdrom2.iso -r(-R) history -> ISOイメージ(LongName, DVD-ROM)を作成
  
  コマンドの実行結果
  --------------------------------------------------
  I: -input-charset not specified, using utf-8 (detected in locale settings)
  Total translation table size: 0
  Total rockridge attributes bytes: 257
  Total directory bytes: 0
  Path table size(bytes): 10
  Max brk space used 0
  420 extents written (0 MB)
  --------------------------------------------------
  
  vm11$ cd /mnt
  vm11$ sudo mkdir dvdrom1 dvdrom2 -> マウントポイント作成
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -r -t iso9660 history-dvdrom1.iso /mnt/dvdrom1 -> 読取専用でマウント
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -r -t iso9660 history-dvdrom2.iso /mnt/dvdrom2 -> 読取専用でマウント
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   838K   1  loop  /mnt/dvdrom1 -> ISOイメージ
  loop1                         7:1     0   840K   1  loop  /mnt/dvdrom2 -> ISOイメージ
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C df -mT
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      1M-blocks  Used  Available  Use%  Mounted on
  devtmpfs                      devtmpfs        947     0        947    0%  /dev
  tmpfs                         tmpfs           969     0        969    0%  /dev/shm
  tmpfs                         tmpfs           969     1        968    1%  /run
  tmpfs                         tmpfs           969     0        969    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs           17394  6439      10956   38%  /
  /dev/vda1                     xfs            1014   199        816   20%  /boot
  tmpfs                         tmpfs           114     0        114    0%  /run/user/1000
  /dev/loop0                    iso9660           1     1          0  100%  /mnt/dvdrom1 -> ISOイメージ
  /dev/loop1                    iso9660           1     1          0  100%  /mnt/dvdrom2 -> ISOイメージ
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ls -lh /mnt/dvdrom[1-2] -> イメージ内を確認
  
  コマンドの実行結果
  --------------------------------------------------
  // dvdrom1 -> ファイル名が「8.3」形式に制限
  -r-xr-xr-x. 1 root root 75  4月 18 11:00 12345678.123
  
  // dvdrom2
  -r--r--r--. 1 root root 75  4月 18 11:00 1234567890.12345
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /mnt/dvdrom[1-2]/* -> ファイル内容を確認
  
  コマンドの実行結果
  --------------------------------------------------
  // 12345678.123
  1582年 本能寺の変
  1600年 関ヶ原の戦い
  1615年 大坂夏の陣
  
  // 1234567890.12345
  1582年 本能寺の変
  1600年 関ヶ原の戦い
  1615年 大坂夏の陣
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/dvdrom1 /mnt/dvdrom2
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f *.iso
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[20]
  暗号化デバイス
  
[内容]
  ## 作業内容
    暗号化デバイスにファイルシステムを作成する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install cryptsetup
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.167523 s, 626 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo cryptsetup create secret0(暗号化デバイス) /dev/loop0 -> 暗号化デバイスに変換
  
  コマンドの実行結果
  --------------------------------------------------
  Enter passphrase for /home/makoto/image0.img: (例えば ma0122ma と入力)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  
   |-- secret0                253:2     0   100M   0  crypt -> 暗号化デバイス
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd /dev/mapper
  vm11$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx. 1 root root       7  4月 18 09:38 centos_vm11-root -> ../dm-0
  lrwxrwxrwx. 1 root root       7  4月 18 09:38 centos_vm11-swap -> ../dm-1
  crw-------. 1 root root 10, 236  4月 18 09:38 control
  lrwxrwxrwx. 1 root root       7  4月 18 12:23 secret0 -> ../dm-2
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/mapper/secret0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults -t xfs /dev/mapper/secret0 /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [10955.614742] XFS (dm-2): Mounting V5 Filesystem
  [10955.633464] XFS (dm-2): Ending clean mount
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  
   |-- secret0                253:2     0   100M   0  crypt /mnt -> 暗号化デバイス
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C df -mT
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      1M-blocks  Used  Available  Use%  Mounted on
  devtmpfs                      devtmpfs        947     0        947    0%  /dev
  tmpfs                         tmpfs           969     0        969    0%  /dev/shm
  tmpfs                         tmpfs           969     1        968    1%  /run
  tmpfs                         tmpfs           969     0        969    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs           17394  6538      10857   38%  /
  /dev/vda1                     xfs            1014   199        816   20%  /boot
  tmpfs                         tmpfs           114     0        114    0%  /run/user/1000
  /dev/mapper/secret0           xfs              97     6         92    6%  /mnt -> 暗号化デバイス
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ mount | grep secret0
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/mapper/secret0 on /mnt type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
  --------------------------------------------------
  
  vm11$ cd $HOME/history
  vm11$ vi AAA.txt
  
  コマンドの実行結果
  --------------------------------------------------
  645年 大化の改新
  710年 平城京遷都
  794年 平安京遷都
  --------------------------------------------------
  
  vm11$ cd $HOME/history
  vm11$ sudo cp -p AAA.txt /mnt -> ファイルを暗号化デバイスにコピー
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd /mnt
  vm11$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-rw-r--. 1 makoto makoto 69  4月 18 12:46 AAA.txt
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [11864.247061] XFS (dm-2): Unmounting Filesystem
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo cryptsetup remove secret0 -> 暗号化デバイスを元に戻す
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[21]
  スーパーブロック
  
[内容]
  ## 作業内容
    ファイルシステム(ext2,ext3,ext4)のスーパーブロックを調査する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「11」を参照
  
================================================================================
[22]
  ファイルシステムチェック - 01 (fsck)
  
[内容]
  ## 作業内容
    ファイルシステムチェックを行う (アンマウントまたは読取専用マウントでないとファイルシステムが壊れる)
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(fsck)
    fsck -r     : 対話的に修復を実行
    fsck -t XX  : ファイルシステム種類(XX)のみ実行
    fsck -A     : ファイル「/etc/fstab」の全ファイルシステムに実行
    fsck -N     : 動作のシミュレートのみ
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image1.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 1.72486 s, 60.8 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  vm11$ sudo losetup /dev/loop1 image1.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t ext4 /dev/loop0
  vm11$ sudo mkfs -t xfs /dev/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo fsck -t ext4 /dev/loop0 -> ファイルシステムチェック
  
  コマンドの実行結果
  --------------------------------------------------
  fsck from util-linux 2.23.2
  e2fsck 1.42.9 (28-Dec-2013) -> 内部でコマンド(e2fsck)を実行
  /dev/loop0: clean, 11/25688 files, 8896/102400 blocks -> 異常なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo fsck -r /dev/loop0 -> 対話的にファイルシステムチェック
  
  コマンドの実行結果
  --------------------------------------------------
  fsck from util-linux 2.23.2
  e2fsck 1.42.9 (28-Dec-2013) -> 内部でコマンド(e2fsck)を実行
  /dev/loop0: clean, 11/25688 files, 8896/102400 blocks -> 異常なし
  /dev/loop0: status 0, rss 3088, real 0.036244, user 0.001382, sys 0.006858
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo fsck -t xfs /dev/loop1 -> ファイルシステムチェック
  
  コマンドの実行結果
  --------------------------------------------------
  fsck from util-linux 2.23.2
  If you wish to check the consistency of an XFS filesystem or
  repair a damaged filesystem, see xfs_repair(8). -> コマンド(xfs_repair)の使用推奨
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_repair /dev/loop1 -> ファイルシステムチェック
  
  コマンドの実行結果
  --------------------------------------------------
  Phase 1 - find and verify superblock...
  Phase 2 - using internal log
          - zero log...
          - scan filesystem freespace and inode maps...
          - found root inode chunk
  Phase 3 - for each AG...
          - scan and clear agi unlinked lists...
          - process known inodes and perform inode discovery...
          - agno = 0
          - agno = 1
          - agno = 2
          - agno = 3
          - process newly discovered inodes...
  Phase 4 - check for duplicate blocks...
          - setting up duplicate extent list...
          - check for inodes claiming duplicate blocks...
          - agno = 0
          - agno = 1
          - agno = 2
          - agno = 3
  Phase 5 - rebuild AG headers and trees...
          - reset superblock...
  Phase 6 - check inode connectivity...
          - resetting contents of realtime bitmap and summary inodes
          - traversing filesystem ...
          - traversal finished ...
          - moving disconnected inodes to lost+found ...
  Phase 7 - verify and correct link counts...
  done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-1].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[23]
  ファイルシステムチェック - 02 (e2fsck)
  
[内容]
  ## 作業内容
    ファイルシステムチェックを行う (アンマウントまたは読取専用マウントでないとファイルシステムが壊れる)
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(e2fsck)
    e2fsck -b XX  : 指定したスーパーブロックのバックアップ(XX)を使用してファイルシステム復元
    e2fsck -c     : 不良ブロックをチェック
    e2fsck -f     : ファイルシステムが「clean」でもチェック
    e2fsck -p     : 不良ブロックを自動的に修復 -> preen(身だしなみの意味)
    e2fsck -y     : 問合せに「yes」と回答
    e2fsck -n     : 問合せに「no」と回答
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.13457 s, 779 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t ext4 /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> スーパーブロックはメモしない、後でコマンド(dumpe2fs)で調査する
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo e2fsck /dev/loop0 -> ファイルシステムチェック
  
  コマンドの実行結果
  --------------------------------------------------
  e2fsck 1.42.9 (28-Dec-2013)
  /dev/loop0: clean, 11/25688 files, 8896/102400 blocks
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo e2fsck -c -y /dev/loop0 -> 不良チェック、問合せにYES
  
  コマンドの実行結果
  --------------------------------------------------
  e2fsck 1.42.9 (28-Dec-2013)
  Checking for bad blocks (read-only test): 0.00% done, 0:00 elapsed.
  
  /dev/loop0: Updating bad block inode.
  Pass 1: Checking inodes, blocks, and sizes
  Pass 2: Checking directory structure
  Pass 3: Checking directory connectivity
  Pass 4: Checking reference counts
  Pass 5: Checking group summary information
  
  /dev/loop0: ***** FILE SYSTEM WAS MODIFIED *****
  /dev/loop0: 11/25688 files (9.1% non-contiguous), 8896/102400 blocks
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo e2fsck -p /dev/loop0 -> 自動修復
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/loop0: clean, 11/25688 files, 8896/102400 blocks
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo dumpe2fs /dev/loop0 | grep -i superblock -> スーパーブロック確認
  
  コマンドの実行結果
  --------------------------------------------------
  dumpe2fs 1.42.9 (28-Dec-2013)
    Primary superblock at 1, Group descriptors at 2-2
    Backup superblock at 8193, Group descriptors at 8194-8194 -> バックアップ(8193)を後に使用
    Backup superblock at 24577, Group descriptors at 24578-24578
    Backup superblock at 40961, Group descriptors at 40962-40962
    Backup superblock at 57345, Group descriptors at 57346-57346
    Backup superblock at 73729, Group descriptors at 73730-73730
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo e2fsck -b 8193 /dev/loop0 -> バックアップ(8193)使用、ファイルシステム修復
  
  コマンドの実行結果
  --------------------------------------------------
  e2fsck 1.42.9 (28-Dec-2013)
  /dev/loop0 was not cleanly unmounted, check forced.
  
  Pass 1: Checking inodes, blocks, and sizes
  Pass 2: Checking directory structure
  Pass 3: Checking directory connectivity
  Pass 4: Checking reference counts
  Pass 5: Checking group summary information
  
  /dev/loop0: ***** FILE SYSTEM WAS MODIFIED *****
  /dev/loop0: 11/25688 files (9.1% non-contiguous), 8896/102400 blocks
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[24]
  ファイルシステムチェック - 03 (xfs_repair)
  
[内容]
  ## 作業内容
    ファイルシステムチェックを行う (アンマウントまたは読取専用マウントの状態でないとファイルシステムが壊れる)
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(xfs_repair)
    xfs_repair XX     : デバイス(XX)のチェックと修復
    xfs_repair -n XX  : デバイス(XX)のチェックのみ
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.298024 s, 352 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_repair -n /dev/loop0 -> ファイルシステムチェックのみ実行
  
  コマンドの実行結果
  --------------------------------------------------
  Phase 1 - find and verify superblock...
  Phase 2 - using internal log
          - zero log...
          - scan filesystem freespace and inode maps...
          - found root inode chunk
  Phase 3 - for each AG...
          - scan (but don't clear) agi unlinked lists...
          - process known inodes and perform inode discovery...
          - agno = 0
          - agno = 1
          - agno = 2
          - agno = 3
          - process newly discovered inodes...
  Phase 4 - check for duplicate blocks...
          - setting up duplicate extent list...
          - check for inodes claiming duplicate blocks...
          - agno = 0
          - agno = 1
          - agno = 2
          - agno = 3
  No modify flag set, skipping phase 5
  Phase 6 - check inode connectivity...
          - traversing filesystem ...
          - traversal finished ...
          - moving disconnected inodes to lost+found ...
  Phase 7 - verify link counts...
  No modify flag set, skipping filesystem flush and exiting.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_repair /dev/loop0 -> ファイルシステムチェックと修復
  
  コマンドの実行結果
  --------------------------------------------------
  Phase 1 - find and verify superblock...
  Phase 2 - using internal log
          - zero log...
          - scan filesystem freespace and inode maps...
          - found root inode chunk
  Phase 3 - for each AG...
          - scan and clear agi unlinked lists...
          - process known inodes and perform inode discovery...
          - agno = 0
          - agno = 1
          - agno = 2
          - agno = 3
          - process newly discovered inodes...
  Phase 4 - check for duplicate blocks...
          - setting up duplicate extent list...
          - check for inodes claiming duplicate blocks...
          - agno = 0
          - agno = 1
          - agno = 2
          - agno = 3
  Phase 5 - rebuild AG headers and trees...
          - reset superblock...
  Phase 6 - check inode connectivity...
          - resetting contents of realtime bitmap and summary inodes
          - traversing filesystem ...
          - traversal finished ...
          - moving disconnected inodes to lost+found ...
  Phase 7 - verify and correct link counts...
  done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[25]
  ファイルシステム管理(ext2,ext3,ext4) - 01 (tune2fs)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(tune2fs)
    tune2fs -c XX  : 最大マウント回数(XX)でファイルシステムチェック -> 0 はチェックしない
    tune2fs -C XX  : 現在のマウント回数を設定
    tune2fs -i XX  : ファイルシステムチェック間隔(XX日) -> 0 はチェックしない
    tune2fs -j     : ext2からext3に変換
    tune2fs -m XX  : root用の管理領域の割合
    tune2fs -l     : スーパーブロック内容を表示
    tune2fs -L XX  : ファイルシステムのボリュームラベル(XX)
    tune2fs -U XX  : UUID(XX)
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.125487 s, 836 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t ext2 /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -j /dev/loop0 -> ファイルシステムのアップグレード
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  Creating journal inode: done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -m 1 /dev/loop0 -> 管理領域の割合を1%に変更
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  Setting reserved blocks percentage to 1% (1024 blocks)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -l /dev/loop0 -> スーパーブロックの内容表示
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  Filesystem volume name:   <none>
  Last mounted on:          <not available>
  Filesystem UUID:          cad03a58-d968-454f-90f7-17a47f9d45f7
  Filesystem magic number:  0xEF53
  Filesystem revision #:    1 (dynamic)
  Filesystem features:      has_journal ext_attr resize_inode dir_index filetype sparse_super
  Filesystem flags:         signed_directory_hash 
  Default mount options:    user_xattr acl
  Filesystem state:         clean
  Errors behavior:          Continue
  Filesystem OS type:       Linux
  Inode count:              25688
  Block count:              102400
  Reserved block count:     1024
  Free blocks:              93487
  Free inodes:              25677
  First block:              1
  Block size:               1024
  Fragment size:            1024
  Reserved GDT blocks:      256
  Blocks per group:         8192
  Fragments per group:      8192
  Inodes per group:         1976
  Inode blocks per group:   247
  Filesystem created:       Tue Apr 18 18:36:28 2023
  Last mount time:          n/a
  Last write time:          Tue Apr 18 18:38:47 2023
  Mount count:              0
  Maximum mount count:      -1
  Last checked:             Tue Apr 18 18:36:28 2023
  Check interval:           0 (<none>)
  Reserved blocks uid:      0 (user root)
  Reserved blocks gid:      0 (group root)
  First inode:              11
  Inode size:               128
  Journal inode:            8
  Default directory hash:   half_md4
  Directory Hash Seed:      31bbfd9e-0370-48f4-8b9f-24692375084a
  Journal backup:           inode blocks
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -L AAA /dev/loop0 -> ボリュームラベルを「AAA」に変更
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -l /dev/loop0 | grep 'volume name' -> ボリュームラベルを確認
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem volume name: AAA
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -l /dev/loop0 | grep 'UUID' -> UUID確認
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem UUID: cad03a58-d968-454f-90f7-17a47f9d45f7
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -U $(uuidgen) /dev/loop0 -> UUID設定
  
  コマンドの実行結果
  --------------------------------------------------
  tune2fs 1.42.9 (28-Dec-2013)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -l /dev/loop0 | grep 'UUID' -> UUID確認
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem UUID: 477f05e5-45df-48e9-bf8b-17395e5fada0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[26]
  ファイルシステム管理(ext2,ext3,ext4) - 02 (badblocks)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(badblocks)
    badblocks -b XX  : ブロックサイズ(XX)を指定
    badblocks -o XX  : 結果をファイル(XX)に出力
    badblocks -w     : 書込モードでテスト -> ファイルシステム破壊？
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.17776 s, 590 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t ext4 /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo tune2fs -l /dev/loop0 | grep -i 'block size' -> ブロックサイズの確認
  
  コマンドの実行結果
  --------------------------------------------------
  Block size: 1024
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo badblocks -b 1024 /dev/loop0 -> 不良ブロックの検索
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[27]
  ファイルシステム管理(ext2,ext3,ext4) - 03 (debugfs)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(debugfs)
    debugfs -w     : 書込可能モードで開く(デフォルトは読取専用)
    debugfs -s XX  : スーパーブロック(XX)を指定
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.141589 s, 741 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t ext4 /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults -t ext4 /dev/loop0 /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [10067.924501] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  /mnt -> マウントしたデバイス
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME/history
  vm11$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-rw-r--. 1 makoto makoto 75  4月 18 11:00 1234567890.12345
  -rw-rw-r--. 1 makoto makoto 69  4月 18 12:46 AAA.txt
  --------------------------------------------------
  
  vm11$ cd $HOME/history
  vm11$ mv 1234567890.12345 BBB.txt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo cp -pr history /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo debugfs -w /dev/loop0 -> 書込可能モードで実行
  
  コマンドの実行結果
  --------------------------------------------------
  debugfs 1.42.9 (28-Dec-2013)
  
  debugfs:  (サブコマンド: ls)
  debugfs:  ls
  2  (12) .    2  (12) ..    11  (20) lost+found    12  (980) history
  
  debugfs:  (サブコマンド: cd)
  debugfs:  cd hitory
  (出力なし)
  
  debugfs:  (サブコマンド: ls)
  debugfs:  ls
  12  (12) .    2  (12) ..    13  (16) AAA.txt    14  (984) BBB.txt
  
  debugfs:  (サブコマンド: cat)
  debugfs:  cat AAA.txt
  
  645年 大化の改新
  710年 平城京遷都
  794年 平安京遷都
  
  debugfs:  (サブコマンド: cat)
  debugfs:  cat BBB.txt
  
  1582年 本能寺の変
  1600年 関ヶ原の戦い
  1615年 大坂夏の陣
  
  debugfs:  (サブコマンド: quit)
  debugfs:  quit

  (OSプロンプトに戻る)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[28]
  S.M.A.R.T
  
[内容]
  ## 作業内容
    ディスクの自己診断
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
  ## コマンド(smartctl)
    smartctl -a  : 自己診断情報を表示
    smartctl -t  : セルフテスト実施
    smartctl -l  : ログタイプ指定
    smartctl -H  : 状態を表示
  
[確認]
  $ cd $HOME
  $ yum list installed | grep smartmontools
  
  コマンドの実行結果
  --------------------------------------------------
  smartmontools.x86_64  1:7.1-1.el8
  --------------------------------------------------
  
  $ cd $HOME
  $ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME               MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  sda                  8:0     0   477G   0  disk  
   |-- sda1            8:1     0     1G   0  part  /boot
   |-- sda2            8:2     0   476G   0  part  
        |-- rl-root  253:0     0    70G   0  lvm   /
        |-- rl-swap  253:1     0   3.9G   0  lvm   [SWAP]
        |-- rl-home  253:2     0 402.1G   0  lvm   /home
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo smartctl -a /dev/sda -> 自己診断情報を表示
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 表示項目が理解不能
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo smartctl -H /dev/sda -> 状態を表示
  
  コマンドの実行結果
  --------------------------------------------------
  smartctl 7.1 2020-04-05 r5049 [x86_64-linux-4.18.0-425.19.2.el8_7.x86_64] (local build)
  Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org
  
  === START OF READ SMART DATA SECTION ===
  SMART overall-health self-assessment test result: PASSED -> テスト合格！
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[29]
  ファイルシステム管理(xfs) - 01 (xfs_admin)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(xfs_admin)
    xfs_admin -u     : UUID表示
    xfs_admin -U XX  : UUID(XX)を設定
    xfs_admin -l     : ラベル表示
    xfs_admin -L XX  : ラベル(XX)を設定
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.601776 s, 174 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults -t xfs /dev/loop0 /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [13467.643878] XFS (loop0): Mounting V5 Filesystem
  [13467.652054] XFS (loop0): Ending clean mount
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  /mnt -> マウントしたデバイス
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_info /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  meta-data=/dev/loop0   isize=512    agcount=4, agsize=6400 blks
           =             sectsz=512   attr=2, projid32bit=1
           =             crc=1        finobt=0 spinodes=0
  data     =             bsize=4096   blocks=25600, imaxpct=25
           =             sunit=0      swidth=0 blks
  naming   =version 2    bsize=4096   ascii-ci=0 ftype=1
  log      =internal     bsize=4096   blocks=855, version=2
           =             sectsz=512   sunit=0 blks, lazy-count=1
  realtime =none         extsz=4096   blocks=0, rtextents=0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [13656.982623] XFS (loop0): Unmounting Filesystem
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_admin -u /dev/loop0 -> UUID表示
  
  コマンドの実行結果
  --------------------------------------------------
  UUID = 3bb60c6d-f357-496c-a4a1-0e05861943c5
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_admin -U $(uuidgen) /dev/loop0 -> UUID設定
  
  コマンドの実行結果
  --------------------------------------------------
  Clearing log and setting UUID
  writing all SBs
  new UUID = c5049f38-9228-437e-af27-ec078bab2185
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_admin -u /dev/loop0 -> UUID表示
  
  コマンドの実行結果
  --------------------------------------------------
  UUID = c5049f38-9228-437e-af27-ec078bab2185
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_admin -l /dev/loop0 -> ラベル表示
  
  コマンドの実行結果
  --------------------------------------------------
  label = ""
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_admin -L 'AAA' /dev/loop0 -> ラベル設定
  
  コマンドの実行結果
  --------------------------------------------------
  writing all SBs
  new label = "AAA"
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_admin -l /dev/loop0 -> ラベル表示
  
  コマンドの実行結果
  --------------------------------------------------
  label = "AAA"
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ディスクイメージ削除
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[30]
  ファイルシステム管理(xfs) - 02 (xfs_info)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  上記の「29」を参照
  
================================================================================
[31]
  ファイルシステム管理(xfs) - 03 (xfsdump)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(xfsdump)
    xfsdump -f XX  : 出力ファイル名(XX)を指定
    xfsdump -l XX  : ダンプレベル(XX)を指定
    xfsdump -J     : ダンプ情報データベース更新しない
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install xfsdump
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image1.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.523387 s, 200 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  vm11$ sudo losetup /dev/loop1 image1.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/loop0
  vm11$ sudo mkfs -t xfs /dev/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults -t xfs /dev/loop0 /mnt/loop0
  vm11$ sudo mount -o defaults -t xfs /dev/loop1 /mnt/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  /mnt/loop0 -> マウントしたデバイス
  loop1                         7:0     0   100M   0  loop  /mnt/loop1 -> マウントしたデバイス
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo cp -p history/AAA.txt /mnt/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfsdump -f loop0-level0.dmp -l 0 /mnt/loop0 -> 完全バックアップ
  
  コマンドの実行結果
  --------------------------------------------------
  xfsdump: using file dump (drive_simple) strategy
  xfsdump: version 3.1.7 (dump format 3.0) - type ^C for status and control
  
  // セッションラベル入力
  please enter label for this dump session (timeout in 300 sec)
  -> loop0-level0-sess
  session label entered: "loop0-level0-sess"
  
  xfsdump: level 0 dump of vm11:/mnt/loop0
  xfsdump: dump date: Tue Apr 18 21:09:30 2023
  xfsdump: session id: 2749bad4-2d37-4214-8c75-2b4000487e4e
  xfsdump: session label: "loop0-level0-sess"
  xfsdump: ino map phase 1: constructing initial dump list
  xfsdump: ino map phase 2: skipping (no pruning necessary)
  xfsdump: ino map phase 3: skipping (only one dump stream)
  xfsdump: ino map construction complete
  xfsdump: estimated dump size: 25216 bytes
  xfsdump: /var/lib/xfsdump/inventory created
  
  // メディアラベル入力
  please enter label for media in drive 0 (timeout in 300 sec)
  -> loop0-level0-media
  media label entered: "loop0-level0-media"
  
  xfsdump: creating dump session media file 0 (media 0, file 0)
  xfsdump: dumping ino map
  xfsdump: dumping directories
  xfsdump: dumping non-directory files
  xfsdump: ending media file
  xfsdump: media file size 22216 bytes
  xfsdump: dump size (non-dir files) : 544 bytes
  xfsdump: dump complete: 151 seconds elapsed
  xfsdump: Dump Summary:
  xfsdump: stream 0 /home/makoto/loop0-level0.dmp OK (success)
  xfsdump: Dump Status: SUCCESS
  --------------------------------------------------
  
  vm11$ cd /mnt/loop0
  vm11$ vi AAA.txt
  
  コマンドの実行結果
  --------------------------------------------------
  645年 大化の改新
  710年 平城京遷都
  794年 平安京遷都
  866年 応天門の変 (追加)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfsdump -f loop0-level1.dmp -l 1 /mnt/loop0 -> 増分バックアップ
  
  コマンドの実行結果
  --------------------------------------------------
  xfsdump: using file dump (drive_simple) strategy
  xfsdump: version 3.1.7 (dump format 3.0) - type ^C for status and control
  
  // セッションラベル入力
  please enter label for this dump session (timeout in 300 sec)
  -> loop0-level1-sess
  session label entered: "loop0-level1-sess"
  
  xfsdump: level 1 incremental dump of vm11:/mnt/loop0 based on level 0 dump begun Tue Apr 18 21:09:30 2023
  xfsdump: dump date: Tue Apr 18 21:17:23 2023
  xfsdump: session id: 945108ce-775b-4de2-939e-85ad848c489f
  xfsdump: session label: "loop0-level1-sess"
  xfsdump: ino map phase 1: constructing initial dump list
  xfsdump: ino map phase 2: pruning unneeded subtrees
  xfsdump: ino map phase 3: skipping (only one dump stream)
  xfsdump: ino map construction complete
  xfsdump: estimated dump size: 25216 bytes
  
  // メディアラベル入力
  please enter label for media in drive 0 (timeout in 300 sec)
  -> loop0-level1-media
  media label entered: "loop0-level1-media"
  
  xfsdump: creating dump session media file 0 (media 0, file 0)
  xfsdump: dumping ino map
  xfsdump: dumping directories
  xfsdump: dumping non-directory files
  xfsdump: ending media file
  xfsdump: media file size 22216 bytes
  xfsdump: dump size (non-dir files) : 544 bytes
  xfsdump: dump complete: 119 seconds elapsed
  xfsdump: Dump Summary:
  xfsdump: stream 0 /home/makoto/loop0-level1.dmp OK (success)
  xfsdump: Dump Status: SUCCESS
  --------------------------------------------------
  
  vm11$ cd /mnt/loop0
  vm11$ vi AAA.txt
  
  コマンドの実行結果
  --------------------------------------------------
  645年 大化の改新
  710年 平城京遷都
  794年 平安京遷都
  866年 応天門の変
  894年 遣唐使の廃止 (追加)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfsdump -f loop0-level2.dmp -l 2 /mnt/loop0 -> 増分バックアップ
  
  コマンドの実行結果
  --------------------------------------------------
  xfsdump: using file dump (drive_simple) strategy
  xfsdump: version 3.1.7 (dump format 3.0) - type ^C for status and control
  
  // セッションラベル入力
  please enter label for this dump session (timeout in 300 sec)
  -> loop0-level2-sess
  session label entered: "loop0-level2-sess"
  
  xfsdump: level 2 incremental dump of vm11:/mnt/loop0 based on level 1 dump begun Tue Apr 18 21:17:23 2023
  xfsdump: dump date: Tue Apr 18 21:23:50 2023
  xfsdump: session id: 4614df6d-2fc3-4153-a86e-fe90bfdceb18
  xfsdump: session label: "loop0-level2-sess"
  xfsdump: ino map phase 1: constructing initial dump list
  xfsdump: ino map phase 2: pruning unneeded subtrees
  xfsdump: ino map phase 3: skipping (only one dump stream)
  xfsdump: ino map construction complete
  xfsdump: estimated dump size: 25216 bytes
  
  // メディアラベル入力
  please enter label for media in drive 0 (timeout in 300 sec)
  -> loop0-level2-media
  media label entered: "loop0-level2-media"
  
  xfsdump: creating dump session media file 0 (media 0, file 0)
  xfsdump: dumping ino map
  xfsdump: dumping directories
  xfsdump: dumping non-directory files
  xfsdump: ending media file
  xfsdump: media file size 22216 bytes
  xfsdump: dump size (non-dir files) : 544 bytes
  xfsdump: dump complete: 103 seconds elapsed
  xfsdump: Dump Summary:
  xfsdump: stream 0 /home/makoto/loop0-level2.dmp OK (success)
  xfsdump: Dump Status: SUCCESS
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ls -lh | grep loop0-level -> バックアップファイル確認
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--.  1 root   root    22K  4月 18 21:12 loop0-level0.dmp
  -rw-r--r--.  1 root   root    22K  4月 18 21:19 loop0-level1.dmp
  -rw-r--r--.  1 root   root    22K  4月 18 21:25 loop0-level2.dmp
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ xfsrestore -I | grep -E 'session|media' -> セッションラベルとメディアラベル
  
  コマンドの実行結果
  --------------------------------------------------
  session 0:
    session label: "loop0-level0-sess"
    session id: 2749bad4-2d37-4214-8c75-2b4000487e4e
      media files: 1
      media file 0:
        media label: "loop0-level0-media"
        media id: 28d59813-33ef-468d-a6cb-d452a2d9514f
  session 1:
    session label: "loop0-level1-sess"
    session id: 945108ce-775b-4de2-939e-85ad848c489f
      media files: 1
      media file 0:
        media label: "loop0-level1-media"
        media id: 21ea992b-5fee-47d0-8f7e-6416b2ff229e
  session 2:
    session label: "loop0-level2-sess"
    session id: 4614df6d-2fc3-4153-a86e-fe90bfdceb18
      media files: 1
      media file 0:
        media label: "loop0-level2-media"
        media id: 2202e962-21fa-4238-a569-80948903c767
  --------------------------------------------------
  
  vm11$ cd $HOME -> 完全バックアップを別ファイルシステムにレストア
  vm11$ sudo xfsrestore -S "2749bad4-2d37-4214-8c75-2b4000487e4e" -L "loop0-level0-media" -f loop0-level0.dmp /mnt/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  xfsrestore: using file dump (drive_simple) strategy
  xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
  xfsrestore: using online session inventory
  xfsrestore: searching media for directory dump
  xfsrestore: examining media file 0
  xfsrestore: reading directories
  xfsrestore: 1 directories and 1 entries processed
  xfsrestore: directory post-processing
  xfsrestore: restoring non-directory files
  xfsrestore: restore complete: 0 seconds elapsed
  xfsrestore: Restore Summary:
  xfsrestore: stream 0 /home/makoto/loop0-level0.dmp OK (success)
  xfsrestore: Restore Status: SUCCESS
  --------------------------------------------------
  
  vm11$ cd /mnt/loop1
  vm11$ cat AAA.txt
  
  コマンドの実行結果
  --------------------------------------------------
  645年 大化の改新
  710年 平城京遷都
  794年 平安京遷都
  --------------------------------------------------
  
  vm11$ cd $HOME -> 増分バックアップを別ファイルシステムにレストア
  vm11$ sudo xfsrestore -S "945108ce-775b-4de2-939e-85ad848c489f" -L "loop0-level1-media" -f loop0-level1.dmp /mnt/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  xfsrestore: using file dump (drive_simple) strategy
  xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
  xfsrestore: using online session inventory
  xfsrestore: searching media for directory dump
  xfsrestore: examining media file 0
  xfsrestore: reading directories
  xfsrestore: 1 directories and 1 entries processed
  xfsrestore: directory post-processing
  xfsrestore: restoring non-directory files
  xfsrestore: restore complete: 0 seconds elapsed
  xfsrestore: Restore Summary:
  xfsrestore: stream 0 /home/makoto/loop0-level1.dmp OK (success)
  xfsrestore: Restore Status: SUCCESS
  --------------------------------------------------
  
  vm11$ cd /mnt/loop1
  vm11$ cat AAA.txt
  
  コマンドの実行結果
  --------------------------------------------------
  645年 大化の改新
  710年 平城京遷都
  794年 平安京遷都
  866年 応天門の変 (反映された)
  --------------------------------------------------
  
  vm11$ cd $HOME -> 増分バックアップを別ファイルシステムにレストア
  vm11$ sudo xfsrestore -S "4614df6d-2fc3-4153-a86e-fe90bfdceb18" -L "loop0-level2-media" -f loop0-level2.dmp /mnt/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  xfsrestore: using file dump (drive_simple) strategy
  xfsrestore: version 3.1.7 (dump format 3.0) - type ^C for status and control
  xfsrestore: using online session inventory
  xfsrestore: searching media for directory dump
  xfsrestore: examining media file 0
  xfsrestore: reading directories
  xfsrestore: 1 directories and 1 entries processed
  xfsrestore: directory post-processing
  xfsrestore: restoring non-directory files
  xfsrestore: restore complete: 0 seconds elapsed
  xfsrestore: Restore Summary:
  xfsrestore: stream 0 /home/makoto/loop0-level2.dmp OK (success)
  xfsrestore: Restore Status: SUCCESS
  --------------------------------------------------
  
  vm11$ cd /mnt/loop1
  vm11$ cat AAA.txt
  
  コマンドの実行結果
  --------------------------------------------------
  645年 大化の改新
  710年 平城京遷都
  794年 平安京遷都
  866年 応天門の変
  894年 遣唐使の廃止
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ diff /mnt/loop0/AAA.txt /mnt/loop1/AAA.txt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/loop0 /mnt/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-1].img loop-level[0-2].dmp
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[32]
  ファイルシステム管理(xfs) - 04 (xfsrestore)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## コマンド(xfsrestore)
    xfsrestore -f XX  : バックアップファイル(XX)を指定
    xfsrestore -S XX  : セッションID(XX)を指定
    xfsrestore -L XX  : セッションラベル(XX)を指定
    xfsrestore -r     : 増分バックアップからリストア
    xfsrestore -i     : 対話的にリストア
    xfsrestore -I     : 全ダンプのセッションIDとセッションラベルを表示
  
[確認]
  上記の「31」を参照
  
================================================================================
[33]
  ファイルシステム管理(xfs) - 05 (xfs_repair)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.433394 s, 242 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo xfs_repair /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  Phase 1 - find and verify superblock...
  Phase 2 - using internal log
          - zero log...
          - scan filesystem freespace and inode maps...
          - found root inode chunk
  Phase 3 - for each AG...
          - scan and clear agi unlinked lists...
          - process known inodes and perform inode discovery...
          - agno = 0
          - agno = 1
          - agno = 2
          - agno = 3
          - process newly discovered inodes...
  Phase 4 - check for duplicate blocks...
          - setting up duplicate extent list...
          - check for inodes claiming duplicate blocks...
          - agno = 0
          - agno = 1
          - agno = 2
          - agno = 3
  Phase 5 - rebuild AG headers and trees...
          - reset superblock...
  Phase 6 - check inode connectivity...
          - resetting contents of realtime bitmap and summary inodes
          - traversing filesystem ...
          - traversal finished ...
          - moving disconnected inodes to lost+found ...
  Phase 7 - verify and correct link counts...
  done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[34]
  ファイルシステム管理(btrfs) - 01 (btrfs)
  
[内容]
  ## 作業内容
    ファイルシステム管理を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.12708 s, 825 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t btrfs /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo btrfs filesystem show -> ファイルシステムの情報を表示
  
  コマンドの実行結果
  --------------------------------------------------
  Label: none  uuid: 33d15954-3b5c-4a95-9527-5bdd5a14483e
    Total devices 1 FS bytes used 112.00KiB
    devid 1 size 100.00MiB used 88.00MiB path /dev/loop0
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults -t btrfs /dev/loop0 /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  /mnt -> マウントしたデバイス
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo btrfs filesystem df /mnt -> マウントしたファイルシステムの使用状況
  
  コマンドの実行結果
  --------------------------------------------------
  Data, single: total=8.00MiB, used=0.00B
  System, DUP: total=8.00MiB, used=16.00KiB
  Metadata, DUP: total=32.00MiB, used=112.00KiB
  GlobalReserve, single: total=16.00MiB, used=0.00B
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo btrfs subvolume create /mnt/sub1 -> サブボリューム作成
  vm11$ sudo btrfs subvolume create /mnt/sub2 -> サブボリューム作成
  
  コマンドの実行結果
  --------------------------------------------------
  Create subvolume '/mnt/sub1'
  Create subvolume '/mnt/sub2'
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo btrfs subvolume list /mnt -> 作成したサブボリューム確認
  
  コマンドの実行結果
  --------------------------------------------------
  ID 256 gen 7 top level 5 path sub1
  ID 257 gen 8 top level 5 path sub2
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt -> 予めトップレベルのボリュームをアンマウント
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  (アンマウント済)
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults,subvolid=256 -t btrfs /dev/loop0 /mnt/loop1 -> サブボリュームを個別にマウント
  vm11$ sudo mount -o defaults,subvolid=257 -t btrfs /dev/loop0 /mnt/loop2 -> サブボリュームを個別にマウント
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C df -mT
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      1M-blocks  Used  Available  Use%  Mounted on
  devtmpfs                      devtmpfs        947     0        947    0%  /dev
  tmpfs                         tmpfs           969     0        969    0%  /dev/shm
  tmpfs                         tmpfs           969     1        968    1%  /run
  tmpfs                         tmpfs           969     0        969    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs           17394  6448      10947   38%  /
  /dev/vda1                     xfs            1014   199        816   20%  /boot
  tmpfs                         tmpfs           114     0        114    0%  /run/user/1000
  tmpfs                         tmpfs           114     0        114    0%  /run/user/0
  /dev/loop0                    btrfs           100    17         19   47%  /mnt/loop1 -> サブボリューム
  /dev/loop0                    btrfs           100    17         19   47%  /mnt/loop2 -> サブボリューム
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/loop1 /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[35]
  ファイルシステム管理(btrfs) - 02 (btrfs-convert)
  
[内容]
  ## 作業内容
    ファイルシステム変換を行う
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.3301 s, 318 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t ext4 -b 4096 /dev/loop0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> ブロックサイズが4096未満の場合、後の「btrfs」への変換時にエラー出力
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo btrfs-convert /dev/loop0 -> ファイルシステム変換
  
  コマンドの実行結果
  --------------------------------------------------
  create btrfs filesystem:
    blocksize: 4096
    nodesize:  16384
    features:  extref, skinny-metadata (default)
  creating ext2 image file
  creating btrfs metadatacopy inodes [o] [         2/        11]
  conversion complete
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults -t btrfs /dev/loop0 /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C df -mT
  
  コマンドの実行結果
  --------------------------------------------------
  Filesystem                    Type      1M-blocks  Used  Available  Use%  Mounted on
  devtmpfs                      devtmpfs        947     0        947    0%  /dev
  tmpfs                         tmpfs           969     0        969    0%  /dev/shm
  tmpfs                         tmpfs           969     1        968    1%  /run
  tmpfs                         tmpfs           969     0        969    0%  /sys/fs/cgroup
  /dev/mapper/centos_vm11-root  xfs           17394  6450      10945   38%  /
  /dev/vda1                     xfs            1014   199        816   20%  /boot
  tmpfs                         tmpfs           114     0        114    0%  /run/user/1000
  /dev/loop0                    btrfs           100    24         56   30%  /mnt -> btrfs を確認
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image0.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[36]
  オートマウント
  
[内容]
  ## 作業内容
    ディレクトリ「/mnt/auto/dir0」に移動時にデバイス「/dev/loop0」を自動マウントする
    ディレクトリ「/mnt/auto/dir1」に移動時にデバイス「/dev/loop1」を自動マウントする
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install autofs
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=loop0.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=loop1.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.215565 s, 486 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 loop0.img
  vm11$ sudo losetup /dev/loop1 loop1.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t ext4 /dev/loop0
  vm11$ sudo mkfs -t ext4 /dev/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vi /etc/auto.master (設定ファイルの修正)
  
  コマンドの実行結果
  --------------------------------------------------
  /misc /etc/auto.misc
  /net  -hosts
  +dir:/etc/auto.master.d
  +auto.master
  /mnt/auto /etc/auto.dir  // 追加 -> ディレクトリ「/mnt/auto」移動時に設定ファイル「/etc/auto.dir」の内容でマウント
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vi /etc/auto.dir -> 設定ファイルの追加
  
  コマンドの実行結果
  --------------------------------------------------
  dir0  -fstype=ext4,rw  :/dev/loop0
  dir1  -fstype=ext4,rw  :/dev/loop1
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo systemctl restart autofs
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  (オートマウント前)
  loop1                         7:1     0   100M   0  loop  (オートマウント前)
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ ls -lh /mnt/auto
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cd /mnt/auto/dir0 -> ディレクトリ移動
  vm11$ cd /mnt/auto/dir1 -> ディレクトリ移動
  
  コマンドの実行結果
  --------------------------------------------------
  [11051.588068] EXT4-fs (loop0): mounted filesystem with ordered data mode. Opts: (null) -> cd /mnt/auto/dir0
  [11114.060107] EXT4-fs (loop1): mounted filesystem with ordered data mode. Opts: (null) -> cd /mnt/auto/dir1
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  /mnt/auto/dir0 (オートマウント後)
  loop1                         7:1     0   100M   0  loop  /mnt/auto/dir1 (オートマウント後)
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/auto/dir0
  vm12$ sudo umount /mnt/auto/dir1
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f loop[0-1].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vi /etc/auto.master
  
  コマンドの実行結果
  --------------------------------------------------
  /misc /etc/auto.misc
  /net  -hosts
  +dir:/etc/auto.master.d
  +auto.master
  # /mnt/auto /etc/auto.dir  // コメントアウト
  --------------------------------------------------
  
  vm11$ cd /etc
  vm11$ sudo rm auto.dir
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo systemctl restart autofs
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
