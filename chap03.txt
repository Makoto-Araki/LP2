================================================================================
[001] ブートからカーネルの起動 - 01 (dmesg)
[002] ブートからカーネルの起動 - 02 (journalctl -b -k)
[003] 設定ファイル(SysVinit) - 01 (/etc/inittab)
[004] 設定ファイル(SysVinit) - 02 (/etc/rcXX.d)
[005] 起動スクリプトとランレベル(SysVinit) - 01 (/etc/init.d/XX)
[006] 起動スクリプトとランレベル(SysVinit) - 02 (service)
[007] サービスの自動起動(SysVinit) - 01 (link)
[008] サービスの自動起動(SysVinit) - 02 (chkconfig)
[009] 起動手順(Systemd)
[010] サービスの管理(Systemd) - 01
[011] サービスの管理(Systemd) - 02
[012] Unit設定ファイル(Systemd)
[013] Systemdのログ - 01 (journalctl)
[014] Systemdのログ - 02 (/etc/systemd/journalctld.conf)
[015] ブートローダー(Grub Legacy) - 01
[016] ブートローダー(Grub Legacy) - 02
[017] ブートローダー(Grub Legacy) - 03
[018] ブートローダー(Grub Legacy) - 04
[019] ブートローダー(Grub 2) - 01
[020] ブートローダー(Grub 2) - 02
[021] Install USB - 01
[022] Install USB - 02
[023] Install USB - 03
================================================================================
[001]
  ブートからカーネルの起動 - 01 (dmesg)
  
[内容]
  ## 作業内容
    ブートからカーネルの起動をコマンド(dmesg)で確認
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun  3 13:25:41 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dmesg | head -n 5
    
    コマンドの実行結果
    --------------------------------------------------
    [    0.000000] Linux version 4.20.1 (root@vm11) (gcc version 8.5.0 20210514 (Red Hat 8.5.0-18) (GCC)) ...
    [    0.000000] Command line: BOOT_IMAGE=(hd0,msdos1)/vmlinuz-4.20.1 root=/dev/mapper/rl_vm11-root ro crashkernel=auto resume=/dev/mapper/rl_vm11-swap rd.lvm.lv=rl_vm11/root rd.lvm.lv=rl_vm11/swap console=ttyS0,115200n8
    [    0.000000] x86/fpu: Supporting XSAVE feature 0x001: 'x87 floating point registers'
    [    0.000000] x86/fpu: Supporting XSAVE feature 0x002: 'SSE registers'
    [    0.000000] x86/fpu: Supporting XSAVE feature 0x004: 'AVX registers'
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[002]
  ブートからカーネルの起動 - 02 (journalctl -b -k)
  
[内容]
  ## 作業内容
    ブートからカーネルの起動をコマンド(journalctl -b -k)で確認
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun  3 13:58:53 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ journalctl -b -k | head -n 5
    
    コマンドの実行結果
    --------------------------------------------------
    -- Logs begin at Sat 2023-06-03 12:45:38 JST, end at Sat 2023-06-03 14:05:11 JST. --
    6月 03 12:45:38 vm11 kernel: Linux version 4.20.1 (root@vm11) (gcc version 8.5.0 20210514 (Red Hat 8.5.0-18) (GCC)) ...
    6月 03 12:45:38 vm11 kernel: Command line: BOOT_IMAGE=(hd0,msdos1)/vmlinuz-4.20.1 root=/dev/mapper/rl_vm11-root ro crashkernel=auto resume=/dev/mapper/rl_vm11-swap rd.lvm.lv=rl_vm11/root rd.lvm.lv=rl_vm11/swap console=ttyS0,115200n8
    6月 03 12:45:38 vm11 kernel: x86/fpu: Supporting XSAVE feature 0x001: 'x87 floating point registers'
    6月 03 12:45:38 vm11 kernel: x86/fpu: Supporting XSAVE feature 0x002: 'SSE registers'
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[003]
  設定ファイル(SysVinit) - 01 (/etc/inittab)
  
[内容]
  ## 作業内容
    設定ファイル(/etc/inittab)の確認
  
  書式
  --------------------------------------------------
  ID : ランレベル : アクション指示 : コマンド
  
  アクション指示
    boot        : システム起動時に実行、プロセス終了を待たずに次のプロセス起動
    bootwait    : システム起動時に実行、プロセス終了後に次のプロセス起動
    ctlaltdel   : Ctrl + Alt + Del、つまりSIGINT時に実行
    initdefault : デフォルトランレベル指定
    once        : 指定ランレベルで一度のみ実行、プロセス終了を待たずに次のプロセス起動
    respawn     : 指定プロセスが終了された場合、プロセスを再起動
    sysinit     : システム起動時に「boot」や「bootwait」よりも先に起動
    wait        : 指定ランレベルで一度のみ実行、プロセス終了後に次のプロセス起動
  --------------------------------------------------
  
[確認]
  vm16# cd $HOME
  vm16# cat /etc/inittab | grep -vE '^#'
  
  コマンドの実行結果
  --------------------------------------------------
  id:3:initdefault: -> デフォルトランレベルは「3」と設定
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[004]
  設定ファイル(SysVinit) - 02 (/etc/rcXX.d)
  
[内容]
  ## 作業内容
    ディレクトリ(/etc/rcXX.d)配下の起動・停止スクリプトを確認
  
[確認]
  vm16# cd $HOME
  vm16# cat /etc/inittab | grep -vE '^#'
  
  コマンドの実行結果
  --------------------------------------------------
  id:3:initdefault: -> デフォルトランレベルは「3」と設定
  --------------------------------------------------
  
  vm16# cd /etc/rc3.d
  vm16# ls -lh | grep sshd -> サンプルとして「sshd」サービスを確認
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx. 1 root root 14  4月 29 18:59 2023 S55sshd -> ../init.d/sshd
  --------------------------------------------------
  
  vm16# cd /etc/init.d
  vm16# head -n 5 sshd
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  #
  # sshd Start up the OpenSSH server daemon
  #
  # chkconfig: 2345 55 25 -> ランレベル「2,3,4,5」で開始スクリプト「S55」、終了スクリプト「K25」の名称
  --------------------------------------------------
  
  vm16# cd /etc/rc3.d
  vm16# ls -lh S55* -> 開始スクリプトを確認
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx. 1 root root 14  4月 29 18:59 2023 S55sshd -> ../init.d/sshd
  --------------------------------------------------
  
  vm16# cd /etc/rc0.d
  vm16# ls -lh K25* -> 終了スクリプトを確認
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx. 1 root root 14  4月 29 18:59 2023 K25sshd -> ../init.d/sshd
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[005]
  起動スクリプトとランレベル(SysVinit) - 01 (/etc/init.d/XX)
  
[内容]
  ## 作業内容
    サービスの起動・停止・再起動等を確認
  
[確認]
  vm16# cd /etc/init.d
  vm16# ls -lh sshd
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxr-xr-x. 1 root root 4.6K  9月  1 02:40 2017 sshd -> このサービスで確認を行う
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# /etc/init.d/sshd status -> サービス状態
  
  コマンドの実行結果
  --------------------------------------------------
  openssh-daemon (pid  1137) を実行中...
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# /etc/init.d/sshd stop -> サービス停止
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を停止中: [  OK  ]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# /etc/init.d/sshd start -> サービス開始
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を起動中: [  OK  ]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# /etc/init.d/sshd restart -> サービス再起動
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を停止中: [  OK  ]
  sshd を起動中: [  OK  ]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# /etc/init.d/sshd condrestart -> サービス起動時のみ再起動
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を停止中: [  OK  ]
  sshd を起動中: [  OK  ]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# /etc/init.d/sshd reload -> 設定の再読込
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を再読み込み中: [  OK  ]
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[006]
  起動スクリプトとランレベル(SysVinit) - 02 (service)
  
[内容]
  ## 作業内容
    サービスの起動・停止・再起動等をコマンド(service)で確認
  
[確認]
  vm16# cd $HOME
  vm16# service sshd status
  
  コマンドの実行結果
  --------------------------------------------------
  openssh-daemon (pid  1102) を実行中...
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# service sshd stop
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を停止中: [  OK  ]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# service sshd start
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を起動中: [  OK  ]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# service sshd restart
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を停止中: [  OK  ]
  sshd を起動中: [  OK  ]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# service sshd condrestart
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を停止中: [  OK  ]
  sshd を起動中: [  OK  ]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# service sshd reload
  
  コマンドの実行結果
  --------------------------------------------------
  sshd を再読み込み中: [  OK  ]
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[007]
  サービスの自動起動(SysVinit) - 01 (link)
  
[内容]
  ## 作業内容
    サービスの自動起動設定を行う
  
[確認]
  vm16# cd /etc/init.d
  vm16# head -n 5 sshd
  
  コマンドの実行結果
  --------------------------------------------------
  #!/bin/bash
  #
  # sshd Start up the OpenSSH server daemon
  #
  # chkconfig: 2345 55 25 -> ランレベル「2,3,4,5」で開始スクリプト「S55」、終了スクリプト「K25」の名称
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# ln -s /etc/init.d/sshd /etc/rc3.d/S55sshd
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# ln -s /etc/init.d/sshd /etc/rc0.d/K25sshd
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[008]
  サービスの自動起動(SysVinit) - 02 (chkconfig)
  
[内容]
  ## 作業内容
    サービスの自動起動設定を行う
  
[確認]
  vm16# cd $HOME
  vm16# chkconfig --list -> 全サービス・全ランレベルの自動起動設定を表示
  
  コマンドの実行結果
  --------------------------------------------------
  auditd            0:off  1:off  2:on   3:on   4:on   5:on   6:off
  blk-availability  0:off  1:on   2:on   3:on   4:on   5:on   6:off
  crond             0:off  1:off  2:on   3:on   4:on   5:on   6:off
  ip6tables         0:off  1:off  2:on   3:on   4:on   5:on   6:off
  iptables          0:off  1:off  2:on   3:on   4:on   5:on   6:off
  iscsi             0:off  1:off  2:off  3:on   4:on   5:on   6:off
  iscsid            0:off  1:off  2:off  3:on   4:on   5:on   6:off
  lvm2-monitor      0:off  1:on   2:on   3:on   4:on   5:on   6:off
  mdmonitor         0:off  1:off  2:on   3:on   4:on   5:on   6:off
  multipathd        0:off  1:off  2:off  3:off  4:off  5:off  6:off
  netconsole        0:off  1:off  2:off  3:off  4:off  5:off  6:off
  netfs             0:off  1:off  2:off  3:on   4:on   5:on   6:off
  network           0:off  1:off  2:on   3:on   4:on   5:on   6:off
  postfix           0:off  1:off  2:on   3:on   4:on   5:on   6:off
  rdisc             0:off  1:off  2:off  3:off  4:off  5:off  6:off
  restorecond       0:off  1:off  2:off  3:off  4:off  5:off  6:off
  rsyslog           0:off  1:off  2:on   3:on   4:on   5:on   6:off
  saslauthd         0:off  1:off  2:off  3:off  4:off  5:off  6:off
  sshd              0:off  1:off  2:on   3:on   4:on   5:on   6:off
  udev-post         0:off  1:on   2:on   3:on   4:on   5:on   6:off
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# chkconfig --list sshd -> サービス指定で自動起動設定を表示
  
  コマンドの実行結果
  --------------------------------------------------
  sshd              0:off  1:off  2:on   3:on   4:on   5:on   6:off
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# chkconfig sshd off -> ランレベル無指定の場合は「2, 3, 4, 5」が処理対象
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# chkconfig --list sshd
  
  コマンドの実行結果
  --------------------------------------------------
  sshd              0:off  1:off  2:off  3:off  4:off  5:off  6:off
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# chkconfig sshd on -> ランレベル無指定の場合は「2, 3, 4, 5」が処理対象
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# chkconfig --list sshd
  
  コマンドの実行結果
  --------------------------------------------------
  sshd              0:off  1:off  2:on   3:on   4:on   5:on   6:off
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# chkconfig --level 3 sshd off -> ランレベル指定でサービスの自動起動を無効
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# chkconfig --level 3 sshd on -> ランレベル指定でサービスの自動起動を有効
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[009]
  起動手順(Systemd)
  
[内容]
  ## 作業内容
    ターゲット(default.target)を追跡する
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun  3 14:05:11 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo find /etc -name default.target
    
    コマンドの実行結果
    --------------------------------------------------
    /etc/systemd/system/default.target
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /etc/systemd/system/default.target -> ターゲットの実体
    
    コマンドの実行結果
    --------------------------------------------------
    lrwxrwxrwx. 1 root root 41  5月 28 11:47 /etc/systemd/system/default.target -> /usr/lib/systemd/system/multi-user.target
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl get-default
    
    コマンドの実行結果
    --------------------------------------------------
    multi-user.target
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl list-dependencies default.target
    
    コマンドの実行結果
    --------------------------------------------------
    default.target(multi-user.target)
    ●|-- auditd.service
    ●|-- chronyd.service
    ●|-- crond.service
    ...
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[010]
  サービスの管理(Systemd) - 01
  
[内容]
  ## 作業内容
    サービスの起動・停止・再起動等を確認 -> サンプル「sshd」サービスを確認
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun Jun  4 08:31:39 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl status sshd -> サービス状態
    
    コマンドの実行結果
    --------------------------------------------------
    ● sshd.service - OpenSSH server daemon
       Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled; vendor preset: enabled)
       Active: active (running) since 月 2023-04-17 09:57:28 JST; 28min ago -> 稼働中(active)を確認
       ...
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /usr/lib/systemd/system/sshd.service -> サービス定義を参照
    
    コマンドの実行結果
    --------------------------------------------------
    [Unit]
    Description=OpenSSH server daemon
    Documentation=man:sshd(8) man:sshd_config(5)
    After=network.target sshd-keygen.service  // network.target,sshd-keygen.serviceが開始後に本サービス起動
    Wants=sshd-keygen.service                 // sshd-keygen.serviceが起動失敗でも本サービス起動
    
    [Service]
    Type=notify
    EnvironmentFile=/etc/sysconfig/sshd  // 本サービスの設定ファイル
    ExecStart=/usr/sbin/sshd -D $OPTIONS
    ExecReload=/bin/kill -HUP $MAINPID
    KillMode=process
    Restart=on-failure
    RestartSec=42s
    
    [Install]
    WantedBy=multi-user.target  // 所属ターゲット
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl is-active sshd -> サービス起動確認
    
    コマンドの実行結果
    --------------------------------------------------
    active
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl is-enabled sshd -> サービス自動起動確認
    
    コマンドの実行結果
    --------------------------------------------------
    enabled -> 自動起動が有効
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /etc/systemd/system/multi-user.target.wants | grep sshd -> 所属ターゲット確認
    
    コマンドの実行結果
    --------------------------------------------------
    lrwxrwxrwx. 1 root root 36  5月 28 11:42 sshd.service -> /usr/lib/systemd/system/sshd.service
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[011]
  サービスの管理(Systemd) - 02
  
[内容]
  ## 作業内容
    検索条件に合致するサービスの検索を行う
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun Jun  4 08:34:19 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl --no-pager list-units -t target | head -n 3
    
    コマンドの実行結果
    --------------------------------------------------
    UNIT               LOAD    ACTIVE  SUB     DESCRIPTION
    basic.target       loaded  active  active  Basic System
    cryptsetup.target  loaded  active  active  Local Encrypted Volumes
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl --no-pager list-units -t service | head -n 3
    
    コマンドの実行結果
    --------------------------------------------------
    UNIT            LOAD    ACTIVE  SUB      DESCRIPTION                                                                  
    auditd.service  loaded  active  running  Security Auditing Service                                                    
    crond.service   loaded  active  running  Command Scheduler                                                            
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl --no-pager list-timers
    
    コマンドの実行結果
    --------------------------------------------------
    NEXT                         LEFT           LAST                         PASSED        UNIT                          ACTIVATES
    Sun 2023-06-04 08:50:00 JST  2min 32s left  Sun 2023-06-04 08:40:06 JST  7min ago      sysstat-collect.timer         sysstat-collect.service
    Sun 2023-06-04 09:36:52 JST  49min left     n/a                          n/a           dnf-makecache.timer           dnf-makecache.service
    Mon 2023-06-05 00:07:00 JST  15h left       n/a                          n/a           sysstat-summary.timer         sysstat-summary.service
    Mon 2023-06-05 08:45:33 JST  23h left       Sun 2023-06-04 08:45:33 JST  1min 53s ago  systemd-tmpfiles-clean.timer  systemd-tmpfiles-clean.service
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl --no-pager list-unit-files -t target | head -n 3
    
    コマンドの実行結果
    --------------------------------------------------
    UNIT FILE         STATE   
    basic.target      static  
    bluetooth.target  static  
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl --no-pager list-unit-files -t service | head -n 3
    
    コマンドの実行結果
    --------------------------------------------------
    UNIT FILE           STATE   
    arp-ethers.service  disabled
    auditd.service      enabled 
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl --no-pager list-timers --all | head -n 3
    
    コマンドの実行結果
    --------------------------------------------------
    NEXT                         LEFT        LAST                         PASSED        UNIT                   ACTIVATES
    Sun 2023-06-04 09:00:00 JST  7min left   Sun 2023-06-04 08:50:11 JST  2min 39s ago  sysstat-collect.timer  sysstat-collect.service
    Sun 2023-06-04 09:36:52 JST  44min left  n/a                          n/a           dnf-makecache.timer    dnf-makecache.service
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[012]
  Unit設定ファイル(Systemd)
  
[内容]
  ## 作業内容
    サービス作成とシステム登録を行う
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun Jun  4 08:43:02 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ vi scripts/script05.sh -> スクリプト作成
    
    コマンドの実行結果
    --------------------------------------------------
    #!/bin/bash
    
    log=/home/makoto/script.log
    value1=1
    value2=9
    
    if test -f $log ; then
      rm -f $log
      touch $log
    fi
    
    while [ $value1 -le $value2 ]
    do
      echo "$value1 : $(date +%Y/%m/%d-%H:%M:%S)" >> $log
      value1=$((value1+1))
      sleep 1
    done
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ chmod 777 scripts/script05.sh -> 実行権限
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script05.sh -> スクリプト実行
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat script.log -> ログ確認
    
    コマンドの実行結果
    --------------------------------------------------
    1 : 2023/06/04-09:36:55
    2 : 2023/06/04-09:36:56
    3 : 2023/06/04-09:36:57
    4 : 2023/06/04-09:36:58
    5 : 2023/06/04-09:36:59
    6 : 2023/06/04-09:37:00
    7 : 2023/06/04-09:37:01
    8 : 2023/06/04-09:37:02
    9 : 2023/06/04-09:37:03
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /usr/lib/systemd/system/onion.service -> サービス定義ファイル
    
    コマンドの実行結果
    --------------------------------------------------
    [Unit]
    Description=onion.service -> サービス名は野菜(タマネギ)から命名
    
    [Service]
    Type=simple
    ExecStart=/home/makoto/scripts/script05.sh
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl daemon-reload -> サービスをシステム登録
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl status onion -> システム上のサービス認識を確認
    
    コマンドの実行結果
    --------------------------------------------------
    ● onion.service
       Loaded: loaded (/usr/lib/systemd/system/onion.service; static; vendor preset>
       Active: inactive (dead)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl start onion -> サービス実行
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat script.log
    
    コマンドの実行結果
    --------------------------------------------------
    1 : 2023/06/04-10:23:38
    2 : 2023/06/04-10:23:39
    3 : 2023/06/04-10:23:40
    4 : 2023/06/04-10:23:41
    5 : 2023/06/04-10:23:42
    6 : 2023/06/04-10:23:43
    7 : 2023/06/04-10:23:44
    8 : 2023/06/04-10:23:45
    9 : 2023/06/04-10:23:46
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ journalctl --no-pager -u onion
    
    コマンドの実行結果
    --------------------------------------------------
    -- Logs begin at Sun 2023-06-04 08:30:18 JST, end at Sun 2023-06-04 10:23:47 JST. --
    6月 04 10:23:38 vm11 systemd[1]: Started onion.service.
    6月 04 10:23:47 vm11 systemd[1]: onion.service: Succeeded.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[013]
  Systemdのログ - 01 (journalctl)
  
[内容]
  ## 作業内容
    コマンド(journalctl)でジャーナル表示を行う
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun Jun  4 09:04:29 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ vi scripts/script06.sh -> スクリプト作成
    
    コマンドの実行結果
    --------------------------------------------------
    #!/bin/bash
    
    for i in $(seq 1 $1) ; do
      echo "script06 - $(date "+%Y/%m/%d %H:%M:%S") - $i"
      sleep 1
    done
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ bash scripts/script06.sh 3 -> スクリプト実行
    
    コマンドの実行結果
    --------------------------------------------------
    script06 - 2023/06/04 12:20:36 - 1
    script06 - 2023/06/04 12:20:37 - 2
    script06 - 2023/06/04 12:20:38 - 3
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemd-cat bash scripts/script06.sh 9 & -> コマンド実行結果をジャーナル出力
    
    コマンドの実行結果
    --------------------------------------------------
    [1] 1172
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ journalctl --follow(-f) -> 末尾を表示し続ける
    
    コマンドの実行結果
    --------------------------------------------------
    ...
    6月 04 12:23:41 vm11 bash[1172]: script06 - 2023/06/04 12:23:41 - 8
    6月 04 12:23:42 vm11 bash[1172]: script06 - 2023/06/04 12:23:42 - 9
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ journalctl --no-pager --unit(-u) onion -> 指定サービスのジャーナル表示
    
    コマンドの実行結果
    --------------------------------------------------
    -- Logs begin at Sun 2023-06-04 12:10:10 JST, end at Sun 2023-06-04 12:32:51 JST. --
    6月 04 12:32:42 vm11 systemd[1]: Started onion.service.
    6月 04 12:32:51 vm11 systemd[1]: onion.service: Succeeded.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ journalctl --no-pager --reverse(-r) --unit(-u) onion -> 末尾を先頭に表示
    
    コマンドの実行結果
    --------------------------------------------------
    -- Logs begin at Sun 2023-06-04 12:10:10 JST, end at Sun 2023-06-04 12:32:51 JST. --
    6月 04 12:32:51 vm11 systemd[1]: onion.service: Succeeded.
    6月 04 12:32:42 vm11 systemd[1]: Started onion.service.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ journalctl --dmesg(-k) --pager-end(-e) -> カーネルメッセージの末尾表示
    
    コマンドの実行結果
    --------------------------------------------------
    ...
    6月 04 12:10:16 vm11 kernel: iTCO_wdt: initialized. heartbeat=30 sec (nowayout>
    6月 04 12:10:17 vm11 kernel: IPv6: ADDRCONF(NETDEV_UP): enp1s0: link is not re>
    --------------------------------------------------
    
    vm11$ cd $HOME/service2
    vm11$ journalctl --priority(-p) info --pager-end(-e) -> 指定プライオリティ以上のジャーナルを末尾表示
    
    コマンドの実行結果
    --------------------------------------------------
    ...
    6月 04 12:40:20 vm11 systemd[1]: sysstat-collect.service: Succeeded.
    6月 04 12:40:20 vm11 systemd[1]: Started system activity accounting tool.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ journalctl --boot(-b) --pager-end(-e) -> システム起動のジャーナル表示
    
    コマンドの実行結果
    --------------------------------------------------
    ...
    6月 04 12:40:20 vm11 systemd[1]: sysstat-collect.service: Succeeded.
    6月 04 12:40:20 vm11 systemd[1]: Started system activity accounting tool.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[014]
  Systemdのログ - 02 (/etc/systemd/journalctld.conf)
  
[内容]
  ## 作業内容
    ジャーナルの永続保持を行う
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sun Jun  4 12:11:00 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /run/log/journal/$(cat /etc/machine-id) -> ジャーナルファイルの実体確認
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r-----+ 1 root systemd-journal 8.0M  6月  4 12:58 system.journal
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir -p /var/log/journal -> 永続的なジャーナル保持のディレクトリ作成
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/systemd/journald.conf -> 設定ファイル修正
    
    コマンドの実行結果
    --------------------------------------------------
    [Journal]
    Storage=persistent  // 修正 - ジャーナルを永続的に保存
    SystemMaxUse=100M   // 修正 - 最大容量は100MB
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl restart systemd-journald -> サービス再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /var/log/journal/$(cat /etc/machine-id)
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r----- 1 root root 8.0M  6月  4 13:03 system.journal -> ジャーナルが永続保持
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[015]
  ブートローダー(Grub Legacy) - 01
  
[内容]
  ## 作業内容
    ブートローダー(Grub Legacy)の各ステージのファイルを確認する
  
  ## 各ステージのファイル
    01. /boot/grub/stage1
    02. /boot/grub/(ファイルシステム名)_stage1_5
    03. /boot/grub/stage2
  
[確認]
  vm16# cd $HOME
  vm16# ls -lh /boot/grub
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root   63  4月 29 19:00 2023 device.map -> デバイス(hd0) = /dev/vda
  -rw-r--r--. 1 root root  14K  4月 29 19:00 2023 e2fs_stage1_5
  -rw-r--r--. 1 root root  13K  4月 29 19:00 2023 fat_stage1_5
  -rw-r--r--. 1 root root  12K  4月 29 19:00 2023 ffs_stage1_5
  -rw-------. 1 root root  830  4月 29 19:05 2023 grub.conf -> 設定ファイル
  -rw-r--r--. 1 root root  12K  4月 29 19:00 2023 iso9660_stage1_5
  -rw-r--r--. 1 root root  13K  4月 29 19:00 2023 jfs_stage1_5
  lrwxrwxrwx. 1 root root   11  4月 29 19:00 2023 menu.lst -> ./grub.conf -> 設定ファイル
  -rw-r--r--. 1 root root  12K  4月 29 19:00 2023 minix_stage1_5
  -rw-r--r--. 1 root root  15K  4月 29 19:00 2023 reiserfs_stage1_5
  -rw-r--r--. 1 root root 1.4K 11月 15 03:01 2010 splash.xpm.gz
  -rw-r--r--. 1 root root  512  4月 29 19:00 2023 stage1
  -rw-r--r--. 1 root root 124K  4月 29 19:00 2023 stage2
  -rw-r--r--. 1 root root  12K  4月 29 19:00 2023 ufs2_stage1_5
  -rw-r--r--. 1 root root  12K  4月 29 19:00 2023 vstafs_stage1_5
  -rw-r--r--. 1 root root  14K  4月 29 19:00 2023 xfs_stage1_5
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[016]
  ブートローダー(Grub Legacy) - 02
  
[内容]
  ## 作業内容
    ブートローダー(Grub Legacy)の設定ファイル(/boot/grub/menu.lst)を確認
  
[確認]
  vm16# cd $HOME
  vm16# lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                             MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  sr0                               11:0     1  1024M   0  rom   
  vda                              252:0     0    20G   0  disk  
   |-- vda1                        252:1     0  500M    0  part  /boot
   |-- vda2                        252:2     0  19.5G   0  part  
        |-- vg_vm16-lv_root (dm-0) 253:0     0  17.6G   0  lvm   /
        |-- vg_vm16-lv_swap (dm-1) 253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# grep -vE '^#' /boot/grub/device.map -> マッピング確認
  
  コマンドの実行結果
  --------------------------------------------------
  (hd0)  /dev/vda -> GRUB上では「/dev/vda」が「hd0」と表記
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# grep -vE '^#' /boot/grub/menu.lst
  
  コマンドの実行結果
  --------------------------------------------------
  default=0
  timeout=5
  splashimage=(hd0,0)/grub/splash.xpm.gz
  hiddenmenu
  title CentOS 6 (2.6.32-754.el6.x86_64)
    root (hd0,0)                       -> パーティション指定 (hd0,0) = /dev/vda1 = /boot
    kernel                             -> カーネル設定
      /vmlinuz-2.6.32-754.el6.x86_64   -> カーネル本体
      ro                               -> 読み取り専用
      root=/dev/mapper/vg_vm16-lv_root -> カーネルが起動するルートファイルシステム
      rd_LVM_LV=vg_vm16/lv_swap
      rd_NO_LUKS
      rd_NO_MD
      crashkernel=auto
      KEYBOARDTYPE=pc
      KEYTABLE=jp106
      LANG=ja_JP.UTF-8
      rd_LVM_LV=vg_vm16/lv_root
      rd_NO_DM
      rhgb
      quiet
      console=tty0 console=ttyS0,115200n8  -> コンソール接続
    initrd                                 -> 初期RAMディスク設定
      /initramfs-2.6.32-754.el6.x86_64.img -> 初期RAMディスク本体
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[017]
  ブートローダー(Grub Legacy) - 03
  
[内容]
  ## 作業内容
    ブートローダー(Grub Legacy)のシェル機能を使用する
  
[確認]
  vm16# cd $HOME
  vm16# grub --version
  
  コマンドの実行結果
  --------------------------------------------------
  grub (GNU GRUB 0.97)
  --------------------------------------------------
  
  vm16# cd $HOME
  vm16# grub -> シェル起動
  
  コマンドの実行結果
  --------------------------------------------------
  (プロンプト変化)
  --------------------------------------------------
    
    grub> 
    grub> help -> コマンド一覧を表示
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    grub> 
    grub> root (hd0,0) -> 操作上の起点を設定 -> (hd0,0) = /dev/vda1 = /boot
    
    コマンドの実行結果
    --------------------------------------------------
    Filesystem type is ext2fs, partition type 0x83
    --------------------------------------------------
    
    grub> 
    grub> cat (/boot)/grub/device.map -> ファイル内容を表示
    
    コマンドの実行結果
    --------------------------------------------------
    (hd0)  /dev/vda -> GRUB上では「/dev/vda」が「hd0」と表記
    --------------------------------------------------
    
    grub> 
    grub> quit -> シェル終了
    
    コマンドの実行結果
    --------------------------------------------------
    quit -> OSに戻る
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[018]
  ブートローダー(Grub Legacy) - 04
  
[内容]
  ## 作業内容
    ブートローダーのシェル機能からカーネルを手動起動する
  
  ## 日本語キーボード(106)と英語キーボード(101)の対応表 -> 英字は同じ
    (106) 1         -> 1 (101)
    (106) Shift + 1 -> ! (101)
    (106) 2         -> 2 (101)
    (106) Shift + 2 -> @ (101)
    (106) 3         -> 3 (101)
    (106) Shift + 3 -> # (101)
    (106) 4         -> 4 (101)
    (106) Shift + 4 -> $ (101)
    (106) 5         -> 5 (101)
    (106) Shift + 5 -> % (101)
    (106) 6         -> 6 (101)
    (106) Shift + 6 -> ^ (101)
    (106) 7         -> 7 (101)
    (106) Shift + 7 -> & (101)
    (106) 8         -> 8 (101)
    (106) Shift + 8 -> * (101)
    (106) 9         -> 9 (101)
    (106) Shift + 9 -> ( (101)
    (106) 0         -> 0 (101)
    (106) Shift + 0 -> ) (101)
    (106) -         -> - (101)
    (106) Shift + - -> _ (101)
    (106) ^         -> = (101)
    (106) Shift + ^ -> + (101)
    (106) \         ->   (101) 該当キーなし
    (106) Shift + \ ->   (101) 該当キーなし
    (106) @         -> [ (101)
    (106) Shift + @ -> { (101)
    (106) [         -> ] (101)
    (106) Shift + [ -> } (101)
    (106) ;         -> ; (101)
    (106) Shift + ; -> : (101)
    (106) :         -> ' (101)
    (106) Shift + : -> " (101)
    (106) ]         -> \ (101)
    (106) Shift + ] -> | (101)
    (106) ,         -> , (101)
    (106) Shift + , -> < (101)
    (106) .         -> . (101)
    (106) Shift + . -> > (101)
    (106) /         -> / (101)
    (106) Shift + / -> ? (101)
    (106) \         ->   (101) 該当キーなし
    (106) Shift + \ ->   (101) 該当キーなし
  
[確認]
  
  ==================================================
  ・端末上ではブートローダーのシェル起動失敗
  ・仮想マシンマネージャー上で「e」から「c」キーの順番でシェル起動
  ==================================================
  
  grub> 
  grub> root (hd0,0) -> 操作の起点
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  grub> 
  grub> kernel
      > /vmlinuz-2.6.32-754.el6.x86_64    // カーネル本体
      > ro                                // 読み取り専用
      > root=/dev/mapper/vg_vm16-lv_root  // カーネルが起動するルートファイルシステム
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
    grub> 
    grub> initrd /initramfs-2.6.32-754.el6.x86_64.img -> 初期RAMディスク本体
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    grub> 
    grub> boot -> システム起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ログインプロンプト表示
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[019]
  ブートローダー(Grub2) - 01
  
[内容]
  ## 作業内容
    ブートローダー(Grub2)のパラメータファイル(/boot/default/grub)から設定ファイル(grub.cfg)を生成
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo ls -lh /boot/grub2/grub.cfg
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 5.0K  4月 16 10:44 /boot/grub2/grub.cfg
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ cat /etc/default/grub -> パラメータファイル
  
  コマンドの実行結果
  --------------------------------------------------
  GRUB_TIMEOUT=5
  GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
  GRUB_DEFAULT=saved
  GRUB_DISABLE_SUBMENU=true
  GRUB_TERMINAL="serial console"
  GRUB_SERIAL_COMMAND="serial --speed=115200"
  GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=centos_vm11/root rd.lvm.lv=centos_vm11/swap console=ttyS0,115200n8"
  GRUB_DISABLE_RECOVERY="true"
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo grub2-mkconfig -o AAA.cfg -> 設定ファイル生成
  
  コマンドの実行結果
  --------------------------------------------------
  // 指定するべき本来の生成場所は /boot/grub2/grub.cfg が正しい
  
  Generating grub configuration file ...
  Found linux image: /boot/vmlinuz-4.15.3
  Found initrd image: /boot/initramfs-4.15.3.img
  Found linux image: /boot/vmlinuz-3.10.0-1160.el7.x86_64
  Found initrd image: /boot/initramfs-3.10.0-1160.el7.x86_64.img
  Found linux image: /boot/vmlinuz-0-rescue-9a873402a94f4530a872af79d68bdeb7
  Found initrd image: /boot/initramfs-0-rescue-9a873402a94f4530a872af79d68bdeb7.img
  [11739.860976] raid6: sse2x1   gen()  8378 MB/s
  [11739.878973] raid6: sse2x1   xor()  5472 MB/s
  [11739.896969] raid6: sse2x2   gen()  9300 MB/s
  [11739.914965] raid6: sse2x2   xor()  7126 MB/s
  [11739.932956] raid6: sse2x4   gen() 10828 MB/s
  [11739.950962] raid6: sse2x4   xor()  7851 MB/s
  [11739.952416] raid6: using algorithm sse2x4 gen() 10828 MB/s
  [11739.954651] raid6: .... xor() 7851 MB/s, rmw enabled
  [11739.956571] raid6: using ssse3x2 recovery algorithm
  [11740.012830] xor: automatically using best checksumming function   avx       
  [11740.269007] Btrfs loaded, crc32c=crc32c-intel
  [11740.317649] fuse init (API version 7.26)
  done
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo rm -f AAA.cfg
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[020]
  ブートローダー(Grub2) - 02
  
[内容]
  ## 作業内容
    ブートローダー(Grub2)のシェル機能でカーネルを手動起動する
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ cat /proc/cmdline -> システム起動時のカーネルパラメータ
  
  コマンドの実行結果
  --------------------------------------------------
  BOOT_IMAGE=/vmlinuz-4.15.3         // カーネル本体 -> (/boot)/vmlinuz-4.15.3
  root=/dev/mapper/centos_vm11-root  // パーティション指定
  ro                                 // 読み取り専用
  crashkernel=auto                   // 不明
  rd.lvm.lv=centos_vm11/root         // カーネルが起動するルートファイルシステム
  rd.lvm.lv=centos_vm11/swap         // スワップ領域
  console=ttyS0,115200n8             // コンソール接続
  LANG=ja_JP.UTF-8                   // 言語・国・文字コード
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo cat /boot/grub2/device.map -> デバイスマッピング
  
  コマンドの実行結果
  --------------------------------------------------
  (hd0)  /dev/vda -> GRUB2上では「/dev/vda」が「hd0」と表記
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo ls -lh /boot | grep -E 'vmlinuz|initram' | grep $(uname -r)
  
  コマンドの実行結果
  --------------------------------------------------
  lrwxrwxrwx. 1 root root   20  4月 16 10:40 vmlinuz -> /boot/vmlinuz-4.15.3
  -rw-r--r--. 1 root root 7.2M  4月 16 10:40 vmlinuz-4.15.3
  -rw-------. 1 root root  40M  4月 16 10:44 initramfs-4.15.3.img
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo systemctl reboot
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> システム選択時に「c」キー押下でシェル起動
  --------------------------------------------------
  
  grub> 
  grub> help -> コマンド一覧
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  grub> 
  grub> set root=(hd0,1) -> 操作の起点
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> (hd0,1) = /dev/vda1 = /boot -> Grub Legacy のシェルと異なるので注意
  --------------------------------------------------
  
  grub> 
  grub> linux
      > (/boot)/vmlinuz-4.15.3             // カーネル本体
      > root=/dev/mapper/centos_vm11-root  // パーティション指定
      > ro                                 // 読み取り専用
      > crashkernel=auto                   // 不明
      > rd.lvm.lv=centos_vm11/root         // カーネルが起動するルートファイルシステム
      > rd.lvm.lv=centos_vm11/swap         // スワップ領域
      > console=ttyS0,115200n8             // コンソール接続
      > LANG=ja_JP.UTF-8                   // 言語・国・文字コード
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  grub> 
  grub> initrd (/boot)/initramfs-4.15.3.img -> 初期RAMディスク本体
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  grub> 
  grub> boot -> システム起動
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> ログインプロンプト表示
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[021]
  Install USB - 01
  
[内容]
  ## 作業内容
    CentOS7のインストールUSBの作成を行う
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
[確認]
  $ cd /usr/local/src
  $ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 qemu qemu 1020264448 11月  3  2020 CentOS-7-x86_64-Minimal-2009.iso
  --------------------------------------------------
  
  $ cd $HOME
  $ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                   MAJ:MIN  RM    SIZE  RO  TYPE  MOUNTPOINT
  sr0                     11:0     1   1024M   0  rom   
  sda                      8:0     0  465.8G   0  disk  
   |-- sda1                8:1     0      1G   0  part  /boot
   |-- sda2                8:2     0  464.8G   0  part  
        |-- centos-root  253:0     0     50G   0  lvm   /
        |-- centos-swap  253:1     0    3.6G   0  lvm   [SWAP]
        |-- centos-home  253:2     0  411.1G   0  lvm   /home
  sdb                      8:16    1     15G   0  disk  
   |-- sdb1                8:17    1     15G   0  part  /run/media/makoto/CentOS 7 x86_64 (接続したUSBメモリ)
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo umount /dev/sdb1
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> アンマウントでシステム側からのアクセス排除
  --------------------------------------------------
  
  $ cd $HOME
  $ LANG=C sudo parted /dev/sdb -s print -> パーティション情報
  
  コマンドの実行結果
  --------------------------------------------------
  Model: ELECOM MF-MSU2B (scsi)
  Disk /dev/sdb: 16.0GB
  Sector size (logical/physical): 512B/512B
  Partition Table: msdos
  Disk Flags: 
  
  Number  Start   End     Size    Type     File system  Flags
  1       1049kB  16.0GB  16.0GB  primary               boot, lba
  --------------------------------------------------
  
  $ cd $HOME
  $ LANG=C sudo parted /dev/sdb -> パーティション修正
  
  コマンドの実行結果
  --------------------------------------------------
  GNU Parted 3.1
  Using /dev/sdb
  Welcome to GNU Parted! Type 'help' to view a list of commands.
  
  (parted) 
  (parted) rm 1 -> パーティション1を削除
  
  (parted) 
  (parted) mklabel msdos -> 管理方式をmsdos(MBR方式)に変更
  
  Warning: The existing disk label on /dev/sdb will be destroyed and all data on this disk will be lost.
  Do you want to continue? Yes/No? Yes (Yesを入力) -> 既存データが破壊されてもOK
  
  (parted) 
  (parted) mkpart -> パーティション作成
  
  Partition type?  primary/extended? primary
  File system type?  [ext2]? fat32 -> USBメモリのファイルシステム
  Start? 0G -> 開始セクタはUSBメモリの最初から
  End? 100% -> 終了セクタはUSBメモリの最後まで
  
  (parted) 
  (parted) set 1 boot on -> 起動フラグを付与
  
  (parted) 
  (parted) quit -> 対話モード終了
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo mkfs.vfat /dev/sdb1 -> ファイルシステム作成
  
  コマンドの実行結果
  --------------------------------------------------
  mkfs.fat 3.0.20 (12 Jun 2013)
  --------------------------------------------------
  
  $ cd $HOME
  $ LANG=C sudo parted /dev/sdb -s print -> パーティション情報
  
  コマンドの実行結果
  --------------------------------------------------
  Model: ELECOM MF-MSU2B (scsi)
  Disk /dev/sdb: 16.0GB
  Sector size (logical/physical): 512B/512B
  Partition Table: msdos
  Disk Flags: 
  
  Number  Start   End     Size    Type     File system  Flags
  1       1049kB  16.0GB  16.0GB  primary  fat32        boot, lba
  --------------------------------------------------
  
  $ cd /usr/local/src
  $ sudo dd if=CentOS-7-x86_64-Minimal-2009.iso of=/dev/sdb bs=512K && sync -> イメージファイルのコピー
  
  コマンドの実行結果
  --------------------------------------------------
  1946+0 レコード入力
  1946+0 レコード出力
  1020264448 バイト (1.0 GB) コピーされました、 158.773 秒、 6.4 MB/秒
  --------------------------------------------------
  
  $ cd $HOME
  $ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                   MAJ:MIN  RM    SIZE  RO  TYPE  MOUNTPOINT
  sr0                     11:0     1   1024M   0  rom   
  sda                      8:0     0  465.8G   0  disk  
   |-- sda1                8:1     0      1G   0  part  /boot
   |-- sda2                8:2     0  464.8G   0  part  
        |-- centos-root  253:0     0     50G   0  lvm   /
        |-- centos-swap  253:1     0    3.6G   0  lvm   [SWAP]
        |-- centos-home  253:2     0  411.1G   0  lvm   /home
  sdb                      8:16    1     15G   0  disk  
   |-- sdb1                8:17    1    973M   0  part  (インストール内容)
   |-- sdb2                8:18    1    8.6M   0  part  (パーティションが増える理由が不明)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[022]
  Install USB - 02 (Rocky Linux 8)
  
[内容]
  ## 作業内容
    Rocky-LinuxのインストールUSBの作成
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
[確認]
  $ cd /usr/local/src
  $ ls -lh | grep -i rocky
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-rw-r--. 1 makoto makoto  10G  1月 25 18:23 Rocky-8.5-x86_64-dvd1.iso     // 通常版
  -rw-rw-r--. 1 makoto makoto 2.0G  1月 25 18:28 Rocky-8.5-x86_64-minimal.iso  // 最小版
  --------------------------------------------------
  
  $ cd $HOME
  $ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                   MAJ:MIN  RM    SIZE  RO  TYPE  MOUNTPOINT
  sr0                     11:0     1   1024M   0  rom   
  sda                      8:0     0  465.8G   0  disk  
   |-- sda1                8:1     0      1G   0  part  /boot
   |-- sda2                8:2     0  464.8G   0  part  
        |-- centos-root  253:0     0     50G   0  lvm   /
        |-- centos-swap  253:1     0    3.6G   0  lvm   [SWAP]
        |-- centos-home  253:2     0  411.1G   0  lvm   /home
  sdb                      8:16    1     15G   0  disk  
   |-- sdb1                8:17    1    973M   0  part  /run/media/makoto/CentOS 7 x86_64 (接続したUSBメモリ)
   |-- sdb2                8:18    1    8.6M   0  part  
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo umount /dev/sdb1
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> アンマウントでシステム側からのアクセス排除
  --------------------------------------------------
  
  $ cd $HOME
  $ LANG=C sudo parted /dev/sdb -s print
  
  コマンドの実行結果
  --------------------------------------------------
  Model: ELECOM MF-MSU2B (scsi)
  Disk /dev/sdb: 16.0GB
  Sector size (logical/physical): 512B/512B
  Partition Table: msdos
  Disk Flags: 
  
  Number  Start   End     Size    Type     File system  Flags
  2       227kB   9239kB  9011kB  primary  fat16
  --------------------------------------------------
  
  $ cd $HOME
  $ LANG=C sudo parted /dev/sdb
  
  コマンドの実行結果
  --------------------------------------------------
  GNU Parted 3.1
  Using /dev/sdb
  Welcome to GNU Parted! Type 'help' to view a list of commands.
  
  (parted) 
  (parted) rm 2 -> パーティション2を削除
  
  (parted) 
  (parted) mklabel msdos -> 管理方式をmsdos(MBR方式)に変更
  
  Warning: The existing disk label on /dev/sdb will be destroyed and all data on this disk will be lost.
  Do you want to continue? Yes/No? Yes (Yesを入力) -> 既存データが破壊されてもOK
  
  (parted) 
  (parted) mkpart -> パーティション作成
  
  Partition type?  primary/extended? primary
  File system type?  [ext2]? fat32 -> USBメモリのファイルシステム
  Start? 0G -> 開始セクタはUSBメモリの最初から
  End? 100% -> 終了セクタはUSBメモリの最後まで
  
  (parted) 
  (parted) set 1 boot on -> 起動フラグを付与
  
  (parted) 
  (parted) quit -> 対話モード終了
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo mkfs.vfat /dev/sdb1
  
  コマンドの実行結果
  --------------------------------------------------
  mkfs.fat 3.0.20 (12 Jun 2013)
  --------------------------------------------------
  
  $ cd $HOME
  $ LANG=C sudo parted /dev/sdb -s print
  
  コマンドの実行結果
  --------------------------------------------------
  Model: ELECOM MF-MSU2B (scsi)
  Disk /dev/sdb: 16.0GB
  Sector size (logical/physical): 512B/512B
  Partition Table: msdos
  Disk Flags: 
  
  Number  Start   End     Size    Type     File system  Flags
  1       1049kB  16.0GB  16.0GB  primary  fat32        boot, lba
  --------------------------------------------------
  
  $ cd /usr/local/src
  $ sudo dd if=Rocky-8.5-x86_64-dvd1.iso of=/dev/sdb bs=512K && sync -> イメージファイルのコピー
  
  コマンドの実行結果
  --------------------------------------------------
  1946+0 レコード入力
  1946+0 レコード出力
  1020264448 バイト (1.0 GB) コピーされました、 158.773 秒、 6.4 MB/秒
  --------------------------------------------------
  
  $ cd $HOME
  $ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                   MAJ:MIN  RM    SIZE  RO  TYPE  MOUNTPOINT
  sr0                     11:0     1   1024M   0  rom   
  sda                      8:0     0  465.8G   0  disk  
   |-- sda1                8:1     0      1G   0  part  /boot
   |-- sda2                8:2     0  464.8G   0  part  
        |-- centos-root  253:0     0     50G   0  lvm   /
        |-- centos-swap  253:1     0    3.6G   0  lvm   [SWAP]
        |-- centos-home  253:2     0  411.1G   0  lvm   /home
  sdb                      8:16    1     15G   0  disk  
   |-- sdb1                8:17    1     10G   0  part  (インストール内容)
   |-- sdb2                8:18    1    9.6M   0  part  (パーティションが増える理由が不明)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[023]
  Install USB - 03
  
[内容]
  ## 作業内容
    システム起動が不能と想定して、レスキューモードでシステム修復
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
[確認]
  > インストールUSBをシステム接続後に電源投入
  > BIOSの起動順序を「HDD -> USB」から「USB -> HDD」に変更
  
  コマンドの実行結果
  --------------------------------------------------
  ・Install CentOS 7
  ・Test this media & Install CentOS 7
  ・Troubleshooting (レスキューモード)
  --------------------------------------------------
  
  > 上記で「Troubleshooting」を選択
  > メニュー表示
  
  コマンドの実行結果
  --------------------------------------------------
  ・Install CentOS 7 in basic graphics mode
  ・Rescue a CentOS system (レスキューモード)
  ・Run a memory test
  ・Boot from local drive
  ・Return to main menu
  --------------------------------------------------
  
  > 上記で「Rescue a CentOS system」を選択
  > メニュー表示
  
  コマンドの実行結果
  --------------------------------------------------
  // メッセージ表示 日本語訳
  
  レスキュー環境は貴方のLinux環境を「/mnt/sysimage」にマウントしようとしています。
  マウント先は変更することが可能です。
  
  メニューで「01」を選択の場合は、現在の手順で進みます。
  メニューで「02」を選択の場合は、現在の読み書き可能でのマウントを読み取り専用でマウントします。
  メニューで「03」を選択の場合は、シェルまでの手順を一気にスキップします。
  
  01: Continue (レスキューモード)
  02: Read-only mount
  03: Skip to shell
  04: Quit (Reboot)
  -------------------------------------------------- 
  
  > 上記で「Continue」を選択
  > レスキューモードのシェル起動
  
  コマンドの実行結果
  --------------------------------------------------
  (プロンプト変化)
  --------------------------------------------------
    
    sh-4.2# 
    sh-4.2# chroot /mnt/sysimage -> 操作起点をHDDのルートに変更
    
    コマンドの実行結果
    --------------------------------------------------
    (出力なし) -> サブシェル「/bin/bash」が起動、プロンプト「bash-4.2#」と記述
    --------------------------------------------------
      
      bash-4.2# 
      bash-4.2# ls -lh
      
      コマンドの実行結果
      --------------------------------------------------
      (省略) -> ルートディレクトリ配下のファイル群を確認
      --------------------------------------------------
      
      bash-4.2# 
      bash-4.2# exit
      
      コマンドの実行結果
      --------------------------------------------------
      (省略) -> 親シェルに戻る
      --------------------------------------------------
      
    sh-4.2# 
    sh-4.2# shutdown -h now
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> シャットダウン後に「インストールUSBをシステムから外す」のを忘れないこと
    --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
