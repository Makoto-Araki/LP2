================================================================================
[001] httpd - 基本設定
[002] httpd - サーバ情報の取得 - 01
[003] httpd - サーバ情報の取得 - 02
[004] httpd - アクセスログ
[005] httpd - エラーログ
[006] httpd - プログラム実行 - CGI
[007] httpd - リダイレクト
[008] httpd - バージョン情報
[009] httpd - 各ユーザーのホームディレクトリ公開
[010] httpd - アクセス制御
[011] httpd - 外部設定ファイル - 01
[012] httpd - 外部設定ファイル - 02
[013] httpd - 基本認証
[014] httpd - ダイジェスト認証
[015] httpd - ホストベースのアクセス制御 - 01
[016] httpd - ホストベースのアクセス制御 - 02
[017] httpd - バーチャルホスト
[018] httpd - SSL/TLS - 01
[019] httpd - SSL/TLS - 02
[020] httpd - SSL/TLS - 03
[021] httpd - ソフトウェア停止
[022] nginx - 基本設定
[023] nginx - アクセスログ
[024] nginx - エラーログ
[025] nginx - リダイレクト
[026] nginx - バージョン情報
[027] nginx - 各ユーザーのホームディレクトリ公開
[028] nginx - アクセス制御
[029] nginx - 基本認証
[030] nginx - ホストベースのアクセス制御
[031] nginx - バーチャルホスト
[032] nginx - SSL/TLS
[033] nginx - リバースプロキシ
[034] squid - 基本設定
[035] squid - フィルタリング(URL)
[036] squid - ソフトウェア停止
[X01] compile - 01
[X02] compile - 02
[X03] compile - 03
[X04] compile - 04
[X05] compile - 05
[X06] compile - 06
================================================================================
[001]
  httpd - 基本設定
  
[内容]
  ## 作業内容
    基本設定
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 19 11:46:58 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo firewall-cmd --list-all
    
    コマンドの実行結果
    --------------------------------------------------
    public
      target: default
      icmp-block-inversion: no
      interfaces: 
      sources: 
      services: cockpit dhcpv6-client dns http https iscsi-target ssh  // http, https を確認
      ports: 12865/tcp 12866/tcp
      protocols: 
      forward: no
      masquerade: no
      forward-ports: 
      source-ports: 
      icmp-blocks: 
      rich rules: 
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cp -p /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.org -> 設定ファイルのバックアップ
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"           // ルートディレクトリ
    Listen 80                         // 受付ポート
    Include conf.modules.d/*.conf     // モジュールロード => /etc/httpd/conf.modules.d/*.conf
    User apache                       // 実行ユーザー
    Group apache                      // 実行グループ
    ServerAdmin makoto@localhost      // 管理者メール
    ServerName www.avswa.com:80       // FQDN
    DocumentRoot "/var/www/html"      // ドキュメントルート
    ErrorLog "logs/error_log"         // エラーログ => /etc/httpd/logs/error_log
    LogLevel warn                     // ログレベル
    AddDefaultCharset UTF-8           // デフォルト文字コード
    ErrorDocument 404 /missing.html   // エラー画面 => /var/www/html/missing.html
    EnableSendfile on                 // 不明
    AccessFileName .htaccess          // 設定上書ファイル
    IncludeOptional conf.d/*.conf     // 追加設定
    
    <Directory />
      AllowOverride none              // 設定の上書不可
      Require all denied              // 全ホストがアクセス不可
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None              // 設定の上書不可
      Require all denied              // 全ホストがアクセス不可
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None              // 設定の上書不可
      Require all granted             // 全ホストがアクセス可能
      Options Indexes FollowSymLinks  // オプション有効 => DirectoryIndex
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None              // 設定の上書不可
      Require all granted             // 全ホストがアクセス可能
      Options None                    // 全オプション無効
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>単独サイト</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/missing.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>エラー画面</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl enable httpd
    
    コマンドの実行結果
    --------------------------------------------------
    Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl start httpd
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>単独サイト</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/aaa.html -> 存在しないファイル
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>エラー画面</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[002]
  httpd - サーバ情報の取得 - 01
  
[内容]
  ## 作業内容
    サーバ情報の取得 - 01
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 20 08:31:58 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep status -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    status_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>   // 追加
      SetHandler server-status  // 追加
    </Location>                 // 追加

    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ http://vm11.avswa.com/server-status -> ホスト側のブラウザから閲覧
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[003]
  httpd - サーバ情報の取得 - 02
  
[内容]
  ## 作業内容
    サーバ情報の取得 - 02
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 20 09:19:18 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep info -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    info_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
    </Location>
    
    <Location /server-info>   // 追加
      SetHandler server-info  // 追加
    </Location>               // 追加
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ http://vm11.avswa.com/server-info -> ホスト側のブラウザから閲覧
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[004]
  httpd - アクセスログ
  
[内容]
  ## 作業内容
    アクセスログ
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 20 10:10:52 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    …
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep log_config -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    log_config_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>単独サイト</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>単独サイト</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /etc/httpd/logs/access_log | tail -n 2
    
    コマンドの実行結果
    --------------------------------------------------
    ::1 - - [20/Jun/2023:10:32:39 +0900] "GET / HTTP/1.1" 200 51
    ::1 - - [20/Jun/2023:10:33:39 +0900] "GET / HTTP/1.1" 200 51
    
    %h  => ::1                           // リモートホスト
    %l  => -                             // リモートログ名
    %u  => -                             // ユーザー名
    %t  => [20/Jun/2023:10:32:39 +0900]  // 処理時刻
    %r  => "GET / HTTP/1.1"              // リクエストヘッダ
    %>s => 200                           // ステータスコード
    %b  => 51                            // バイト数
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[005]
  httpd - エラーログ
  
[内容]
  ## 作業内容
    エラーログ
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 20 10:32:10 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    ErrorLog "logs/error_log"
    LogLevel warn
    …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /etc/httpd/logs/error_log | tail
    
    コマンドの実行結果
    --------------------------------------------------
    [Tue Jun 20 09:29:58.990807 2023] [mpm_event:notice] [pid 828:tid 140015928953152] AH00493: SIGUSR1 received.  Doing graceful restart
    [Tue Jun 20 09:29:59.104822 2023] [lbmethod_heartbeat:notice] [pid 828:tid 140015928953152] AH02282: No slotmem from mod_heartmonitor
    [Tue Jun 20 09:29:59.106023 2023] [http2:warn] [pid 828:tid 140015928953152] AH02951: mod_ssl does not seem to be enabled
    [Tue Jun 20 09:29:59.107999 2023] [mpm_event:notice] [pid 828:tid 140015928953152] AH00489: Apache/2.4.37 (rocky) configured -- resuming normal operations
    [Tue Jun 20 09:29:59.108040 2023] [core:notice] [pid 828:tid 140015928953152] AH00094: Command line: '/usr/sbin/httpd -D FOREGROUND'
    [Tue Jun 20 09:50:07.068113 2023] [mpm_event:notice] [pid 828:tid 140015928953152] AH00493: SIGUSR1 received.  Doing graceful restart
    [Tue Jun 20 09:50:07.233972 2023] [lbmethod_heartbeat:notice] [pid 828:tid 140015928953152] AH02282: No slotmem from mod_heartmonitor
    [Tue Jun 20 09:50:07.234949 2023] [http2:warn] [pid 828:tid 140015928953152] AH02951: mod_ssl does not seem to be enabled
    [Tue Jun 20 09:50:07.247644 2023] [mpm_event:notice] [pid 828:tid 140015928953152] AH00489: Apache/2.4.37 (rocky) configured -- resuming normal operations
    [Tue Jun 20 09:50:07.247687 2023] [core:notice] [pid 828:tid 140015928953152] AH00094: Command line: '/usr/sbin/httpd -D FOREGROUND'
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[006]
  httpd - プログラム実行 - CGI
  
[内容]
  ## 作業内容
    プログラム実行 - CGI
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 20 08:14:53 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    …
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep alias -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    alias_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ which perl
    
    コマンドの実行結果
    --------------------------------------------------
    /usr/bin/perl
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/cgi-bin/file1.cgi -> CGI
    
    コマンドの実行結果
    --------------------------------------------------
    #!/usr/bin/perl
    
    print <<EOF;
    Content-type: text/html
    
    <html><body><h1>Hello World</h1></body></html>
    EOF
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chown apache:apache /var/www/cgi-bin/file1.cgi
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 700 /var/www/cgi-bin/file1.cgi
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/cgi-bin/file1.cgi
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Hello World</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[007]
  httpd - リダイレクト
  
[内容]
  ## 作業内容
    リダイレクト
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 20 10:51:08 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    Redirect / http://localhost/work1.html  // 追加
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
    </Location>
    
    <Location /server-info>
      SetHandler server-info
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/work1.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Work1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    <!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
    <html>
    <head>
    <title>302 Found</title>  // デフォルトではステータス(302)を返す模様
    </head>
    <body>
    <h1>Found</h1>
    <p>The document has moved <a href="http://localhost/work1.html">here</a></p>
    </body>
    </html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    Redirect / http://localhost/work1.html  // 削除
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rm /var/www/html/work1.html
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[008]
  httpd - バージョン情報
  
[内容]
  ## 作業内容
    バージョン情報
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 20 12:21:23 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl -I http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    //
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod  // 追加
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
    </Location>
    
    <Location /server-info>
      SetHandler server-info
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    //
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl -I http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    //
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[009]
  httpd - 各ユーザーのホームディレクトリ公開
  
[内容]
  ## 作業内容
    各ユーザーのホームディレクトリ公開
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 20 12:52:24 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo ls -lh /etc/httpd/conf.d
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r-- 1 root root  400  5月 18 01:28 README
    -rw-r--r-- 1 root root 2.9K  5月 18 01:28 autoindex.conf
    -rw-r--r-- 1 root root 1.3K  5月 18 01:26 userdir.conf
    -rw-r--r-- 1 root root  574  5月 18 01:26 welcome.conf
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /etc/httpd/conf.d/userdir.conf | grep -vE '^#|^.*#'
    
    コマンドの実行結果
    --------------------------------------------------
    <IfModule mod_userdir.c>
      UserDir disabled  // ホームディレクトリを公開しない
    </IfModule>
    
    <Directory "/home/*/public_html">
      AllowOverride FileInfo AuthConfig Limit Indexes
      Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
      Require method GET POST OPTIONS
    </Directory>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep userdir
    
    コマンドの実行結果
    --------------------------------------------------
    userdir_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /etc/skel/public_html -> スケルトンにディレクトリ追加
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo useradd user1
    vm11$ sudo useradd user2
    vm11$ sudo useradd user3
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ echo 'user1' | sudo passwd --stdin user1 1>/dev/null
    vm11$ echo 'user2' | sudo passwd --stdin user2 1>/dev/null
    vm11$ echo 'user3' | sudo passwd --stdin user3 1>/dev/null
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 711 /home/user1
    vm11$ sudo chmod 711 /home/user2
    vm11$ sudo chmod 711 /home/user3
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 755 /home/user1/public_html
    vm11$ sudo chmod 755 /home/user2/public_html
    vm11$ sudo chmod 755 /home/user3/public_html
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ su -c "echo '<html><body><h1>User1</h1></body></html>' >> ~user1/public_html/index.html" user1
    vm11$ su -c "echo '<html><body><h1>User2</h1></body></html>' >> ~user2/public_html/index.html" user2
    vm11$ su -c "echo '<html><body><h1>User3</h1></body></html>' >> ~user3/public_html/index.html" user3
    
    コマンドの実行結果
    --------------------------------------------------
    パスワード: (各ユーザーのパスワード入力)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf.d/userdir.conf
    
    コマンドの実行結果
    --------------------------------------------------
    <IfModule mod_userdir.c>
      UserDir public_html  // 修正 : disable => public_html
    </IfModule>
    
    <Directory "/home/*/public_html">
      AllowOverride All  // 修正 : FileInfo AuthConfig Limit Indexes => All
      Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
      Require method GET POST OPTIONS
    </Directory>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ getenforce
    
    コマンドの実行結果
    --------------------------------------------------
    Enforcing
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo setenforce 0 -> SELinux無効
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ su -c 'curl http://localhost/~user1/' user1
    vm11$ su -c 'curl http://localhost/~user2/' user2
    vm11$ su -c 'curl http://localhost/~user3/' user3
    
    コマンドの実行結果
    --------------------------------------------------
    // user1
    パスワード: (パスワード入力)
    <html><body><h1>User1</h1></body></html>

    // user2
    パスワード: (パスワード入力)
    <html><body><h1>User2</h1></body></html>
    
    // user3
    パスワード: (パスワード入力)
    <html><body><h1>User3</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/~user1/
    vm11$ curl http://localhost/~user2/
    vm11$ curl http://localhost/~user3/
    
    コマンドの実行結果
    --------------------------------------------------
    // user1
    <html><body><h1>User1</h1></body></html>
    
    // user2
    <html><body><h1>User2</h1></body></html>
    
    // user3
    <html><body><h1>User3</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[010]
  httpd - アクセス制御
  
[内容]
  ## 作業内容
    アクセス制御
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun 21 11:50:47 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/html/dirA">  // 追加
      AllowOverride None              // 追加
      Require all granted             // 追加 => 全ホストをアクセス可
      Options Indexes                 // 追加
    </Directory>                      // 追加
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None              // 追加
      Require all denied              // 追加 => 全ホストをアクセス不可
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None              // 追加
      Require all denied              // 追加 => 全ホストをアクセス不可
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /var/www/html/dirA
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/dirA/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirA</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirA/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirA</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/html/dirA">
      AllowOverride None
      Require all denied  // 修正 => 全ホストをアクセス不可
      Options Indexes
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirA/ -> アクセス不可
    
    コマンドの実行結果
    --------------------------------------------------
    <!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
    <html>
    <head>
    <title>403 Forbidden</title>
    </head>
    <body>
    <h1>Forbidden</h1>
    <p>You don't have permission to access this resource.</p>
    </body>
    </html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[011]
  httpd - 外部設定ファイル - 01
  
[内容]
  ## 作業内容
    外部設定ファイル - 01
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun 21 13:02:11 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/html/dirA">
      AllowOverride All  // 修正 : None -> All (.htaccess の全設定を有効)
      Require all denied
      Options Indexes
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirA/
    
    コマンドの実行結果
    --------------------------------------------------
    <!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
    <html>
    <head>
    <title>403 Forbidden</title>
    </head>
    <body>
    <h1>Forbidden</h1>
    <p>You don't have permission to access this resource.</p>
    </body>
    </html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/dirA/.htaccess
    
    コマンドの実行結果
    --------------------------------------------------
    Require all granted  // 全ホストをアクセス可能にする
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirA/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirA</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[012]
  httpd - 外部設定ファイル - 02
  
[内容]
  ## 作業内容
    外部設定ファイル - 02
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun 21 17:47:15 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/html/dirA">
      AllowOverride All  // 確認 :  All (.htaccess の全設定を有効)
      Require all denied
      Options Indexes
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/dirA/.htaccess
    
    コマンドの実行結果
    --------------------------------------------------
    Require all granted
    Options +ExecCGI            // 追加 : CGI実行可能
    AddHandler cgi-script .cgi  // 追加
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/dirA/file1.cgi
    
    コマンドの実行結果
    --------------------------------------------------
    #!/usr/bin/perl
    
    print <<EOF;
    Content-type: text/html
    
    <html><body><h1>Hello World</h1></body></html>
    EOF
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 755 /var/www/html/dirA/file1.cgi
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirA/file1.cgi
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Hello World</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[013]
  httpd - 基本認証
  
[内容]
  ## 作業内容
    基本認証
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 22 13:47:04 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep auth_basic -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    auth_basic_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/html/dirA">
      AllowOverride All
      Require all denied
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirB">         // 追加
      AuthType basic                         // 追加
      AuthName "Enter user and pass"         // 追加
      AuthUserFile /etc/httpd/conf/htpasswd  // 追加
      AllowOverride All                      // 追加
      Require valid-user                     // 追加
      Options Indexes                        // 追加
    </Directory>                             // 追加
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo htpasswd -c /etc/httpd/conf/htpasswd user1 -> 新規作成
    vm11$ sudo htpasswd /etc/httpd/conf/htpasswd user2    -> 追記
    vm11$ sudo htpasswd /etc/httpd/conf/htpasswd user3    -> 追記
    
    コマンドの実行結果
    --------------------------------------------------
    // user1
    New password: (user1)
    Re-type new password: (user1)
    Adding password for user user1
    
    // user2
    New password: (user2)
    Re-type new password: (user2)
    Adding password for user user2
    
    // user3
    New password: (user3)
    Re-type new password: (user3)
    Adding password for user user3
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /etc/httpd/conf/htpasswd
    
    コマンドの実行結果
    --------------------------------------------------
    user1:$apr1$Yj0PGaD5$i9rn8DYqtjrKmFvqzf0Ar.
    user2:$apr1$VkwgSRiP$OMjvy3mTjk3KS1W0hIkJV/
    user3:$apr1$lfCeU3jb$cjq.gOW3KQsFsEF6/IqWE.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /var/www/html/dirB
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 777 /var/www/html/dirB
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/dirB/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirB</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl -u user1:user1 http://localhost/dirB/ -> 基本認証でアクセス
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirB</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[014]
  httpd - ダイジェスト認証
  
[内容]
  ## 作業内容
    ダイジェスト認証
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 23 04:05:33 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep auth_digest -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    auth_digest_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/html/dirA">
      AllowOverride All
      Require all denied
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirB">
      AuthType basic
      AuthName "Enter user and pass"
      AuthUserFile /etc/httpd/conf/htpasswd
      AllowOverride All
      Require valid-user
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirC">         // 追加
      AuthType digest                        // 追加
      AuthName "dirC"                        // 追加
      AuthUserFile /etc/httpd/conf/htdigest  // 追加
      AllowOverride All                      // 追加
      Require valid-user                     // 追加
      Options Indexes                        // 追加
    </Directory>                             // 追加
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo htdigest -c /etc/httpd/conf/htdigest dirC user1 -> 新規作成
    vm11$ sudo htdigest /etc/httpd/conf/htdigest dirC user2    -> 追記
    vm11$ sudo htdigest /etc/httpd/conf/htdigest dirC user3    -> 追記
    
    コマンドの実行結果
    --------------------------------------------------
    // user1
    Adding password for user1 in realm dirC.
    New password: (user1)
    Re-type new password: (user1)
    
    // user2
    Adding user user2 in realm dirC
    New password: (user2)
    Re-type new password: (user2)
    
    // user3
    Adding user user3 in realm dirC
    New password: (user3)
    Re-type new password: (user3)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /etc/httpd/conf/htdigest
    
    コマンドの実行結果
    --------------------------------------------------
    user1:dirC:ee1168f854a34d087005f11bae88c9de
    user2:dirC:705e2348df687a8b438bde472ba0efca
    user3:dirC:dcb3cf47b3969fd8c251ba383f47b966
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /var/www/html/dirC
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 777 /var/www/html/dirC
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/dirC/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirC</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --digest -u user1:user1 http://localhost/dirC/ -> ダイジェスト認証でアクセス
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirC</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[015]
  httpd - ホストベースのアクセス制御 - 01
  
[内容]
  ## 作業内容
    ホストベースのアクセス制御 - 01
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 23 04:48:21 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep access_compat -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    access_compat_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/html/dirA">
      AllowOverride All
      Require all denied
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirB">
      AuthType basic
      AuthName "Enter user and pass"
      AuthUserFile /etc/httpd/conf/htpasswd
      AllowOverride All
      Require valid-user
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirC">
      AuthType digest
      AuthName "dirC"
      AuthUserFile /etc/httpd/conf/htdigest
      AllowOverride All
      Require valid-user
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirD">  // 追加
      AllowOverride All               // 追加
      Order allow,deny                // 追加
      Allow from all                  // 追加
      Deny from 192.168.122.12/32     // 追加
      Options Indexes                 // 追加
    </Directory>                      // 追加
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /var/www/html/dirD
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 777 /var/www/html/dirD
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/dirD/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirD</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirD/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirD</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jun 17 17:42:56 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl http://vm11.avswa.com/dirD/
    
    コマンドの実行結果
    --------------------------------------------------
    <!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
    <html>
    <head>
    <title>403 Forbidden</title>
    </head>
    <body>
    <h1>Forbidden</h1>
    <p>You don't have permission to access this resource.</p>
    </body>
    </html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[016]
  httpd - ホストベースのアクセス制御 - 02
  
[内容]
  ## 作業内容
    ホストベースのアクセス制御 - 02
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 23 05:06:42 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep authz_host -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    authz_host_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"
    ErrorLog "logs/error_log"
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <Directory "/var/www/html">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/html/dirA">
      AllowOverride All
      Require all denied
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirB">
      AuthType basic
      AuthName "Enter user and pass"
      AuthUserFile /etc/httpd/conf/htpasswd
      AllowOverride All
      Require valid-user
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirC">
      AuthType digest
      AuthName "dirC"
      AuthUserFile /etc/httpd/conf/htdigest
      AllowOverride All
      Require valid-user
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirD">
      AllowOverride All
      Order allow,deny
      Allow from all
      Deny from 192.168.122.12/32
      Options Indexes
    </Directory>
    
    <Directory "/var/www/html/dirE">  // 追加
      AllowOverride All               // 追加
      Require all denied              // 追加
      Require ip 192.168.122.12       // 追加
      Options Indexes                 // 追加
    </Directory>                      // 追加
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>
      DirectoryIndex index.html
    </IfModule>
    
    <IfModule alias_module>
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    </IfModule>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    
    <IfModule mime_magic_module>
      MIMEMagicFile conf/magic
    </IfModule>
    
    <IfModule log_config_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b" common
      CustomLog "logs/access_log" common
    </IfModule>
    
    <IfModule mime_module>
      TypesConfig /etc/mime.types
      AddType application/x-compress .Z
      AddType application/x-gzip .gz .tgz
      AddType text/html .shtml
      AddOutputFilter INCLUDES .shtml
    </IfModule>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /var/www/html/dirE
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 777 /var/www/html/dirE
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/html/dirE/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirE</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirE/
    
    コマンドの実行結果
    --------------------------------------------------
    <!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
    <html>
    <head>
    <title>403 Forbidden</title>
    </head>
    <body>
    <h1>Forbidden</h1>
    <p>You don't have permission to access this resource.</p>
    </body>
    </html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 23 05:20:39 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl http://vm11.avswa.com/dirE/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirE</h1></body></html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[017]
  httpd - バーチャルホスト
  
[内容]
  ## 作業内容
    名前ベースのバーチャルホスト
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 23 05:21:40 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep dir -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    dir_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep alias -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    alias_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep mime_magic -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    mime_magic_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep log_config -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    log_config_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep mime_module -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    mime_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf -> 設定ファイルを一新する
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerAdmin makoto@localhost                    // 削除
    ServerName www.avswa.com:80
    DocumentRoot "/var/www/html"                    // 削除
    ErrorLog "logs/error_log"                       // 削除
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    DirectoryIndex index.html                       // 追加
    ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"       // 追加
    MIMEMagicFile conf/magic                        // 追加
    LogFormat "%h %l %u %t \"%r\" %>s %b" common    // 追加
    TypesConfig /etc/mime.types                     // 追加
    AddType application/x-compress .Z               // 追加
    AddType application/x-gzip .gz .tgz             // 追加
    AddType text/html .shtml                        // 追加
    AddOutputFilter INCLUDES .shtml                 // 追加
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <VirtualHost *:80>                              // 追加
      ServerAdmin makoto@localhost                  // 追加
      ServerName site1.avswa.com:80                 // 追加
      DocumentRoot "/var/www/site1"                 // 追加
      ErrorLog "logs/site1_err_log"                 // 追加
      CustomLog "logs/site1_log" common             // 追加
    </VirtualHost>                                  // 追加
    
    <VirtualHost *:80>                              // 追加
      ServerAdmin makoto@localhost                  // 追加
      ServerName site2.avswa.com:80                 // 追加
      DocumentRoot "/var/www/site2"                 // 追加
      ErrorLog "logs/site2_err_log"                 // 追加
      CustomLog "logs/site2_log" common             // 追加
    </VirtualHost>                                  // 追加
    
    <Directory "/var/www/site1">                    // 追加
      AllowOverride None                            // 追加
      Require all granted                           // 追加
      Options Indexes FollowSymLinks                // 追加
    </Directory>                                    // 追加
    
    <Directory "/var/www/site2">                    // 追加
      AllowOverride None                            // 追加
      Require all granted                           // 追加
      Options Indexes FollowSymLinks                // 追加
    </Directory>                                    // 追加
    
    <Directory "/var/www/html">                     // 削除
      AllowOverride None                            // 削除
      Require all granted                           // 削除
      Options Indexes FollowSymLinks                // 削除
    </Directory>                                    // 削除
    
    <Directory "/var/www/html/dirA">                // 削除
      AllowOverride All                             // 削除
      Require all denied                            // 削除
      Options Indexes                               // 削除
    </Directory>                                    // 削除
    
    <Directory "/var/www/html/dirB">                // 削除
      AuthType basic                                // 削除
      AuthName "Enter user and pass"                // 削除
      AuthUserFile /etc/httpd/conf/htpasswd         // 削除
      AllowOverride All                             // 削除
      Require valid-user                            // 削除
      Options Indexes                               // 削除
    </Directory>                                    // 削除
    
    <Directory "/var/www/html/dirC">                // 削除
      AuthType digest                               // 削除
      AuthName "dirC"                               // 削除
      AuthUserFile /etc/httpd/conf/htdigest         // 削除
      AllowOverride All                             // 削除
      Require valid-user                            // 削除
      Options Indexes                               // 削除
    </Directory>                                    // 削除
    
    <Directory "/var/www/html/dirD">                // 削除
      AllowOverride All                             // 削除
      Order allow,deny                              // 削除
      Allow from all                                // 削除
      Deny from 192.168.122.12/32                   // 削除
      Options Indexes                               // 削除
    </Directory>                                    // 削除
    
    <Directory "/var/www/html/dirE">                // 削除
      AllowOverride All                             // 削除
      Require all denied                            // 削除
      Require ip 192.168.122.12                     // 削除
      Options Indexes                               // 削除
    </Directory>                                    // 削除
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <IfModule dir_module>                           // 削除
      DirectoryIndex index.html                     // 削除
    </IfModule>                                     // 削除
    
    <IfModule alias_module>                         // 削除
      ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"     // 削除
    </IfModule>                                     // 削除
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    
    <IfModule mime_magic_module>                    // 削除
      MIMEMagicFile conf/magic                      // 削除
    </IfModule>                                     // 削除
    
    <IfModule log_config_module>                    // 削除
      LogFormat "%h %l %u %t \"%r\" %>s %b" common  // 削除
      CustomLog "logs/access_log" common            // 削除
    </IfModule>                                     // 削除
    
    <IfModule mime_module>                          // 削除
      TypesConfig /etc/mime.types                   // 削除
      AddType application/x-compress .Z             // 削除
      AddType application/x-gzip .gz .tgz           // 削除
      AddType text/html .shtml                      // 削除
      AddOutputFilter INCLUDES .shtml               // 削除
    </IfModule>                                     // 削除
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /var/www/site1
    vm11$ sudo mkdir /var/www/site2
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 777 /var/www/site1
    vm11$ sudo chmod 777 /var/www/site2
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /var/www/site1/index.html
    vm11$ sudo vi /var/www/site2/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    // site1
    <html><body><h1>Site1</h1></body></html>
    
    // site2
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/hosts
    
    コマンドの実行結果
    --------------------------------------------------
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    192.168.122.11 vm11 site1.avswa.com site2.avswa.com  // 修正
    192.168.122.12 vm12
    192.168.122.13 vm13
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site1.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site2.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo ls -lh /etc/httpd/logs/
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r--. 1 root root 11K  6月 23 05:38 access_log
    -rw-r--r--. 1 root root 53K  6月 23 12:40 error_log
    -rw-r--r--. 1 root root   0  6月 23 12:40 site1_err_log  // エラーログ => データなし
    -rw-r--r--. 1 root root 133  6月 23 12:44 site1_log      // アクセスログ
    -rw-r--r--. 1 root root   0  6月 23 12:40 site2_err_log  // エラーログ => データなし
    -rw-r--r--. 1 root root  72  6月 23 12:44 site2_log      // アクセスログ
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /etc/httpd/logs/site1_log -> アクセスログ
    
    コマンドの実行結果
    --------------------------------------------------
    192.168.122.11 - - [23/Jun/2023:12:44:22 +0900] "GET / HTTP/1.1" 200 41
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /etc/httpd/logs/site2_log -> アクセスログ
    
    コマンドの実行結果
    --------------------------------------------------
    192.168.122.11 - - [23/Jun/2023:12:44:26 +0900] "GET / HTTP/1.1" 200 41
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[018]
  httpd - SSL/TLS - 01
  
[内容]
  ## 作業内容
    認証局作成、自己認証する
  
  ## ディレクトリ構成
    /opt/pki
      |-- /config
            |-- openssl-siteCA.cnf  // 設定ファイル
      |-- /siteCA
            |-- /certs          // 検証用の証明書
            |-- /crl            // 失効リスト
            |-- /newcerts       // 認証局発行の証明書
            |-- /private        // 認証局の秘密鍵
            |-- serial          // シリアル番号
            |-- crlnum          // CRL
            |-- index.txt       // 認証局の管理データベース
            |-- siteCaReq.pem   // 認証局の証明書署名要求
            |-- siteCaCert.pem  // 認証局のデジタル証明書
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 23 16:47:38 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir -p /opt/pki/config
    vm11$ sudo mkdir -p /opt/pki/siteCA
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir -p /opt/pki/siteCA/certs
    vm11$ sudo mkdir -p /opt/pki/siteCA/crl
    vm11$ sudo mkdir -p /opt/pki/siteCA/newcerts
    vm11$ sudo mkdir -p /opt/pki/siteCA/private
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /opt/pki/config/openssl-siteCA.cnf -> 設定ファイルの作成
    
    コマンドの実行結果
    --------------------------------------------------
    [ ca ]
      default_ca = CA_default  // セクション「CA_default」を参照
    
    [ CA_default ]
      dir = /opt/pki/siteCA
      certs = $dir/certs
      crl_dir = $dir/crl
      database = $dir/index.txt
      new_certs_dir = $dir/newcerts
      serial = $dir/serial
      crlnumber = $dir/crlnum
      crl = $dir/crl.pem
      RANDFILE = $dir/.rand
      name_opt = CA_default
      cert_opt = CA_default
      default_days = 365
      default_crl_days = 30
      default_bits = 2048
      default_md = sha256
      preserve = no
      policy = policy_match  // セクション「policy_match」を参照
    
    [ policy_match ]
      countryName = match
      stateOrProvinceName = match
      organizationName = match
      organizationalUnitName = optional
      commonName = supplied
      emailAddress = optional
    
    [ v3_ca ]
      subjectKeyIdentifier = hash
      authorityKeyIdentifier = keyid:always,issuer
      basicConstraints = CA:true      // CAフラグ
      keyUsage = cRLSign,keyCertSign  // 鍵用途(CRL署名、鍵署名)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo touch /opt/pki/siteCA/serial
    vm11$ sudo touch /opt/pki/siteCA/crlnum
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ su - root
    vm11# echo "01" >> /opt/pki/siteCA/serial
    vm11# echo "00" >> /opt/pki/siteCA/crlnum
    vm11# exit

    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo touch /opt/pki/siteCA/index.txt -> データベース作成
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl genrsa                         // 認証局の秘密鍵を生成
        > -out /opt/pki/siteCA/private/siteCaKey.pem  // 秘密鍵ファイル
        > -aes256                                     // 暗号化アルゴリズム
        > -passout pass:ma0122ma                      // 秘密鍵のパスフレーズ
        > 2048                                        // 鍵長
    
    コマンドの実行結果
    --------------------------------------------------
    Generating RSA private key, 2048 bit long modulus …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl req                            // 証明書署名要求(CSR)を作成
        > -new                                        // 新規作成
        > -key /opt/pki/siteCA/private/siteCaKey.pem  // 秘密鍵ファイル
        > -out /opt/pki/siteCA/siteCaReq.pem          // 証明書署名要求(CSR)
        > -passin pass:ma0122ma                       // 秘密鍵のパスフレーズ
        > -subj "/C=JP/ST=Saitama/L=Tokorozawa/O=avswa.com/CN=$siteCA.avswa.com"  // 認証局の情報
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm12$ sudo openssl ca                             // 証明書署名要求(CSR)を自己署名・サーバー証明書を作成
        > -config /opt/pki/config/openssl-siteCA.cnf  // 設定ファイル
        > -batch                                      // 対話形式は使用しない
        > -in /opt/pki/siteCA/siteCaReq.pem           // 証明書署名要求(CSR)
        > -out /opt/pki/siteCA/siteCaCert.pem         // サーバー証明書
        > -keyfile /opt/pki/siteCA/private/siteCaKey.pem  // 秘密鍵ファイル
        > -selfsign                                   // 自己署名
        > -passin pass:ma0122ma                       // 秘密鍵のパスフレーズ
        > -extensions v3_ca                           // 設定ファイルの拡張セクションもロード
    
    コマンドの実行結果
    --------------------------------------------------
    Using configuration from /opt/pki/config/openssl-siteCA.cnf
    Check that the request matches the signature
    Signature ok
    Certificate Details:
        Serial Number: 1 (0x1)
        Validity
            Not Before: Jun 26 04:19:41 2023 GMT
            Not After : Jun 25 04:19:41 2024 GMT
        Subject:
            countryName         = JP
            stateOrProvinceName = Saitama
            organizationName    = avswa.com
            commonName          = .avswa.com
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                67:55:D1:BE:13:72:ED:15:D6:2C:66:BE:74:F4:2B:F0:ED:94:3A:58
            X509v3 Authority Key Identifier: 
                keyid:67:55:D1:BE:13:72:ED:15:D6:2C:66:BE:74:F4:2B:F0:ED:94:3A:58
            X509v3 Basic Constraints: 
                CA:TRUE
            X509v3 Key Usage: 
                Certificate Sign, CRL Sign
    Certificate is to be certified until Jun 25 04:19:41 2024 GMT (365 days)
    Write out database with 1 new entries
    Data Base Updated
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl x509                           // サーバー証明書の内容確認
        > -in /opt/pki/siteCA/siteCaCert.pem          // サーバー証明書
        > -text                                       // テキスト出力
        > -noout                                      // 出力ファイルなし
    
    コマンドの実行結果
    --------------------------------------------------
    Certificate:
        Data:
            Version: 3 (0x2)
            Serial Number: 1 (0x1)
            Signature Algorithm: sha256WithRSAEncryption
            Issuer: C = JP, ST = Saitama, O = avswa.com, CN = .avswa.com
            Validity
                Not Before: Jun 26 04:19:41 2023 GMT
                Not After : Jun 25 04:19:41 2024 GMT
            Subject: C = JP, ST = Saitama, O = avswa.com, CN = .avswa.com
            Subject Public Key Info:
                Public Key Algorithm: rsaEncryption
                    RSA Public-Key: (2048 bit)
                    Modulus:
                    …
                    Exponent: 65537 (0x10001)
            X509v3 extensions:
                X509v3 Subject Key Identifier: 
                    67:55:D1:BE:13:72:ED:15:D6:2C:66:BE:74:F4:2B:F0:ED:94:3A:58
                X509v3 Authority Key Identifier: 
                    keyid:67:55:D1:BE:13:72:ED:15:D6:2C:66:BE:74:F4:2B:F0:ED:94:3A:58
                X509v3 Basic Constraints: 
                    CA:TRUE
                X509v3 Key Usage: 
                    Certificate Sign, CRL Sign
        Signature Algorithm: sha256WithRSAEncryption
        …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /opt/pki/siteCA/index.txt -> データベース
    
    コマンドの実行結果
    --------------------------------------------------
    V 240625041941Z 01 unknown /C=JP/ST=Saitama/O=avswa.com/CN=.avswa.com
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /opt/pki/siteCA/serial -> シリアル番号
    
    コマンドの実行結果
    --------------------------------------------------
    02 -> 次に使用される番号の模様
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[019]
  httpd - SSL/TLS - 02
  
[内容]
  ## 作業内容
    認証局で各サイトの署名を行いサーバー証明書を作成
  
  ## ディレクトリ構成
    /opt/pki
      |-- /config
            |-- openssl-site.cnf  // 設定ファイル => 作成対象
      |-- /siteCA
            |-- …
            |-- /private          // 認証局の秘密鍵
            |-- siteCaCert.pem    // 認証局のサーバー証明書
      |-- /site
            |-- site1.csr         // サイト(site1)の証明書署名要求(CSR)
            |-- site1.crt         // サイト(site1)のサーバー証明書
            |-- site2.csr         // サイト(site2)の証明書署名要求(CSR)
            |-- site2.crt         // サイト(site2)のサーバー証明書
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 26 13:02:57 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir -p /opt/pki/site
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /opt/pki/config/openssl-site.cnf -> 設定ファイルの作成
    
    コマンドの実行結果
    --------------------------------------------------
    [ ca ]
      default_ca = CA_default  // セクション「CA_default」を参照
    
    [ CA_default ]
      dir = /opt/pki/siteCA
      certs = $dir/certs
      crl_dir = $dir/crl
      database = $dir/index.txt
      new_certs_dir = $dir/newcerts
      serial = $dir/serial
      crlnumber = $dir/crlnum
      crl = $dir/crl.pem
      RANDFILE = $dir/.rand
      name_opt = CA_default
      cert_opt = CA_default
      default_days = 365
      default_crl_days = 30
      default_bits = 2048
      default_md = sha256
      preserve = no
      policy = policy_match  // セクション「policy_match」を参照
    
    [ policy_match ]
      countryName = match
      stateOrProvinceName = match
      organizationName = match
      organizationalUnitName = optional
      commonName = supplied
      emailAddress = optional
    
    [ v3_ca ]
      subjectKeyIdentifier = hash
      authorityKeyIdentifier = keyid:always,issuer
      basicConstraints = CA:false                                   // CAフラグ
      keyUsage = nonRepudiation, digitalSignature, keyEncipherment  // 鍵用途(デジタル署名、鍵暗号化)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl genrsa                             // サイト(site1)の秘密鍵を作成
        > -out /opt/pki/site/site1.key                    // 秘密鍵ファイル
        > -aes256                                         // 暗号化アルゴリズム
        > -passout pass:ma0122ma                          // 秘密鍵のパスフレーズ
        > 2048                                            // 鍵長
    
    コマンドの実行結果
    --------------------------------------------------
    Generating RSA private key, 2048 bit long modulus …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl genrsa                             // サイト(site2)の秘密鍵を作成
        > -out /opt/pki/site/site2.key                    // 秘密鍵ファイル
        > -aes256                                         // 暗号化アルゴリズム
        > -passout pass:ma0122ma                          // 秘密鍵のパスフレーズ
        > 2048                                            // 鍵長
    
    コマンドの実行結果
    --------------------------------------------------
    Generating RSA private key, 2048 bit long modulus …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl req                                // サイト(site1)の証明書署名要求(CSR)を作成
        > -new                                            // 新規作成
        > -key /opt/pki/site/site1.key                    // 秘密鍵ファイル
        > -out /opt/pki/site/site1.csr                    // 証明書署名要求(CSR)
        > -passin pass:ma0122ma                           // 秘密鍵のパスフレーズ
        > -subj "/C=JP/ST=Saitama/L=Tokorozawa/O=avswa.com/CN=site1.avswa.com"  // サイト情報
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl req                                // サイト(site2)の証明書署名要求(CSR)を作成
        > -new                                            // 新規作成
        > -key /opt/pki/site/site2.key                    // 秘密鍵ファイル
        > -out /opt/pki/site/site2.csr                    // 証明書署名要求(CSR)
        > -passin pass:ma0122ma                           // 秘密鍵のパスフレーズ
        > -subj "/C=JP/ST=Saitama/L=Tokorozawa/O=avswa.com/CN=site2.avswa.com"  // サイト情報
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl ca                                 // サイト(site1)を署名
        > -config /opt/pki/config/openssl-site.cnf        // 設定ファイル
        > -batch                                          // 対話形式は使用しない
        > -in /opt/pki/site/site1.csr                     // 証明書署名要求(CSR)
        > -out /opt/pki/site/site1.crt                    // サーバー証明書
        > -keyfile /opt/pki/siteCA/private/siteCaKey.pem  // 秘密鍵ファイル(CA)
        > -cert /opt/pki/siteCA/siteCaCert.pem            // サーバー証明書(CA)
        > -passin pass:ma0122ma                           // 秘密鍵のパスフレーズ
        > -extensions v3_ca                               // 設定ファイルの拡張セクションもロード
    
    コマンドの実行結果
    --------------------------------------------------
    Using configuration from /opt/pki/config/openssl-site.cnf
    Check that the request matches the signature
    Signature ok
    Certificate Details:
        Serial Number: 2 (0x2)
        Validity
            Not Before: Jun 26 04:56:34 2023 GMT
            Not After : Jun 25 04:56:34 2024 GMT
        Subject:
            countryName         = JP
            stateOrProvinceName = Saitama
            organizationName    = avswa.com
            commonName          = site1.avswa.com
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                C1:F8:7D:CC:69:99:88:BA:5E:23:C1:D8:A6:39:C4:34:9D:6F:36:73
            X509v3 Authority Key Identifier: 
                keyid:67:55:D1:BE:13:72:ED:15:D6:2C:66:BE:74:F4:2B:F0:ED:94:3A:58
            X509v3 Basic Constraints: 
                CA:FALSE
            X509v3 Key Usage: 
                Digital Signature, Non Repudiation, Key Encipherment
    Certificate is to be certified until Jun 25 04:56:34 2024 GMT (365 days)
    Write out database with 1 new entries
    Data Base Updated
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo openssl ca                                 // サイト(site2)を署名
        > -config /opt/pki/config/openssl-site.cnf        // 設定ファイル
        > -batch                                          // 対話形式は使用しない
        > -in /opt/pki/site/site2.csr                     // 証明書署名要求(CSR)
        > -out /opt/pki/site/site2.crt                    // サーバー証明書
        > -keyfile /opt/pki/siteCA/private/siteCaKey.pem  // 秘密鍵ファイル(CA)
        > -cert /opt/pki/siteCA/siteCaCert.pem            // サーバー証明書(CA)
        > -passin pass:ma0122ma                           // 秘密鍵のパスフレーズ
        > -extensions v3_ca                               // 設定ファイルの拡張セクションもロード
    
    コマンドの実行結果
    --------------------------------------------------
    Using configuration from /opt/pki/config/openssl-site.cnf
    Check that the request matches the signature
    Signature ok
    Certificate Details:
        Serial Number: 3 (0x3)
        Validity
            Not Before: Jun 26 05:01:31 2023 GMT
            Not After : Jun 25 05:01:31 2024 GMT
        Subject:
            countryName         = JP
            stateOrProvinceName = Saitama
            organizationName    = avswa.com
            commonName          = site2.avswa.com
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                73:2E:1C:53:9D:26:C5:21:92:50:B5:7E:B5:DD:26:20:C7:B4:97:84
            X509v3 Authority Key Identifier: 
                keyid:67:55:D1:BE:13:72:ED:15:D6:2C:66:BE:74:F4:2B:F0:ED:94:3A:58
            X509v3 Basic Constraints: 
                CA:FALSE
            X509v3 Key Usage: 
                Digital Signature, Non Repudiation, Key Encipherment
    Certificate is to be certified until Jun 25 05:01:31 2024 GMT (365 days)
    Write out database with 1 new entries
    Data Base Updated
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[020]
  httpd - SSL/TLS - 03
  
[内容]
  ## 作業内容
    バーチャルホスト内の各サイトをHTTPS化
  
  ## ディレクトリ構成
    /opt/pki
      |-- /site
            |-- site1.key  // サイト(site1)の秘密鍵
            |-- site1.crt  // サイト(site1)のサーバー証明書
            |-- site2.key  // サイト(site2)の秘密鍵
            |-- site2.crt  // サイト(site2)のサーバー証明書
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 26 13:44:26 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /opt/pki/site | grep -E 'site1|site2' -> サーバー証明書の確認
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r--. 1 root root 4.3K  6月 26 13:56 site1.crt
    -rw-r--r--. 1 root root 1001  6月 26 13:49 site1.csr
    -rw-------. 1 root root 1.8K  6月 26 13:47 site1.key
    -rw-r--r--. 1 root root 4.3K  6月 26 14:01 site2.crt
    -rw-r--r--. 1 root root 1001  6月 26 13:50 site2.csr
    -rw-------. 1 root root 1.8K  6月 26 13:48 site2.key
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep ssl -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なしのためインストールが必要
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo dnf -y install mod_ssl
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf/httpd.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ServerRoot "/etc/httpd"
    Listen 80
    Include conf.modules.d/*.conf
    User apache
    Group apache
    ServerName www.avswa.com
    LogLevel warn
    ServerTokens Prod
    AddDefaultCharset UTF-8
    ErrorDocument 404 /missing.html
    EnableSendfile on
    AccessFileName .htaccess
    IncludeOptional conf.d/*.conf
    DirectoryIndex index.html
    ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
    MIMEMagicFile conf/magic
    LogFormat "%h %l %u %t \"%r\" %>s %b" common
    TypesConfig /etc/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType text/html .shtml
    AddOutputFilter INCLUDES .shtml
    
    <Directory />
      AllowOverride none
      Require all denied
    </Directory>
    
    <Directory "/var/www">
      AllowOverride None
      Require all denied
    </Directory>
    
    <VirtualHost *:80>
      ServerAdmin makoto@localhost
      ServerName site1.avswa.com:80
      DocumentRoot "/var/www/site1"
      ErrorLog "logs/site1_err_log"
      CustomLog "logs/site1_log" common
    </VirtualHost>
    
    <VirtualHost *:80>
      ServerAdmin makoto@localhost
      ServerName site2.avswa.com:80
      DocumentRoot "/var/www/site2"
      ErrorLog "logs/site2_err_log"
      CustomLog "logs/site2_log" common
    </VirtualHost>
    
    <Directory "/var/www/site1">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/site2">
      AllowOverride None
      Require all granted
      Options Indexes FollowSymLinks
    </Directory>
    
    <Directory "/var/www/cgi-bin">
      AllowOverride None
      Require all granted
      Options None
    </Directory>
    
    <Files ".ht*">
      Require all denied
    </Files>
    
    <Location /server-status>
      SetHandler server-status
      AllowOverride None
      Require all denied
    </Location>
    
    <Location /server-info>
      SetHandler server-info
      AllowOverride None
      Require all denied
    </Location>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/httpd/conf.d/ssl.conf -> 設定ファイルの修正
    
    コマンドの実行結果
    --------------------------------------------------
    Listen 443
    
    SSLRandomSeed startup builtin                        // 不明
    SSLRandomSeed connect builtin                        // 不明
    SSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES           // 暗号化の優先順位
    SSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES      // 暗号化の優先順位(プロキシ接続)
    SSLHonorCipherOrder on                               // 低負荷の暗号化を自動選択
    SSLProtocol all -SSLv3                               // サポートプロトコル
    SSLProxyProtocol all -SSLv3                          // サポートプロトコル(プロキシ接続)
    SSLPassPhraseDialog exec:/etc/ssl/certs/pass_ssl.sh  // 秘密鍵パスフレーズ入力時の入力方式
    
    <FilesMatch "\.(cgi|shtml|phtml|php)$">
      SSLOptions +StdEnvVars  // SSL/TLS関連の環境変数をCGI/SSIで使用可能
    </FilesMatch>
    
    <Directory "/usr/local/apache2/cgi-bin">
      SSLOptions +StdEnvVars  // SSL/TLS関連の環境変数をCGI/SSIで使用可能
    </Directory>
    
    <VirtualHost *:443>
      ServerName site1.avswa.com:443
      ServerAdmin makoto@localost
      DocumentRoot "/var/www/site1"
      ErrorLog "logs/site1_err_log"
      CustomLog "logs/site1_log" common
      SSLEngine on
      SSLCertificateFile "/opt/pki/site/site1.crt"
      SSLCertificateKeyFile "/opt/pki/site/site1.key"
    </VirtualHost>
    
    <VirtualHost *:443>
      ServerName site2.avswa.com:443
      ServerAdmin makoto@localhost
      DocumentRoot "/var/www/site2"
      ErrorLog "logs/site2_err_log"
      CustomLog "logs/site2_log" common
      SSLEngine on
      SSLCertificateFile "/opt/pki/site/site2.crt"
      SSLCertificateKeyFile "/opt/pki/site/site2.key"
    </VirtualHost>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/ssl/certs/pass_ssl.sh -> スクリプト作成
    
    コマンドの実行結果
    --------------------------------------------------
    #!/bin/bash
    
    case $1 in
      site1.avswa.com:443)
        echo 'ma0122ma';;
      site2.avswa.com:443)
        echo 'ma0122ma';;
    esac
    
    exit 0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 755 /etc/ssl/certs/pass_ssl.sh -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ httpd -M | grep ssl -> モジュール確認
    
    コマンドの実行結果
    --------------------------------------------------
    ssl_module (shared) -> DSO
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ getenforce
    
    コマンドの実行結果
    --------------------------------------------------
    Enforcing
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo setenforce 0
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl configtest 
    
    コマンドの実行結果
    --------------------------------------------------
    Syntax OK
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo apachectl graceful -> 安全に再起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site1.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site2.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --cacert /opt/pki/siteCA/siteCaCert.pem https://site1.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --cacert /opt/pki/siteCA/siteCaCert.pem https://site2.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[021]
  httpd - ソフトウェア停止
  
[内容]
  ## 作業内容
    ソフトウェア停止
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Mon Jun 26 15:55:17 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl stop httpd
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl disable httpd
    
    コマンドの実行結果
    --------------------------------------------------
    Removed /etc/systemd/system/multi-user.target.wants/httpd.service.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[022]
  nginx - 基本設定
  
[内容]
  ## 作業内容
    基本設定
  
  ## コマンド(nginx)
    nginx            // Nginxを起動する
    nginx -s stop    // Nginxを停止する
    nginx -s quit    // Nginxを安全に停止する
    nginx -s reload  // Nginxの設定ファイルを読み込む
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 27 12:50:44 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ps aux | grep nginx | grep -v grep
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ソフトウェアが起動していない
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -> ソフトウェア起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ps aux | grep nginx | grep -v grep
    
    コマンドの実行結果
    --------------------------------------------------
    root   3378  0.0  0.1  103424  2168 ?  Ss   13:07   0:00  nginx: master process nginx  // マスタープロセス
    nginx  3379  0.0  0.5  124740  7984 ?  S    13:07   0:00  nginx: worker process        // ワーカープロセス
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ http://vm11.avswa.com/ -> ホスト側のブラウザから閲覧
    
    コマンドの実行結果
    --------------------------------------------------
    (ウェルカムページが表示)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s quit -> 安全に停止
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cp -p /etc/nginx/nginx.conf /etc/nginx/nginx.conf.org -> 設定ファイルのバックアップ
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      
      server {
        listen 80;                             // Port 80
        server_name vm11.avswa.com;            // Hostname
        error_page 404 /404.html;              // Error 404 => http://vm11.avswa.com/404.html => /etc/nginx/html/404.html
        error_page 500 502 503 504 /50x.html;  // Error 50x => http://vm11.avswa.com/50x.html => /etc/nginx/html/50x.html
        
        location / {                           // Location 
          root /etc/nginx/html;                // http://vm11.avswa.com/ => /etc/nginx/html/
          index index.html index.htm;
        }
        
        location = /404.html {                 // Location http://vm11.avswa.com/404.html
          root /etc/nginx/html;                // DocumentRoot => /etc/nginx/html
        }
        
        location = /50x.html {                 // Location http://vm11.avswa.com/50x.html
          root /etc/nginx/html;                // DocumentRoot => /etc/nginx/html
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir -p /etc/nginx/html
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/html/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>単独サイト</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/html/404.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Error-404</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/html/50x.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Error-50x</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl enable nginx
    
    コマンドの実行結果
    --------------------------------------------------
    Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl start nginx
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>単独サイト</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/aaa.html -> 存在しないファイル
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Error-404</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[023]
  nginx - アクセスログ
  
[内容]
  ## 作業内容
    アクセスログ
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 27 16:01:22 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    …
    http {
      …
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      …
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>単独サイト</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>単独サイト</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /var/log/nginx/access.log | tail -n 2
    
    コマンドの実行結果
    --------------------------------------------------
    127.0.0.1 - - [27/Jun/2023:16:30:34 +0900] "GET / HTTP/1.1" 200 51 "-" "curl/7.61.1" "-"
    127.0.0.1 - - [27/Jun/2023:16:30:36 +0900] "GET / HTTP/1.1" 200 51 "-" "curl/7.61.1" "-"
    
    $remote_addr            => 127.0.0.1
    $remote_user            => -
    [$time_local]           => [27/Jun/2023:16:30:34 +0900]
    "$request"              => "GET / HTTP/1.1"
    $status                 => 200
    $body_bytes_sent        => 51
    "$http_referer"         => "-"
    "$http_user_agent"      => "curl/7.61.1"
    "$http_x_forwarded_for" => "-"
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[024]
  nginx - エラーログ
  
[内容]
  ## 作業内容
    エラーログ
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 27 16:30:10 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    …
    error_log /var/log/nginx/error.log;
    …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /var/log/nginx/error.log | tail
    
    コマンドの実行結果
    --------------------------------------------------
    2023/06/27 15:10:04 [error] 3570#0: *14 open() "/etc/nginx/html/501.html" failed (2: No such file or directory), client: 192.168.122.11, server: vm11.avswa.com, request: "GET /501.html HTTP/1.1", host: "vm11.avswa.com"
    2023/06/27 15:10:43 [error] 3570#0: *15 open() "/etc/nginx/html/aaa.html" failed (2: No such file or directory), client: 192.168.122.1, server: vm11.avswa.com, request: "GET /aaa.html HTTP/1.1", host: "vm11.avswa.com"
    2023/06/27 15:35:35 [error] 3621#0: *18 open() "/etc/nginx/html/aaa.html" failed (2: No such file or directory), client: 127.0.0.1, server: vm11.avswa.com, request: "GET /aaa.html HTTP/1.1", host: "localhost"
    2023/06/27 15:38:33 [error] 3621#0: *19 open() "/etc/nginx/html/aaa.html" failed (2: No such file or directory), client: 127.0.0.1, server: vm11.avswa.com, request: "GET /aaa.html HTTP/1.1", host: "localhost"
    2023/06/27 15:38:51 [error] 3621#0: *21 open() "/etc/nginx/html/aaa.html" failed (2: No such file or directory), client: 127.0.0.1, server: vm11.avswa.com, request: "GET /aaa.html HTTP/1.1", host: "localhost"
    2023/06/27 16:24:33 [error] 3759#0: *26 open() "/etc/nginx/html/aaa.html" failed (2: No such file or directory), client: 127.0.0.1, server: vm11.avswa.com, request: "GET /aaa.html HTTP/1.1", host: "localhost"
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[025]
  nginx - リダイレクト
  
[内容]
  ## 作業内容
    リダイレクト
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 27 17:24:50 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      
      server {
        listen 80;
        server_name vm11.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        rewrite ^/index.html$ work1.html redirect;  // 追加 : http://vm11.avswa.com/index.html => http://vm11.avswa.com/work1.html
        
        location / {
          root /etc/nginx/html;
          index index.html index.htm;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/html/work1.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Work1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html>
    <head>
    <title>302 Found</title>
    </head>
    <body bgcolor="white">
    <center><h1>302 Found</h1></center>  // デフォルトではステータス(302)を返す模様
    <hr>
    <center>nginx/1.14.1</center>
    </body>
    </html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    …
      server {
        …
        rewrite ^/index.html$ work1.html redirect;  // 削除
        …
      }
    …
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo rm /etc/nginx/html/work1.html
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[026]
  nginx - バージョン情報
  
[内容]
  ## 作業内容
    バージョン情報
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 27 20:34:24 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl -I http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    HTTP/1.1 200 OK
    Server: nginx/1.14.1  // バージョン情報が見えてしまう
    Date: Tue, 27 Jun 2023 12:02:40 GMT
    Content-Type: text/html
    Content-Length: 51
    Last-Modified: Tue, 27 Jun 2023 05:54:02 GMT
    Connection: keep-alive
    ETag: "649a797a-33"
    Accept-Ranges: bytes
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      server_tokens off;  // 追加
      
      server {
        listen 80;
        server_name vm11.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html;
          index index.html index.htm;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl -I http://localhost/
    
    コマンドの実行結果
    --------------------------------------------------
    HTTP/1.1 200 OK
    Server: nginx  // バージョン情報が見えなくなった
    Date: Tue, 27 Jun 2023 12:04:29 GMT
    Content-Type: text/html
    Content-Length: 51
    Last-Modified: Tue, 27 Jun 2023 05:54:02 GMT
    Connection: keep-alive
    ETag: "649a797a-33"
    Accept-Ranges: bytes
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[027]
  nginx - 各ユーザーのホームディレクトリ公開
  
[内容]
  ## 作業内容
    各ユーザーのホームディレクトリ公開
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Tue Jun 27 21:01:23 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      server_tokens off;
      
      server {
        listen 80;
        server_name vm11.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html;
          index index.html index.htm;
        }
        
        location ~ ^/~(.+?)(/.*)?$ {     // 追加
          alias /home/$1/public_html$2;  // 追加
          index index.html index.htm;    // 追加
          autoindex on;                  // 追加
        }                                // 追加
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ getenforce
    
    コマンドの実行結果
    --------------------------------------------------
    Enforcing
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo setenforce 0 -> SELinux無効
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ su -c 'curl http://localhost/~user1/' user1
    vm11$ su -c 'curl http://localhost/~user2/' user2
    vm11$ su -c 'curl http://localhost/~user3/' user3
    
    コマンドの実行結果
    --------------------------------------------------
    // user1
    パスワード: (パスワード入力)
    <html><body><h1>User1</h1></body></html>
    
    // user2
    パスワード: (パスワード入力)
    <html><body><h1>User2</h1></body></html>
    
    // user3
    パスワード: (パスワード入力)
    <html><body><h1>User3</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/~user1/
    vm11$ curl http://localhost/~user2/
    vm11$ curl http://localhost/~user3/
    
    コマンドの実行結果
    --------------------------------------------------
    // user1
    <html><body><h1>User1</h1></body></html>
    
    // user2
    <html><body><h1>User2</h1></body></html>
    
    // user3
    <html><body><h1>User3</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[028]
  nginx - アクセス制御
  
[内容]
  ## 作業内容
    アクセス制御
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 29 01:34:50 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      server_tokens off;
      
      server {
        listen 80;
        server_name vm11.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html;
          index index.html index.htm;
        }
        
        location /dirA {               // 追加
          alias /etc/nginx/html/dirA;  // 追加
          index index.html index.htm;  // 追加
          allow all;                   // 追加 => 全アドレスがアクセス可
        }                              // 追加
        
        location ~ ^/~(.+?)(/.*)?$ {
          alias /home/$1/public_html$2;
          index index.html index.htm;
          autoindex on;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /etc/nginx/html/dirA
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/html/dirA/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirA</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirA/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirA</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      server_tokens off;
      
      server {
        listen 80;
        server_name vm11.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html;
          index index.html index.htm;
        }
        
        location /dirA {
          alias /etc/nginx/html/dirA;
          index index.html index.htm;
          deny all;  // 修正 => 全アドレスをアクセス不可
        }
        
        location ~ ^/~(.+?)(/.*)?$ {
          alias /home/$1/public_html$2;
          index index.html index.htm;
          autoindex on;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirA/ -> アクセス不可
    
    コマンドの実行結果
    --------------------------------------------------
    <html>
    <head>
    <title>403 Forbidden</title>
    </head>
    <body bgcolor="white">
    <center><h1>403 Forbidden</h1></center>
    <hr>
    <center>nginx</center>
    </body>
    </html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[029]
  nginx - 基本認証
  
[内容]
  ## 作業内容
    基本認証
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 29 03:11:12 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      server_tokens off;
      
      server {
        listen 80;
        server_name vm11.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html;
          index index.html index.htm;
        }
        
        location /dirA {
          alias /etc/nginx/html/dirA;
          index index.html index.htm;
          deny all;
        }
        
        location /dirB {                                  // 追加
          alias /etc/nginx/html/dirB;                     // 追加
          index index.html index.htm;                     // 追加
          auth_basic "Enter user and pass";               // 追加
          auth_basic_user_file /etc/httpd/conf/htpasswd;  // 追加
        }                                                 // 追加
        
        location ~ ^/~(.+?)(/.*)?$ {
          alias /home/$1/public_html$2;
          index index.html index.htm;
          autoindex on;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cat /etc/httpd/conf/htpasswd
    
    コマンドの実行結果
    --------------------------------------------------
    user1:$apr1$Yj0PGaD5$i9rn8DYqtjrKmFvqzf0Ar.
    user2:$apr1$VkwgSRiP$OMjvy3mTjk3KS1W0hIkJV/
    user3:$apr1$lfCeU3jb$cjq.gOW3KQsFsEF6/IqWE.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /etc/nginx/html/dirB
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 777 /etc/nginx/html/dirB
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/html/dirB/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirB</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl -u user1:user1 http://localhost/dirB/ -> 基本認証でアクセス
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirB</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[030]
  nginx - ホストベースのアクセス制御
  
[内容]
  ## 作業内容
    ホストベースのアクセス制御
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 29 04:11:58 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      server_tokens off;
      
      server {
        listen 80;
        server_name vm11.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html;
          index index.html index.htm;
        }
        
        location /dirA {
          alias /etc/nginx/html/dirA;
          index index.html index.htm;
          deny all;
        }
        
        location /dirB {
          alias /etc/nginx/html/dirB;
          index index.html index.htm;
          auth_basic "Enter user and pass";
          auth_basic_user_file /etc/httpd/conf/htpasswd;
        }
        
        location /dirC {               // 追加
          alias /etc/nginx/html/dirC;  // 追加
          index index.html index.htm;  // 追加
          deny 192.168.122.12;         // 追加
        }                              // 追加
        
        location ~ ^/~(.+?)(/.*)?$ {
          alias /home/$1/public_html$2;
          index index.html index.htm;
          autoindex on;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /etc/nginx/html/dirC
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 777 /etc/nginx/html/dirC
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/html/dirC/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirC</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://localhost/dirC/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>dirC</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 23 05:38:20 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl http://vm11.avswa.com/dirC/
    
    コマンドの実行結果
    --------------------------------------------------
    <html>
    <head>
    <title>403 Forbidden</title>
    </head>
    <body bgcolor="white">
    <center><h1>403 Forbidden</h1></center>
    <hr>
    <center>nginx</center>
    </body>
    </html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[031]
  nginx - バーチャルホスト
  
[内容]
  ## 作業内容
    名前ベースのバーチャルホスト
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 29 04:47:29 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf -> 設定ファイルを一新する
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      server_tokens off;
      
      server {
        listen 80;
        server_name site1.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html/site1;
          index index.html index.htm;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
      
      server {
        listen 80;
        server_name site2.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html/site2;
          index index.html index.htm;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkdir /etc/nginx/html/site1
    vm11$ sudo mkdir /etc/nginx/html/site2
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo chmod 777 /etc/nginx/html/site1
    vm11$ sudo chmod 777 /etc/nginx/html/site2
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/html/site1/index.html
    vm11$ sudo vi /etc/nginx/html/site2/index.html
    
    コマンドの実行結果
    --------------------------------------------------
    // site1
    <html><body><h1>Site1</h1></body></html>
    
    // site2
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/hosts
    
    コマンドの実行結果
    --------------------------------------------------
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    192.168.122.11 vm11 site1.avswa.com site2.avswa.com  // 修正
    192.168.122.12 vm12
    192.168.122.13 vm13
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site1.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site2.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo ls -lh /var/log/nginx
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r--. 1 root root  12K  6月 29 05:33 access.log
    -rw-r--r--. 1 root root 8.9K  6月 29 05:33 error.log
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo tail /var/log/nginx/access.log -> アクセスログ
    
    コマンドの実行結果
    --------------------------------------------------
    192.168.122.11 - - [29/Jun/2023:05:33:34 +0900] "GET / HTTP/1.1" 200 41 "-" "curl/7.61.1" "-"
    192.168.122.11 - - [29/Jun/2023:05:33:39 +0900] "GET / HTTP/1.1" 200 41 "-" "curl/7.61.1" "-"
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[032]
  nginx - SSL/TLS
  
[内容]
  ## 作業内容
    バーチャルホスト内の各サイトをHTTPS化
  
  ## ディレクトリ構成
    /opt/pki
      |-- /site
            |-- site1.key  // サイト(site1)の秘密鍵
            |-- site1.crt  // サイト(site1)のサーバー証明書
            |-- site2.key  // サイト(site2)の秘密鍵
            |-- site2.crt  // サイト(site2)のサーバー証明書
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 29 05:28:52 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ ls -lh /opt/pki/site | grep -E 'site1|site2' -> サーバー証明書の確認
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-r--r--. 1 root root 4.3K  6月 26 13:56 site1.crt
    -rw-r--r--. 1 root root 1001  6月 26 13:49 site1.csr
    -rw-------. 1 root root 1.8K  6月 26 13:47 site1.key
    -rw-r--r--. 1 root root 4.3K  6月 26 14:01 site2.crt
    -rw-r--r--. 1 root root 1001  6月 26 13:50 site2.csr
    -rw-------. 1 root root 1.8K  6月 26 13:48 site2.key
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    user nginx;
    worker_processes 1;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;
    include /usr/share/nginx/modules/*.conf;
    
    ## Events Modules
    events {
      worker_connections 1024;
    }
    
    ## HTTP Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      log_format main '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"';
      access_log /var/log/nginx/access.log main;
      server_tokens off;
      
      server {
        listen 80;
        server_name site1.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html/site1;
          index index.html index.htm;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
      
      server {
        listen 80;
        server_name site2.avswa.com;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location / {
          root /etc/nginx/html/site2;
          index index.html index.htm;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
      
      server {
        listen 443 ssl;
        server_name site1.avswa.com;
        ssl_certificate_key /opt/pki/site/site1.key;
        ssl_certificate /opt/pki/site/site1.crt;
        ssl_password_file /etc/nginx/site1-pass;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;
        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        
        location / {
          root /etc/nginx/html/site1;
          index index.html index.htm;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
      
      server {
        listen 443 ssl;
        server_name site2.avswa.com;
        ssl_certificate_key /opt/pki/site/site2.key;
        ssl_certificate /opt/pki/site/site2.crt;
        ssl_password_file /etc/nginx/site2-pass;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;
        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        
        location / {
          root /etc/nginx/html/site2;
          index index.html index.htm;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm11$ su - root
    vm11# echo 'ma0122ma' > /etc/nginx/site1-pass
    vm11# echo 'ma0122ma' > /etc/nginx/site2-pass
    vm11# exit
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -t 
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo nginx -s reload -> 設定を再ロード
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site1.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site2.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --cacert /opt/pki/siteCA/siteCaCert.pem https://site1.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --cacert /opt/pki/siteCA/siteCaCert.pem https://site2.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[033]
  nginx - リバースプロキシ
  
[内容]
  ## 作業内容
    リバースプロキシ
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 複数サイト(HTTPS) => 既に設定済み
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : リバースプロキシ
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 29 09:54:16 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cp /opt/pki/siteCA/siteCaCert.pem /etc/nginx/html/site1/
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 29 12:45:44 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /etc/hosts
    
    コマンドの実行結果
    --------------------------------------------------
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    192.168.122.11 vm11 site1.avswa.com site2.avswa.com  // 修正
    192.168.122.12 vm12
    192.168.122.13 vm13
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl http://site1.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl http://site2.avswa.com/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ wget http://site1.avswa.com/siteCaCert.pem
    
    コマンドの実行結果
    --------------------------------------------------
    2023-06-29 15:55:48 (272 MB/s) - `siteCaCert.pem' へ保存完了 [4329/4329]
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl --cacert siteCaCert.pem https://site1.avswa.com/ -> 認証局(CA)の公開鍵があればHTTPS通信も可能
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl --cacert siteCaCert.pem https://site2.avswa.com/ -> 認証局(CA)の公開鍵があればHTTPS通信も可能
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.org
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo vi /etc/nginx/nginx.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ## Worker Process Counts
    worker_processes 1;
    
    ## Module Events
    events {
      worker_connections 1024;
    }
    
    ## Web Server
    http {
      include mime.types;
      default_type application/octet-stream;
      sendfile on;
      keepalive_timeout 65;
      
      server {
        listen 80;
        server_name localhost;
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;
        
        location /site1 {
          proxy_pass http://site1.avswa.com/;
        }
        
        location /site2 {
          proxy_pass http://site2.avswa.com/;
        }
        
        location = /404.html {
          root /etc/nginx/html;
        }
        
        location = /50x.html {
          root /etc/nginx/html;
        }
      }
    }
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo ngix -t
    
    コマンドの実行結果
    --------------------------------------------------
    nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    nginx: configuration file /etc/nginx/nginx.conf test is successful
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ ps aux | grep nginx | grep -v grep
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ソフトウェアが起動していない
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo nginx -> Nginxを起動
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl http://localhost/site1/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ curl http://localhost/site2/
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm12 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[034]
  squid - 基本設定
  
[内容]
  ## 作業内容
    基本設定
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 30 17:10:48 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site1.avswa.com/ -> サイトアクセス可能
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl http://site2.avswa.com/ -> サイトアクセス可能
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo firewall-cmd --list-all
    
    コマンドの実行結果
    --------------------------------------------------
    public
      target: default
      icmp-block-inversion: no
      interfaces: 
      sources: 
      services: cockpit dhcpv6-client dns http https iscsi-target squid ssh  // squid を確認
      ports: 12865/tcp 12866/tcp
      protocols: 
      forward: no
      masquerade: no
      forward-ports: 
      source-ports: 
      icmp-blocks: 
      rich rules: 
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ systemctl is-active squid
    
    コマンドの実行結果
    --------------------------------------------------
    inactive -> ソフトウェアが起動していない
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo cp /etc/squid/squid.conf /etc/squid/squid.conf.org
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/squid/squid.conf
    
    コマンドの実行結果
    --------------------------------------------------
    ## ネットワーク定義
    # acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)
    # acl localnet src 10.0.0.0/8             # RFC 1918 local private network (LAN)
    # acl localnet src 100.64.0.0/10          # RFC 6598 shared address space (CGN)
    # acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly plugged) machines
    # acl localnet src 172.16.0.0/12          # RFC 1918 local private network (LAN)
    acl localnet src 192.168.122.0/24         # RFC 1918 local private network (LAN)
    # acl localnet src fc00::/7               # RFC 4193 local private network range
    # acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines
    
    ## ポート定義
    acl SSL_ports  port 443                   # ssl/tls
    acl Safe_ports port 80                    # http
    acl Safe_ports port 21                    # ftp
    acl Safe_ports port 443                   # https
    acl Safe_ports port 70                    # gopher
    acl Safe_ports port 210                   # wais
    acl Safe_ports port 1025-65535            # unregistered ports
    acl Safe_ports port 280                   # http-mgmt
    acl Safe_ports port 488                   # gss-http
    acl Safe_ports port 591                   # filemaker
    acl Safe_ports port 777                   # multiling http
    
    ## フィルタリング(URL)
    acl blacklist dstdomain "/etc/squid/blacklist"
    http_access deny blacklist
    
    ## アクセス拒否
    http_access deny !Safe_ports
    
    ## キャッシュマネージャーへのアクセス制御
    http_access allow localhost manager
    http_access deny manager
    
    ## ローカルアクセス制御
    http_access allow localnet
    http_access allow localhost
    http_access deny all
    
    ## 待受ポート番号
    http_port 3128
    
    ## コアダンプ出力先
    coredump_dir /usr/local/squid-5.3/var/cache/squid
    
    ## キャッシュ更新間隔
    refresh_pattern ^ftp: 1440 20% 10080
    refresh_pattern ^gopher: 1440 0% 1440
    refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
    refresh_pattern . 0 20% 4320
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ getenforce
    
    コマンドの実行結果
    --------------------------------------------------
    Enforcing
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo setenforce 0
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl start squid
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --proxy http://localhost:3128 http://site1.avswa.com -> プロキシ経由
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --proxy http://localhost:3128 http://site2.avswa.com -> プロキシ経由
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[035]
  squid - フィルタリング(URL)
  
[内容]
  ## 作業内容
    フィルタリング(URL)
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 30 18:30:51 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --proxy http://localhost:3128 http://site1.avswa.com
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --proxy http://localhost:3128 http://site2.avswa.com
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site2</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vi /etc/squid/blacklist
    
    コマンドの実行結果
    --------------------------------------------------
    site2.avswa.com
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl reload squid
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --proxy http://localhost:3128 http://site1.avswa.com
    
    コマンドの実行結果
    --------------------------------------------------
    <html><body><h1>Site1</h1></body></html>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ curl --proxy http://localhost:3128 http://site2.avswa.com
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> プロキシからエラー表示
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[036]
  squid - ソフトウェア停止
  
[内容]
  ## 作業内容
    ソフトウェア停止
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 30 19:47:54 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl stop nginx
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl disable nginx
    
    コマンドの実行結果
    --------------------------------------------------
    Removed /etc/systemd/system/multi-user.target.wants/nginx.service.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl stop squid
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo systemctl disable squid
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  $ cd $HOME
  $ ssh vm12 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Thu Jun 29 16:22:53 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl stop nginx
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl disable nginx
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm12 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[X01]
  compile - 01
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール (APR)
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Fri Jun 30 21:15:33 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo dnf -y install wget gcc expat-devel tar make
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://www.apache.org/dist/apr/apr-1.7.4.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://www.apache.org/dist/apr/apr-1.7.4.tar.gz.sha256
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo sha256sum -c apr-1.7.4.tar.gz.sha256
    
    コマンドの実行結果
    --------------------------------------------------
    apr-1.7.4.tar.gz: 完了
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo tar -zxf apr-1.7.4.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/apr-1.7.4
    vm13$ sudo ./configure --prefix=/usr/local/apr-1.7.4
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> Makefile
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/apr-1.7.4
    vm13$ sudo make
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ビルド実行
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/apr-1.7.4
    vm13$ sudo make install
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> インストール
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm13 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[X02]
  compile - 02
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール (APR-Util)
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jul  1 07:56:49 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://dlcdn.apache.org//apr/apr-util-1.6.3.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://www.apache.org/dist/apr/apr-util-1.6.3.tar.gz.sha256
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo sha256sum -c apr-util-1.6.3.tar.gz.sha256
    
    コマンドの実行結果
    --------------------------------------------------
    apr-util-1.6.3.tar.gz: 完了
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo tar -zxf apr-util-1.6.3.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/apr-util-1.6.3
    vm13$ sudo ./configure --prefix=/usr/local/apr-util-1.6.3 --with-apr=/usr/local/apr-1.7.4
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> Makefile
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/apr-util-1.6.3
    vm13$ sudo make
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ビルド実行
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/apr-util-1.6.3
    vm13$ sudo make install
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> インストール
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm13 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[X03]
  compile - 03
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール (PCRE)
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jul  1 08:21:41 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo dnf -y install gcc-c++ pcre-devel
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://sourceforge.net/projects/pcre/files/pcre/8.45/pcre-8.45.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo tar -zxf pcre-8.45.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/pcre-8.45
    vm13$ sudo ./configure --prefix=/usr/local/pcre-8.45
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> Makefile
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/pcre-8.45
    vm13$ sudo make
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ビルド実行
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/pcre-8.45
    vm13$ sudo make install
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> インストール
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm13 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[X04]
  compile - 04
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール (OPENSSL)
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jul  1 08:29:16 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo dnf -y install perl
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://www.openssl.org/source/openssl-1.1.0h.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo tar -zxf openssl-1.1.0h.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/openssl-1.1.0h
    vm13$ sudo ./config --openssldir=/usr/local/openssl-1.1.0
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> Makefile
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/openssl-1.1.0h
    vm13$ sudo make
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ビルド実行
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/openssl-1.1.0h
    vm13$ sudo make install
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> インストール
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm13 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[X05]
  compile - 05
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール (NGHTTP2)
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jul  1 08:35:58 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://github.com/nghttp2/nghttp2/releases/download/v1.31.0/nghttp2-1.31.0.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo tar -zxf nghttp2-1.31.0.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/nghttp2-1.31.0
    vm13$ sudo env OPENSSL_CFLAGS="-I/usr/local/openssl/include" OPENSSL_LIBS="-L/usr/local/openssl/lib -lssl -lcrypto" ./configure
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> Makefile
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/nghttp2-1.31.0
    vm13$ sudo make
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ビルド実行
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/nghttp2-1.31.0
    vm13$ sudo make install
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> インストール
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm13 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[X06]
  compile - 06
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール (Apache)
  
[確認]
  $ cd $HOME
  $ ssh vm13 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Sat Jul  1 08:53:37 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://dlcdn.apache.org//httpd/httpd-2.4.57.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo wget --no-check-certificate https://downloads.apache.org/httpd/httpd-2.4.57.tar.gz.sha256
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo sha256sum -c httpd-2.4.57.tar.gz.sha256
    
    コマンドの実行結果
    --------------------------------------------------
    httpd-2.4.57.tar.gz: 完了
    --------------------------------------------------
    
    vm13$ cd /usr/local/src
    vm13$ sudo tar -zxf httpd-2.4.57.tar.gz
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/httpd-2.4.57
    vm13$ sudo cat INSTALL
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> インストール概要を確認、以降は概要に従い作業する
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/httpd-2.4.57
    vm13$ sudo ./configure
        > --prefix=/usr/local/apache2                // DESTINATION
        > --with-apr=/usr/local/apr-1.7.4            // APR
        > --with-apr-util=/usr/local/apr-util-1.6.3  // APR-UTIL
        > --with-pcre=/usr/local/pcre-8.45           // PCRE
        > --with-ssl=/usr/local/openssl-1.1.0        // OPENSSL
        > --with-mpm=prefork                         // PHP(prefork)
        > --enable-http2                             // HTTP2
        > --enable-ssl                               // SSL
        > --enable-so                                // APXS
        > --enable-mods-shared=all                   // DDL
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> Makefile
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/httpd-2.4.57
    vm13$ sudo make
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> ビルド実行
    --------------------------------------------------
    
    vm13$ cd /usr/local/src/httpd-2.4.57
    vm13$ sudo make install
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> インストール
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ LANG=C sudo useradd -d /tmp -s /sbin/nologin apache
    
    コマンドの実行結果
    --------------------------------------------------
    useradd: warning: the home directory already exists.
    Not copying any file from skel directory into it.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ LANG=C sudo passwd apache
    
    コマンドの実行結果
    --------------------------------------------------
    Changing password for user apache.
    New password: (apache)
    BAD PASSWORD: The password is shorter than 8 characters
    Retype new password: (apache)
    passwd: all authentication tokens updated successfully.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo chown -R apache:apache /usr/local/apache2
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo vi /etc/bashrc
    
    コマンドの実行結果
    --------------------------------------------------
    (末尾に追加) -> PATH=$PATH:/usr/local/apache2/bin
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ source /etc/bashrc
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ which apachectl
    
    コマンドの実行結果
    --------------------------------------------------
    /usr/local/apache2/bin/apachectl
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo vi /usr/lib/systemd/system/httpd.service -> 自動起動のためサービスファイルを作成
    
    コマンドの実行結果
    --------------------------------------------------
    [Unit]
    Description=Apache httpd daemon
    
    [Service]
    Type=forking
    ExecStart=/usr/local/apache2/bin/apachectl -k start
    ExecStop=/usr/local/apache2/bin/apachectl -k stop
    
    [Install]
    WantedBy=multi-user.target
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl daemon-reload -> システムに通知
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl enable httpd
    
    コマンドの実行結果
    --------------------------------------------------
    Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl start httpd
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl is-active httpd
    
    コマンドの実行結果
    --------------------------------------------------
    active
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl stop httpd
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl disable httpd
    
    コマンドの実行結果
    --------------------------------------------------
    Removed /etc/systemd/system/multi-user.target.wants/httpd.service.
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm13 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
