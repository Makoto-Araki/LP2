================================================================================
[01] Apache - 01 (ソースから構築 - APR)
[02] Apache - 02 (ソースから構築 - APR-Util)
[03] Apache - 03 (ソースから構築 - PCRE)
[04] Apache - 04 (ソースから構築 - OPENSSL)
[05] Apache - 05 (ソースから構築 - NGHTTP2)
[06] Apache - 06 (ソースから構築 - Apache)
================================================================================
[01]
  Apache - 01 (ソースから構築 - APR)
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ sudo yum -y install wget gcc expat-devel (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo wget --no-check-certificate https://www.apache.org/dist/apr/apr-1.7.0.tar.gz (ソース取得)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo wget --no-check-certificate https://www.apache.org/dist/apr/apr-1.7.0.tar.gz.sha256 (チェックサム取得)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo sha256sum -c apr-1.7.0.tar.gz.sha256 (チェックサム確認)
  
  コマンドの実行結果
  --------------------------------------------------
  apr-1.7.0.tar.gz: 完了
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo tar -zxf apr-1.7.0.tar.gz (アーカイブ解凍と展開)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/apr-1.7.0
  vm12$ sudo ./configure --prefix=/usr/local/apr-1.7.0 (Makefile生成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/apr-1.7.0
  vm12$ sudo make (ビルド実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/apr-1.7.0
  vm12$ sudo make install (インストール実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  Apache - 02 (ソースから構築 - APR-Util)
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd /usr/local/src
  vm12$ sudo wget --no-check-certificate https://dlcdn.apache.org//apr/apr-util-1.6.1.tar.gz (ソース取得)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo wget --no-check-certificate https://www.apache.org/dist/apr/apr-util-1.6.1.tar.gz.sha256 (チェックサム取得)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo sha256sum -c apr-util-1.6.1.tar.gz.sha256 (チェックサム確認)
  
  コマンドの実行結果
  --------------------------------------------------
  apr-util-1.6.1.tar.gz: 完了
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo tar -zxf apr-util-1.6.1.tar.gz (アーカイブ解凍と展開)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/apr-util-1.6.1
  vm12$ sudo ./configure --prefix=/usr/local/apr-util-1.6.1 --with-apr=/usr/local/apr-1.7.0 (Makefile生成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/apr-util-1.6.1
  vm12$ sudo make (ビルド実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/apr-util-1.6.1
  vm12$ sudo make install (インストール実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  Apache - 03 (ソースから構築 - PCRE)
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ sudo yum -y install gcc-c++ (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src (ソース取得)
  vm12$ sudo wget --no-check-certificate https://sourceforge.net/projects/pcre/files/pcre/8.45/pcre-8.45.tar.gz
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo tar -zxf pcre-8.45.tar.gz (アーカイブ解凍と展開)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/pcre-8.45
  vm12$ sudo ./configure --prefix=/usr/local/pcre-8.45 (Makefile生成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/pcre-8.45
  vm12$ sudo make (ビルド実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/pcre-8.45
  vm12$ sudo make install (インストール実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  Apache - 04 (ソースから構築 - OPENSSL)
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ sudo yum -y install perl (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo wget --no-check-certificate https://www.openssl.org/source/openssl-1.1.0h.tar.gz (ソース取得)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo tar -zxf openssl-1.1.0h.tar.gz (アーカイブ解凍と展開)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/openssl-1.1.0h
  vm12$ sudo ./config --openssldir=/usr/local/openssl-1.1.0 (Makefile生成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/openssl-1.1.0h
  vm12$ sudo make (ビルド実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/openssl-1.1.0h
  vm12$ sudo make install (インストール実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  Apache - 05 (ソースから構築 - NGHTTP2)
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd /usr/local/src (ソース取得)
  vm12$ sudo wget --no-check-certificate https://github.com/nghttp2/nghttp2/releases/download/v1.31.0/nghttp2-1.31.0.tar.gz
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo tar -zxf nghttp2-1.31.0.tar.gz (アーカイブ解凍と展開)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/nghttp2-1.31.0 (Makefile生成)
  vm12$ sudo env OPENSSL_CFLAGS="-I/usr/local/openssl/include" OPENSSL_LIBS="-L/usr/local/openssl/lib -lssl -lcrypto" ./configure
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/nghttp2-1.31.0
  vm12$ sudo make (ビルド実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/nghttp2-1.31.0
  vm12$ sudo make install (インストール実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[06]
  Apache - 06 (ソースから構築 - Apache)
  
[内容]
  ## 作業内容
    ソースからコンパイルとインストール
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd /usr/local/src
  vm12$ sudo wget --no-check-certificate https://dlcdn.apache.org//httpd/httpd-2.4.52.tar.gz (ソース取得)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo wget --no-check-certificate https://downloads.apache.org/httpd/httpd-2.4.52.tar.gz.sha256 (チェックサム取得)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo sha256sum -c httpd-2.4.52.tar.gz.sha256 (チェックサム確認)
  
  コマンドの実行結果
  --------------------------------------------------
  httpd-2.4.52.tar.gz: 完了
  --------------------------------------------------
  
  vm12$ cd /usr/local/src
  vm12$ sudo tar -zxf httpd-2.4.52.tar.gz (アーカイブ解凍と展開)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/httpd-2.4.52
  vm12$ sudo cat INSTALL (INSTALL確認)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> インストール概要を確認、以降は概要に従い作業する
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/httpd-2.4.52
  vm12$ (Makefile生成)
    sudo ./configure
    --prefix=/usr/local/apache2
    --with-apr=/usr/local/apr-1.7.0            // APR
    --with-apr-util=/usr/local/apr-util-1.6.1  // APR-Util
    --with-pcre=/usr/local/pcre-8.45           // PCRE
    --with-ssl=/usr/local/openssl-1.1.0        // OPENSSL
    --with-mpm=prefork                         // PHP(prefork)
    --enable-http2            // HTTP2
    --enable-ssl              // SSL
    --enable-so               // APXS
    --enable-mods-shared=all  // Dynamic Modules
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/httpd-2.4.52
  vm12$ sudo make (ビルド実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /usr/local/src/httpd-2.4.52
  vm12$ sudo make install (インストール実行)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo useradd -d /tmp -s /sbin/nologin apache (実行用ユーザー追加)
  
  コマンドの実行結果
  --------------------------------------------------
  useradd: 警告: ホームディレクトリが既に存在します。
  skel ディレクトリからのコピーは行いません。
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo passwd apache (パスワード更新)
  
  コマンドの実行結果
  --------------------------------------------------
  ユーザー apache のパスワードを変更。
  新しいパスワード: (パスワード入力)
  新しいパスワードを再入力してください: (パスワード入力)
  passwd: すべての認証トークンが正しく更新できました。
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo chown -R apache:apache /usr/local/apache2 (所有者とグループの変更)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo vi /etc/bashrc (シェルの設定ファイル編集)
  
  コマンドの実行結果
  --------------------------------------------------
  (末尾に追加) -> PATH=$PATH:/usr/local/apache2/bin
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ source /etc/bashrc (シェルの設定ファイルを読み込み)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo vi /usr/lib/systemd/system/httpd.service (自動起動のためサービスファイルを作成)
  
  コマンドの実行結果
  --------------------------------------------------
  [Unit]
  Description=Apache httpd daemon
  
  [Service]
  Type=forking
  ExecStart=/usr/local/apache2/bin/apachectl -k start
  
  [Install]
  WantedBy=multi-user.target
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl daemon-reload (サービスファイルをシステムに通知)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl enable httpd (サービスの自動起動)
  
  コマンドの実行結果
  --------------------------------------------------
  Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl start httpd (サービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl status httpd (サービスの状態)
  
  コマンドの実行結果
  --------------------------------------------------
  ● httpd.service - Apache httpd daemon
     Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)
     Active: active (running) since 日 2022-01-16 19:00:28 JST; 45s ago
    Process: 3384 ExecStart=/usr/local/apache2/bin/apachectl -k start (code=exited, status=0/SUCCESS)
   Main PID: 3387 (httpd)
     CGroup: /system.slice/httpd.service
             ├─3387 /usr/local/apache2/bin/httpd -k start
             ├─3388 /usr/local/apache2/bin/httpd -k start
             ├─3389 /usr/local/apache2/bin/httpd -k start
             ├─3390 /usr/local/apache2/bin/httpd -k start
             ├─3391 /usr/local/apache2/bin/httpd -k start
             └─3392 /usr/local/apache2/bin/httpd -k start
  
  1月 16 19:00:28 vm12 systemd[1]      : Starting Apache httpd daemon...
  1月 16 19:00:28 vm12 apachectl[3384] : AH00558: httpd: Could not reliably d...e
  1月 16 19:00:28 vm12 systemd[1]      : Started Apache httpd daemon.
  Hint: Some lines were ellipsized, use -l to show in full.
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ curl localhost:80 (Webページ要求に対する応答)
  
  コマンドの実行結果
  --------------------------------------------------
  <html><body><h1>It works!</h1></body></html>
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl stop httpd (サービスの停止)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
