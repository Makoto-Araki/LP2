================================================================================
[001] RAIDの構築と運用 - 01 (RAID-0)
[002] RAIDの構築と運用 - 02 (RAID-1)
[003] RAIDの構築と運用 - 03 (RAID-4)
[004] RAIDの構築と運用 - 04 (RAID-5)
[005] RAIDの構築と運用 - 05
[006] RAIDの構築と運用 - 06
[007] LVMの調査
[008] LVMの作成
[009] LVMの管理 - 01 (ボリュームグループの拡張・縮小)
[010] LVMの管理 - 02 (論理ボリュームの拡張・縮小)
[011] LVMの管理 - 03 (スナップショット)
[012] ハードディスクの管理
[013] SSD
[014] iSCSI
================================================================================
[001]
  RAIDの構築と運用 - 01 (RAID-0)
  
[内容]
  ## 作業内容
    RAIDアレイ(RAID-0)の作成後にマウントする
  
  ## コマンド(mdadm) - 01
    mdadm --create(-C) XX                        : RAIDアレイ(XX)を作成
    mdadm --create(-C) XX --auto(-a)             : RAIDアレイ(XX)を作成、デバイスファイル自動作成
    mdadm --create(-C) XX --chunk(-c) YY         : RAIDアレイ(XX)を作成、チャンクサイズ(YY)
    mdadm --create(-C) XX --level(-l) YY         : RAIDアレイ(XX)を作成、RAIDレベル(YY)
    mdadm --create(-C) XX --raid-devices(-n) YY  : RAIDアレイ(XX)を作成、RAIDデバイス数(YY)
    mdadm --create(-C) XX --spare-devices(-x) YY : RAIDアレイ(XX)を作成、スペアデバイス数(YY)
  
  ## コマンド(mdadm) - 02
    mdadm --manage XX                 : RAIDアレイ(XX)をメンテ
    mdadm --manage XX --add(-a) YY    : RAIDアレイ(XX)をメンテ、デバイス(YY)を追加
    mdadm --manage XX --remove(-r) YY : RAIDアレイ(XX)をメンテ、デバイス(YY)を削除
    mdadm --manage XX --fail(-f) YY   : RAIDアレイ(XX)をメンテ、デバイス(YY)に不良マーク
  
  ## コマンド(mdadm) - 03
    mdadm --misc XX               : RAIDアレイ(XX)を問合せ
    mdadm --misc --query(-Q) XX   : RAIDアレイ(XX)を問合せ、RAIDアレイ(XX)を状態を表示
    mdadm --misc --detail(-D) XX  : RAIDアレイ(XX)を問合せ、RAIDアレイ(XX)を状態を表示
    mdadm --misc --examine(-E) XX : RAIDアレイ(XX)を問合せ、構成デバイスの状態を表示
    mdadm --misc --readonly XX    : RAIDアレイ(XX)を読み取り専用にする
    mdadm --misc --readwrite XX   : RAIDアレイ(XX)を書き込み可能にする
    mdadm --misc --stop XX        : RAIDアレイ(XX)を停止する
    mdadm --misc --stop --scan XX : RAIDアレイを停止する
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun  7 12:29:59 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dd if=/dev/zero of=image0.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image1.img bs=10M count=10
    
    コマンドの実行結果
    --------------------------------------------------
    // image0.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.415416 s, 252 MB/s
    
    // image1.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.451671 s, 232 MB/s
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup /dev/loop0 image0.img
    vm11$ sudo losetup /dev/loop1 image1.img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm             // アレイ作成
        > --create /dev/md0      // アレイ名
        > --level 0              // レベル
        > --raid-devices 2       // デバイス数
        > /dev/loop0 /dev/loop1  // デバイス名
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: Defaulting to version 1.2 metadata
    mdadm: array /dev/md0 started.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /proc/mdstat -> アレイ確認
    
    コマンドの実行結果
    --------------------------------------------------
    Personalities : [raid0] 
    md0 : active raid0 loop1[1] loop0[0]
          200704 blocks super 1.2 512k chunks      
    unused devices: <none>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkfs -t xfs /dev/md0
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mount -o defaults /dev/md0 /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo umount /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm (--misc) --stop /dev/md0 -> アレイ停止
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: stopped /dev/md0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup -D
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ rm -f image[0-1].img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[002]
  RAIDの構築と運用 - 02 (RAID-1)
  
[内容]
  ## 作業内容
    RAIDアレイ(RAID-1)の作成後にマウントする
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun  7 12:33:47 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dd if=/dev/zero of=image0.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image1.img bs=10M count=10
    
    コマンドの実行結果
    --------------------------------------------------
    // image0.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.138058 s, 760 MB/s
    
    // image1.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.286048 s, 367 MB/s
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup /dev/loop0 image0.img
    vm11$ sudo losetup /dev/loop1 image1.img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm             // アレイ作成
        > --create /dev/md0      // アレイ名
        > --level 1              // レベル
        > --raid-devices 2       // デバイス数
        > /dev/loop0 /dev/loop1  // デバイス名
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: Defaulting to version 1.2 metadata
    mdadm: array /dev/md0 started.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /proc/mdstat -> アレイ確認
    
    コマンドの実行結果
    --------------------------------------------------
    Personalities : [raid0] [raid1] 
    md0 : active raid1 loop1[1] loop0[0]
          101376 blocks super 1.2 [2/2] [UU]
    unused devices: <none>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkfs -t xfs /dev/md0
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mount -o defaults /dev/md0 /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo umount /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm (--misc) --stop /dev/md0 -> アレイ停止
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: stopped /dev/md0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup -D
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ rm -f image[0-1].img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[003]
  RAIDの構築と運用 - 03 (RAID-4)
  
[内容]
  ## 作業内容
    RAIDアレイ(RAID-4)の作成後にマウントする
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun  7 14:01:25 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dd if=/dev/zero of=image0.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image1.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image2.img bs=10M count=10
    
    コマンドの実行結果
    --------------------------------------------------
    // image0.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.12755 s, 822 MB/s
    
    // image1.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.442624 s, 237 MB/s
    
    // image2.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.635922 s, 165 MB/s
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup /dev/loop0 image0.img
    vm11$ sudo losetup /dev/loop1 image1.img
    vm11$ sudo losetup /dev/loop2 image2.img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm                        // アレイ作成
        > --create /dev/md0                 // アレイ名
        > --level 4                         // レベル
        > --raid-devices 3                  // デバイス数
        > /dev/loop0 /dev/loop1 /dev/loop2  // デバイス名
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: Defaulting to version 1.2 metadata
    mdadm: array /dev/md0 started.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /proc/mdstat -> アレイ確認
    
    コマンドの実行結果
    --------------------------------------------------
    Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] 
    md0 : active raid4 loop2[3] loop1[1] loop0[0]
          200704 blocks super 1.2 level 4, 512k chunk, algorithm 0 [3/3] [UUU]      
    unused devices: <none>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkfs -t xfs /dev/md0
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mount -o defaults /dev/md0 /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo umount /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm (--misc) --stop /dev/md0 -> アレイ停止
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: stopped /dev/md0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup -D
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ rm -f image[0-2].img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[004]
  RAIDの構築と運用 - 04 (RAID-5)
  
[内容]
  ## 作業内容
    RAIDアレイ(RAID-5)の作成後にマウントする
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun  7 18:08:30 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dd if=/dev/zero of=image0.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image1.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image2.img bs=10M count=10
    
    コマンドの実行結果
    --------------------------------------------------
    // image0.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.126731 s, 827 MB/s
    
    // image1.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.119279 s, 879 MB/s
    
    // image2.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.151261 s, 693 MB/s
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup /dev/loop0 image0.img
    vm11$ sudo losetup /dev/loop1 image1.img
    vm11$ sudo losetup /dev/loop2 image2.img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm                        // アレイ作成
        > --create /dev/md0                 // アレイ名
        > --level 5                         // レベル
        > --raid-devices 3                  // デバイス数
        > /dev/loop0 /dev/loop1 /dev/loop2  // デバイス名
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: Defaulting to version 1.2 metadata
    mdadm: array /dev/md0 started.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /proc/mdstat -> アレイ確認
    
    コマンドの実行結果
    --------------------------------------------------
    Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] 
    md0 : active raid5 loop2[3] loop1[1] loop0[0]
          200704 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/3] [UUU]      
    unused devices: <none>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkfs -t xfs /dev/md0
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mount -o defaults /dev/md0 /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo umount /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm (--misc) --stop /dev/md0 -> アレイ停止
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: stopped /dev/md0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup -D
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ rm -f image[0-2].img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[005]
  RAIDの構築と運用 - 05
  
[内容]
  ## 作業内容
    RAIDアレイ(RAID-5)に対して「--misc」で様々な問合せ
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun  7 18:33:35 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dd if=/dev/zero of=image0.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image1.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image2.img bs=10M count=10
    
    コマンドの実行結果
    --------------------------------------------------
    // image0.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.114007 s, 920 MB/s
    
    // image1.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.119548 s, 877 MB/s
    
    // image2.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.11592 s, 905 MB/s
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup /dev/loop0 image0.img
    vm11$ sudo losetup /dev/loop1 image1.img
    vm11$ sudo losetup /dev/loop2 image2.img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm                        // アレイ作成
        > --create /dev/md0                 // アレイ名
        > --level 5                         // レベル
        > --raid-devices 3                  // デバイス数
        > /dev/loop0 /dev/loop1 /dev/loop2  // デバイス名
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: Defaulting to version 1.2 metadata
    mdadm: array /dev/md0 started.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /proc/mdstat -> アレイ確認
    
    コマンドの実行結果
    --------------------------------------------------
    Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] 
    md0 : active raid5 loop2[3] loop1[1] loop0[0]
          200704 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/3] [UUU]      
    unused devices: <none>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --misc -Q(--query) /dev/md0 -> アレイ状態
    
    コマンドの実行結果
    --------------------------------------------------
    /dev/md0: 196.00MiB raid5 3 devices, 0 spares. Use mdadm --detail for more detail
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --misc -D(--detail) /dev/md0 -> アレイ詳細
    
    コマンドの実行結果
    --------------------------------------------------
    /dev/md0:
      Version            : 1.2
      Creation Time      : Wed Jun  7 18:56:23 2023
      Raid Level         : raid5
      Array Size         : 200704 (196.00 MiB 205.52 MB)
      Used Dev Size      : 100352 (98.00 MiB 102.76 MB)
      Raid Devices       : 3
      Total Devices      : 3
      Persistence        : Superblock is persistent
      Update Time        : Wed Jun  7 18:56:25 2023
      State              : clean 
      Active Devices     : 3
      Working Devices    : 3
      Failed Devices     : 0
      Spare Devices      : 0
      Layout             : left-symmetric
      Chunk Size         : 512K
      Consistency Policy : resync
      Name               : vm11:0  (local to host vm11)
      UUID               : 66c8cf54:9efa9df9:a1453815:0db187a6
      Events             : 18
      
      Number   Major   Minor   RaidDevice   State
      0        7       0       0            active sync   /dev/loop0
      1        7       1       1            active sync   /dev/loop1
      3        7       2       2            active sync   /dev/loop2
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --misc -E(--examine) /dev/md0 -> アレイ状態
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: No md superblock detected on /dev/md0.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm (--misc) --stop /dev/md0 -> アレイ停止
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: stopped /dev/md0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup -D
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ rm -f image[0-2].img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[006]
  RAIDの構築と運用 - 06
  
[内容]
  ## 作業内容
    RAIDアレイ(RAID-5)に対して「--manage」で予備デバイス操作
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun  7 18:48:59 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dd if=/dev/zero of=image0.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image1.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image2.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image3.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image4.img bs=10M count=10
    
    コマンドの実行結果
    --------------------------------------------------
    // image0.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.133254 s, 787 MB/s
    
    // image1.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.144073 s, 728 MB/s
    
    // image2.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.127716 s, 821 MB/s
    
    // image3.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.390171 s, 269 MB/s
    
    // image4.img
    10+0 レコード入力
    10+0 レコード出力
    104857600 bytes (105 MB, 100 MiB) copied, 0.429531 s, 244 MB/s
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup /dev/loop0 image0.img
    vm11$ sudo losetup /dev/loop1 image1.img
    vm11$ sudo losetup /dev/loop2 image2.img
    vm11$ sudo losetup /dev/loop3 image3.img
    vm11$ sudo losetup /dev/loop4 image4.img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm                                   // アレイ作成
        > --create /dev/md0                            // アレイ名
        > --level 5                                    // レベル
        > --raid-devices 3                             // デバイス数
        > --spare-devices 1                            // スペア数
        > /dev/loop0 /dev/loop1 /dev/loop2 /dev/loop3  // デバイス名
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: Defaulting to version 1.2 metadata
    mdadm: array /dev/md0 started.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ cat /proc/mdstat -> アレイ確認
    
    コマンドの実行結果
    --------------------------------------------------
    Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] 
    md0 : active raid5 loop2[4] loop3[3](S) loop1[1] loop0[0]
          200704 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/3] [UUU]      
    unused devices: <none>
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --misc -Q(--query) /dev/md0 -> アレイ状態
    
    コマンドの実行結果
    --------------------------------------------------
    /dev/md0: 196.00MiB raid5 3 devices, 1 spare. Use mdadm --detail for more detail.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --misc -D(--detail) /dev/md0 -> アレイ詳細
    
    コマンドの実行結果
    --------------------------------------------------
    /dev/md0:
      Version            : 1.2
      Creation Time      : Wed Jun  7 20:05:24 2023
      Raid Level         : raid5
      Array Size         : 200704 (196.00 MiB 205.52 MB)
      Used Dev Size      : 100352 (98.00 MiB 102.76 MB)
      Raid Devices       : 3
      Total Devices      : 4
      Persistence        : Superblock is persistent
      Update Time        : Wed Jun  7 20:05:25 2023
      State              : clean 
      Active Devices     : 3
      Working Devices    : 4
      Failed Devices     : 0
      Spare Devices      : 1
      Layout             : left-symmetric
      Chunk Size         : 512K
      Consistency Policy : resync
      Name               : vm11:0  (local to host vm11)
      UUID               : e948e4a7:4fc31f3a:20b32de6:5fe42c7a
      Events             : 18
      
      Number   Major   Minor   RaidDevice   State
      0        7       0       0            active sync   /dev/loop0
      1        7       1       1            active sync   /dev/loop1
      4        7       2       2            active sync   /dev/loop2
      3        7       3       -            spare         /dev/loop3
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --manage /dev/md0 -f(--fail) /dev/loop0 -> 不良マーク
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: set /dev/loop0 faulty in /dev/md0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --misc -D(--detail) /dev/md0 -> アレイ詳細
    
    コマンドの実行結果
    --------------------------------------------------
    /dev/md0:
      Version            : 1.2
      Creation Time      : Wed Jun  7 20:05:24 2023
      Raid Level         : raid5
      Array Size         : 200704 (196.00 MiB 205.52 MB)
      Used Dev Size      : 100352 (98.00 MiB 102.76 MB)
      Raid Devices       : 3
      Total Devices      : 4
      Persistence        : Superblock is persistent
      Update Time        : Wed Jun  7 20:22:09 2023
      State              : clean 
      Active Devices     : 3
      Working Devices    : 3
      Failed Devices     : 1
      Spare Devices      : 0
      Layout             : left-symmetric
      Chunk Size         : 512K
      Consistency Policy : resync
      Name               : vm11:0  (local to host vm11)
      UUID               : e948e4a7:4fc31f3a:20b32de6:5fe42c7a
      Events             : 37
      
      Number   Major   Minor   RaidDevice   State
      3        7       3       0            active sync   /dev/loop3  // スペアがアレイに組み込まれる
      1        7       1       1            active sync   /dev/loop1
      4        7       2       2            active sync   /dev/loop2
      0        7       0       -            faulty        /dev/loop0  // 不良マーク
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --manage /dev/md0 -r(--remove) /dev/loop0 -> 不良デバイス削除
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: hot removed /dev/loop0 from /dev/md0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --misc -D(--detail) /dev/md0 -> アレイ詳細
    
    コマンドの実行結果
    --------------------------------------------------
    /dev/md0:
      Version            : 1.2
      Creation Time      : Wed Jun  7 20:05:24 2023
      Raid Level         : raid5
      Array Size         : 200704 (196.00 MiB 205.52 MB)
      Used Dev Size      : 100352 (98.00 MiB 102.76 MB)
      Raid Devices       : 3
      Total Devices      : 3
      Persistence        : Superblock is persistent
      Update Time        : Wed Jun  7 20:32:22 2023
      State              : clean 
      Active Devices     : 3
      Working Devices    : 3
      Failed Devices     : 0
      Spare Devices      : 0
      Layout             : left-symmetric
      Chunk Size         : 512K
      Consistency Policy : resync
      Name               : vm11:0  (local to host vm11)
      UUID               : e948e4a7:4fc31f3a:20b32de6:5fe42c7a
      Events             : 38
      
      Number   Major   Minor   RaidDevice   State
      3        7       3       0            active sync   /dev/loop3
      1        7       1       1            active sync   /dev/loop1
      4        7       2       2            active sync   /dev/loop2
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --manage /dev/md0 -a(--add) /dev/loop4 -> デバイス追加
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: added /dev/loop4
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm --misc -D(--detail) /dev/md0 -> アレイ詳細
    
    コマンドの実行結果
    --------------------------------------------------
    /dev/md0:
      Version            : 1.2
      Creation Time      : Wed Jun  7 20:05:24 2023
      Raid Level         : raid5
      Array Size         : 200704 (196.00 MiB 205.52 MB)
      Used Dev Size      : 100352 (98.00 MiB 102.76 MB)
      Raid Devices       : 3
      Total Devices      : 4
      Persistence        : Superblock is persistent
      Update Time        : Wed Jun  7 20:46:23 2023
      State              : clean 
      Active Devices     : 3
      Working Devices    : 4
      Failed Devices     : 0
      Spare Devices      : 1
      Layout             : left-symmetric
      Chunk Size         : 512K
      Consistency Policy : resync
      Name               : vm11:0  (local to host vm11)
      UUID               : e948e4a7:4fc31f3a:20b32de6:5fe42c7a
      Events             : 39
      
      Number   Major   Minor   RaidDevice   State
      3        7       3       0            active sync   /dev/loop3
      1        7       1       1            active sync   /dev/loop1
      4        7       2       2            active sync   /dev/loop2
      5        7       4       -            spare         /dev/loop4  // 追加デバイス
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mdadm (--misc) --stop /dev/md0 -> アレイ停止
    
    コマンドの実行結果
    --------------------------------------------------
    mdadm: stopped /dev/md0
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup -D
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ rm -f image[0-4].img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[007]
  LVMの調査
  
[内容]
  ## 作業内容
    仮想マシンのLVMについて調査
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  Last login: Wed Jun  7 20:01:11 2023 from 192.168.122.1
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ lsblk
    
    コマンドの実行結果
    --------------------------------------------------
    NAME                    MAJ:MIN  RM  SIZE  RO  TYPE  MOUNTPOINT
    sr0                      11:0     1 1024M   0  rom   
    vda                     252:0     0   30G   0  disk  
     |-- vda1               252:1     0    1G   0  part  /boot
     |-- vda2               252:2     0   29G   0  part  
          |-- rl_vm11-root  253:0     0   26G   0  lvm   /
          |-- rl_vm11-swap  253:1     0    3G   0  lvm   [SWAP]
    vdb                     252:16    0    2G   0  disk  
     |-- vdb1               252:17    0  999M   0  part  /mnt/mp1
     |-- vdb2               252:18    0  980M   0  part  /mnt/mp2
    vdc                     252:32    0    2G   0  disk  
     |-- vdc1               252:33    0  999M   0  part  [SWAP]
     |-- vdc2               252:34    0  980M   0  part  [SWAP]
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C sudo parted /dev/vda -s print -> パーティション情報
    
    コマンドの実行結果
    --------------------------------------------------
    Model: Virtio Block Device (virtblk)
    Disk /dev/vda: 32.2GB
    Sector size (logical/physical): 512B/512B
    Partition Table: msdos
    Disk Flags: 
    
    Number  Start   End     Size    Type     Filesystem  Flags
    1       1049kB  1075MB  1074MB  primary  xfs           boot
    2       1075MB  32.2GB  31.1GB  primary                lvm  // LVM が判明
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C sudo parted /dev/vdb -s print -> パーティション情報
    
    コマンドの実行結果
    --------------------------------------------------
    Model: Virtio Block Device (virtblk)
    Disk /dev/vdb: 2097MB
    Sector size (logical/physical): 512B/512B
    Partition Table: msdos
    Disk Flags: 
    
    Number  Start   End     Size    Type     Filesystem  Flags
    1       1049kB  1049MB  1048MB  primary  ext4
    2       1070MB  2097MB  1028MB  primary  ext4
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ LANG=C sudo parted /dev/vdc -s print -> パーティション情報
    
    コマンドの実行結果
    --------------------------------------------------
    Model: Virtio Block Device (virtblk)
    Disk /dev/vdc: 2097MB
    Sector size (logical/physical): 512B/512B
    Partition Table: msdos
    Disk Flags: 
    
    Number  Start   End     Size    Type     Filesystem      Flags
    1       1049kB  1049MB  1048MB  primary  linux-swap(v1)
    2       1070MB  2097MB  1028MB  primary  linux-swap(v1)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo lvscan -> 論理ボリューム探査
    
    コマンドの実行結果
    --------------------------------------------------
    ACTIVE  '/dev/rl_vm11/swap' [3.00 GiB] inherit
    ACTIVE  '/dev/rl_vm11/root' [<26.00 GiB] inherit
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vgscan -> ボリュームグループ探査
    
    コマンドの実行結果
    --------------------------------------------------
    Found volume group "rl_vm11" using metadata type lvm2
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo pvscan -> 物理ボリューム探査
    
    コマンドの実行結果
    --------------------------------------------------
    PV /dev/vda2   VG rl_vm11   lvm2 [<29.00 GiB / 0    free]
    Total: 1 [<29.00 GiB] / in use: 1 [<29.00 GiB] / in no VG: 0 [0   ]
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ exit
    
    コマンドの実行結果
    --------------------------------------------------
    Connection to vm11 closed.
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[008]
  LVMの作成
  
[内容]
  ## 作業内容
    論理ボリュームを作成後にマウントする
  
[確認]
  $ cd $HOME
  $ ssh vm11 -> 公開鍵認証でSSH接続
  
  コマンドの実行結果
  --------------------------------------------------
  //
  --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ dd if=/dev/zero of=image0.img bs=10M count=10
    vm11$ dd if=/dev/zero of=image1.img bs=10M count=10
    
    コマンドの実行結果
    --------------------------------------------------
    // image0.img
    // image1.img
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo losetup /dev/loop0 image0.img
    vm11$ sudo losetup /dev/loop1 image1.img
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo pvcreate /dev/loop0 /dev/loop1 -> 物理ボリュームの初期化
    
    コマンドの実行結果
    --------------------------------------------------
    Physical volume "/dev/loop0" successfully created.
    Physical volume "/dev/loop1" successfully created.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vgcreate vg0 /dev/loop0 /dev/loop1 -> ボリュームグループの作成
    
    コマンドの実行結果
    --------------------------------------------------
    Volume group "vg0" successfully created
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo lvcreate -L 50M -n lv0 vg0 -> 論理ボリュームの作成
    vm11$ sudo lvcreate -L 50M -n lv1 vg0 -> 論理ボリュームの作成
    vm11$ sudo lvcreate -L 50M -n lv2 vg0 -> 論理ボリュームの作成
    
    コマンドの実行結果
    --------------------------------------------------
    Rounding up size to full physical extent 52.00 MiB
    Logical volume "lv0" created.
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mkfs -t xfs /dev/vg0/lv0
    vm11$ sudo mkfs -t xfs /dev/vg0/lv1
    vm11$ sudo mkfs -t xfs /dev/vg0/lv2
    
    コマンドの実行結果
    --------------------------------------------------
    (省略)
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv0 /mnt/loop0
    vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv1 /mnt/loop1
    vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv2 /mnt/loop2
    
    コマンドの実行結果
    --------------------------------------------------
    [10536.272400] XFS (dm-2): Mounting V5 Filesystem
    [10536.282739] XFS (dm-2): Ending clean mount
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo pvscan -> 物理ボリュームの表示
    
    コマンドの実行結果
    --------------------------------------------------
    PV /dev/loop0   VG vg0             lvm2 [96.00 MiB / 0         free]
    PV /dev/loop1   VG vg0             lvm2 [96.00 MiB / 36.00 MiB free]
    PV /dev/vda2    VG centos_vm11     lvm2 [<19.00 GiB / 0    free]
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo pvdisplay /dev/loop0 -> 物理ボリュームの詳細を表示
    
    コマンドの実行結果
    --------------------------------------------------
    PV Name               /dev/loop0
    VG Name               vg0
    PV Size               100.00 MiB / not usable 4.00 MiB
    Allocatable           yes (but full)
    PE Size               4.00 MiB
    Total PE              24
    Free PE               0
    Allocated PE          24
    PV UUID               Cc9lde-1Zu3-EQvZ-HPMk-Zih2-yDQj-KKrZlG
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo pvdisplay /dev/loop1 -> 物理ボリュームの詳細を表示
    
    コマンドの実行結果
    --------------------------------------------------
    PV Name               /dev/loop1
    VG Name               vg0
    PV Size               100.00 MiB / not usable 4.00 MiB
    Allocatable           yes 
    PE Size               4.00 MiB
    Total PE              24
    Free PE               9
    Allocated PE          15
    PV UUID               PmTv4a-qhzB-MwdA-ODJP-eqYJ-ro3K-fi2AdW
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vgscan -> ボリュームグループの表示
    
    コマンドの実行結果
    --------------------------------------------------
    Reading volume groups from cache.
    Found volume group "vg0" using metadata type lvm2
    Found volume group "centos_vm11" using metadata type lvm2
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo vgdisplay vg0 -> ボリュームグループの詳細を表示
    
    コマンドの実行結果
    --------------------------------------------------
    VG Name               vg0
    System ID             
    Format                lvm2
    Metadata Areas        2
    Metadata Sequence No  4
    VG Access             read/write
    VG Status             resizable
    MAX LV                0
    Cur LV                3
    Open LV               3
    Max PV                0
    Cur PV                2
    Act PV                2
    VG Size               192.00 MiB
    PE Size               4.00 MiB
    Total PE              48
    Alloc PE / Size       39 / 156.00 MiB
    Free  PE / Size       9 / 36.00 MiB
    VG UUID               Hps2Bi-1uI2-bMsz-Ovr1-Wca5-nrKP-1vtbnf
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo lvscan -> 論理ボリュームの表示
    
    コマンドの実行結果
    --------------------------------------------------
    ACTIVE            '/dev/vg0/lv0' [52.00 MiB] inherit
    ACTIVE            '/dev/vg0/lv1' [52.00 MiB] inherit
    ACTIVE            '/dev/vg0/lv2' [52.00 MiB] inherit
    ACTIVE            '/dev/centos_vm11/swap' [2.00 GiB] inherit
    ACTIVE            '/dev/centos_vm11/root' [<17.00 GiB] inherit
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo lvdisplay /dev/vg0/lv0 -> 論理ボリュームの詳細を表示
    
    コマンドの実行結果
    --------------------------------------------------
    LV Path                 /dev/vg0/lv0
    LV Name                 lv0
    VG Name                 vg0
    LV UUID                 NzpkHL-BeBh-LxeT-5ovo-2MlM-kCha-5IbZVi
    LV Write Access         read/write
    LV Creation host, time  vm11, 2023-04-19 20:10:34 +0900
    LV Status               available
    # open                  1
    LV Size                 52.00 MiB
    Current LE              13
    Segments                1
    Allocation              inherit
    Read ahead sectors      auto
    - currently set to      8192
    Block device            253:2
    --------------------------------------------------
    
    vm11$ cd $HOME
    vm11$ sudo lvdisplay /dev/vg0/lv1 -> 論理ボリュームの詳細を表示
    
  コマンドの実行結果
  --------------------------------------------------
  LV Path                 /dev/vg0/lv1
  LV Name                 lv1
  VG Name                 vg0
  LV UUID                 Z3WDe5-zfQq-MLsh-KFfb-6i9L-AQTW-8RwADa
  LV Write Access         read/write
  LV Creation host, time  vm11, 2023-04-19 20:11:19 +0900
  LV Status               available
  # open                  1
  LV Size                 52.00 MiB
  Current LE              13
  Segments                1
  Allocation              inherit
  Read ahead sectors      auto
  - currently set to      8192
  Block device            253:3
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvdisplay /dev/vg0/lv2 -> 論理ボリュームの詳細を表示
  
  コマンドの実行結果
  --------------------------------------------------
  LV Path                 /dev/vg0/lv2
  LV Name                 lv2
  VG Name                 vg0
  LV UUID                 2rTDQZ-2wpz-pZ10-7lgf-SK3C-Z5Yy-X2ofu0
  LV Write Access         read/write
  LV Creation host, time  vm11, 2023-04-19 20:11:26 +0900
  LV Status               available
  # open                  1
  LV Size                 52.00 MiB
  Current LE              13
  Segments                2
  Allocation              inherit
  Read ahead sectors      auto
  - currently set to      8192
  Block device            253:4
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/loop0
  vm11$ sudo umount /mnt/loop1
  vm11$ sudo umount /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  [12240.220671] XFS (dm-2): Unmounting Filesystem
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvremove /dev/vg0/lv0 -> 論理ボリュームの削除
  vm11$ sudo lvremove /dev/vg0/lv1 -> 論理ボリュームの削除
  vm11$ sudo lvremove /dev/vg0/lv2 -> 論理ボリュームの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Do you really want to remove active logical volume vg0/lv0? [y/n]: y
    Logical volume "lv0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgremove vg0 -> ボリュームグループの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvremove /dev/loop0 /dev/loop1 -> 物理ボリュームの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Labels on physical volume "/dev/loop0" successfully wiped.
  Labels on physical volume "/dev/loop1" successfully wiped.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-1].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[009]
  LVMの管理 - 01 (ボリュームグループの拡張・縮小)
  
[内容]
  ## 作業内容
    論理ボリュームがマウント状態で、ボリュームグループの拡張・縮小を実験
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image1.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image2.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.206419 s, 508 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  vm11$ sudo losetup /dev/loop1 image1.img
  vm11$ sudo losetup /dev/loop2 image2.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvcreate /dev/loop0 /dev/loop1 /dev/loop2 -> 物理ボリュームの初期化
  
  コマンドの実行結果
  --------------------------------------------------
  Physical volume "/dev/loop0" successfully created.
  Physical volume "/dev/loop1" successfully created.
  Physical volume "/dev/loop2" successfully created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgcreate vg0 /dev/loop0 /dev/loop1 -> ボリュームグループの作成
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully created
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvcreate -L 50M -n lv0 vg0 -> 論理ボリュームの作成
  vm11$ sudo lvcreate -L 50M -n lv1 vg0 -> 論理ボリュームの作成
  vm11$ sudo lvcreate -L 50M -n lv2 vg0 -> 論理ボリュームの作成
  
  コマンドの実行結果
  --------------------------------------------------
  Rounding up size to full physical extent 52.00 MiB
  Logical volume "lv0" created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/vg0/lv0
  vm11$ sudo mkfs -t xfs /dev/vg0/lv1
  vm11$ sudo mkfs -t xfs /dev/vg0/lv2
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv0 /mnt/loop0
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv1 /mnt/loop1
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv2 /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  [13607.796644] XFS (dm-2): Mounting V5 Filesystem
  [13607.805070] XFS (dm-2): Ending clean mount
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  
   |-- vg0-lv2                253:4     0    52M   0  lvm   /mnt/loop2 -> 論理ボリューム
   |-- vg0-lv0                253:2     0    52M   0  lvm   /mnt/loop0 -> 論理ボリューム
  loop1                         7:1     0   100M   0  loop  
   |-- vg0-lv2                253:4     0    52M   0  lvm   /mnt/loop2 -> 論理ボリューム
   |-- vg0-lv1                253:3     0    52M   0  lvm   /mnt/loop1 -> 論理ボリューム
  loop2                         7:2     0   100M   0  loop  (ボリュームグループに未所属)
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgreduce vg0 /dev/loop0 -> ボリュームグループの縮小
  
  コマンドの実行結果
  --------------------------------------------------
  Physical volume "/dev/loop0" still in use -> 使用中の物理ボリュームは削除不可
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgextend vg0 /dev/loop2 -> ボリュームグループの拡張
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully extended
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgdisplay vg0 -> ボリュームグループの詳細を表示
  
  コマンドの実行結果
  --------------------------------------------------
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        3
  Metadata Sequence No  5
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                3 -> /dev/vg0/lv0, /dev/vg0/lv1, /dev/vg0/lv2
  Open LV               3 -> /dev/vg0/lv0, /dev/vg0/lv1, /dev/vg0/lv2
  Max PV                0
  Cur PV                3 -> /dev/loop0, /dev/loop1, /dev/loop2
  Act PV                3 -> /dev/loop0, /dev/loop1, /dev/loop2
  VG Size               288.00 MiB
  PE Size               4.00 MiB
  Total PE              72
  Alloc PE / Size       39 / 156.00 MiB
  Free  PE / Size       33 / 132.00 MiB
  VG UUID               c2O3Tk-GiZg-cFD8-yjIT-AmsS-WInt-cNXdU1
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/loop0
  vm11$ sudo umount /mnt/loop1
  vm11$ sudo umount /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  [14874.230488] XFS (dm-2): Unmounting Filesystem
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvremove /dev/vg0/lv0 -> 論理ボリュームの削除
  vm11$ sudo lvremove /dev/vg0/lv1 -> 論理ボリュームの削除
  vm11$ sudo lvremove /dev/vg0/lv2 -> 論理ボリュームの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Do you really want to remove active logical volume vg0/lv0? [y/n]: y
    Logical volume "lv0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgremove vg0 -> ボリュームグループの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvremove /dev/loop0 /dev/loop1 /dev/loop2 -> 物理ボリュームの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Labels on physical volume "/dev/loop0" successfully wiped.
  Labels on physical volume "/dev/loop1" successfully wiped.
  Labels on physical volume "/dev/loop2" successfully wiped.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-2].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[010]
  LVMの管理 - 02 (論理ボリュームの拡張・縮小)
  
[内容]
  ## 作業内容
    論理ボリュームがマウント状態で、論理ボリュームの拡張・縮小を実験
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image1.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image2.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.163529 s, 641 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  vm11$ sudo losetup /dev/loop1 image1.img
  vm11$ sudo losetup /dev/loop2 image2.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvcreate /dev/loop0 /dev/loop1 /dev/loop2 -> 物理ボリュームの初期化
  
  コマンドの実行結果
  --------------------------------------------------
  Physical volume "/dev/loop0" successfully created.
  Physical volume "/dev/loop1" successfully created.
  Physical volume "/dev/loop2" successfully created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgcreate vg0 /dev/loop0 /dev/loop1 /dev/loop2 -> ボリュームグループの作成
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully created
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvcreate -L 50M -n lv0 vg0 -> 論理ボリュームの作成
  vm11$ sudo lvcreate -L 50M -n lv1 vg0 -> 論理ボリュームの作成
  vm11$ sudo lvcreate -L 50M -n lv2 vg0 -> 論理ボリュームの作成
  
  コマンドの実行結果
  --------------------------------------------------
  Rounding up size to full physical extent 52.00 MiB
  Logical volume "lv0" created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/vg0/lv0
  vm11$ sudo mkfs -t xfs /dev/vg0/lv1
  vm11$ sudo mkfs -t xfs /dev/vg0/lv2
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv0 /mnt/loop0
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv1 /mnt/loop1
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv2 /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  [15647.594873] XFS (dm-2): Mounting V5 Filesystem
  [15647.599373] XFS (dm-2): Ending clean mount
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  
   |-- vg0-lv0                253:2     0    52M   0  lvm   /mnt/loop0 -> 論理ボリューム
  loop1                         7:1     0   100M   0  loop  
   |-- vg0-lv1                253:3     0    52M   0  lvm   /mnt/loop1 -> 論理ボリューム
  loop2                         7:2     0   100M   0  loop  
   |-- vg0-lv2                253:4     0    52M   0  lvm   /mnt/loop2 -> 論理ボリューム
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvreduce -L 20M /dev/vg0/lv0 -> 論理ボリュームの縮小
  
  コマンドの実行結果
  --------------------------------------------------
  WARNING: Reducing active and open logical volume to 20.00 MiB.
  THIS MAY DESTROY YOUR DATA (filesystem etc.)
  Do you really want to reduce vg0/lv0? [y/n]: y  (マウント状態でも論理ボリュームのサイズ縮小は可能)
  Size of logical volume vg0/lv0 changed from 52.00 MiB (13 extents) to 20.00 MiB (5 extents).
  Logical volume vg0/lv0 successfully resized.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop 
   |-- vg0-lv0                253:2     0    20M   0  lvm   /mnt/loop0 -> 50M から 20M に縮小
  loop1                         7:1     0   100M   0  loop  
   |-- vg0-lv1                253:3     0    52M   0  lvm   /mnt/loop1
  loop2                         7:2     0   100M   0  loop  
   |-- vg0-lv2                253:4     0    52M   0  lvm   /mnt/loop2
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvdisplay /dev/vg0/lv0 -> 論理ボリュームの詳細を表示
  
  コマンドの実行結果
  --------------------------------------------------
  LV Path                 /dev/vg0/lv0
  LV Name                 lv0
  VG Name                 vg0
  LV UUID                 l6qBIP-BQUD-ReyX-X2yj-jd5i-SbJr-DyxLRB
  LV Write Access         read/write
  LV Creation host, time  vm11, 2023-04-19 21:41:11 +0900
  LV Status               available
  # open                  1
  LV Size                 20.00 MiB -> 指定したサイズに縮小
  Current LE              5
  Segments                1
  Allocation              inherit
  Read ahead sectors      auto
  - currently set to      8192
  Block device            253:2
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvextend -L 60M /dev/vg0/lv0 -> 論理ボリュームの拡張
  
  コマンドの実行結果
  --------------------------------------------------
  Size of logical volume vg0/lv0 changed from 20.00 MiB (5 extents) to 60.00 MiB (15 extents).
  Logical volume vg0/lv0 successfully resized.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop 
   |-- vg0-lv0                253:2     0    60M   0  lvm   /mnt/loop0 -> 20M から 60M に拡張
  loop1                         7:1     0   100M   0  loop  
   |-- vg0-lv1                253:3     0    52M   0  lvm   /mnt/loop1
  loop2                         7:2     0   100M   0  loop  
   |-- vg0-lv2                253:4     0    52M   0  lvm   /mnt/loop2
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvdisplay /dev/vg0/lv0 -> 論理ボリュームの詳細を表示
  
  コマンドの実行結果
  --------------------------------------------------
  LV Path                 /dev/vg0/lv0
  LV Name                 lv0
  VG Name                 vg0
  LV UUID                 l6qBIP-BQUD-ReyX-X2yj-jd5i-SbJr-DyxLRB
  LV Write Access         read/write
  LV Creation host, time  vm11, 2023-04-19 21:41:11 +0900
  LV Status               available
  # open                  1
  LV Size                 60.00 MiB -> 指定したサイズに拡張
  Current LE              15
  Segments                1
  Allocation              inherit
  Read ahead sectors      auto
  - currently set to      8192
  Block device            253:2
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/loop0
  vm11$ sudo umount /mnt/loop1
  vm11$ sudo umount /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  [16799.730558] XFS (dm-2): Unmounting Filesystem
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvremove /dev/vg0/lv0 -> 論理ボリュームの削除
  vm11$ sudo lvremove /dev/vg0/lv1 -> 論理ボリュームの削除
  vm11$ sudo lvremove /dev/vg0/lv2 -> 論理ボリュームの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Do you really want to remove active logical volume vg0/lv0? [y/n]: y
    Logical volume "lv0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgremove vg0 -> ボリュームグループの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvremove /dev/loop0 /dev/loop1 /dev/loop2 -> 物理ボリュームの削除
  
  コマンドの実行結果
  --------------------------------------------------
  Labels on physical volume "/dev/loop0" successfully wiped.
  Labels on physical volume "/dev/loop1" successfully wiped.
  Labels on physical volume "/dev/loop2" successfully wiped.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-2].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[011]
  LVMの管理 - 03 (スナップショット)
  
[内容]
  ## 作業内容
    論理ボリュームがマウント状態で、スナップショットによる復元を実験
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image1.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image2.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.155328 s, 675 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  vm11$ sudo losetup /dev/loop1 image1.img
  vm11$ sudo losetup /dev/loop2 image2.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvcreate /dev/loop0 /dev/loop1 /dev/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  Physical volume "/dev/loop0" successfully created.
  Physical volume "/dev/loop1" successfully created.
  Physical volume "/dev/loop2" successfully created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgcreate vg0 /dev/loop0 /dev/loop1 /dev/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully created
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvcreate -L 50M -n lv0 vg0
  vm11$ sudo lvcreate -L 50M -n lv1 vg0
  vm11$ sudo lvcreate -L 50M -n lv2 vg0
  
  コマンドの実行結果
  --------------------------------------------------
  Rounding up size to full physical extent 52.00 MiB
  Logical volume "lv0" created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/vg0/lv0
  vm11$ sudo mkfs -t xfs /dev/vg0/lv1
  vm11$ sudo mkfs -t xfs /dev/vg0/lv2
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv0 /mnt/loop0
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv1 /mnt/loop1
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv2 /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  [17804.880495] XFS (dm-2): Mounting V5 Filesystem
  [17804.886300] XFS (dm-2): Ending clean mount
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop 
   |-- vg0-lv0                253:2     0    60M   0  lvm   /mnt/loop0 -> 論理ボリューム
  loop1                         7:1     0   100M   0  loop  
   |-- vg0-lv1                253:3     0    52M   0  lvm   /mnt/loop1 -> 論理ボリューム
  loop2                         7:2     0   100M   0  loop  
   |-- vg0-lv2                253:4     0    52M   0  lvm   /mnt/loop2 -> 論理ボリューム
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd /mnt/loop0
  vm11$ sudo touch sample1.txt -> 論理ボリュームにファイル作成
  vm11$ sudo touch sample2.txt -> 論理ボリュームにファイル作成
  vm11$ sudo touch sample3.txt -> 論理ボリュームにファイル作成
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvcreate -s -L 20M -n sp0 /dev/vg0/lv0 -> 論理ボリュームのスナップショット作成
  
  コマンドの実行結果
  --------------------------------------------------
  Logical volume "sp0" created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvscan -> 論理ボリュームとスナップショットの確認
  
  コマンドの実行結果
  --------------------------------------------------
  ACTIVE  Original  '/dev/vg0/lv0' [52.00 MiB] inherit -> 論理ボリューム
  ACTIVE            '/dev/vg0/lv1' [52.00 MiB] inherit
  ACTIVE            '/dev/vg0/lv2' [52.00 MiB] inherit
  ACTIVE  Snapshot  '/dev/vg0/sp0' [20.00 MiB] inherit -> スナップショット
  ACTIVE            '/dev/centos_vm11/swap' [2.00 GiB] inherit
  ACTIVE            '/dev/centos_vm11/root' [<17.00 GiB] inherit
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvdisplay /dev/vg0/lv0 -> 論理ボリュームの詳細を表示
  
  コマンドの実行結果
  --------------------------------------------------
  LV Path                 /dev/vg0/lv0
  LV Name                 lv0
  VG Name                 vg0
  LV UUID                 KomZCa-jNWQ-UeiU-I9bW-iSef-VitP-cG2YIM
  LV Write Access         read/write
  LV Creation host, time  vm11, 2023-04-19 22:18:06 +0900
  LV snapshot status      source of
                          sp0 [active]
  LV Status               available
  # open                  1
  LV Size                 52.00 MiB
  Current LE              13
  Segments                1
  Allocation              inherit
  Read ahead sectors      auto
  - currently set to      8192
  Block device            253:2
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvdisplay /dev/vg0/sp0 -> スナップショットの詳細を表示
  
  コマンドの実行結果
  --------------------------------------------------
  LV Path                 /dev/vg0/sp0
  LV Name                 sp0
  VG Name                 vg0
  LV UUID                 UV6uMz-ebwp-XUXe-liMy-apLO-UnKp-LKtVaO
  LV Write Access         read/write
  LV Creation host, time  vm11, 2023-04-19 22:28:26 +0900
  LV snapshot status      active destination for lv0 -> 論理ボリューム(lv0)へのスナップショット
  LV Status               available
  # open                  0
  LV Size                 52.00 MiB
  Current LE              13
  COW-table size          20.00 MiB
  COW-table LE            5
  Allocated to snapshot   0.10%
  Snapshot chunk size     4.00 KiB
  Segments                1
  Allocation              inherit
  Read ahead sectors      auto
  - currently set to      8192
  Block device            253:7
  --------------------------------------------------
  
  vm11$ cd /mnt/loop0
  vm11$ sudo rm sample2.txt -> 論理ボリュームからファイル削除
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd /mnt/loop0
  vm11$ sudo ls -lh -> 論理ボリュームのファイル一覧
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 0 12月 31 18:29 sample1.txt
  -rw-r--r--. 1 root root 0 12月 31 18:29 sample3.txt
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/loop0 -> 論理ボリュームのアンマウント
  
  コマンドの実行結果
  --------------------------------------------------
  [18869.421267] XFS (dm-2): Unmounting Filesystem
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvconvert --merge /dev/vg0/sp0 -> スナップショットを使用して論理ボリューム復元
  
  コマンドの実行結果
  --------------------------------------------------
  Merging of volume vg0/sp0 started.
  vg0/lv0: Merged: 100.00%
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -t xfs -o defaults /dev/vg0/lv0 /mnt/loop0 -> 論理ボリュームをマウント
  
  コマンドの実行結果
  --------------------------------------------------
  [18950.265607] XFS (dm-2): Mounting V5 Filesystem
  [18950.275223] XFS (dm-2): Starting recovery (logdev: internal)
  [18950.279218] XFS (dm-2): Ending recovery (logdev: internal)
  --------------------------------------------------
  
  vm11$ cd /mnt/loop0
  vm11$ sudo ls -lh -> 論理ボリュームのファイル一覧
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 0  4月 19 22:27 sample1.txt
  -rw-r--r--. 1 root root 0  4月 19 22:27 sample2.txt  // 削除したファイルが復元
  -rw-r--r--. 1 root root 0  4月 19 22:27 sample3.txt
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvscan -> 論理ボリュームとスナップショットの確認
  
  コマンドの実行結果
  --------------------------------------------------
  ACTIVE  '/dev/vg0/lv0' [52.00 MiB] inherit  // スナップショットは復元作業に使用され無くなる
  ACTIVE  '/dev/vg0/lv1' [52.00 MiB] inherit
  ACTIVE  '/dev/vg0/lv2' [52.00 MiB] inherit
  ACTIVE  '/dev/centos_vm11/swap' [2.00 GiB] inherit
  ACTIVE  '/dev/centos_vm11/root' [<17.00 GiB] inherit
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt/loop0
  vm11$ sudo umount /mnt/loop1
  vm11$ sudo umount /mnt/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  [19492.386905] XFS (dm-2): Unmounting Filesystem
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvremove /dev/vg0/lv0
  vm11$ sudo lvremove /dev/vg0/lv1
  vm11$ sudo lvremove /dev/vg0/lv2
  
  コマンドの実行結果
  --------------------------------------------------
  Do you really want to remove active logical volume vg0/lv0? [y/n]: y
    Logical volume "lv0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgremove vg0
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvremove /dev/loop0 /dev/loop1 /dev/loop2
  
  コマンドの実行結果
  --------------------------------------------------
  Labels on physical volume "/dev/loop0" successfully wiped.
  Labels on physical volume "/dev/loop1" successfully wiped.
  Labels on physical volume "/dev/loop2" successfully wiped.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-2].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[012]
  ハードディスクの管理
  
[内容]
  ## 作業内容
    ハードディスクのパラメータ確認
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
  ## コマンド(sdparm)
    sdparm -q           : 冒頭プロファイル非表示
    sdparm -a(--all) XX : ハードディスク(XX)の全情報表示
  
[確認]
  $ cd $HOME
  $ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME               MAJ:MIN  RM    SIZE  RO  TYPE  MOUNTPOINT
  sda                  8:0     0    477G   0  disk  (対象ハードディスク) -> sdparam を使用
   |-- sda1            8:1     0      1G   0  part  /boot
   |-- sda2            8:2     0    476G   0  part  
        |-- rl-root  253:0     0     70G   0  lvm   /
        |-- rl-swap  253:1     0    3.9G   0  lvm   [SWAP]
        |-- rl-home  253:2     0  402.1G   0  lvm   /home
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo dnf -y install sdparm
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo sdparm /dev/sda -> ハードディスクのパラメータ確認
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/sda: ATA  Crucial_CT512MX1  MU01 -> ATA規格のHDD

  Read write error recovery mode page:
    AWRE          1  [cha: n, def:  1]
    ARRE          0  [cha: n, def:  0]
    PER           0  [cha: n, def:  0]
  Caching (SBC) mode page:
    IC            0  [cha: n, def:  0]
    WCE           1  [cha: y, def:  1]
    RCD           0  [cha: n, def:  0]
  Control mode page:
    TST           0  [cha: n, def:  0]
    SWP           0  [cha: n, def:  0]
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo sdparm -a /dev/sda -> 全パラメータ確認
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/sda: ATA  Crucial_CT512MX1  MU01

  Read write error recovery mode page:
    AWRE          1  [cha: n, def:  1]
    ARRE          0  [cha: n, def:  0]
    ...
  Caching (SBC) mode page:
    IC            0  [cha: n, def:  0]
    ABPF          0  [cha: n, def:  0]
    ...
  Control mode page:
    TST           0  [cha: n, def:  0]
    TMF_ONLY      0  [cha: n, def:  0]
    ...
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo sdparm --command=capacity /dev/sda -> ブロック数・ブロックサイズ
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/sda: ATA  Crucial_CT512MX1  MU01

  blocks: 1000215216      // ブロック数
  block_length: 512       // ブロックサイズ
  capacity_mib: 488386.3  // 全容量(MB)
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo sdparm --command=profile /dev/sda -> プロファイル表示
  
  コマンドの実行結果
  --------------------------------------------------
  /dev/sda: ATA  Crucial_CT512MX1  MU01 -> 冒頭の情報が表示
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo sdparm -q --command=ready /dev/sda -> 生死の確認
  
  コマンドの実行結果
  --------------------------------------------------
  Ready -> 稼働中  // 非稼動 -> Not-Ready
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[013]
  SSD
  
[内容]
  ## 作業内容
    記憶装置がHDDかSSDか確認する
  
  ## 使用マシン
    HOST : localhost
    IPV4 : DHCP
    MEMO : ホスト
  
[確認]
  $ cd $HOME
  $ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME               MAJ:MIN  RM    SIZE  RO  TYPE  MOUNTPOINT
  sda                  8:0     0    477G   0  disk  (記憶装置)
   |-- sda1            8:1     0      1G   0  part  /boot
   |-- sda2            8:2     0    476G   0  part  
        |-- rl-root  253:0     0     70G   0  lvm   /
        |-- rl-swap  253:1     0    3.9G   0  lvm   [SWAP]
        |-- rl-home  253:2     0  402.1G   0  lvm   /home
  --------------------------------------------------
  
  $ cd $HOME
  $ cat /sys/block/sda/queue/rotational -> HDDかSSDか判別
  
  コマンドの実行結果
  --------------------------------------------------
  0 -> SSD  // 1 -> HDD
  --------------------------------------------------
  
  $ cd $HOME
  $ lsblk -o name,rota -> HDDかSSDか判別
  
  コマンドの実行結果
  --------------------------------------------------
  NAME               ROTA
  sda                0 (SDD)
   |-- sda1          0
   |-- sda2          0
        |-- rl-root  0
        |-- rl-swap  0
        |-- rl-home  0
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo hdparm -I /dev/sda | grep -i trim -> SSDがTrim対応か判定
  
  コマンドの実行結果
  --------------------------------------------------
  * Data Set Management TRIM supported (limit 8 blocks) -> SSDがTrim対応と判明
  * Deterministic read ZEROs after TRIM
  --------------------------------------------------
  
  $ cd $HOME
  $ mount | grep -i discard -> マウントオプションで自動Trimか判定
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし、自動でTrim実行する設定ではない
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo fstrim -v /(ルートディレクトリ) -> コマンド(fstrim)で手動Trimを行う
  
  コマンドの実行結果
  --------------------------------------------------
  /: 59.7 GiB (64049324032 バイト) に切り揃えました
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[014]
  iSCSI
  
[内容]
  ## 作業内容
    論理ボリュームを「ターゲット」で公開、クライアントは「イニシエータ」としてアクセス
  
  ## 使用マシン
    HOST : vm11
    IPV4 : 192.168.122.11
    MEMO : 仮想マシン
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
[確認]
  vm11$ cd $HOME
  vm11$ sudo yum -y install targetcli
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ LANG=C dd if=/dev/zero of=image0.img bs=10M count=10
  vm11$ LANG=C dd if=/dev/zero of=image1.img bs=10M count=10
  
  コマンドの実行結果
  --------------------------------------------------
  10+0 records in
  10+0 records out
  104857600 bytes (105 MB) copied, 0.226317 s, 463 MB/s
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup /dev/loop0 image0.img
  vm11$ sudo losetup /dev/loop1 image1.img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvcreate /dev/loop0 /dev/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  Physical volume "/dev/loop0" successfully created.
  Physical volume "/dev/loop1" successfully created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgcreate vg0 /dev/loop0 /dev/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully created
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvcreate -L 150M -n lv0 vg0
  
  コマンドの実行結果
  --------------------------------------------------
  Rounding up size to full physical extent 152.00 MiB
  Logical volume "lv0" created.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mkfs -t xfs /dev/vg0/lv0
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  
   |-- vg0-lv0                253:2     0   152M   0  lvm   (論理ボリューム)
  loop1                         7:1     0   100M   0  loop  
   |-- vg0-lv0                253:2     0   152M   0  lvm   (論理ボリューム)
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo yum -y install iscsi-initiator-utils
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm12$ cd 4HOME
    vm12$ cat /etc/iscsi/initiatorname.iscsi
    
    コマンドの実行結果
    --------------------------------------------------
    InitiatorName=iqn.1994-05.com.redhat:11f16be6b393
    --------------------------------------------------
    
  vm11$ cd $HOME
  vm11$ sudo targetcli ls -> ターゲット設定項目を確認
  
  コマンドの実行結果
  --------------------------------------------------
  o- /  [...]
    o- backstores  [...]
    | o- block  [Storage Objects: 0]  // 公開ディスク -> ここに論理ボリュームを指定
    | o- fileio  [Storage Objects: 0]
    | o- pscsi  [Storage Objects: 0]
    | o- ramdisk  [Storage Objects: 0]
    o- iscsi  [Targets: 0]  // ターゲット識別名(IQN) -> 配下に多数の設定項目を作成
    o- loopback  [Targets: 0]
  --------------------------------------------------
  
  設定項目
  ==================================================
  /backstores/block      : 公開ディスク
  /iscsi                 : ターゲット識別名(IQN)
  /iscsi/(IQN)/tpg1/luns : 識別名(IQN)と公開ディスクのリンク
  /iscsi/(IQN)/tpg1/acls : アクセス制限(ACL)
  ==================================================
  
  vm11$ cd $HOME
  vm11$ sudo targetcli /backstores/block create name=vm11-lv0 dev=/dev/vg0/lv0 -> 公開ディスクに論理ボリューム指定
  
  コマンドの実行結果
  --------------------------------------------------
  Created block storage object vm11-lv0 using /dev/vg0/lv0.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo targetcli ls -> ターゲット設定項目を確認
  
  コマンドの実行結果
  --------------------------------------------------
  o- /  [...]
    o- backstores  [...]
    | o- block  [Storage Objects: 1]
    | | o- vm11-lv0  [/dev/vg0/lv0 (152.0MiB) write-thru deactivated] -> 公開ディスク名、論理ボリューム
    | |   o- alua  [ALUA Groups: 1]
    | |     o- default_tg_pt_gp  [ALUA state: Active/optimized]
    | o- fileio  [Storage Objects: 0]
    | o- pscsi  [Storage Objects: 0]
    | o- ramdisk  [Storage Objects: 0]
    o- iscsi  [Targets: 0]
    o- loopback  [Targets: 0]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo targetcli /iscsi create iqn.2023-04.com.test:vm11-share01 -> ターゲット識別名(IQN)を指定
  
  コマンドの実行結果
  --------------------------------------------------
  Created target iqn.2023-04.com.test:vm11-share01. -> ターゲット識別名(IQN)
  Created TPG 1.
  Global pref auto_add_default_portal=true
  Created default portal listening on all IPs (0.0.0.0), port 3260.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo targetcli ls -> ターゲット設定項目を確認
  
  コマンドの実行結果
  --------------------------------------------------
  o- /  [...]
    o- backstores  [...]
    | o- block  [Storage Objects: 1]
    | | o- vm11-lv0  [/dev/vg0/lv0 (152.0MiB) write-thru deactivated] -> 公開ディスク名、論理ボリューム
    | |   o- alua  [ALUA Groups: 1]
    | |     o- default_tg_pt_gp  [ALUA state: Active/optimized]
    | o- fileio  [Storage Objects: 0]
    | o- pscsi  [Storage Objects: 0]
    | o- ramdisk  [Storage Objects: 0]
    o- iscsi  [Targets: 1]
    | o- iqn.2023-04.com.test:vm11-share01  [TPGs: 1] -> ターゲット識別名(IQN)
    |   o- tpg1  [no-gen-acls, no-auth]
    |     o- acls  [ACLs: 0]
    |     o- luns  [LUNs: 0]
    |     o- portals  [Portals: 1]
    |       o- 0.0.0.0:3260  [OK]
    o- loopback  [Targets: 0]
  --------------------------------------------------
  
  vm11$ cd $HOME -> 公開ディスクとターゲット識別名(IQN)をリンク
  vm11$ sudo targetcli /iscsi/iqn.2023-04.com.test:vm11-share01/tpg1/luns create /backstores/block/vm11-lv0
  
  コマンドの実行結果
  --------------------------------------------------
  Created LUN 0.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo targetcli ls -> ターゲット設定項目を確認
  
  コマンドの実行結果
  --------------------------------------------------
  o- /  [...]
    o- backstores  [...]
    | o- block  [Storage Objects: 1]
    | | o- vm11-lv0  [/dev/vg0/lv0 (152.0MiB) write-thru activated] -> 公開ディスク名、論理ボリューム
    | |   o- alua  [ALUA Groups: 1]
    | |     o- default_tg_pt_gp  [ALUA state: Active/optimized]
    | o- fileio  [Storage Objects: 0]
    | o- pscsi  [Storage Objects: 0]
    | o- ramdisk  [Storage Objects: 0]
    o- iscsi  [Targets: 1]
    | o- iqn.2023-04.com.test:vm11-share01  [TPGs: 1] -> ターゲット識別名(IQN)
    |   o- tpg1  [no-gen-acls, no-auth]
    |     o- acls  [ACLs: 0]
    |     o- luns  [LUNs: 1]
    |     | o- lun0  [block/vm11-lv0 (/dev/vg0/lv0) (default_tg_pt_gp)] -> 公開ディスクへのリンク
    |     o- portals  [Portals: 1]
    |       o- 0.0.0.0:3260  [OK]
    o- loopback  [Targets: 0]
  --------------------------------------------------
  
  vm11$ cd $HOME -> アクセス可能なiSCSIイニシエータ名を登録
  vm11$ sudo targetcli /iscsi/iqn.2023-04.com.test:vm11-share01/tpg1/acls create iqn.1994-05.com.redhat:11f16be6b393
  
  コマンドの実行結果
  --------------------------------------------------
  Created Node ACL for iqn.1994-05.com.redhat:11f16be6b393
  Created mapped LUN 0.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo targetcli ls -> ターゲット設定項目を確認
  
  コマンドの実行結果
  --------------------------------------------------
  o- /  [...]
    o- backstores  [...]
    | o- block  [Storage Objects: 1]
    | | o- vm11-lv0  [/dev/vg0/lv0 (152.0MiB) write-thru activated] -> 公開ディスク名、論理ボリューム
    | |   o- alua  [ALUA Groups: 1]
    | |     o- default_tg_pt_gp  [ALUA state: Active/optimized]
    | o- fileio  [Storage Objects: 0]
    | o- pscsi  [Storage Objects: 0]
    | o- ramdisk  [Storage Objects: 0]
    o- iscsi  [Targets: 1]
    | o- iqn.2023-04.com.test:vm11-share01  [TPGs: 1] -> ターゲット識別名(IQN)
    |   o- tpg1  [no-gen-acls, no-auth]
    |     o- acls  [ACLs: 1]
    |     | o- iqn.1994-05.com.redhat:11f16be6b393  [Mapped LUNs: 1] -> アクセス可能なイニシエータ名
    |     |   o- mapped_lun0  [lun0 block/vm11-lv0 (rw)]
    |     o- luns  [LUNs: 1]
    |     | o- lun0  [block/vm11-lv0 (/dev/vg0/lv0) (default_tg_pt_gp)] -> 公開ディスクへのリンク
    |     o- portals  [Portals: 1]
    |       o- 0.0.0.0:3260  [OK]
    o- loopback  [Targets: 0]
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo targetcli saveconfig -> ターゲット設定項目を保存
  
  コマンドの実行結果
  --------------------------------------------------
  Configuration saved to /etc/target/saveconfig.json
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo firewall-cmd --add-service=iscsi-target --permanent
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo firewall-cmd --reload
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------

  vm11$ cd $HOME
  vm11$ sudo systemctl restart target
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo iscsiadm -m discovery -t sendtargets -p 192.168.122.11 -> ターゲットの検索
    
    コマンドの実行結果
    --------------------------------------------------
    192.168.122.11:3260,1 iqn.2023-04.com.test:vm11-share01
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo iscsiadm -m node --login -> ターゲットへログイン
    
    コマンドの実行結果
    --------------------------------------------------
    Logging in to [iface: default, target: iqn.2023-04.com.test:vm11-share01, portal: 192.168.122.11,3260] (multiple)
      [ 2510.772674] scsi host6: iSCSI Initiator over TCP/IP
      [ 2510.800227] scsi 6:0:0:0: Direct-Access LIO-ORG vm11-lv0 4.0 PQ: 0 ANSI: 5
      [ 2510.807551] scsi 6:0:0:0: alua: supports implicit and explicit TPGS
      [ 2510.809771] scsi 6:0:0:0: alua: device naa.60014052b074bcf100245f49bb99698f port group 0 rel port 1
      [ 2510.814942] scsi 6:0:0:0: alua: Attached
      [ 2510.823663] scsi 6:0:0:0: alua: transition timeout set to 60 seconds
      [ 2510.826395] scsi 6:0:0:0: alua: port group 00 state A non-preferred supports TOlUSNA
      [ 2510.830137] scsi 6:0:0:0: Attached scsi generic sg1 type 0
    
    Login to [iface: default, target: iqn.2023-04.com.test:vm11-share01, portal: 192.168.122.11,3260] successful.
      [ 2510.854712] sd 6:0:0:0: [sda] 311296 512-byte logical blocks: (159 MB/152 MiB)
      [ 2510.860928] sd 6:0:0:0: [sda] Write Protect is off
      [ 2510.863829] sd 6:0:0:0: [sda] Write cache: enabled, read cache: enabled, supports DPO and FUA
      [ 2510.876840] sd 6:0:0:0: [sda] Optimal transfer size 1310720 bytes
      [ 2510.888801] sd 6:0:0:0: [sda] Attached SCSI disk
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ lsblk -> ターゲットのデバイスを確認
    
    コマンドの実行結果
    --------------------------------------------------
    NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
    sda                           8:0     0   152M   0  disk  (ターゲット)
    sr0                          11:0     1  1024M   0  rom   
    vda                         252:0     0    20G   0  disk  
     |-- vda1                   252:1     0     1G   0  part  /boot
     |-- vda2                   252:2     0    19G   0  part  
          |-- centos_vm11-root  253:0     0    17G   0  lvm   /
          |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ lsblk -S -> SCSIデバイスのみ表示
    
    コマンドの実行結果
    --------------------------------------------------
    NAME  HCTL     TYPE  VENDOR   MODEL         REV   TRAN
    sda   6:0:0:0  disk  LIO-ORG  vm11-lv0      4.0   iscsi (ターゲット)
    sr0   0:0:0:0  rom   QEMU     QEMU DVD-ROM  2.5+  sata
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo mount -o defaults -t xfs /dev/sda /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    [ 3086.324705] XFS (sda): Mounting V5 Filesystem
    [ 3086.353023] XFS (sda): Ending clean mount
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ lsblk -> ターゲットのデバイスを確認
    
    コマンドの実行結果
    --------------------------------------------------
    NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
    sda                           8:0     0   152M   0  disk  /mnt -> ターゲットのデバイスをマウント
    sr0                          11:0     1  1024M   0  rom   
    vda                         252:0     0    20G   0  disk  
     |-- vda1                   252:1     0     1G   0  part  /boot
     |-- vda2                   252:2     0    19G   0  part  
          |-- centos_vm11-root  253:0     0    17G   0  lvm   /
          |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
    --------------------------------------------------
    
    vm12$ cd /mnt
    vm12$ sudo touch sample1.txt -> ターゲットのデバイスにファイル作成
    vm12$ sudo touch sample2.txt -> ターゲットのデバイスにファイル作成
    vm12$ sudo touch sample3.txt -> ターゲットのデバイスにファイル作成
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo umount /mnt
    
    コマンドの実行結果
    --------------------------------------------------
    [ 3371.825131] XFS (sda): Unmounting Filesystem
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo iscsiadm -m node --logoutall=all -> ターゲットからログアウト
    
    コマンドの実行結果
    --------------------------------------------------
    Logging out of session [sid: 1, target: iqn.2023-04.com.test:vm11-share01, portal: 192.168.122.11,3260]
    [ 3396.939818] sd 6:0:0:0: alua: Detached
    [ 3396.950612] sd 6:0:0:0: [sda] Synchronizing SCSI cache
    Logout of [sid: 1, target: iqn.2023-04.com.test:vm11-share01, portal: 192.168.122.11,3260] successful.
    --------------------------------------------------
    
    vm12$ cd $HOME
    vm12$ sudo systemctl disable iscsi -> サービスの自動起動を無効化
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 無効化しないと起動時にターゲットへの検索・ログイン処理が実行される
    --------------------------------------------------
    
  vm11$ cd $HOME
  vm11$ sudo targetcli clearconfig confirm=True -> ターゲットの初期化
  
  コマンドの実行結果
  --------------------------------------------------
  All configuration cleared
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo systemctl stop target
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo mount -o defaults -t xfs /dev/vg0/lv0 /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [ 3695.991646] XFS (dm-2): Mounting V5 Filesystem
  [ 3695.997516] XFS (dm-2): Ending clean mount
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ lsblk
  
  コマンドの実行結果
  --------------------------------------------------
  NAME                        MAJ:MIN  RM   SIZE  RO  TYPE  MOUNTPOINT
  vdb                         252:16    0     2G   0  disk  
   |-- vdb2                   252:18    0   975M   0  part  
   |-- vdb1                   252:17    0     1G   0  part  
  sr0                          11:0     1  1024M   0  rom   
  loop0                         7:0     0   100M   0  loop  
   |-- vg0-lv0                253:2     0   152M   0  lvm   /mnt -> 論理ボリューム
  loop1                         7:1     0   100M   0  loop  
   |-- vg0-lv0                253:2     0   152M   0  lvm   /mnt -> 論理ボリューム
  vda                         252:0     0    20G   0  disk  
   |-- vda1                   252:1     0     1G   0  part  /boot
   |-- vda2                   252:2     0    19G   0  part  
        |-- centos_vm11-root  253:0     0    17G   0  lvm   /
        |-- centos_vm11-swap  253:1     0     2G   0  lvm   [SWAP]
  --------------------------------------------------
  
  vm11$ cd /mnt
  vm11$ ls -lh
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 0  4月 20 11:21 sample1.txt
  -rw-r--r--. 1 root root 0  4月 20 11:21 sample2.txt
  -rw-r--r--. 1 root root 0  4月 20 11:21 sample3.txt
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo umount /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  [ 3866.784640] XFS (dm-2): Unmounting Filesystem
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo lvremove /dev/vg0/lv0
  
  コマンドの実行結果
  --------------------------------------------------
  Do you really want to remove active logical volume vg0/lv0? [y/n]: y
    Logical volume "lv0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo vgremove vg0
  
  コマンドの実行結果
  --------------------------------------------------
  Volume group "vg0" successfully removed
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo pvremove /dev/loop0 /dev/loop1
  
  コマンドの実行結果
  --------------------------------------------------
  Labels on physical volume "/dev/loop0" successfully wiped.
  Labels on physical volume "/dev/loop1" successfully wiped.
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ sudo losetup -D
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm11$ cd $HOME
  vm11$ rm -f image[0-1].img
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
