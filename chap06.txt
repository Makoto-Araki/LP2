================================================================================
[01] ネットワークデバイス - 01
[02] ネットワークデバイス - 02
[03] ネットワークデバイス - 03 (ifconfig)
[04] ARP
[05] ネットワーク管理コマンド - 01 (ping)
[06] ネットワーク管理コマンド - 02 (ping6)
[07] ネットワーク管理コマンド - 03 (traceroute)
[08] ネットワーク管理コマンド - 04 (traceroute6)
[09] ネットワーク管理コマンド - 05 (tcpdump)
================================================================================
[01]
  ネットワークデバイス - 01
  
[内容]
  ## 作業内容
    システムのイーサネットのネットワークデバイスを調査する
  
  ## 使用マシン
    HOST : localhost
    IPV4 : 192.168.1.3
    MEMO : ホスト
  
  ## 命名規則1
    en(イーサネット) + p0(PCIバスの0番目) + s0(スロット0)
    en(イーサネット) + p0(PCIバスの0番目) + s1(スロット1)
  
  ## 命名規則2
    en(イーサネット) + o0(オンボードの0番目)
    en(イーサネット) + o1(オンボードの1番目)
  
[確認]
  $ cd $HOME
  $ dmesg | grep enp (PCIバス)
  
  コマンドの実行結果
  --------------------------------------------------
  [   56.978724] IPv6: ADDRCONF(NETDEV_UP): enp1s0: link is not ready
  [   56.990397] IPv6: ADDRCONF(NETDEV_UP): enp1s0: link is not ready
  [   57.991210] tg3 0000:01:00.0 enp1s0: Link is down
  [   61.003359] tg3 0000:01:00.0 enp1s0: Link is up at 1000 Mbps, full duplex
  [   61.003365] tg3 0000:01:00.0 enp1s0: Flow control is off for TX and off for RX
  [   61.003383] IPv6: ADDRCONF(NETDEV_CHANGE): enp1s0: link becomes ready
  --------------------------------------------------
  
  $ cd $HOME
  $ dmesg | grep eno (オンボード)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  ネットワークデバイス - 02
  
[内容]
  ## 作業内容
    システムの無線LANのネットワークデバイスを調査する
  
  ## 使用マシン
    HOST : localhost
    IPV4 : 192.168.1.3
    MEMO : ホスト
  
  ## 命名規則1
    wl(無線LAN) + p0(PCIバスの0番目) + s0(スロット0)
    wl(無線LAN) + p0(PCIバスの0番目) + s1(スロット1)
  
  ## 命名規則2
    wl(無線LAN) + o0(オンボードの0番目)
    wl(無線LAN) + o1(オンボードの1番目)
  
[確認]
  $ cd $HOME
  $ dmesg | grep wlp (PCIバス)
  
  コマンドの実行結果
  --------------------------------------------------
  [   56.995670] IPv6: ADDRCONF(NETDEV_UP): wlp2s0: link is not ready
  --------------------------------------------------
  
  $ cd $HOME
  $ dmesg | grep wlo (オンボード)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  ネットワークデバイス - 03 (ifconfig)
  
[内容]
  ## 作業内容
    ネットワークデバイスの設定をコマンド(ifconfig)で行う
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(ifconfig)
    ifconfig -a                // 全ネットワークデバイスを表示
    ifconfig XX                // ネットワークデバイス(XX)を表示
    ifconfig XX YY netmask ZZ  // ネットワークデバイス(XX)にIPアドレス(YY)、ネットマスク(ZZ)を設定する
    ifconfig XX up             // ネットワークデバイス(XX)を起動
    ifconfig XX down           // ネットワークデバイス(XX)を停止
  
[確認]
  vm12$ cd $HOME
  vm12$ ifconfig (-a) (全てのネットワークデバイスを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.122.12  netmask 255.255.255.0  broadcast 192.168.122.255
        inet6 fe80::5054:ff:fe70:e23b  prefixlen 64  scopeid 0x20<link>
        ether 52:54:00:70:e2:3b  txqueuelen 1000  (Ethernet)
        RX packets 102  bytes 7029 (6.8 KiB)
        RX errors 0  dropped 20  overruns 0  frame 0
        TX packets 44  bytes 3496 (3.4 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
  
  lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 32  bytes 2592 (2.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 32  bytes 2592 (2.5 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ ifconfig eth0 (ネットワークデバイス(eth0)を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.122.12  netmask 255.255.255.0  broadcast 192.168.122.255
        inet6 fe80::5054:ff:fe70:e23b  prefixlen 64  scopeid 0x20<link>
        ether 52:54:00:70:e2:3b  txqueuelen 1000  (Ethernet)
        RX packets 239  bytes 14549 (14.2 KiB)
        RX errors 0  dropped 20  overruns 0  frame 0
        TX packets 64  bytes 4968 (4.8 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo ifconfig eth0:0 192.168.122.22 netmask 255.255.255.0 (ネットワークデバイス(eth0)に仮想IPアドレスを付与する)
  vm12$ sudo ifconfig eth0:1 192.168.122.32 netmask 255.255.255.0 (ネットワークデバイス(eth0)に仮想IPアドレスを付与する)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ ifconfig eth0:0 up
  vm12$ ifconfig eth0:1 up
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ ifconfig (-a) (全てのネットワークデバイスを表示)
  
  コマンドの実行結果
  --------------------------------------------------
  eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.122.12  netmask 255.255.255.0  broadcast 192.168.122.255
        inet6 fe80::5054:ff:fe70:e23b  prefixlen 64  scopeid 0x20<link>
        ether 52:54:00:70:e2:3b  txqueuelen 1000  (Ethernet)
        RX packets 912  bytes 51533 (50.3 KiB)
        RX errors 0  dropped 20  overruns 0  frame 0
        TX packets 160  bytes 11984 (11.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
  
  // 再起動でクリア
  eth0:0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.122.22  netmask 255.255.255.0  broadcast 192.168.122.255
        ether 52:54:00:70:e2:3b  txqueuelen 1000  (Ethernet)
  
  // 再起動でクリア
  eth0:1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.122.32  netmask 255.255.255.0  broadcast 192.168.122.255
        ether 52:54:00:70:e2:3b  txqueuelen 1000  (Ethernet)
  
  lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 32  bytes 2592 (2.5 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 32  bytes 2592 (2.5 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  ARP
  
[内容]
  ## 作業内容
    ARPの設定をコマンド(arp)で行う
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(arp)
    arp -a XX     // 指定ホスト(XX)のエントリまたは全エントリ表示
    arp -d XX     // 指定ホスト(XX)のエントリ削除
    arp -f XX     // ファイルからホストとMACアドレスの対応を詠み込む -> デフォルトは「/etc/ethers」
    arp -n        // ホスト名の名前解決を行わない
    arp -i XX     // 指定NIC(XX)のエントリ表示
    arp -a XX YY  // ホスト名(XX)とMACアドレス(YY)の組合せエントリを追加
  
[確認]
  vm12$ cd $HOME
  vm12$ arp -a (全エントリ表示)
  
  コマンドの実行結果
  --------------------------------------------------
  vm13 (192.168.122.13) at 52:54:00:de:1a:a8 [ether] on eth0
  gateway (192.168.122.1) at 52:54:00:b4:eb:a9 [ether] on eth0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ arp -a vm13 (指定ホスト(vm13)のエントリ表示)
  
  コマンドの実行結果
  --------------------------------------------------
  vm13 (192.168.122.13) at 52:54:00:de:1a:a8 [ether] on eth0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ arp -d 192.168.122.13 (エントリを削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ vi /etc/ethers (設定ファイルを編集)
  
  コマンドの実行結果
  --------------------------------------------------
  52:54:00:de:1a:a8 192.168.122.13  // vm13
  52:54:00:b4:eb:a9 192.168.122.1   // ゲートウェイ
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ arp -f (/etc/ethers) (設定ファイルを読込)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ arp -a (全エントリ表示)
  
  コマンドの実行結果
  --------------------------------------------------
  vm13 (192.168.122.13) at 52:54:00:de:1a:a8 [ether] PERM on eth0
  gateway (192.168.122.1) at 52:54:00:b4:eb:a9 [ether] PERM on eth0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ arp -a -n (ホスト名の名前解決を行わない)
  
  コマンドの実行結果
  --------------------------------------------------
  ? (192.168.122.13) at 52:54:00:de:1a:a8 [ether] PERM on eth0
  ? (192.168.122.1) at 52:54:00:b4:eb:a9 [ether] PERM on eth0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ arp -i eth0 (指定NICのエントリ表示)
  
  コマンドの実行結果
  --------------------------------------------------
  Address   HWtype  HWaddress          Flags Mask  Iface
  vm13      ether   52:54:00:de:1a:a8  CM          eth0
  gateway   ether   52:54:00:b4:eb:a9  CM          eth0
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ arp -d 192.168.122.13 (エントリを削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ arp -s vm13 52:54:00:de:1a:a8 (ホスト名とMACアドレスの組合せエントリを追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  ネットワーク管理コマンド - 01 (ping)
  
[内容]
  ## 作業内容
    ネットワーク管理をコマンド(ping)で行う
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(ping)
    ping XX        // 指定ホスト(XX)にICMPパケットを送信(Ctrl + C で停止)
    ping -c NN XX  // 指定ホスト(XX)にICMPパケットを送信、送信回数(NN)回
    ping -n XX     // 指定ホスト(XX)にICMPパケットを送信、ホスト名の名前解決を行わない
    ping -i NN XX  // 指定ホスト(XX)にICMPパケットを送信、送信間隔(NN)秒
  
[確認]
  vm12$ cd $HOME
  vm12$ ping -n -c 3 -i 1 www.yahoo.co.jp (ホスト名の名前解決は行わない、送信回数は3回、送信間隔は1秒)
  
  コマンドの実行結果
  --------------------------------------------------
  PING edge12.g.yimg.jp (182.22.28.252) 56(84) bytes of data.
  64 bytes from 182.22.28.252: icmp_seq=1 ttl=54 time=6.83 ms
  64 bytes from 182.22.28.252: icmp_seq=2 ttl=54 time=5.66 ms
  64 bytes from 182.22.28.252: icmp_seq=3 ttl=54 time=5.70 ms
  
  --- edge12.g.yimg.jp ping statistics ---
  3 packets transmitted, 3 received, 0% packet loss, time 2004ms
  rtt min/avg/max/mdev = 5.660/6.065/6.832/0.549 ms
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[06]
  ネットワーク管理コマンド - 02 (ping6)
  
[内容]
  ## 作業内容
    ネットワーク管理をコマンド(ping6)で行う
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(ping6)
    ping6 XX        // 指定ホスト(XX)にICMPパケットを送信(Ctrl + C で停止)
    ping6 -c NN XX  // 指定ホスト(XX)にICMPパケットを送信、送信回数(NN)回
    ping6 -n XX     // 指定ホスト(XX)にICMPパケットを送信、ホスト名の名前解決を行わない
    ping6 -i NN XX  // 指定ホスト(XX)にICMPパケットを送信、送信間隔(NN)秒
  
[確認]
  vm12$ cd $HOME
  vm12$ ping6 -n -c 3 -i 1 localhost (ホスト名の名前解決は行わない、送信回数は3回、送信間隔は1秒)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[07]
  ネットワーク管理コマンド - 03 (traceroute)
  
[内容]
  ## 作業内容
    ネットワーク管理をコマンド(traceroute)で行う
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(traceroute)
    traceroute XX        // 指定ホスト(XX)への通信経路を表示
    traceroute -n XX     // 指定ホスト(XX)への通信経路を表示、ホスト名の名前解決を行わない
    traceroute -i NN XX  // 指定ホスト(XX)への通信経路を表示、NIC(NN)を指定
  
[確認]
  vm12$ cd $HOME
  vm12$ sudo yum -y install traceroute (パッケージ追加))
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ traceroute -n www.yahoo.co.jp (ホスト名の名前解決は行わないで通信経路を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  traceroute to www.yahoo.co.jp (183.79.250.123), 30 hops max, 60 byte packets

  01  192.168.122.1    5.458 ms  5.338 ms  5.049 ms
  02  192.168.1.1      4.785 ms  4.647 ms  4.407 ms
  03  118.23.5.241     8.984 ms  8.870 ms  8.989 ms
  04  118.23.5.133     8.560 ms  8.260 ms  8.635 ms
  05  118.23.39.101    8.587 ms  8.603 ms  9.445 ms
  06  153.146.171.93   9.190 ms  9.090 ms  8.904 ms
  07  60.37.54.73      8.931 ms  9.616 ms  9.490 ms
  08  125.170.97.129   9.426 ms  9.578 ms  8.641 ms
  09  122.1.245.190    9.615 ms  9.224 ms  9.407 ms
  10  153.149.219.146  9.614 ms  8.276 ms  7.990 ms
  11  153.149.219.154  9.309 ms  9.876 ms  4.490 ms
  12  211.0.206.166    9.366 ms  6.359 ms  2.957 ms
  13  * * *
  -- 省略 --
  28  * * *
  29  * * *
  30  * * *
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[08]
  ネットワーク管理コマンド - 04 (traceroute6)
  
[内容]
  ## 作業内容
    ネットワーク管理をコマンド(traceroute6)で行う
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## コマンド(traceroute6)
    traceroute6 XX        // 指定ホスト(XX)への通信経路を表示
    traceroute6 -n XX     // 指定ホスト(XX)への通信経路を表示、ホスト名の名前解決を行わない
    traceroute6 -i NN XX  // 指定ホスト(XX)への通信経路を表示、NIC(NN)を指定
  
[確認]
  vm12$ cd $HOME
  vm12$ traceroute6 -n localhost (ホスト名の名前解決は行わないで通信経路を表示)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[09]
  ネットワーク管理コマンド - 05 (tcpdump)
  
[内容]
  ## 作業内容
    ネットワーク管理をコマンド(tcpdump)で行う
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン(サーバー用途)
  
  ## 使用マシン
    HOST : vm13
    IPV4 : 192.168.122.13
    MEMO : 仮想マシン(クライアント用途)
  
  ## コマンド(tcpdump)
    tcpdump -i XX  // NIC(XX)を指定
    tcpdump -n     // ホストの名前解決を行わない
    tcpdump -N     // ホストのドメイン名を表示しない
    tcpdump -p     // 自分宛のパケット以外はキャプチャしない(非プロミスキャスモード)
    tcpdump -t     // 時刻を表示しない
    tcpdump -v     // 詳細に表示
    tcpdump -l     // 標準出力をバッファリング
    tcpdump -s XX  // パケットからの抽出バイト数(XX)を指定
    tcpdump -X     // 16進数とASCII文字で表示
    tcpdump -w XX  // キャプチャ内容をファイル(XX)に保存
    tcpdump src host XX  // 送信元ホスト(XX)を指定
    tcpdump dst host XX  // 送信先ホスト(XX)を指定
    tcpdump host XX      // 送信元または送信先ホスト(XX)を指定
    tcpdump src net XX mask YY  // 送信元ネットワーク(XX)とそのネットマスク(YY)を指定
    tcpdump dst net XX mask YY  // 送信先ネットワーク(XX)とそのネットマスク(YY)を指定
    tcpdump net XX mask YY      // 送信元または送信先ネットワーク(XX)とそのネットマスク(YY)を指定
    tcpdump src port XX  // 送信元ポート(XX)を指定
    tcpdump dst port XX  // 送信先ポート(XX)を指定
    tcpdump port XX      // ポート(XX)を指定

[確認]
  vm12$ cd $HOME
  vm12$ sudo yum -y install tcpdump (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo tcpdump -n -l -i eth0 src host vm13 (名前解決なし、バッファリング、NIC指定、送信元(vm13)のトラフィック監視)
  
  コマンドの実行結果
  --------------------------------------------------
  [29214.472802] device eth0 entered promiscuous mode
  tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
  listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes

  // ここでホスト(vm13)からトラフィック送信

  20:26:35.927583 ARP, Request who-has 192.168.122.12 tell 192.168.122.13, length 28
  20:26:35.927957 IP 192.168.122.13 > 192.168.122.12: ICMP echo request, id 1210, seq 1, length 64
  20:26:36.929333 IP 192.168.122.13 > 192.168.122.12: ICMP echo request, id 1210, seq 2, length 64
  20:26:37.931282 IP 192.168.122.13 > 192.168.122.12: ICMP echo request, id 1210, seq 3, length 64
  20:26:41.234037 ARP, Reply 192.168.122.13 is-at 52:54:00:01:99:8f, length 28
  
  5 packets captured
  5 packets received by filter
  0 packets dropped by kernel
  [29236.335926] device eth0 left promiscuous mode
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ ping -c 3 -i 1 vm12
    
    コマンドの実行結果
    --------------------------------------------------
    PING vm12 (192.168.122.12) 56(84) bytes of data.
    64 bytes from vm12 (192.168.122.12): icmp_seq=1 ttl=64 time=1.00 ms
    64 bytes from vm12 (192.168.122.12): icmp_seq=2 ttl=64 time=0.711 ms
    64 bytes from vm12 (192.168.122.12): icmp_seq=3 ttl=64 time=0.765 ms
    
    --- vm12 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 2003ms
    rtt min/avg/max/mdev = 0.711/0.826/1.003/0.129 ms
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
