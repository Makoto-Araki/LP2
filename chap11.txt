================================================================================
[01] Samba - 01
[02] Samba - 02 (共有フォルダ - 登録ユーザーのみアクセス可能)
[03] Samba - 03 (ホームディレクトリ)
[04] Samba - 04 (パスワード変更)
[05] Samba - 05 (マスターブラウザの検索)
[06] Samba - 06 (Windows側の共有フォルダをSambaクライアントからアクセス)
[07] Samba - 07 (Windows側の共有フォルダをLinux側からマウント)
[08] NFS - 01 (RPC)
[09] NFS - 02 (NFS)
================================================================================
[01]
  Samba - 01
  
[内容]
  ## 作業内容
    共有フォルダを作成、Windows側から誰でもアクセス可能にする
  
  ## 使用マシン
    HOST : rock
    IPV4 : dhcp
    MEMO : Rocky Linux
    USER : makoto
  
  ## 使用マシン
    HOST : pc01
    IPV4 : dhcp
    MEMO : Windows10 -> WORKGROUP
    USER : Owner
  
[確認]
  $ cd $HOME
  $ sudo dnf -y install samba samba-client
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo useradd -s /usr/bin/bash kate
  $ sudo useradd -s /usr/bin/bash mike
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> Linux側のOSユーザーを作成
  --------------------------------------------------
  
  $ cd $HOME
  $ LANG=C sudo passwd kate
  $ LANG=C sudo passwd mike
  
  コマンドの実行結果
  --------------------------------------------------
  // Kate
  Changing password for user kate.
  New password: (ka0122ma)
  Retype new password: (ka0122ma)
  passwd: all authentication tokens updated successfully.
  
  // Mike
  Changing password for user mike.
  New password: (mi0122ma)
  Retype new password: (mi0122ma)
  passwd: all authentication tokens updated successfully.
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo mkdir -p /home/samba
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 共有フォルダ作成
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo chmod 777 /home/samba
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 誰でも閲覧可能、変更可能にする
  --------------------------------------------------
  
  $ cd $HOME
  $ echo 'AAA AAA AAA' > file1.txt
  $ echo 'BBB BBB BBB' > file2.txt
  $ echo 'CCC CCC CCC' > file3.txt
  $ echo 'DDD DDD DDD' > file4.txt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> ファイル作成
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo chmod 777 file[1-4].txt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 誰でも閲覧可能、変更可能にする
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo cp -p /etc/samba/smb.conf /etc/samba/smb.conf.org
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 設定ファイルのバックアップ
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo vi /etc/samba/smb.conf
  
  コマンドの実行結果
  --------------------------------------------------
  [global]
    workgroup = WORKGROUP                         // This server is WORKGROUP at Windows Network
    server role = STANDALONE                      // This server is not Domain Controller
    netbios name = rock                           // NetBIOS Name
    server string = File Server for Windows User  // Description
    hosts allow = 192.168.1. 127.                 // Accessible Hosts
    guest account = makoto                        // Guest behaves as makoto user in Linux
    map to guest = Bad User                       // If input user is not existed, Samba reckon guest(makoto)
    log file = /var/log/samba/%m.log              // Samba log
    max log size = 0                              // Samba log size is unlimited
    wins support = No                             // Samba needs no WINS, uses /etc/samba/lmhosts
    security = user                               // Samba needs Linux Account
    passdb backend = smbpasswd                    // Samba stores user data in smbpasswd
    smb passwd file = /etc/samba/smbpasswd        // Smbpasswd file
    create mask = 0777                            // File Permission
    directory mask = 0777                         // Directory Permission
    local master = No                             // Master Browser is not this Linux machine
    preferred master = No                         // Master Browser is not this Linux machine
    domain master = No                            // Master Browser is not this Linux machine
    os level = 10                                 // Master Browser is not this Linux machine
    
  [share]
    comment = share directory in rock             // Description
    browseable = Yes                              // Windows User can browse this SHARE
    writable = Yes                                // Windows User can write in this SHARE
    path = /home/samba                            // Specify the directory path for this SHARE
    public = Yes                                  // Guest User can access this SHARE
    guest ok = Yes                                // Guest User can access this SHARE
    guest only = Yes                              // Guest User can access this SHARE
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo testparm -> 設定ファイルの書式チェック
  
  コマンドの実行結果
  --------------------------------------------------
  Load smb config files from /etc/samba/smb.conf
  Loaded services file OK.
  Weak crypto is allowed by GnuTLS (e.g. NTLM as a compatibility fallback)
  
  // スタンドアロン
  Server role: ROLE_STANDALONE
  
  // Enterで先に進む
  Press enter to see a dump of your service definitions
  
  // グローバル
  [global]
	  domain master = No
	  guest account = makoto
	  local master = No
	  log file = /var/log/samba/%m.log
	  map to guest = Bad User
	  max log size = 0
	  os level = 10
	  passdb backend = smbpasswd
	  preferred master = No
	  security = USER
	  server role = standalone server
	  server string = File Server for Windows User
	  smb passwd file = /etc/samba/smbpasswd
	  idmap config * : backend = tdb
	  create mask = 0777
	  directory mask = 0777
	  hosts allow = 192.168.1. 127.
  
  // 共有フォルダ
  [share]
	  comment = share directory in rock
	  guest ok = Yes
	  guest only = Yes
	  path = /home/samba
	  read only = No
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo pdbedit -a kate
  $ sudo pdbedit -a mike
  
  コマンドの実行結果
  --------------------------------------------------
  // Kate
  new password               : (ka0122ma)
  retype new password        : (ka0122ma)
  startsmbfilepwent_internal : file /etc/samba/smbpasswd did not exist. File successfully created.
  Unix username              : kate
  NT username                : 
  Account Flags              : [U          ]
  User SID                   : S-1-5-21-4149390873-1238832848-2495149049-3002
  Primary Group SID          : S-1-5-21-4149390873-1238832848-2495149049-513
  Full Name                  : 
  Home Directory             : \\ROCK\kate
  HomeDir Drive              : 
  Logon Script               : 
  Profile Path               : \\ROCK\kate\profile
  Domain                     : ROCK
  Account desc               : 
  Workstations               : 
  Munged dial                : 
  Logon time                 : 0
  Logoff time                : never
  Kickoff time               : never
  Password last set          : 土, 01  7月 2023 12:35:53 JST
  Password can change        : 土, 01  7月 2023 12:35:53 JST
  Password must change       : never
  Last bad password          : 0
  Bad password count         : 0
  Logon hours                : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
  
  // Mike
  new password               : (mi0122ma)
  retype new password        : (mi0122ma)
  Unix username              : mike
  NT username                : 
  Account Flags              : [U          ]
  User SID                   : S-1-5-21-4149390873-1238832848-2495149049-3004
  Primary Group SID          : S-1-5-21-4149390873-1238832848-2495149049-513
  Full Name                  : 
  Home Directory             : \\ROCK\mike
  HomeDir Drive              : 
  Logon Script               : 
  Profile Path               : \\ROCK\mike\profile
  Domain                     : ROCK
  Account desc               : 
  Workstations               : 
  Munged dial                : 
  Logon time                 : 0
  Logoff time                : never
  Kickoff time               : never
  Password last set          : 土, 01  7月 2023 12:45:10 JST
  Password can change        : 土, 01  7月 2023 12:45:10 JST
  Password must change       : never
  Last bad password          : 0
  Bad password count         : 0
  Logon hours                : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo pdbedit -L
  
  コマンドの実行結果
  --------------------------------------------------
  kate:1001:
  mike:1002:
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo chmod 600 /etc/samba/smbpasswd
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  $ cd $HOME
  $ ifconfig enp0s25 | grep inet
  
  コマンドの実行結果
  --------------------------------------------------
  inet 192.168.1.4  netmask 255.255.255.0  broadcast 192.168.1.255  // rock の IPv4 が判明
  inet6 fe80::7258:12ff:fe26:accf  prefixlen 64  scopeid 0x20<link>
  inet6 2400:4052:20c0:bc00:7258:12ff:fe26:accf  prefixlen 64  scopeid 0x0<global>
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo vi /etc/samba/lmhosts -> Windows側でも同ファイルを用意
  
  コマンドの実行結果
  --------------------------------------------------
  127.0.0.1 localhost
  192.168.1.2 pc01  // 追加 => 事前に調査
  192.168.1.4 rock  // 追加
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo vi /etc/hosts -> Windows側でも同ファイルを用意
  
  コマンドの実行結果
  --------------------------------------------------
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  
  192.168.122.11 vm11 vm11.avswa.com
  192.168.122.12 vm12 vm12.avswa.com
  192.168.122.13 vm13 vm13.avswa.com
  
  192.168.1.2 pc01  // 追加 => 事前に調査
  192.168.1.4 rock  // 追加
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo firewall-cmd --add-service=samba --permanent
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo firewall-cmd --reload
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo systemctl start smb nmb
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo semanage fcontext -a -t samba_share_t /home/samba
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> /home/samba 以下の SELinux コンテキスト修正
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo restorecon -R -v /home/samba
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コンテキスト修正を反映
  --------------------------------------------------
  
  ==================================================
    Sambaクライアントで接続(Sambaユーザー登録済み)
  ==================================================
  
  //$ cd $HOME
  //$ sudo setenforce 0
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  //--------------------------------------------------
  
  $ cd $HOME
  $ smbclient -U kate //rock/share -> Sambaクライアントで共有フォルダに接続
  
  コマンドの実行結果
  --------------------------------------------------
  Password for [WORKGROUP\kate]: (ka0122ma)
  Try "help" to get a list of possible commands.
  --------------------------------------------------
    
    smb:\> 
    smb:\> mput file1.txt -> ファイルを共有フォルダにアップロード
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file1.txt? (yes)
    putting file file1.txt as \file1.txt (2.0 kb/s) (average 2.0 kb/s)
    --------------------------------------------------
    
    smb:\> 
    smb:\> mput file2.txt -> ファイルを共有フォルダにアップロード
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file2.txt? (yes)
    putting file file2.txt as \file2.txt (1.3 kb/s) (average 1.6 kb/s)
    --------------------------------------------------
    
    smb:\> 
    smb:\> exit
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
  $ cd $HOME
  $ ls -lh /home/samba -> 共有フォルダの内容を確認
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:17 file1.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:19 file2.txt
  --------------------------------------------------
  
  //$ cd $HOME
  //$ sudo setenforce 1
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> 出力なし
  //--------------------------------------------------
  
  ==================================================
     Sambaクライアントで接続(Sambaユーザー未登録)
  ==================================================
  
  //$ cd $HOME
  //$ sudo setenforce 0
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  //--------------------------------------------------
  
  $ cd $HOME
  $ smbclient -U AAAA //rock/share -> Sambaクライアントで共有フォルダに接続
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\AAAA's password: (AAAA) -> OSユーザーにもSambaユーザーにも未登録
  Try "help" to get a list of possible commands.
  --------------------------------------------------
    
    smb:\> 
    smb:\> mput file3.txt -> ファイルを共有フォルダにアップロード
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file3.txt? (yes)
    putting file file3.txt as \file3.txt (0.6 kb/s) (average 0.6 kb/s)
    --------------------------------------------------
    
    smb:\> 
    smb:\> mput file4.txt -> ファイルを共有フォルダにアップロード
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file4.txt? (yes)
    putting file file4.txt as \file4.txt (1.3 kb/s) (average 0.8 kb/s)
    --------------------------------------------------
    
    smb:\> 
    smb:\> exit
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
  $ cd $HOME
  $ ls -lh /home/samba -> 共有フォルダの内容を確認
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:17 file1.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:19 file2.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:28 file3.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:29 file4.txt
  --------------------------------------------------
  
  //$ cd $HOME
  //$ sudo setenforce 1
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> 出力なし
  //--------------------------------------------------
  
  ==================================================
       Windows側から接続(Sambaユーザー未登録)
  ==================================================
  
  //$ cd $HOME
  //$ sudo setenforce 0
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  //--------------------------------------------------
    
    > Windows側の操作
    > アクセス -> \\rock\share
    
    コマンドの実行結果
    --------------------------------------------------
    ホスト(rock)がブラウずされない -> プロトコル(SMB1)を有効化
    ホスト(rock)にアクセスできない -> ゲストログオンを許可
    --------------------------------------------------
    
    > Windows側の操作
    > ダウンロード
    
    コマンドの実行結果
    --------------------------------------------------
    ( file[1-4].txt をダウンロード)
    --------------------------------------------------
    
    > Windows側の操作
    > ファイル作成

    コマンドの実行結果
    --------------------------------------------------
    ( file[5-6].txt をファイル作成)
    --------------------------------------------------
    
    > Windows側の操作
    > アップロード

    コマンドの実行結果
    --------------------------------------------------
    (ファイル file[5-6].txt を共有フォルダにアップロード)
    --------------------------------------------------
    
  $ cd $HOME
  $ ls -lh /home/samba -> 共有フォルダの内容を確認
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:17 file1.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:19 file2.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:28 file3.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 13:29 file4.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 19:23 file5.txt
  -rwxrw-rw-. 1 makoto makoto 12  7月  1 19:24 file6.txt
  --------------------------------------------------
  
  //$ cd $HOME
  //$ sudo setenforce 1
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> 出力なし
  //--------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  Samba - 02 (共有フォルダ - 登録ユーザーのみアクセス可能)
  
[内容]
  ## 作業内容
    共有フォルダに登録ユーザーのみアクセス可能にする
  
  ## 使用マシン
    HOST : rock
    IPV4 : dhcp
    MEMO : Rocky Linux
    USER : makoto
  
  ## 使用マシン
    HOST : pc01
    IPV4 : dhcp
    MEMO : Windows10 -> WORKGROUP
    USER : Owner
  
[確認]
  $ cd $HOME
  $ sudo rm -f /home/samba/file[1-6].txt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo vi /etc/samba/smb.conf
  
  コマンドの実行結果
  --------------------------------------------------
  [global]
    workgroup = WORKGROUP                         // This server is WORKGROUP
    server role = STANDALONE                      // This server is not Domain Controller
    netbios name = FS01                           // NetBIOS
    server string = File Server for Windows User  // Description
    hosts allow = 192.168.1. 127.                 // Accessible Hosts
    guest account = makoto                        // Guest behaves as makoto user in Linux
    map to guest = Never                          // Guest login is impossible (Bad User -> Never)
    log file = /var/log/samba/%m.log              // Samba log
    max log size = 0                              // Samba log size is unlimited
    wins support = No                             // Samba needs no WINS, uses /etc/samba/lmhosts
    security = user                               // Samba needs Linux Account
    passdb backend = smbpasswd                    // Samba stores user data in smbpasswd
    smb passwd file = /etc/samba/smbpasswd        // Smbpasswd file
    create mask = 0777                            // File Permission
    directory mask = 0777                         // Directory Permission
    local master = No                             // Master Browser is not me
    preferred master = No                         // Master Browser is not me
    domain master = No                            // Master Browser is not me
    os level = 10                                 // Master Browser is not me
    
  [share]
    comment = share directory in FS01             // Description
    browseable = Yes                              // Windows User can browse this SHARE
    writable = Yes                                // Windows User can write in this SHARE
    path = /home/samba                            // Specify the directory path for this SHARE
    public = No                                   // Guest User can not access (Yes -> No)
    guest ok = No                                 // Guest User can not access (Yes -> No)
    guest only = No                               // Guest User can not access (Yes -> No)
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo testparm
  
  コマンドの実行結果
  --------------------------------------------------
  Load smb config files from /etc/samba/smb.conf
  Loaded services file OK.      // 構文チェックに異常なし
  Server role: ROLE_STANDALONE  // スタンドアロン
  
  // Enterキー押下で先に進む
  Press enter to see a dump of your service definitions
  
  # Global parameters
  [global]
    domain master = No
    guest account = makoto
    local master = No
    log file = /var/log/samba/%m.log
    max log size = 0
    os level = 10
    passdb backend = smbpasswd
    preferred master = No
    security = USER
    server role = standalone server
    server string = File Server for Windows User
    smb passwd file = /etc/samba/smbpasswd
    idmap config * : backend = tdb
    create mask = 0777
    directory mask = 0777
    hosts allow = 192.168.1. 127.
  
  [share]
    comment = share directory in FS01
    path = /home/samba
    read only = No
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo systemctl start smb nmb
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
    Sambaクライアントで接続(Sambaユーザー登録済み)
  ==================================================
  
  //# cd $HOME
  //# setenforce 0 (SELinuxの無効化)
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  //--------------------------------------------------
  
  $ cd $HOME
  $ smbclient -U kate //rock/share -> Sambaクライアントで共有フォルダに接続
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122maと入力)
  Try "help" to get a list of possible commands.
  --------------------------------------------------
    
    smb:\> 
    smb:\> mput file1.txt -> ファイルを共有フォルダにアップロード
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file1.txt? (yes)
    putting file file1.txt as \file1.txt (0.5 kb/s) (average 0.5 kb/s)
    --------------------------------------------------
    
    smb:\> 
    smb:\> mput file2.txt -> ファイルを共有フォルダにアップロード
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file2.txt? (yes)
    putting file file2.txt as \file2.txt (1.0 kb/s) (average 0.7 kb/s)
    --------------------------------------------------
    
    smb:\> 
    smb:\> exit
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
  $ cd $HOME
  $ ls -lh /home/samba
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:29 file1.txt  // 所有者が「Sambaユーザー」通りに設定されている
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:29 file2.txt  // 所有者が「Sambaユーザー」通りに設定されている
  --------------------------------------------------
  
  //# cd $HOME
  //# setenforce 1 (SELinuxの有効化)
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> 出力なし
  //--------------------------------------------------
  
  ==================================================
     Sambaクライアントで接続(Sambaユーザー未登録)
  ==================================================
  
  //# cd $HOME
  //# setenforce 0 (SELinuxの無効化)
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  //--------------------------------------------------
  
  $ cd $HOME
  $ smbclient -U AAAA //rock/share -> Sambaクライアントで共有フォルダに接続
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\AAAA's password: (AAAAと入力) -> 当然ながらOSユーザーにもSambaユーザーにも未登録
  session setup failed: NT_STATUS_LOGON_FAILURE -> Sambaサーバーと接続できなくなる
  --------------------------------------------------
  
  //# cd $HOME
  //# setenforce 1 (SELinuxの有効化)
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> 出力なし
  //--------------------------------------------------
  
  ==================================================
         Windows側から接続(Samba登録ユーザー)
  ==================================================
  
  //# cd $HOME
  //# setenforce 0 (SELinuxの無効化)
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  //--------------------------------------------------
    
    > Windows側の操作
    > アクセス -> \\rock\share

    コマンドの実行結果
    --------------------------------------------------
    (資格情報ダイアログにSambaユーザー(kate)のユーザーとパスワードを入力)
    --------------------------------------------------
    
    > Windows側の操作
    > ダウンロード
    
    コマンドの実行結果
    --------------------------------------------------
    ( file[1-2].txt をダウンロード)
    --------------------------------------------------
    
    > Windows側の操作
    > ファイル作成

    コマンドの実行結果
    --------------------------------------------------
    ( file[3-4].txt をファイル作成)
    --------------------------------------------------
    
    > Windows側の操作
    > アップロード

    コマンドの実行結果
    --------------------------------------------------
    (ファイル file[3-4].txt を共有フォルダにアップロード)
    --------------------------------------------------
    
  $ cd $HOME
  $ ls -lh /home/samba -> 共有フォルダの内容を確認
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:29 file1.txt
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:29 file2.txt
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:41 file3.txt  // 所有者が「Sambaユーザー」通りに設定されている
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:41 file4.txt  // 所有者が「Sambaユーザー」通りに設定されている
  --------------------------------------------------
  
  //# cd $HOME
  //# setenforce 1 (SELinuxの有効化)
  
  //コマンドの実行結果
  //--------------------------------------------------
  //(省略) -> 出力なし
  //--------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  Samba - 03 (ホームディレクトリ)
  
[内容]
  ## 作業内容
    登録ユーザーのホームディレクトリを開放する
  
  ## 使用マシン
    HOST : rock
    IPV4 : dhcp
    MEMO : Rocky Linux
    USER : makoto
  
  ## 使用マシン
    HOST : pc01
    IPV4 : dhcp
    MEMO : Windows10 -> WORKGROUP
    USER : Owner
  
[確認]
  $ cd $HOME
  $ sudo rm -f /home/samba/file[1-4].txt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo vi /etc/samba/smb.conf
  
  コマンドの実行結果
  --------------------------------------------------
  [global]
    workgroup = WORKGROUP                         // This server is WORKGROUP
    server role = STANDALONE                      // This server is not Domain Controller
    netbios name = rock                           // NetBIOS
    server string = File Server for Windows User  // Description
    hosts allow = 192.168.1. 127.                 // Accessible Hosts
    guest account = makoto                        // Guest behaves as makoto user in Linux
    map to guest = Never                          // Guest login is impossible (Bad User -> Never)
    log file = /var/log/samba/%m.log              // Samba log
    max log size = 0                              // Samba log size is unlimited
    wins support = No                             // Samba needs no WINS, uses /etc/samba/lmhosts
    security = user                               // Samba needs Linux Account
    passdb backend = smbpasswd                    // Samba stores user data in smbpasswd
    smb passwd file = /etc/samba/smbpasswd        // Smbpasswd file
    create mask = 0777                            // File Permission
    directory mask = 0777                         // Directory Permission
    local master = No                             // Master Browser is not me
    preferred master = No                         // Master Browser is not me
    domain master = No                            // Master Browser is not me
    os level = 10                                 // Master Browser is not me
    
  [homes]
    comment = home directory in rock              // Description
    browseable = Yes                              // Windows User can browse home directory
    writable = Yes                                // Windows User can write in home directory
    
  [share]
    comment = share directory in rock             // Description
    browseable = Yes                              // Windows User can browse this SHARE
    writable = Yes                                // Windows User can write in this SHARE
    path = /home/samba                            // Specify the directory path for this SHARE
    public = No                                   // Guest User can not access (Yes -> No)
    guest ok = No                                 // Guest User can not access (Yes -> No)
    guest only = No                               // Guest User can not access (Yes -> No)
  --------------------------------------------------
  
  $ cd $HOME
  $ sudo testparm
  
  コマンドの実行結果
  --------------------------------------------------
  Load smb config files from /etc/samba/smb.conf
  Loaded services file OK.      // 構文チェックに異常なし
  Server role: ROLE_STANDALONE  // スタンドアロン
  
  // Enterキー押下で先に進む
  Press enter to see a dump of your service definitions
  
  # Global parameters
  [global]
    domain master = No
    guest account = makoto
    local master = No
    log file = /var/log/samba/%m.log
    max log size = 0
    os level = 10
    passdb backend = smbpasswd
    preferred master = No
    security = USER
    server role = standalone server
    server string = File Server for Windows User
    smb passwd file = /etc/samba/smbpasswd
    idmap config * : backend = tdb
    create mask = 0777
    directory mask = 0777
    hosts allow = 192.168.1. 127.
  
  [homes]
    comment = home directory in FS01
    read only = No
  
  [share]
    comment = share directory in FS01
    path = /home/samba
    read only = No
  --------------------------------------------------
  
  # cd $HOME
  # systemctl start smb nmb (Sambaサービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
    Sambaクライアントで接続(Sambaユーザー登録済み)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U kate //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122maと入力)
  Try "help" to get a list of possible commands.
    
    smb: \> (ファイルを共有フォルダにアップロード)
    smb: \>  mput file1.txt
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file1.txt? (yes)
    putting file file1.txt as \file1.txt (0.5 kb/s) (average 0.5 kb/s)
    --------------------------------------------------
    
    smb: \> (Sambaクライアント終了)
    smb: \>  exit

    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    OSプロンプトに戻る
    
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U kate //FS01/kate (Sambaクライアントでホームディレクトリに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122maと入力)
  Try "help" to get a list of possible commands.
    
    smb: \> (ファイルを共有フォルダにアップロード)
    smb: \>  mput file2.txt
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file2.txt? (yes)
    putting file file2.txt as \file2.txt (0.5 kb/s) (average 0.5 kb/s)
    --------------------------------------------------
    
    smb: \> (Sambaクライアント終了)
    smb: \>  exit

    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    OSプロンプトに戻る
    
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U mike //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\mike's password: (mi0122maと入力)
  Try "help" to get a list of possible commands.
  
    smb: \> (ファイルを共有フォルダにアップロード)
    smb: \>  mput file3.txt
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file3.txt? (yes)
    putting file file3.txt as \file3.txt (0.5 kb/s) (average 0.5 kb/s)
    --------------------------------------------------
    
    smb: \> (Sambaクライアント終了)
    smb: \>  exit
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    OSプロンプトに戻る
    
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U mike //FS01/mike (Sambaクライアントでホームディレクトリに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\mike's password: (mi0122maと入力)
  Try "help" to get a list of possible commands.
    
    smb: \> (ファイルを共有フォルダにアップロード)
    smb: \>  mput file4.txt
    
    コマンドの実行結果
    --------------------------------------------------
    Put file file4.txt? (yes)
    putting file file4.txt as \file4.txt (0.5 kb/s) (average 0.5 kb/s)
    --------------------------------------------------
    
    smb: \> (Sambaクライアント終了)
    smb: \>  exit
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    OSプロンプトに戻る
    
  --------------------------------------------------
  
  # cd /home/samba
  # ls -lh (共有フォルダの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 kate kate 12  1月 24 20:10 file1.txt  // 所有者が「Sambaユーザー」通りに設定されている
  -rwxrw-rw-. 1 mike mike 12  1月 24 20:18 file3.txt  // 所有者が「Sambaユーザー」通りに設定されている
  --------------------------------------------------
  
  # cd /home
  # ls -lh kate mike | grep file (ホームディレクトリの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 kate kate 12  1月 24 20:12 file2.txt  // 所有者が「Sambaユーザー」通りに設定されている
  -rwxrw-rw-. 1 mike mike 12  1月 24 20:20 file4.txt  // 所有者が「Sambaユーザー」通りに設定されている
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
         Windows側から接続(Samba登録ユーザー)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
    
    操作1
    ==================================================
    ネットワークパス「\\FS01」にアクセス -> 資格情報ダイアログ、Sambaユーザー(kate)のユーザーとパスワード入力
    ==================================================
    
    操作2
    ==================================================
    フォルダ「homes & kate & share」が表示
    ==================================================
    
    操作3
    ==================================================
    フォルダ「homes & kate」の内容はファイル「file1.txt」-> homes = kate の認識でOK
    ==================================================
    
    操作4
    ==================================================
    フォルダ「share」の内容はファイル「file[2,4].txt」
    ==================================================
    
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  Samba - 04 (パスワード変更)
  
[内容]
  ## 作業内容
    Sambaユーザーのパスワード変更(複雑化)時に、OSユーザーのパスワードも連動させる
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「FS01」のまま
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # Windows用ファイルサーバーに構築する
    USER : root                    # root
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「PC01」のまま
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # ドメイン未参加(WORKGROUP)
    USER : Owner                   # 元々存在していたユーザー(Administrators)
  
  ## 設定情報(Samba)
    DIRECTORY : /home/samba        # サーバー側ディレクトリ
    SHARENAME : share              # 共有名
  
[確認]
  # cd /home/samba
  # rm -f file[1,3].txt (共有フォルダのファイル削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd /etc/samba
  # vi smb.conf (設定ファイルの修正)
  
  コマンドの実行結果
  --------------------------------------------------
  [global]
    workgroup = WORKGROUP                         // This server is WORKGROUP
    server role = STANDALONE                      // This server is not Domain Controller
    netbios name = FS01                           // NetBIOS
    server string = File Server for Windows User  // Description
    hosts allow = 192.168.1. 127.                 // Accessible Hosts
    guest account = makoto                        // Guest behaves as makoto user in Linux
    map to guest = Never                          // Guest login is impossible (Bad User -> Never)
    log file = /var/log/samba/%m.log              // Samba log
    max log size = 0                              // Samba log size is unlimited
    encrypt passwords = Yes                       // Samba use encrypt password
    wins support = No                             // Samba needs no WINS, uses /etc/samba/lmhosts
    security = user                               // Samba needs Linux Account
    passdb backend = smbpasswd                    // Samba stores user data in smbpasswd
    smb passwd file = /etc/samba/smbpasswd        // Smbpasswd file
    unix password sync = Yes                      // Samba user changes password, Linux user password is going to be changed
    passwd program = /bin/passwd %u               // Samba user changes password, Samba uses this program
    passwd chat = *New*password* %n\n *Retype*new*password* %n\n *passwd:*all*authentication*tokens*updated*successfully*
    create mask = 0777                            // File Permission
    directory mask = 0777                         // Directory Permission
    local master = No                             // Master Browser is not me
    preferred master = No                         // Master Browser is not me
    domain master = No                            // Master Browser is not me
    os level = 10                                 // Master Browser is not me
    
  [homes]
    comment = home directory in FS01   // Description
    browseable = Yes                   // Windows User can browse home directory
    writable = Yes                     // Windows User can write in home directory
    
  [share]
    comment = share directory in FS01  // Description
    browseable = Yes                   // Windows User can browse this SHARE
    writable = Yes                     // Windows User can write in this SHARE
    path = /home/samba                 // Specify the directory path for this SHARE
    public = No                        // Guest User can not access (Yes -> No)
    guest ok = No                      // Guest User can not access (Yes -> No)
    guest only = No                    // Guest User can not access (Yes -> No)
  --------------------------------------------------
  
  # cd $HOME
  # testparm (構文チェック)
  
  コマンドの実行結果
  --------------------------------------------------
  Load smb config files from /etc/samba/smb.conf
  Loaded services file OK.      // 構文チェックに異常なし
  Server role: ROLE_STANDALONE  // スタンドアロン
  
  // Enterキー押下で先に進む
  Press enter to see a dump of your service definitions
  
  # Global parameters
  [global]
    domain master = No
    guest account = makoto
    local master = No
    log file = /var/log/samba/%m.log
    max log size = 0
    os level = 10
    passdb backend = smbpasswd
    passwd chat = *New*password* %n\n *Retype*new*password* %n\n *passwd:*all*authentication*tokens*updated*successfully*
    passwd program = /bin/passwd %u
    preferred master = No
    security = USER
    server role = standalone server
    server string = File Server for Windows User
    smb passwd file = /etc/samba/smbpasswd
    unix password sync = Yes
    idmap config * : backend = tdb
    create mask = 0777
    directory mask = 0777
    hosts allow = 192.168.1. 127.
  
  [homes]
    comment = home directory in FS01
    read only = No
  
  [share]
    comment = share directory in FS01
    path = /home/samba
    read only = No
  --------------------------------------------------
  
  # cd $HOME
  # systemctl start smb nmb (Sambaサービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
    
    $ cd $HOME
    $ whoami (OSユーザーの確認)
    
    コマンドの実行結果
    --------------------------------------------------
    makoto
    --------------------------------------------------
    
    $ cd $HOME
    $ LANG=C su - kate (OSユーザー変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Password: (ka0122maと入力)
    --------------------------------------------------
    
    $ cd $HOME
    $ smbpasswd -U kate (Sambaユーザーのパスワード変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Old SMB password: (ka0122maと入力)
    New SMB password: (ka0122ma9310saと入力)
    Retype new SMB password: (ka0122ma9310saと入力)
    Password changed for user kate
    --------------------------------------------------
    
    $ cd $HOME
    $ exit (ログアウト)
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト
    --------------------------------------------------
    
    $ cd $HOME
    $ LANG=C su - mike (OSユーザー変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Password: (mi0122maと入力)
    --------------------------------------------------
    
    $ cd $HOME
    $ smbpasswd -U mike (Sambaユーザーのパスワード変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Old SMB password: (mi0122maと入力)
    New SMB password: (mi0122ma9310saと入力)
    Retype new SMB password: (mi0122ma9310saと入力)
    Password changed for user mike
    --------------------------------------------------
    
    $ cd $HOME
    $ exit (ログアウト)
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト
    --------------------------------------------------
    
    $ cd $HOME
    $ LANG=C su - kate (OSユーザー変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Password: (ka0122ma9310saと入力)
    Last login: Tue Jan 25 10:40:17 JST 2022 on pts/2
    --------------------------------------------------
    
    $ cd $HOME
    $ exit (ログアウト)
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト
    --------------------------------------------------
    
    $ cd $HOME
    $ LANG=C su - mike (OSユーザー変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Password: (mi0122ma9310saと入力)
    Last login: Tue Jan 25 10:51:08 JST 2022 on pts/2
    --------------------------------------------------
    
    $ cd $HOME
    $ exit (ログアウト)
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト
    --------------------------------------------------
    
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
    Sambaクライアントで接続(Sambaユーザー登録済み)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U kate //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122ma9310saと入力)
  Try "help" to get a list of possible commands.
    
    smb: \> (Sambaクライアント終了)
    smb: \>  exit
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    プロンプトに戻る
    
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U mike //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\mike's password: (mi0122ma9310saと入力)
  Try "help" to get a list of possible commands.
    
    smb: \> (Sambaクライアント終了)
    smb: \>  exit
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    プロンプトに戻る
    
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  Samba - 05 (マスターブラウザの検索)
  
[内容]
  ## 作業内容
    設定通りにマスターブラウザが「PC01」であるか確認する
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「FS01」のまま
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # Windows用ファイルサーバーに構築する
    USER : root                    # root
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「PC01」のまま
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # ドメイン未参加(WORKGROUP)
    USER : Owner                   # 元々存在していたユーザー(Administrators)
  
  ## 設定情報(Samba)
    DIRECTORY : /home/samba        # サーバー側ディレクトリ
    SHARENAME : share              # 共有名
  
  ## コマンド(nmblookup)
    nmblookup -A XX  // 引数(XX)をIPアドレスと見なす
    nmblookup -M XX  // 引数(XX = WORKGROUP)からマスターブラウザを検索する
  
[確認]
  # cd $HOME
  # systemctl start smb nmb (Sambaサービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd $HOME
  # nmblookup WORKGROUP (ワークグループの所属ホスト一覧)
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.1.3 WORKGROUP<00>
  192.168.1.2 WORKGROUP<00>
  192.168.1.1 WORKGROUP<00>
  --------------------------------------------------
  
  # cd $HOME
  # nmblookup -M WORKGROUP (マスターブラウザの検索)
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.1.2 WORKGROUP<1d>  // マスターブラウザは「192.168.1.2」と判明
  --------------------------------------------------
  
  # cd $HOME
  # nmblookup -A 192.168.1.2 (IPアドレスから逆引き)
  
  コマンドの実行結果
  --------------------------------------------------
  Looking up status of 192.168.1.2
    PC01            <00> -         B <ACTIVE>  // NetBIOS名は「PC01」、タイプ「00」 -> ファイル共有クライアント
    PC01            <20> -         B <ACTIVE>  // NetBIOS名は「PC01」、タイプ「20」 -> ファイル共有サーバー
    WORKGROUP       <00> - <GROUP> B <ACTIVE>  // ワークグループ名、タイプ「00」 -> ドメイン名
    WORKGROUP       <1e> - <GROUP> B <ACTIVE>  // ワークグループ名、タイプ「1e」 -> ポテンシャルブラウザ
    WORKGROUP       <1d> -         B <ACTIVE>  // ワークグループ名、タイプ「1d」 -> マスターブラウザ
    ..__MSBROWSE__. <01> - <GROUP> B <ACTIVE>
  
  MAC Address = EC-F4-BB-47-A4-58
  --------------------------------------------------
  
  # cd $HOME
  # nmblookup PC01 (NetBIOS名から正引き)

  コマンドの実行結果
  --------------------------------------------------
  192.168.1.2 PC01<00>
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[06]
  Samba - 06 (Windows側の共有フォルダをSambaクライアントからアクセス)
  
[内容]
  ## 作業内容
    Windows側の共有フォルダにSambaクライアントでアクセスする
  
  ## 使用マシン
    HOST : localhost               # ホスト名は「FS01」のまま
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # 追記事項なし
    USER : root                    # 追記事項なし
  
  ## 使用マシン
    HOST : localhost               # ホスト名は「PC01」のまま
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # 追記事項なし
    USER : Makoto                  # 今回の動作確認で追加されたOSユーザー
  
  ## 設定情報(Windows)
    DIRECTORY : C:/share           # サーバー側ディレクトリ
    SHARENAME : share              # 共有設定済み(所有者 = Owner, アクセス権 = Owner, Makoto)
    MEMO : file[1-2].txt           # 先の記録で使用したファイルを共有内に設置
  
[確認]
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U Makoto //PC01/share (SambaクライアントでWindows側の共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\Makoto's password: (Windows側でMakoto作成時に設定したパスワード入力)
  Try "help" to get a list of possible commands.
    
    smb: \> (共有フォルダ内のファイル一覧)
    smb: \>  ls
    
    コマンドの実行結果
    --------------------------------------------------
    .  (Parent)                         D        0  Tue Jan 25 14:37:54 2022
    .. (Curent)                         D        0  Tue Jan 25 14:37:54 2022
    file1.txt                           A       12  Mon Jan 24 18:29:11 2022
    file2.txt                           A       12  Mon Jan 24 18:29:18 2022
    --------------------------------------------------
    
    smb: \> (ファイルの内容を確認)
    smb: \>  more file1.txt
    
    コマンドの実行結果
    --------------------------------------------------
    getting file \file1.txt of size 12 as /tmp/smbmore.QBMOeW (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)
    AAA AAA AAA
    --------------------------------------------------
    
    smb: \> (ファイルの内容を確認)
    smb: \>  more file2.txt
    
    コマンドの実行結果
    --------------------------------------------------
    getting file \file2.txt of size 12 as /tmp/smbmore.yFgF0u (3.9 KiloBytes/sec) (average 0.4 KiloBytes/sec)
    BBB BBB BBB
    --------------------------------------------------
    
    smb: \> (Sambaクライアント終了)
    smb: \>  exit

    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    OSプロンプトに戻る
    
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[07]
  Samba - 07 (Windows側の共有フォルダをLinux側からマウント)
  
[内容]
  ## 作業内容
    Windows側の共有フォルダをLinux側からマウントする
  
  ## 使用マシン
    HOST : localhost               # ホスト名は「FS01」のまま
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # 追記事項なし
    USER : root                    # 追記事項なし
  
  ## 使用マシン
    HOST : localhost               # ホスト名は「PC01」のまま
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # 追記事項なし
    USER : Makoto                  # 今回の動作確認で追加されたOSユーザー
  
  ## 設定情報(Windows)
    DIRECTORY : C:/share           # サーバー側ディレクトリ
    SHARENAME : share              # 共有設定済み(所有者 = Owner, アクセス権 = Owner, Makoto)
    MEMO : file[1-2].txt           # 先の記録で使用したファイルを共有内に設置
  
[確認]
  # cd $HOME (Windows側の共有フォルダをLinux側からマウントする)
  # mount -t cifs -o defaults,username=Makoto,password=ma0122ma9310sa4221pd //PC01/share /mnt
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd /mnt
  # ls -lh (Windows側の共有フォルダのファイル一覧)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxr-xr-x. 1 root root 12  1月 24 18:29 file1.txt
  -rwxr-xr-x. 1 root root 12  1月 24 18:29 file2.txt
  --------------------------------------------------
  
  # cd /mnt
  # cat file1.txt file2.txt (ファイル確認)
  
  コマンドの実行結果
  --------------------------------------------------
  AAA AAA AAA
  BBB BBB BBB
  --------------------------------------------------
  
  # cd $HOME
  # umount /mnt (アンマウント)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[08]
  NFS - 01 (RPC)
  
[内容]
  ## 作業内容
    リモートホスト機能を各ホスト独自にサービス(portmap)が識別番号(RPC番号)として動的に管理 -> NFSの土台
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : 仮想マシン
  
  ## 使用マシン
    HOST : vm13
    IPV4 : 192.168.122.13
    MEMO : 仮想マシン
  
[確認]
  vm12$ cd $HOME
  vm12$ sudo yum list installed | grep rpcbind (サービスのインストール確認)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo yum -y install rpcbind (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl is-active rpcbind (サービスの確認)
  
  コマンドの実行結果
  --------------------------------------------------
  inactive -> rpcinfo を一度でも使用すると「active」になる
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo rpcinfo -p (システムで動作中のRPCサービス一覧)
  
  コマンドの実行結果
  --------------------------------------------------
  program  vers  proto  port  service
  100000   4     tcp    111   portmapper
  100000   3     tcp    111   portmapper
  100000   2     tcp    111   portmapper
  100000   4     udp    111   portmapper
  100000   3     udp    111   portmapper
  100000   2     udp    111   portmapper
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo yum list installed | grep rpcbind (サービスのインストール確認)
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo yum -y install rpcbind (パッケージ追加)
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo systemctl is-active rpcbind (サービスの確認)
    
    コマンドの実行結果
    --------------------------------------------------
    inactive -> rpcinfo を一度でも使用すると「active」になる
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo rpcinfo -p (システムで動作中のRPCサービス一覧)
    
    コマンドの実行結果
    --------------------------------------------------
    program  vers  proto  port  service
    100000   4     tcp    111   portmapper
    100000   3     tcp    111   portmapper
    100000   2     tcp    111   portmapper
    100000   4     udp    111   portmapper
    100000   3     udp    111   portmapper
    100000   2     udp    111   portmapper
    --------------------------------------------------
    
  以下の確認に続く
  
================================================================================
[09]
  NFS - 02 (NFS)
  
[内容]
  ## 作業内容
    特定ディレクトリをクライアントに公開
  
  ## 使用マシン
    HOST : vm12
    IPV4 : 192.168.122.12
    MEMO : NFS Server
  
  ## 使用マシン
    HOST : vm13
    IPV4 : 192.168.122.13
    MEMO : NFS Client
  
[確認]
  vm12$ cd $HOME
  vm12$ sudo yum -y install nfs-utils (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  vm12$ cd /home
  vm12$ sudo mkdir nfs (公開ディレクトリを作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd /home
  vm12$ sudo chmod 777 nfs (公開ディレクトリに権限付与)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd /home/nfs
  vm12$ sudo echo 'AAA AAA AAA' > file1.txt (サンプルファイル作成)
  vm12$ sudo echo 'BBB BBB BBB' > file2.txt (サンプルファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo firewall-cmd --add-service=nfs --permanent
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo firewall-cmd --reload
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo systemctl start nfs-server (NFSサーバー起動)
  
  コマンドの実行結果
  --------------------------------------------------
  [11760.181464] RPC: Registered named UNIX socket transport module.        // RPC番号をサービス(portmap)に登録
  [11760.183205] RPC: Registered udp transport module.                      // RPC番号をサービス(portmap)に登録
  [11760.184513] RPC: Registered tcp transport module.                      // RPC番号をサービス(portmap)に登録
  [11760.185794] RPC: Registered tcp NFSv4.1 backchannel transport module.  // RPC番号をサービス(portmap)に登録
  [11760.423968] Installing knfsd (copyright (C) 1996 okir@monad.swb.de).
  [11760.665947] NFSD: starting 90-second grace period (net ffffffff95315e40)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo rpcinfo -p | grep -i nfs (システムで動作中のRPCサービスからNFS関連を抽出)
  
  コマンドの実行結果
  --------------------------------------------------
  program  vers  proto  port  service
  100003   3     tcp    2049  nfs
  100003   4     tcp    2049  nfs
  100227   3     tcp    2049  nfs_acl
  100003   3     udp    2049  nfs
  100003   4     udp    2049  nfs
  100227   3     udp    2049  nfs_acl
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo exportfs -v (ディレクトリの公開状況を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし) -> 設定ファイルに「/home/nfs」の記述が無いため公開ディレクトリが無い状態
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo showmount -e vm12 (ディレクトリの公開状況を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  Export list for vm12: (公開ディレクトリが無い状態)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo vi /etc/exports (設定ファイルの修正)
  
  コマンドの実行結果
  --------------------------------------------------
  /home/nfs 192.168.122.0/255.255.255.0(rw,async,no_root_squash)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo exportfs -a -r (設定ファイルの内容を公開ディレクトリに反映)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo exportfs -v (ディレクトリの公開状況を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  /home/nfs 192.168.122.0/255.255.255.0 (async,wdelay,hide,no_subtree_check,sec=sys,rw,secure,no_root_squash,no_all_squash)
  --------------------------------------------------
  
  vm12$ cd $HOME
  vm12$ sudo showmount -e vm12 (ディレクトリの公開状況を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  Export list for vm12:
  /home/nfs 192.168.122.0/255.255.255.0
  --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo yum -y install nfs-utils (パッケージ追加)
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> エラー出力が無ければOK
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo mount -t nfs vm12:/home/nfs /mnt (NFSマウント)
    
    コマンドの実行結果
    --------------------------------------------------
    [10979.915209] FS-Cache: Loaded
    [10979.984599] RPC: Registered named UNIX socket transport module.        // RPC番号をサービス(portmap)に登録
    [10979.986581] RPC: Registered udp transport module.                      // RPC番号をサービス(portmap)に登録
    [10979.987976] RPC: Registered tcp transport module.                      // RPC番号をサービス(portmap)に登録
    [10979.989459] RPC: Registered tcp NFSv4.1 backchannel transport module.  // RPC番号をサービス(portmap)に登録
    [10980.066437] FS-Cache: Netfs 'nfs' registered for caching
    [10980.081501] Key type dns_resolver registered
    [10980.119499] NFS: Registering the id_resolver key type
    [10980.121972] Key type id_resolver registered
    [10980.123139] Key type id_legacy registered
    --------------------------------------------------
    
    vm13$ cd /mnt
    vm13$ ls -lh (公開ディレクトリ内を確認)
    
    コマンドの実行結果
    --------------------------------------------------
    -rw-rw-r--. 1 makoto makoto 12  1月 26 11:28 file1.txt
    -rw-rw-r--. 1 makoto makoto 12  1月 26 11:29 file2.txt
    --------------------------------------------------
    
    vm13$ cd $HOME
    vm13$ sudo umount /mnt (NFSマウント)
    
    コマンドの実行結果
    --------------------------------------------------
    (省略) -> 出力なし
    --------------------------------------------------
    
  vm12$ cd $HOME
  vm12$ sudo systemctl stop nfs-server (NFSサーバー停止)
  
  コマンドの実行結果
  --------------------------------------------------
  [34378.980197] nfsd: last server has exited, flushing export cache
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
