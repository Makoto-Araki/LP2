================================================================================
[01] Samba - 01 (共有フォルダ - 誰でもアクセス可能)
[02] Samba - 02 (共有フォルダ - 登録ユーザーのみアクセス可能)
[03] Samba - 03 (ホームディレクトリ)
[04] Samba - 04 (パスワード変更)
[05] Samba - 05 (マスターブラウザの検索)
================================================================================
[01]
  Samba - 01 (共有フォルダ - 誰でもアクセス可能)
  
[内容]
  ## 作業内容
    共有フォルダを作成、Windows側から誰でもアクセス可能にする
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「FS01」に変更
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # Windows用ファイルサーバーに構築する
    USER : root                    # OSユーザーで kate, mike を追加する
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「PC01」に変更
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # ドメイン未参加(WORKGROUP)
    USER : Owner                   # 元々存在していたユーザー(Administrators)
  
  ## 設定情報(Samba)
    DIRECTORY : /home/samba        # サーバー側ディレクトリ
    SHARENAME : share              # 共有名
  
[確認]
  # cd $HOME
  # yum -y install samba samba-client (パッケージ追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> エラー出力が無ければOK
  --------------------------------------------------
  
  # cd $HOME
  # hostnamectl set-hostname FS01 (ホスト名変更)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd $HOME
  # useradd -s /usr/bin/bash kate (ユーザー追加)
  # useradd -s /usr/bin/bash mike (ユーザー追加)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd $HOME
  # LANG=C passwd kate (パスワード変更)
  # LANG=C passwd mike (パスワード変更)
  
  コマンドの実行結果
  --------------------------------------------------
  // Kate
  Changing password for user kate.
  New password: (ka0122maと入力)
  Retype new password: (ka0122maと入力)
  passwd: all authentication tokens updated successfully.
  
  // Mike
  Changing password for user mike.
  New password: (mi0122maと入力)
  Retype new password: (mi0122maと入力)
  passwd: all authentication tokens updated successfully.
  --------------------------------------------------
  
  # cd $HOME
  # mkdir -p /home/samba (共有フォルダ作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd $HOME
  # chmod 777 /home/samba (共有フォルダの権限変更)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 誰でも閲覧可能、変更可能にする
  --------------------------------------------------
  
  # cd $HOME
  # echo 'AAA AAA AAA' > file1.txt (ファイル作成)
  # echo 'BBB BBB BBB' > file2.txt (ファイル作成)
  # echo 'CCC CCC CCC' > file3.txt (ファイル作成)
  # echo 'DDD DDD DDD' > file4.txt (ファイル作成)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd $HOME
  # chmod 777 file[1-4].txt (権限変更)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 誰でも閲覧可能、変更可能にする
  --------------------------------------------------
  
  # cd /etc/samba
  # cp -p smb.conf smb.conf.org (設定ファイルのバックアップ)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd /etc/samba
  # vi smb.conf (設定ファイルの修正)
  
  コマンドの実行結果
  --------------------------------------------------
  [global]
    workgroup = WORKGROUP                         // This server is WORKGROUP
    server role = STANDALONE                      // This server is not Domain Controller
    netbios name = FS01                           // NetBIOS
    server string = File Server for Windows User  // Description
    hosts allow = 192.168.1. 127.                 // Accessible Hosts
    guest account = makoto                        // Guest behaves as makoto user in Linux
    map to guest = Bad User                       // If input user is not existed, Samba reckon guest(makoto)
    log file = /var/log/samba/%m.log              // Samba log
    max log size = 0                              // Samba log size is unlimited
    encrypt passwords = Yes                       // Samba use encrypt password
    wins support = No                             // Samba needs no WINS, uses /etc/samba/lmhosts
    security = user                               // Samba needs Linux Account
    passdb backend = smbpasswd                    // Samba stores user data in smbpasswd
    smb passwd file = /etc/samba/smbpasswd        // Smbpasswd file
    create mask = 0777                            // File Permission
    directory mask = 0777                         // Directory Permission
    local master = No                             // Master Browser is not me
    preferred master = No                         // Master Browser is not me
    domain master = No                            // Master Browser is not me
    os level = 10                                 // Master Browser is not me
    
  [share]
    comment = share directory in FS01  // Description
    browseable = Yes                   // Windows User can browse this SHARE
    writable = Yes                     // Windows User can write in this SHARE
    path = /home/samba                 // Specify the directory path for this SHARE
    public = Yes                       // Guest User can access this SHARE
    guest ok = Yes                     // Guest User can access this SHARE
    guest only = Yes                   // Guest User can access this SHARE
  --------------------------------------------------
  
  # cd $HOME
  # testparm (構文チェック)
  
  コマンドの実行結果
  --------------------------------------------------
  Load smb config files from /etc/samba/smb.conf
  Loaded services file OK.      // 構文チェックに異常なし
  Server role: ROLE_STANDALONE  // スタンドアロン
  
  // Enterキー押下で先に進む
  Press enter to see a dump of your service definitions
  
  # Global parameters
  [global]
    domain master = No
    guest account = makoto
    local master = No
    log file = /var/log/samba/%m.log
    map to guest = Bad User
    max log size = 0
    os level = 10
    passdb backend = smbpasswd
    preferred master = No
    security = USER
    server role = standalone server
    server string = File Server for Windows User
    smb passwd file = /etc/samba/smbpasswd
    idmap config * : backend = tdb
    create mask = 0777
    directory mask = 0777
    hosts allow = 192.168.1. 127.
  
  [share]
    comment = share directory in FS01
    guest ok = Yes
    guest only = Yes
    path = /home/samba
    read only = No
  --------------------------------------------------
  
  # cd $HOME
  # pdbedit -a kate (Sambaユーザー登録)
  # pdbedit -a mike (Sambaユーザー登録)
  
  コマンドの実行結果
  --------------------------------------------------
  // Kate
  new password         : (ka0122maと入力)
  retype new password  : (ka0122maと入力)
  Unix username        : kate
  NT username          : 
  Account Flags        : [U          ]
  User SID             : S-1-5-21-333211391-2767060413-2512415146-3002
  Primary Group SID    : S-1-5-21-333211391-2767060413-2512415146-513
  Full Name            : 
  Home Directory       : \\fs01\kate
  HomeDir Drive        : 
  Logon Script         : 
  Profile Path         : \\fs01\kate\profile
  Domain               : FS01
  Account desc         : 
  Workstations         : 
  Munged dial          : 
  Logon time           : 0
  Logoff time          : never
  Kickoff time         : never
  Password last set    : 日, 23  1月 2022 23:48:12 JST
  Password can change  : 日, 23  1月 2022 23:48:12 JST
  Password must change : never
  Last bad password    : 0
  Bad password count   : 0
  Logon hours          : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
  
  // Mike
  new password         : (mi0122maと入力)
  retype new password  : (mi0122maと入力)
  Unix username        : mike
  NT username          : 
  Account Flags        : [U          ]
  User SID             : S-1-5-21-333211391-2767060413-2512415146-3004
  Primary Group SID    : S-1-5-21-333211391-2767060413-2512415146-513
  Full Name            : 
  Home Directory       : \\fs01\mike
  HomeDir Drive        : 
  Logon Script         : 
  Profile Path         : \\fs01\mike\profile
  Domain               : FS01
  Account desc         : 
  Workstations         : 
  Munged dial          : 
  Logon time           : 0
  Logoff time          : never
  Kickoff time         : never
  Password last set    : 日, 23  1月 2022 23:52:23 JST
  Password can change  : 日, 23  1月 2022 23:52:23 JST
  Password must change : never
  Last bad password    : 0
  Bad password count   : 0
  Logon hours          : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
  --------------------------------------------------
  
  # cd $HOME
  # pdbedit -L (Sambaユーザーの一覧)
  
  コマンドの実行結果
  --------------------------------------------------
  kate:1001:
  mike:1002:
  --------------------------------------------------
  
  # cd $HOME
  # vi /etc/samba/lmhosts (設定ファイル修正) -> Windows側でも同ファイルを用意
  
  コマンドの実行結果
  --------------------------------------------------
  127.0.0.1 localhost
  192.168.1.2 PC01 (追加)
  192.168.1.3 FS01 (追加)
  --------------------------------------------------
  
  # cd $HOME
  # vi /etc/hosts (設定ファイル修正) -> Windows側でも同ファイルを用意
  
  コマンドの実行結果
  --------------------------------------------------
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  192.168.1.2 PC01 (追加)
  192.168.1.3 FS01 (追加)
  --------------------------------------------------
  
  # cd $HOME
  # firewall-cmd --add-service=samba --permanent (設定ファイル修正)
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  # cd $HOME
  # firewall-cmd --reload (設定ファイル修正)
  
  コマンドの実行結果
  --------------------------------------------------
  success
  --------------------------------------------------
  
  # cd $HOME
  # systemctl start smb nmb (Sambaサービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
    Sambaクライアントで接続(Sambaユーザー登録済み)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U kate //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122maと入力)
  Try "help" to get a list of possible commands.
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file1.txt

  Put file file1.txt? (yes)
  putting file file1.txt as \file1.txt (0.5 kb/s) (average 0.5 kb/s)
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file2.txt

  Put file file2.txt? (yes)
  putting file file2.txt as \file2.txt (1.0 kb/s) (average 0.7 kb/s)
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd /home/samba
  # ls -lh (共有フォルダの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:18 file1.txt  // 所有者が「Guest Account」のユーザーになるのは何故？
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:18 file2.txt  // 所有者が「Guest Account」のユーザーになるのは何故？
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
     Sambaクライアントで接続(Sambaユーザー未登録)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U AAAA //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\AAAA's password: (AAAAと入力) -> 当然ながらOSユーザーにもSambaユーザーにも未登録
  Try "help" to get a list of possible commands.
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file3.txt

  Put file file3.txt? (yes)
  putting file file3.txt as \file3.txt (1.2 kb/s) (average 1.2 kb/s)
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file4.txt

  Put file file4.txt? (yes)
  putting file file4.txt as \file4.txt (2.9 kb/s) (average 1.7 kb/s)
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd /home/samba
  # ls -lh (共有フォルダの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:18 file1.txt
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:18 file2.txt
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:21 file3.txt  // 所有者が「Guest Account」のユーザーになる
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:22 file4.txt  // 所有者が「Guest Account」のユーザーになる
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
       Windows側から接続(Sambaユーザー未登録)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
    
    操作1
    ==================================================
    ネットワークパス「\\FS01\share」にアクセス -> トラブル発生
    ==================================================
    
    トラブル1
    ==================================================
    Windows側のエクスプローラに「FS01」がブラウズされない -> プロトコル「SMB1」を有効化で解決
    ==================================================
    
    トラブル2
    ==================================================
    ブラウズされた「FS01」の共有フォルダにアクセス不可 -> ゲストログオンを許可で解決
    ==================================================
    
    操作2
    ==================================================
    共有フォルダ中の「file[1-4].txt」をローカルにダウンロード
    ==================================================
    
    操作3
    ==================================================
    ローカルにコピーしたファイルを元に「file[5-6].txt」を作成
    ==================================================
    
    操作4
    ==================================================
    ファイル「file[1-6].txt」を共有フォルダにアップロード
    ==================================================
    
  # cd /home/samba
  # ls -lh (共有フォルダの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:18 file1.txt
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:18 file2.txt
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:21 file3.txt
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 09:22 file4.txt
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 12:39 file5.txt  // 所有者が「Guest Account」のユーザーになる
  -rwxrw-rw-. 1 makoto makoto 12  1月 24 12:39 file6.txt  // 所有者が「Guest Account」のユーザーになる
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[02]
  Samba - 02 (共有フォルダ - 登録ユーザーのみアクセス可能)
  
[内容]
  ## 作業内容
    共有フォルダに登録ユーザーのみアクセス可能にする
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「FS01」のまま
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # Windows用ファイルサーバーに構築する
    USER : root                    # root
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「PC01」のまま
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # ドメイン未参加(WORKGROUP)
    USER : Owner                   # 元々存在していたユーザー(Administrators)
  
  ## 設定情報(Samba)
    DIRECTORY : /home/samba        # サーバー側ディレクトリ
    SHARENAME : share              # 共有名
  
[確認]
  # cd /home/samba
  # rm -f file[1-6].txt (共有フォルダのファイル削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd /etc/samba
  # vi smb.conf (設定ファイルの修正)
  
  コマンドの実行結果
  --------------------------------------------------
  [global]
    workgroup = WORKGROUP                         // This server is WORKGROUP
    server role = STANDALONE                      // This server is not Domain Controller
    netbios name = FS01                           // NetBIOS
    server string = File Server for Windows User  // Description
    hosts allow = 192.168.1. 127.                 // Accessible Hosts
    guest account = makoto                        // Guest behaves as makoto user in Linux
    map to guest = Never                          // Guest login is impossible (Bad User -> Never)
    log file = /var/log/samba/%m.log              // Samba log
    max log size = 0                              // Samba log size is unlimited
    encrypt passwords = Yes                       // Samba use encrypt password
    wins support = No                             // Samba needs no WINS, uses /etc/samba/lmhosts
    security = user                               // Samba needs Linux Account
    passdb backend = smbpasswd                    // Samba stores user data in smbpasswd
    smb passwd file = /etc/samba/smbpasswd        // Smbpasswd file
    create mask = 0777                            // File Permission
    directory mask = 0777                         // Directory Permission
    local master = No                             // Master Browser is not me
    preferred master = No                         // Master Browser is not me
    domain master = No                            // Master Browser is not me
    os level = 10                                 // Master Browser is not me
    
  [share]
    comment = share directory in FS01  // Description
    browseable = Yes                   // Windows User can browse this SHARE
    writable = Yes                     // Windows User can write in this SHARE
    path = /home/samba                 // Specify the directory path for this SHARE
    public = No                        // Guest User can not access (Yes -> No)
    guest ok = No                      // Guest User can not access (Yes -> No)
    guest only = No                    // Guest User can not access (Yes -> No)
  --------------------------------------------------
  
  # cd $HOME
  # testparm (構文チェック)
  
  コマンドの実行結果
  --------------------------------------------------
  Load smb config files from /etc/samba/smb.conf
  Loaded services file OK.      // 構文チェックに異常なし
  Server role: ROLE_STANDALONE  // スタンドアロン
  
  // Enterキー押下で先に進む
  Press enter to see a dump of your service definitions
  
  # Global parameters
  [global]
    domain master = No
    guest account = makoto
    local master = No
    log file = /var/log/samba/%m.log
    max log size = 0
    os level = 10
    passdb backend = smbpasswd
    preferred master = No
    security = USER
    server role = standalone server
    server string = File Server for Windows User
    smb passwd file = /etc/samba/smbpasswd
    idmap config * : backend = tdb
    create mask = 0777
    directory mask = 0777
    hosts allow = 192.168.1. 127.
  
  [share]
    comment = share directory in FS01
    path = /home/samba
    read only = No
  --------------------------------------------------
  
  # cd $HOME
  # systemctl start smb nmb (Sambaサービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
    Sambaクライアントで接続(Sambaユーザー登録済み)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U kate //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122maと入力)
  Try "help" to get a list of possible commands.
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file1.txt

  Put file file1.txt? (yes)
  putting file file1.txt as \file1.txt (0.5 kb/s) (average 0.5 kb/s)
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file2.txt

  Put file file2.txt? (yes)
  putting file file2.txt as \file2.txt (1.0 kb/s) (average 0.7 kb/s)
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd /home/samba
  # ls -lh (共有フォルダの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:29 file1.txt  // 所有者が「Sambaユーザー」通りに設定されている
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:29 file2.txt  // 所有者が「Sambaユーザー」通りに設定されている
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
     Sambaクライアントで接続(Sambaユーザー未登録)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U AAAA //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\AAAA's password: (AAAAと入力) -> 当然ながらOSユーザーにもSambaユーザーにも未登録
  session setup failed: NT_STATUS_LOGON_FAILURE -> Sambaサーバーと接続できなくなる
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
         Windows側から接続(Samba登録ユーザー)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
    
    操作1
    ==================================================
    ネットワークパス「\\FS01\share」にアクセス -> 資格情報ダイアログ、Sambaユーザー(kate)のユーザーとパスワード入力
    ==================================================
    
    操作2
    ==================================================
    共有フォルダ中の「file[1-2].txt」をローカルにダウンロード
    ==================================================
    
    操作3
    ==================================================
    ローカルにコピーしたファイルを元に「file[3-4].txt」を作成
    ==================================================
    
    操作4
    ==================================================
    ファイル「file[1-4].txt」を共有フォルダにアップロード
    ==================================================
    
  # cd /home/samba
  # ls -lh (共有フォルダの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:29 file1.txt
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:29 file2.txt
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:41 file3.txt  // 所有者が「Sambaユーザー」通りに設定されている
  -rwxrw-rw-. 1 kate kate 12  1月 24 18:41 file4.txt  // 所有者が「Sambaユーザー」通りに設定されている
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[03]
  Samba - 03 (ホームディレクトリ)
  
[内容]
  ## 作業内容
    登録ユーザーのホームディレクトリを開放する
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「FS01」のまま
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # Windows用ファイルサーバーに構築する
    USER : root                    # root
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「PC01」のまま
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # ドメイン未参加(WORKGROUP)
    USER : Owner                   # 元々存在していたユーザー(Administrators)
  
  ## 設定情報(Samba)
    DIRECTORY : /home/samba        # サーバー側ディレクトリ
    SHARENAME : share              # 共有名
  
[確認]
  # cd /home/samba
  # rm -f file[1-4].txt (共有フォルダのファイル削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd /etc/samba
  # vi smb.conf (設定ファイルの修正)
  
  コマンドの実行結果
  --------------------------------------------------
  [global]
    workgroup = WORKGROUP                         // This server is WORKGROUP
    server role = STANDALONE                      // This server is not Domain Controller
    netbios name = FS01                           // NetBIOS
    server string = File Server for Windows User  // Description
    hosts allow = 192.168.1. 127.                 // Accessible Hosts
    guest account = makoto                        // Guest behaves as makoto user in Linux
    map to guest = Never                          // Guest login is impossible (Bad User -> Never)
    log file = /var/log/samba/%m.log              // Samba log
    max log size = 0                              // Samba log size is unlimited
    encrypt passwords = Yes                       // Samba use encrypt password
    wins support = No                             // Samba needs no WINS, uses /etc/samba/lmhosts
    security = user                               // Samba needs Linux Account
    passdb backend = smbpasswd                    // Samba stores user data in smbpasswd
    smb passwd file = /etc/samba/smbpasswd        // Smbpasswd file
    create mask = 0777                            // File Permission
    directory mask = 0777                         // Directory Permission
    local master = No                             // Master Browser is not me
    preferred master = No                         // Master Browser is not me
    domain master = No                            // Master Browser is not me
    os level = 10                                 // Master Browser is not me
    
  [homes]
    comment = home directory in FS01   // Description
    browseable = Yes                   // Windows User can browse home directory
    writable = Yes                     // Windows User can write in home directory
    
  [share]
    comment = share directory in FS01  // Description
    browseable = Yes                   // Windows User can browse this SHARE
    writable = Yes                     // Windows User can write in this SHARE
    path = /home/samba                 // Specify the directory path for this SHARE
    public = No                        // Guest User can not access (Yes -> No)
    guest ok = No                      // Guest User can not access (Yes -> No)
    guest only = No                    // Guest User can not access (Yes -> No)
  --------------------------------------------------
  
  # cd $HOME
  # testparm (構文チェック)
  
  コマンドの実行結果
  --------------------------------------------------
  Load smb config files from /etc/samba/smb.conf
  Loaded services file OK.      // 構文チェックに異常なし
  Server role: ROLE_STANDALONE  // スタンドアロン
  
  // Enterキー押下で先に進む
  Press enter to see a dump of your service definitions
  
  # Global parameters
  [global]
    domain master = No
    guest account = makoto
    local master = No
    log file = /var/log/samba/%m.log
    max log size = 0
    os level = 10
    passdb backend = smbpasswd
    preferred master = No
    security = USER
    server role = standalone server
    server string = File Server for Windows User
    smb passwd file = /etc/samba/smbpasswd
    idmap config * : backend = tdb
    create mask = 0777
    directory mask = 0777
    hosts allow = 192.168.1. 127.
  
  [homes]
    comment = home directory in FS01
    read only = No
  
  [share]
    comment = share directory in FS01
    path = /home/samba
    read only = No
  --------------------------------------------------
  
  # cd $HOME
  # systemctl start smb nmb (Sambaサービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
    Sambaクライアントで接続(Sambaユーザー登録済み)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U kate //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122maと入力)
  Try "help" to get a list of possible commands.
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file1.txt

  Put file file1.txt? (yes)
  putting file file1.txt as \file1.txt (0.5 kb/s) (average 0.5 kb/s)
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U kate //FS01/kate (Sambaクライアントでホームディレクトリに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122maと入力)
  Try "help" to get a list of possible commands.
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file2.txt

  Put file file2.txt? (yes)
  putting file file2.txt as \file2.txt (0.5 kb/s) (average 0.5 kb/s)
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U mike //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\mike's password: (mi0122maと入力)
  Try "help" to get a list of possible commands.
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file3.txt
  
  Put file file3.txt? (yes)
  putting file file3.txt as \file3.txt (0.5 kb/s) (average 0.5 kb/s)
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U mike //FS01/mike (Sambaクライアントでホームディレクトリに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\mike's password: (mi0122maと入力)
  Try "help" to get a list of possible commands.
  
  // ファイルを共有フォルダにアップロード
  smb: \> 
  smb: \> mput file4.txt
  
  Put file file4.txt? (yes)
  putting file file4.txt as \file4.txt (0.5 kb/s) (average 0.5 kb/s)
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd /home/samba
  # ls -lh (共有フォルダの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 kate kate 12  1月 24 20:10 file1.txt  // 所有者が「Sambaユーザー」通りに設定されている
  -rwxrw-rw-. 1 mike mike 12  1月 24 20:18 file3.txt  // 所有者が「Sambaユーザー」通りに設定されている
  --------------------------------------------------
  
  # cd /home
  # ls -lh kate mike | grep file (ホームディレクトリの内容を確認)
  
  コマンドの実行結果
  --------------------------------------------------
  -rwxrw-rw-. 1 kate kate 12  1月 24 20:12 file2.txt  // 所有者が「Sambaユーザー」通りに設定されている
  -rwxrw-rw-. 1 mike mike 12  1月 24 20:20 file4.txt  // 所有者が「Sambaユーザー」通りに設定されている
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
         Windows側から接続(Samba登録ユーザー)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
    
    操作1
    ==================================================
    ネットワークパス「\\FS01」にアクセス -> 資格情報ダイアログ、Sambaユーザー(kate)のユーザーとパスワード入力
    ==================================================
    
    操作2
    ==================================================
    フォルダ「homes & kate & share」が表示
    ==================================================
    
    操作3
    ==================================================
    フォルダ「homes & kate」の内容はファイル「file1.txt」-> homes = kate の認識でOK
    ==================================================
    
    操作4
    ==================================================
    フォルダ「share」の内容はファイル「file[2,4].txt」
    ==================================================
    
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[04]
  Samba - 04 (パスワード変更)
  
[内容]
  ## 作業内容
    Sambaユーザーのパスワード変更(複雑化)時に、OSユーザーのパスワードも連動させる
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「FS01」のまま
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # Windows用ファイルサーバーに構築する
    USER : root                    # root
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「PC01」のまま
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # ドメイン未参加(WORKGROUP)
    USER : Owner                   # 元々存在していたユーザー(Administrators)
  
  ## 設定情報(Samba)
    DIRECTORY : /home/samba        # サーバー側ディレクトリ
    SHARENAME : share              # 共有名
  
[確認]
  # cd /home/samba
  # rm -f file[1,3].txt (共有フォルダのファイル削除)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd /etc/samba
  # vi smb.conf (設定ファイルの修正)
  
  コマンドの実行結果
  --------------------------------------------------
  [global]
    workgroup = WORKGROUP                         // This server is WORKGROUP
    server role = STANDALONE                      // This server is not Domain Controller
    netbios name = FS01                           // NetBIOS
    server string = File Server for Windows User  // Description
    hosts allow = 192.168.1. 127.                 // Accessible Hosts
    guest account = makoto                        // Guest behaves as makoto user in Linux
    map to guest = Never                          // Guest login is impossible (Bad User -> Never)
    log file = /var/log/samba/%m.log              // Samba log
    max log size = 0                              // Samba log size is unlimited
    encrypt passwords = Yes                       // Samba use encrypt password
    wins support = No                             // Samba needs no WINS, uses /etc/samba/lmhosts
    security = user                               // Samba needs Linux Account
    passdb backend = smbpasswd                    // Samba stores user data in smbpasswd
    smb passwd file = /etc/samba/smbpasswd        // Smbpasswd file
    unix password sync = Yes                      // Samba user changes password, Linux user password is going to be changed
    passwd program = /bin/passwd %u               // Samba user changes password, Samba uses this program
    passwd chat = *New*password* %n\n *Retype*new*password* %n\n *passwd:*all*authentication*tokens*updated*successfully*
    create mask = 0777                            // File Permission
    directory mask = 0777                         // Directory Permission
    local master = No                             // Master Browser is not me
    preferred master = No                         // Master Browser is not me
    domain master = No                            // Master Browser is not me
    os level = 10                                 // Master Browser is not me
    
  [homes]
    comment = home directory in FS01   // Description
    browseable = Yes                   // Windows User can browse home directory
    writable = Yes                     // Windows User can write in home directory
    
  [share]
    comment = share directory in FS01  // Description
    browseable = Yes                   // Windows User can browse this SHARE
    writable = Yes                     // Windows User can write in this SHARE
    path = /home/samba                 // Specify the directory path for this SHARE
    public = No                        // Guest User can not access (Yes -> No)
    guest ok = No                      // Guest User can not access (Yes -> No)
    guest only = No                    // Guest User can not access (Yes -> No)
  --------------------------------------------------
  
  # cd $HOME
  # testparm (構文チェック)
  
  コマンドの実行結果
  --------------------------------------------------
  Load smb config files from /etc/samba/smb.conf
  Loaded services file OK.      // 構文チェックに異常なし
  Server role: ROLE_STANDALONE  // スタンドアロン
  
  // Enterキー押下で先に進む
  Press enter to see a dump of your service definitions
  
  # Global parameters
  [global]
    domain master = No
    guest account = makoto
    local master = No
    log file = /var/log/samba/%m.log
    max log size = 0
    os level = 10
    passdb backend = smbpasswd
    passwd chat = *New*password* %n\n *Retype*new*password* %n\n *passwd:*all*authentication*tokens*updated*successfully*
    passwd program = /bin/passwd %u
    preferred master = No
    security = USER
    server role = standalone server
    server string = File Server for Windows User
    smb passwd file = /etc/samba/smbpasswd
    unix password sync = Yes
    idmap config * : backend = tdb
    create mask = 0777
    directory mask = 0777
    hosts allow = 192.168.1. 127.
  
  [homes]
    comment = home directory in FS01
    read only = No
  
  [share]
    comment = share directory in FS01
    path = /home/samba
    read only = No
  --------------------------------------------------
  
  # cd $HOME
  # systemctl start smb nmb (Sambaサービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
    
    $ cd $HOME
    $ whoami (OSユーザーの確認)
    
    コマンドの実行結果
    --------------------------------------------------
    makoto
    --------------------------------------------------
    
    $ cd $HOME
    $ LANG=C su - kate (OSユーザー変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Password: (ka0122maと入力)
    --------------------------------------------------
    
    $ cd $HOME
    $ smbpasswd -U kate (Sambaユーザーのパスワード変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Old SMB password: (ka0122maと入力)
    New SMB password: (ka0122ma9310saと入力)
    Retype new SMB password: (ka0122ma9310saと入力)
    Password changed for user kate
    --------------------------------------------------
    
    $ cd $HOME
    $ exit (ログアウト)
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト
    --------------------------------------------------
    
    $ cd $HOME
    $ LANG=C su - mike (OSユーザー変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Password: (mi0122maと入力)
    --------------------------------------------------
    
    $ cd $HOME
    $ smbpasswd -U mike (Sambaユーザーのパスワード変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Old SMB password: (mi0122maと入力)
    New SMB password: (mi0122ma9310saと入力)
    Retype new SMB password: (mi0122ma9310saと入力)
    Password changed for user mike
    --------------------------------------------------
    
    $ cd $HOME
    $ exit (ログアウト)
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト
    --------------------------------------------------
    
    $ cd $HOME
    $ LANG=C su - kate (OSユーザー変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Password: (ka0122ma9310saと入力)
    Last login: Tue Jan 25 10:40:17 JST 2022 on pts/2
    --------------------------------------------------
    
    $ cd $HOME
    $ exit (ログアウト)
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト
    --------------------------------------------------
    
    $ cd $HOME
    $ LANG=C su - mike (OSユーザー変更)
    
    コマンドの実行結果
    --------------------------------------------------
    Password: (mi0122ma9310saと入力)
    Last login: Tue Jan 25 10:51:08 JST 2022 on pts/2
    --------------------------------------------------
    
    $ cd $HOME
    $ exit (ログアウト)
    
    コマンドの実行結果
    --------------------------------------------------
    ログアウト
    --------------------------------------------------
    
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  ==================================================
    Sambaクライアントで接続(Sambaユーザー登録済み)
  ==================================================
  
  # cd $HOME
  # setenforce 0 (SELinuxの無効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> コマンド実行時に権限不足のエラー出力されるのを回避
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U kate //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\kate's password: (ka0122ma9310saと入力)
  Try "help" to get a list of possible commands.
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd $HOME
  # smbclient -U mike //FS01/share (Sambaクライアントで共有フォルダに接続)
  
  コマンドの実行結果
  --------------------------------------------------
  Enter WORKGROUP\mike's password: (mi0122ma9310saと入力)
  Try "help" to get a list of possible commands.
  
  // Sambaクライアント終了
  smb: \> 
  smb: \> exit
  --------------------------------------------------
  
  # cd $HOME
  # setenforce 1 (SELinuxの有効化)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
[05]
  Samba - 05 (マスターブラウザの検索)
  
[内容]
  ## 作業内容
    設定通りにマスターブラウザが「PC01」であるか確認する
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「FS01」のまま
    IPV4 : 192.168.1.3             # DHCP
    MEMO : ノート(CentOS7)         # Windows用ファイルサーバーに構築する
    USER : root                    # root
  
  ## 使用マシン
    HOST : localhost               # ホスト名を「PC01」のまま
    IPV4 : 192.168.1.2             # DHCP
    MEMO : ノート(Windows10)       # ドメイン未参加(WORKGROUP)
    USER : Owner                   # 元々存在していたユーザー(Administrators)
  
  ## 設定情報(Samba)
    DIRECTORY : /home/samba        # サーバー側ディレクトリ
    SHARENAME : share              # 共有名
  
  ## コマンド(nmblookup)
    nmblookup -A XX  // 引数(XX)をIPアドレスと見なす
    nmblookup -M XX  // 引数(XX = WORKGROUP)からマスターブラウザを検索する
  
[確認]
  # cd $HOME
  # systemctl start smb nmb (Sambaサービスの起動)
  
  コマンドの実行結果
  --------------------------------------------------
  (省略) -> 出力なし
  --------------------------------------------------
  
  # cd $HOME
  # nmblookup WORKGROUP (ワークグループの所属ホスト一覧)
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.1.3 WORKGROUP<00>
  192.168.1.2 WORKGROUP<00>
  192.168.1.1 WORKGROUP<00>
  --------------------------------------------------
  
  # cd $HOME
  # nmblookup -M WORKGROUP (マスターブラウザの検索)
  
  コマンドの実行結果
  --------------------------------------------------
  192.168.1.2 WORKGROUP<1d>
  --------------------------------------------------
  
  # cd $HOME
  # nmblookup -A 192.168.1.2 (IPアドレスから逆引き)
  
  コマンドの実行結果
  --------------------------------------------------
  Looking up status of 192.168.1.2
    PC01            <00> -         B <ACTIVE> 
    WORKGROUP       <00> - <GROUP> B <ACTIVE> 
    PC01            <20> -         B <ACTIVE> 
    WORKGROUP       <1e> - <GROUP> B <ACTIVE> 
    WORKGROUP       <1d> -         B <ACTIVE> 
    ..__MSBROWSE__. <01> - <GROUP> B <ACTIVE> 
  
  MAC Address = EC-F4-BB-47-A4-58
  --------------------------------------------------
  
  # cd $HOME
  # nmblookup PC01 (NetBIOS名から正引き)

  コマンドの実行結果
  --------------------------------------------------
  192.168.1.2 PC01<00>
  --------------------------------------------------
  
  以下の確認に続く
  
================================================================================
